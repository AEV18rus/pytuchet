This file is a merged representation of the entire codebase, combined into a single document by Repomix.

<file_summary>
This section contains a summary of this file.

<purpose>
This file contains a packed representation of the entire repository's contents.
It is designed to be easily consumable by AI systems for analysis, code review,
or other automated processes.
</purpose>

<file_format>
The content is organized as follows:
1. This summary section
2. Repository information
3. Directory structure
4. Repository files (if enabled)
5. Multiple file entries, each consisting of:
  - File path as an attribute
  - Full contents of the file
</file_format>

<usage_guidelines>
- This file should be treated as read-only. Any changes should be made to the
  original repository files, not this packed version.
- When processing this file, use the file path to distinguish
  between different files in the repository.
- Be aware that this file may contain sensitive information. Handle it with
  the same level of security as you would the original repository.
</usage_guidelines>

<notes>
- Some files may have been excluded based on .gitignore rules and Repomix's configuration
- Binary files are not included in this packed representation. Please refer to the Repository Structure section for a complete list of file paths, including binary files
- Files matching patterns in .gitignore are excluded
- Files matching default ignore patterns are excluded
- Files are sorted by Git change count (files with more changes are at the bottom)
</notes>

</file_summary>

<directory_structure>
docs/
   vyplata-admin.md
  personal-cabinet-plan.md
public/
  banya-icon.svg
  calendar.svg
  favicon.ico
  file.svg
  globe.svg
  logo.svg
  next.svg
  test-payouts.html
  test.html
  trash.svg
  vercel.svg
  version.json
  window.svg
scripts/
  check-and-create-tables.js
  check-month-status-table.js
  create-fallback-user.js
  create-test-data.js
  create-test-user.js
  debug-month-filtering.js
  fix-month-status-table.js
  init-local-postgres.sql
  init-postgres.js
  init-vercel-postgres.js
  migrate-users-auth-fields.js
  setup-telegram-webhook.js
  test-advance.js
  test-carryover.js
  test-cascading-carryover.js
  test-corrected-payout-logic.js
  test-month-fixes.js
  test-ui-carryover.js
src/
  app/
    account/
      page.tsx
    admin/
      logs/
        page.tsx
      reports/
        page.tsx
      page.tsx
    api/
      admin/
        cleanup-users/
          route.ts
        create-test-shifts/
          route.ts
        create-test-user/
          route.ts
        fix-schema/
          route.ts
        logs/
          route.ts
        month-status/
          route.ts
        month-totals/
          route.ts
        months-with-shifts/
          route.ts
        payouts/
          [id]/
            route.ts
          route.ts
        reports/
          route.ts
        shifts/
          route.ts
      auth/
        login/
          route.ts
        logout/
          route.ts
        me/
          route.ts
        telegram/
          route.ts
      hello/
        route.ts
      init-db/
        route.ts
      payouts/
        [id]/
          route.ts
        route.ts
      prices/
        [id]/
          route.ts
        bulk/
          route.ts
        route.ts
      reports/
        [employeeId]/
          shifts/
            route.ts
        route.ts
      shifts/
        [id]/
          route.ts
        route.ts
      telegram-webhook/
        route.ts
      user/
        profile/
          route.ts
        register/
          route.ts
        set-password/
          route.ts
      users/
        [id]/
          route.ts
        route.ts
      version/
        route.ts
    login/
      page.tsx
    payouts/
      page.tsx
    pricing/
      page.tsx
    register/
      page.tsx
    favicon.ico
    globals.css
    layout.tsx
    page.tsx
  components/
    ui/
      Button.tsx
      Card.tsx
      Icons.tsx
      Input.tsx
      Select.tsx
    Navigation.tsx
    NewPaymentForm.tsx
    PaymentsList.tsx
    TelegramWebApp.tsx
    Toast.tsx
    UserGreeting.tsx
    UserManagement.tsx
    VersionDisplay.tsx
  contexts/
    ServicesContext.tsx
  hooks/
    useTelegramAuth.ts
  lib/
    auth-server.ts
    auth.ts
    db.ts
    global-init.ts
    logging.ts
    password.ts
    rateLimit.ts
    session.ts
    startup.ts
telegram-bot/
  .gitignore
  bot.js
  package.json
  README.md
.gitignore
.vercelignore
cookies.txt
database.db
eslint.config.mjs
FINAL_SETUP_INSTRUCTIONS.md
next.config.ts
package.json
postcss.config.mjs
README_WEBHOOK.md
README.md
shifts.db
TELEGRAM_WEBHOOK_SETUP.md
test_database.db
test-sync.html
tsconfig.json
VERCEL_SETUP.md
vercel.json
version.json
</directory_structure>

<files>
This section contains the contents of the repository's files.

<file path="docs/ vyplata-admin.md">
# –≠—Ç–∞–ø—ã –≤–Ω–µ–¥—Ä–µ–Ω–∏—è –≤—ã–ø–ª–∞—Ç –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º

## –≠—Ç–∞–ø 2. Backend / API
- —Ä–∞—Å—à–∏—Ä–∏—Ç—å –º–æ–¥–µ–ª—å –≤—ã–ø–ª–∞—Ç: `initiated_by`, `initiator_role`, `comment`, `method`, `source`, –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ `reversed_at` –¥–ª—è –æ—Ç–∫–∞—Ç–æ–≤;
- —Å–æ–∑–¥–∞—Ç—å endpoint `POST /api/payouts` (—Ç–æ–ª—å–∫–æ –∞–¥–º–∏–Ω), –∫–æ—Ç–æ—Ä—ã–π –≤–∞–ª–∏–¥–∏—Ä—É–µ—Ç —Å—É–º–º—É, —Ñ–∏–∫—Å–∏—Ä—É–µ—Ç –∑–∞–ø–∏—Å—å –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ–±–Ω–æ–≤–ª—ë–Ω–Ω—ã–π –æ—Å—Ç–∞—Ç–æ–∫;
- –ø–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ –∑–∞–ø—Ä–æ—Å–∞ –ø–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞—Ç—å –∞–≥—Ä–µ–≥–∞—Ç—ã (–æ—Å—Ç–∞—Ç–æ–∫, –∏—Ç–æ–≥–æ) –ª–∏–±–æ –≤ –±–∞–∑–µ, –ª–∏–±–æ –Ω–∞ –ª–µ—Ç—É —á–µ—Ä–µ–∑ —Ç—Ä–∏–≥–≥–µ—Ä/–≤—å—é.

## –≠—Ç–∞–ø 3. –ò—Å—Ç–æ—Ä–∏—è –≤—ã–ø–ª–∞—Ç
- –≤ –æ—Ç—á—ë—Ç–∞—Ö –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –ø–æ—Å–ª–µ–¥–Ω–∏–µ –≤—ã–ø–ª–∞—Ç—ã –ø–æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫—É —Å –ø–æ–º–µ—Ç–∫–æ–π ¬´–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä¬ª/¬´–ú–∞—Å—Ç–µ—Ä¬ª, —Å—É–º–º–æ–π –∏ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–º;
- –≤ –ª–∏—á–Ω–æ–º –∫–∞–±–∏–Ω–µ—Ç–µ –º–∞—Å—Ç–µ—Ä–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–æ—Ç –∂–µ –∏—Å—Ç–æ—á–Ω–∏–∫ –¥–∞–Ω–Ω—ã—Ö, —á—Ç–æ–±—ã –≤–∏–¥–µ—Ç—å –ø–æ–ª–Ω—É—é –∏—Å—Ç–æ—Ä–∏—é –∏ –∫—Ç–æ –∏–Ω–∏—Ü–∏–∏—Ä–æ–≤–∞–ª –∑–∞–ø–∏—Å—å;
- –ø—Ä–µ–¥—É—Å–º–æ—Ç—Ä–µ—Ç—å –æ–ø—Ü–∏—é –æ—Ç–∫–∞—Ç–∞/–ø–æ–º–µ—Ç–∫–∏, –µ—Å–ª–∏ –∞–¥–º–∏–Ω –∏—Å–ø—Ä–∞–≤–ª—è–µ—Ç –æ—à–∏–±–∫—É.

## –≠—Ç–∞–ø 4. –î–æ–≤–æ–¥–∫–∞ UI
- –ø—Ä–∏–≤–µ—Å—Ç–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –∏ —Å—Ç–∞—Ç—É—Å—ã –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ –æ—Ç—á—ë—Ç–æ–≤ –∏ –≤ –õ–ö –∫ –µ–¥–∏–Ω–æ–º—É —Å—Ç–∏–ª—é (toast/–±–∞–Ω–Ω–µ—Ä—ã);
- –¥–æ—Ä–∞–±–æ—Ç–∞—Ç—å –∫–Ω–æ–ø–∫–∏/—Ñ–æ—Ä–º—ã (—Ä–∞–∑–º–µ—Ä—ã, –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å, –º–æ–±–∏–ª—å–Ω–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ), –¥–æ–±–∞–≤–∏—Ç—å –ø–æ–¥—Å–∫–∞–∑–∫–∏ –ø—Ä–∏ –≤–≤–æ–¥–µ –≤—ã–ø–ª–∞—Ç;
- –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ —Å–¥–µ–ª–∞—Ç—å collapse/expand –¥–ª—è –∏—Å—Ç–æ—Ä–∏–∏, —á—Ç–æ–±—ã –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –æ—Å—Ç–∞–≤–∞–ª—Å—è –∫–æ–º–ø–∞–∫—Ç–Ω—ã–º.

## –≠—Ç–∞–ø 5. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ —Ä–µ–ª–∏–∑
- –ø—Ä–æ–≥–Ω–∞—Ç—å —Å—Ü–µ–Ω–∞—Ä–∏–∏: –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤—ã–ø–ª–∞—Ç—ã, –æ—Ç–º–µ–Ω–∞, –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤ –æ—Ç—á—ë—Ç–∞—Ö –∏ –õ–ö –Ω–∞ —Ä–∞–∑–Ω—ã—Ö —à–∏—Ä–∏–Ω–∞—Ö;
- —É–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ API –∑–∞—â–∏—â–µ–Ω—ã –ø—Ä–∞–≤–∞–º–∏ (—Ç–æ–ª—å–∫–æ –∞–¥–º–∏–Ω), –∞ –∑–∞–ø–∏—Å–∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –ø–∏—à—É—Ç—Å—è –≤ –∏—Å—Ç–æ—Ä–∏—é;
- –ø–æ—Å–ª–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å –∫–æ–º–º–∏—Ç –∏ –ø—É—à —Å –æ–ø–∏—Å–∞–Ω–∏–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏–π –∏ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–µ–π –ø–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—é.
</file>

<file path="docs/personal-cabinet-plan.md">
# –ü–ª–∞–Ω: –õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç –∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –ø–æ –ø–∞—Ä–æ–ª—é

## –¶–µ–ª—å
- –î–æ–±–∞–≤–∏—Ç—å –≤—Ö–æ–¥ —á–µ—Ä–µ–∑ –±—Ä–∞—É–∑–µ—Ä –ø–æ –ª–æ–≥–∏–Ω—É –∏ –ø–∞—Ä–æ–ª—é.
- –õ–æ–≥–∏–Ω ‚Äî `username` –∏–∑ Telegram.
- –ü–∞—Ä–æ–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–¥–∞–µ—Ç —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ –≤ –ª–∏—á–Ω–æ–º –∫–∞–±–∏–Ω–µ—Ç–µ.
- –°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å —Ç–µ–∫—É—â–µ–π –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–µ–π —á–µ—Ä–µ–∑ Telegram.

## –¢–µ–∫—É—â–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞
- –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –æ—Å–Ω–æ–≤–∞–Ω–∞ –Ω–∞ `telegram_id` (–∑–∞–≥–æ–ª–æ–≤–æ–∫ `x-telegram-id`).
- Fallback-–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –¥–ª—è –±—Ä–∞—É–∑–µ—Ä–∞ –±–µ–∑ Telegram (`telegram_id = 87654321`).
- –ù–µ—Ç –ø–æ–ª–µ–π –¥–ª—è –ø–∞—Ä–æ–ª—è/—Å–µ—Å—Å–∏–π –≤ –ë–î.
- –•—Ä–∞–Ω–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ `localStorage` –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ; –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è –≤ –ë–î —á–µ—Ä–µ–∑ `/api/user/profile`.

## –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å, –≤–æ—à–µ–¥—à–∏–π —á–µ—Ä–µ–∑ Telegram, –º–æ–∂–µ—Ç —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø–∞—Ä–æ–ª—å.
- –í—Ö–æ–¥ —á–µ—Ä–µ–∑ –±—Ä–∞—É–∑–µ—Ä –ø–æ `username` (–∏–∑ Telegram) + –ø–∞—Ä–æ–ª—å.
- –ë–µ–∑–æ–ø–∞—Å–Ω–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø–∞—Ä–æ–ª–µ–π (bcrypt/argon2).
- –°–µ—Å—Å–∏–∏: –±–µ–∑–æ–ø–∞—Å–Ω—ã–µ `HttpOnly` cookies.
- –ï–¥–∏–Ω–∞—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –¥–ª—è –æ–±–µ–∏—Ö —Å—Ö–µ–º (Telegram –∏ –ø–∞—Ä–æ–ª—å).
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –±–µ–∑ `username` –≤ Telegram (–ø—Ä–µ–¥–ª–æ–∂–∏—Ç—å —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤—É).

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Ä–µ—à–µ–Ω–∏—è

### –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
- –¢–∞–±–ª–∏—Ü–∞ `users`: –¥–æ–±–∞–≤–∏—Ç—å –ø–æ–ª—è
  - `password_hash` (—Å—Ç—Ä–æ–∫–∞, nullable)
  - `password_set_at` (datetime, nullable)
  - `last_login_at` (datetime, nullable)
- –•—ç—à –ø–∞—Ä–æ–ª—è: `bcrypt` —Å –¥–æ—Å—Ç–∞—Ç–æ—á–Ω—ã–º —á–∏—Å–ª–æ–º —Ä–∞—É–Ω–¥–æ–≤ (12+).

### API —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã
- `POST /api/auth/set-password`
  - –¢—Ä–µ–±—É–µ—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é —á–µ—Ä–µ–∑ Telegram (–∑–∞–ª–æ–≥–∏–Ω–µ–Ω –ø–æ `x-telegram-id`).
  - –í–∞–ª–∏–¥–∏—Ä—É–µ—Ç –Ω–æ–≤—ã–π –ø–∞—Ä–æ–ª—å, —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç `password_hash`, –ø—Ä–æ—Å—Ç–∞–≤–ª—è–µ—Ç `password_set_at`.
- `POST /api/auth/login`
  - –í—Ö–æ–¥ –ø–æ `username` + `password`.
  - –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –ë–î, —Å—Ä–∞–≤–Ω–∏–≤–∞–µ—Ç —Ö—ç—à, —Å–æ–∑–¥–∞–µ—Ç —Å–µ—Å—Å–∏—é (cookie).
- `POST /api/auth/logout`
  - –£–¥–∞–ª—è–µ—Ç cookie-—Å–µ—Å—Å–∏—é.
- `GET /api/auth/me`
  - –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø—Ä–æ—Ñ–∏–ª—å –ø–æ cookie-—Å–µ—Å—Å–∏–∏ (–±—Ä–∞—É–∑–µ—Ä) –∏–ª–∏ `x-telegram-id` (Telegram).

### –°–µ—Å—Å–∏–∏ –∏ –∫—É–∫–∏
- Cookie: `HttpOnly`, `Secure` (–≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ), `SameSite=Lax`.
- –°–æ–¥–µ—Ä–∂–∏–º–æ–µ cookie: 
  - –ª–∏–±–æ `session_id` —Å —Å–µ—Ä–≤–µ—Ä–Ω—ã–º —Ö—Ä–∞–Ω–∏–ª–∏—â–µ–º (–ø—Ä–æ—Å—Ç–æ –∏ –≥–∏–±–∫–æ),
  - –ª–∏–±–æ –ø–æ–¥–ø–∏—Å–∞–Ω–Ω—ã–π JWT (–º–∏–Ω–∏–º—É–º: `user_id`, `telegram_id`, `exp`) ‚Äî –∞–∫–∫—É—Ä–∞—Ç–Ω–æ —Å —Ä–µ–≤–æ–∫–∞—Ü–∏–µ–π.
- –ò—Å—Ç–æ—á–Ω–∏–∫ –∏—Å—Ç–∏–Ω—ã –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ ‚Äî —Å–µ—Ä–≤–µ—Ä: Next.js Route Handlers —á–∏—Ç–∞—é—Ç cookie –∏/–∏–ª–∏ `x-telegram-id`.

### –ö–ª–∏–µ–Ω—Ç—Å–∫–∞—è —á–∞—Å—Ç—å
- –°—Ç—Ä–∞–Ω–∏—Ü–∞ `/login`:
  - –ü–æ–ª—è: `username`, `password`, –∫–Ω–æ–ø–∫–∞ –≤—Ö–æ–¥–∞.
  - –£—Å–ø–µ—à–Ω—ã–π –≤—Ö–æ–¥ ‚Äî —Ä–µ–¥–∏—Ä–µ–∫—Ç –≤ –ª–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç.
- –°—Ç—Ä–∞–Ω–∏—Ü–∞ `/account/security`:
  - –î–ª—è Telegram-–∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö: —Ñ–æ—Ä–º–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∏/—Å–º–µ–Ω—ã –ø–∞—Ä–æ–ª—è.
  - –ü–æ–∫–∞–∑ —Å–æ—Å—Ç–æ—è–Ω–∏—è: –ø–∞—Ä–æ–ª—å —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω/–Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω, –¥–∞—Ç–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∏.
- –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏:
  - –î–æ–±–∞–≤–∏—Ç—å –ø–æ–¥–¥–µ—Ä–∂–∫—É cookie-—Å–µ—Å—Å–∏–∏ –≤ `useTelegramAuth` (–æ–ø—Ä–µ–¥–µ–ª—è—Ç—å, –≤–æ—à–µ–ª –ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —á–µ—Ä–µ–∑ –±—Ä–∞—É–∑–µ—Ä).
  - –ï–¥–∏–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å `isAuthenticated`, `user`, `logout`.

### –û–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ —Å—Ö–µ–º –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
- `requireAuth` –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ:
  - –ü—ã—Ç–∞–µ—Ç—Å—è —Å–Ω–∞—á–∞–ª–∞ cookie-—Å–µ—Å—Å–∏—é.
  - –ï—Å–ª–∏ –Ω–µ—Ç ‚Äî fallback –Ω–∞ –∑–∞–≥–æ–ª–æ–≤–æ–∫ `x-telegram-id`.
- –ê–¥–º–∏–Ω/–∑–∞—â–∏—â–µ–Ω–Ω—ã–µ API:
  - –ò—Å–ø–æ–ª—å–∑—É—é—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π `requireAuth`.

## –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
- –ü–∞—Ä–æ–ª–∏: `bcrypt` (12+), –∑–∞–ø—Ä–µ—Ç —Å–ª–∞–±—ã—Ö –ø–∞—Ä–æ–ª–µ–π, –º–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –¥–ª–∏–Ω–∞ (–Ω–µ –º–µ–Ω–µ–µ 8).
- –ë—Ä—É—Ç—Ñ–æ—Ä—Å: rate limiting –¥–ª—è `/api/auth/login`.
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–ø—ã—Ç–æ–∫ –≤—Ö–æ–¥–∞ (—É—Ä–æ–≤–µ–Ω—å `info/warn/error`), –±–µ–∑ –∑–∞–ø–∏—Å–∏ –ø–∞—Ä–æ–ª–µ–π.
- CSRF: –¥–ª—è cookie-—Å–µ—Å—Å–∏–π –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `SameSite=Lax`; –∫—Ä–∏—Ç–∏—á–Ω—ã–µ —Ñ–æ—Ä–º—ã –º–æ–∂–Ω–æ –∑–∞—â–∏—Ç–∏—Ç—å CSRF-—Ç–æ–∫–µ–Ω–æ–º.
- –û—à–∏–±–∫–∏: –µ–¥–∏–Ω–æ–æ–±—Ä–∞–∑–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è, –±–µ–∑ —É—Ç–µ—á–∫–∏ –¥–µ—Ç–∞–ª–µ–π (–Ω–∞–ø—Ä–∏–º–µ—Ä, ‚Äú–ù–µ–≤–µ—Ä–Ω—ã–µ —É—á–µ—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ‚Äù).

## UX –¥–µ—Ç–∞–ª–∏ –∏ –∫—Ä–∞–π–Ω–∏–µ —Å–ª—É—á–∞–∏
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –±–µ–∑ `username` –≤ Telegram:
  - –í `/account/security` –ø–æ–∫–∞–∑–∞—Ç—å –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –∏ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—é –∫–∞–∫ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å `username` –≤ Telegram, 
  - –ª–∏–±–æ –ø—Ä–µ–¥–ª–æ–∂–∏—Ç—å –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–æ–µ –ø–æ–ª–µ –ª–æ–≥–∏–Ω–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, `display_name` –∏–ª–∏ `telegram_id` –ø–æ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏—é).
- –°–º–µ–Ω–∞ –ø–∞—Ä–æ–ª—è:
  - –¢—Ä–µ–±–æ–≤–∞—Ç—å –≤–≤–æ–¥ —Ç–µ–∫—É—â–µ–≥–æ –ø–∞—Ä–æ–ª—è –ø—Ä–∏ –µ–≥–æ –Ω–∞–ª–∏—á–∏–∏.
  - –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ–± —É—Å–ø–µ—à–Ω–æ–π —Å–º–µ–Ω–µ.
- –õ–æ–≥–∞—É—Ç:
  - –ö–Ω–æ–ø–∫–∞ –≤ —à–∞–ø–∫–µ/–º–µ–Ω—é, –æ—á–∏—â–∞–µ—Ç cookie + –ª–æ–∫–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ.

## –ö—Ä–∏—Ç–µ—Ä–∏–∏ –ø—Ä–∏–µ–º–∫–∏
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —á–µ—Ä–µ–∑ Telegram –º–æ–∂–µ—Ç —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø–∞—Ä–æ–ª—å.
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –≤–æ–π—Ç–∏ —á–µ—Ä–µ–∑ `/login` –ø–æ `username` + –ø–∞—Ä–æ–ª—å.
- –ü–æ—Å–ª–µ –≤—Ö–æ–¥–∞ —á–µ—Ä–µ–∑ –±—Ä–∞—É–∑–µ—Ä —Å—Ç—Ä–∞–Ω–∏—Ü—ã –∑–∞—â–∏—â–µ–Ω–Ω—ã–µ –¥–æ—Å—Ç—É–ø–Ω—ã.
- –õ–æ–≥–∞—É—Ç –æ—á–∏—â–∞–µ—Ç —Å–µ—Å—Å–∏—é.
- –û—à–∏–±–∫–∏ –∏ –≤–∞–ª–∏–¥–∞—Ç–æ—Ä—ã —Ä–∞–±–æ—Ç–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ (—Å–ª–∞–±—ã–µ –ø–∞—Ä–æ–ª–∏ –æ—Ç–∫–ª–æ–Ω—è—é—Ç—Å—è).
- –õ–æ–≥–∏ —Å–æ–¥–µ—Ä–∂–∞—Ç –ø–æ–ª–µ–∑–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –±–µ–∑ —É—Ç–µ—á–∫–∏ —Å–µ–∫—Ä–µ—Ç–æ–≤.

## –ü–ª–∞–Ω —Ä–∞–±–æ—Ç (–∏—Ç–µ—Ä–∞—Ü–∏–∏)

1) –ú–∏–≥—Ä–∞—Ü–∏–∏ –ë–î
- –î–æ–±–∞–≤–∏—Ç—å –ø–æ–ª—è `password_hash`, `password_set_at`, `last_login_at`.
- –û–±–Ω–æ–≤–∏—Ç—å —Å–ª–æ–π `db.ts` –¥–ª—è —á—Ç–µ–Ω–∏—è/–∑–∞–ø–∏—Å–∏ —ç—Ç–∏—Ö –ø–æ–ª–µ–π.

2) –°–µ—Ä–≤–µ—Ä–Ω—ã–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã
- `POST /api/auth/set-password` (—Ç–æ–ª—å–∫–æ Telegram-–∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–º).
- `POST /api/auth/login`, `POST /api/auth/logout`, `GET /api/auth/me`.
- –û–±–Ω–æ–≤–∏—Ç—å `requireAuth` –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏ cookie.

3) –ö–ª–∏–µ–Ω—Ç—Å–∫–∏–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
- `/login` ‚Äî —Ñ–æ—Ä–º–∞ –≤—Ö–æ–¥–∞.
- `/account/security` ‚Äî —É—Å—Ç–∞–Ω–æ–≤–∫–∞/—Å–º–µ–Ω–∞ –ø–∞—Ä–æ–ª—è.

4) –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è
- –û–±–Ω–æ–≤–∏—Ç—å `useTelegramAuth` –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π —Ä–∞–±–æ—Ç—ã —Å cookie-—Å–µ—Å—Å–∏–µ–π.
- –û–±–Ω–æ–≤–∏—Ç—å –∑–∞—â–∏—â–µ–Ω–Ω—ã–µ API/—Å—Ç—Ä–∞–Ω–∏—Ü—ã –Ω–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –æ–±–Ω–æ–≤–ª–µ–Ω–Ω–æ–≥–æ `requireAuth`.

5) –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∏ –ø–æ–ª–∏—Ä–æ–≤–∫–∞
- Rate limiting, —É–ª—É—á—à–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π –æ—à–∏–±–æ–∫, UX –¥–ª—è –æ—Ç—Å—É—Ç—Å—Ç–≤–∏—è `username`.
- –ñ—É—Ä–Ω–∞–ª—ã —Å–æ–±—ã—Ç–∏–π –≤—Ö–æ–¥–∞/–≤—ã—Ö–æ–¥–∞.

## –û—Ü–µ–Ω–∫–∞ —Ä–∏—Å–∫–æ–≤
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –±–µ–∑ `username` –≤ Telegram ‚Äî –Ω—É–∂–µ–Ω UX/–∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞.
- –°–º–µ—à–µ–Ω–∏–µ –¥–≤—É—Ö —Å—Ö–µ–º –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ ‚Äî —Ç–µ—Å—Ç—ã –Ω–∞ –∫–æ–Ω—Ñ–ª–∏–∫—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–π.
- –•—Ä–∞–Ω–µ–Ω–∏–µ —Å–µ—Å—Å–∏–π ‚Äî –æ–±–µ—Å–ø–µ—á–∏—Ç—å –æ—á–∏—Å—Ç–∫—É/—Ä–µ–≤–æ–∫–∞—Ü–∏—é –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏.

## –†–µ—à–µ–Ω–∏—è –ø–æ–¥ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏–µ
- –°–ø–æ—Å–æ–± —Ö—Ä–∞–Ω–µ–Ω–∏—è —Å–µ—Å—Å–∏–π: cookie + `session_id` (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é) –∏–ª–∏ JWT.
- –ü–æ–ª–∏—Ç–∏–∫–∞ –ø–∞—Ä–æ–ª–µ–π: –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è (–¥–ª–∏–Ω–∞, —Å–ª–æ–∂–Ω–æ—Å—Ç—å).
- –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π –ª–æ–≥–∏–Ω –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –±–µ–∑ Telegram `username`.
</file>

<file path="public/banya-icon.svg">
<svg width="80" height="80" viewBox="0 0 80 80" fill="none" xmlns="http://www.w3.org/2000/svg">
  <!-- –ü–∞—Ä -->
  <path d="M20 25C20 25 22 20 25 22C28 24 26 28 26 28" stroke="#f5f1e8" stroke-width="2" stroke-linecap="round" opacity="0.8"/>
  <path d="M30 20C30 20 32 15 35 17C38 19 36 23 36 23" stroke="#f5f1e8" stroke-width="2" stroke-linecap="round" opacity="0.6"/>
  <path d="M45 25C45 25 47 20 50 22C53 24 51 28 51 28" stroke="#f5f1e8" stroke-width="2" stroke-linecap="round" opacity="0.8"/>
  
  <!-- –û—Å–Ω–æ–≤–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –±–∞–Ω–∏ -->
  <rect x="15" y="35" width="50" height="30" rx="3" fill="#f5f1e8" stroke="#d4c4a8" stroke-width="2"/>
  
  <!-- –ö—Ä—ã—à–∞ -->
  <path d="M10 35L40 20L70 35H10Z" fill="#d4c4a8" stroke="#b8a082" stroke-width="2"/>
  
  <!-- –î–≤–µ—Ä—å -->
  <rect x="35" y="45" width="10" height="20" rx="1" fill="#b8a082" stroke="#9d8566" stroke-width="1"/>
  <circle cx="42" cy="55" r="1" fill="#9d8566"/>
  
  <!-- –û–∫–Ω–æ -->
  <rect x="20" y="45" width="8" height="8" rx="1" fill="#e8dcc0" stroke="#d4c4a8" stroke-width="1"/>
  <line x1="24" y1="45" x2="24" y2="53" stroke="#d4c4a8" stroke-width="1"/>
  <line x1="20" y1="49" x2="28" y2="49" stroke="#d4c4a8" stroke-width="1"/>
  
  <!-- –í–µ–Ω–∏–∫ -->
  <g transform="translate(52, 40)">
    <!-- –†—É—á–∫–∞ -->
    <line x1="0" y1="0" x2="12" y2="15" stroke="#8b4513" stroke-width="2" stroke-linecap="round"/>
    <!-- –õ–∏—Å—Ç—å—è -->
    <ellipse cx="2" cy="2" rx="3" ry="6" fill="#228b22" opacity="0.8" transform="rotate(-30)"/>
    <ellipse cx="4" cy="1" rx="2.5" ry="5" fill="#32cd32" opacity="0.7" transform="rotate(-20)"/>
    <ellipse cx="6" cy="3" rx="3" ry="5.5" fill="#228b22" opacity="0.8" transform="rotate(-40)"/>
  </g>
  
  <!-- –ö–æ–≤—à -->
  <g transform="translate(18, 60)">
    <ellipse cx="0" cy="0" rx="4" ry="2" fill="#8b4513"/>
    <line x1="-4" y1="0" x2="-8" y2="-3" stroke="#8b4513" stroke-width="2" stroke-linecap="round"/>
  </g>
</svg>
</file>

<file path="public/calendar.svg">
<svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
  <rect x="3" y="4" width="18" height="18" rx="2" ry="2" stroke="currentColor" stroke-width="2" fill="none"/>
  <line x1="16" y1="2" x2="16" y2="6" stroke="currentColor" stroke-width="2"/>
  <line x1="8" y1="2" x2="8" y2="6" stroke="currentColor" stroke-width="2"/>
  <line x1="3" y1="10" x2="21" y2="10" stroke="currentColor" stroke-width="2"/>
  <circle cx="8" cy="14" r="1" fill="currentColor"/>
  <circle cx="12" cy="14" r="1" fill="currentColor"/>
  <circle cx="16" cy="14" r="1" fill="currentColor"/>
  <circle cx="8" cy="18" r="1" fill="currentColor"/>
  <circle cx="12" cy="18" r="1" fill="currentColor"/>
</svg>
</file>

<file path="public/file.svg">
<svg fill="none" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg"><path d="M14.5 13.5V5.41a1 1 0 0 0-.3-.7L9.8.29A1 1 0 0 0 9.08 0H1.5v13.5A2.5 2.5 0 0 0 4 16h8a2.5 2.5 0 0 0 2.5-2.5m-1.5 0v-7H8v-5H3v12a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1M9.5 5V2.12L12.38 5zM5.13 5h-.62v1.25h2.12V5zm-.62 3h7.12v1.25H4.5zm.62 3h-.62v1.25h7.12V11z" clip-rule="evenodd" fill="#666" fill-rule="evenodd"/></svg>
</file>

<file path="public/globe.svg">
<svg fill="none" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><g clip-path="url(#a)"><path fill-rule="evenodd" clip-rule="evenodd" d="M10.27 14.1a6.5 6.5 0 0 0 3.67-3.45q-1.24.21-2.7.34-.31 1.83-.97 3.1M8 16A8 8 0 1 0 8 0a8 8 0 0 0 0 16m.48-1.52a7 7 0 0 1-.96 0H7.5a4 4 0 0 1-.84-1.32q-.38-.89-.63-2.08a40 40 0 0 0 3.92 0q-.25 1.2-.63 2.08a4 4 0 0 1-.84 1.31zm2.94-4.76q1.66-.15 2.95-.43a7 7 0 0 0 0-2.58q-1.3-.27-2.95-.43a18 18 0 0 1 0 3.44m-1.27-3.54a17 17 0 0 1 0 3.64 39 39 0 0 1-4.3 0 17 17 0 0 1 0-3.64 39 39 0 0 1 4.3 0m1.1-1.17q1.45.13 2.69.34a6.5 6.5 0 0 0-3.67-3.44q.65 1.26.98 3.1M8.48 1.5l.01.02q.41.37.84 1.31.38.89.63 2.08a40 40 0 0 0-3.92 0q.25-1.2.63-2.08a4 4 0 0 1 .85-1.32 7 7 0 0 1 .96 0m-2.75.4a6.5 6.5 0 0 0-3.67 3.44 29 29 0 0 1 2.7-.34q.31-1.83.97-3.1M4.58 6.28q-1.66.16-2.95.43a7 7 0 0 0 0 2.58q1.3.27 2.95.43a18 18 0 0 1 0-3.44m.17 4.71q-1.45-.12-2.69-.34a6.5 6.5 0 0 0 3.67 3.44q-.65-1.27-.98-3.1" fill="#666"/></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h16v16H0z"/></clipPath></defs></svg>
</file>

<file path="public/next.svg">
<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 394 80"><path fill="#000" d="M262 0h68.5v12.7h-27.2v66.6h-13.6V12.7H262V0ZM149 0v12.7H94v20.4h44.3v12.6H94v21h55v12.6H80.5V0h68.7zm34.3 0h-17.8l63.8 79.4h17.9l-32-39.7 32-39.6h-17.9l-23 28.6-23-28.6zm18.3 56.7-9-11-27.1 33.7h17.8l18.3-22.7z"/><path fill="#000" d="M81 79.3 17 0H0v79.3h13.6V17l50.2 62.3H81Zm252.6-.4c-1 0-1.8-.4-2.5-1s-1.1-1.6-1.1-2.6.3-1.8 1-2.5 1.6-1 2.6-1 1.8.3 2.5 1a3.4 3.4 0 0 1 .6 4.3 3.7 3.7 0 0 1-3 1.8zm23.2-33.5h6v23.3c0 2.1-.4 4-1.3 5.5a9.1 9.1 0 0 1-3.8 3.5c-1.6.8-3.5 1.3-5.7 1.3-2 0-3.7-.4-5.3-1s-2.8-1.8-3.7-3.2c-.9-1.3-1.4-3-1.4-5h6c.1.8.3 1.6.7 2.2s1 1.2 1.6 1.5c.7.4 1.5.5 2.4.5 1 0 1.8-.2 2.4-.6a4 4 0 0 0 1.6-1.8c.3-.8.5-1.8.5-3V45.5zm30.9 9.1a4.4 4.4 0 0 0-2-3.3 7.5 7.5 0 0 0-4.3-1.1c-1.3 0-2.4.2-3.3.5-.9.4-1.6 1-2 1.6a3.5 3.5 0 0 0-.3 4c.3.5.7.9 1.3 1.2l1.8 1 2 .5 3.2.8c1.3.3 2.5.7 3.7 1.2a13 13 0 0 1 3.2 1.8 8.1 8.1 0 0 1 3 6.5c0 2-.5 3.7-1.5 5.1a10 10 0 0 1-4.4 3.5c-1.8.8-4.1 1.2-6.8 1.2-2.6 0-4.9-.4-6.8-1.2-2-.8-3.4-2-4.5-3.5a10 10 0 0 1-1.7-5.6h6a5 5 0 0 0 3.5 4.6c1 .4 2.2.6 3.4.6 1.3 0 2.5-.2 3.5-.6 1-.4 1.8-1 2.4-1.7a4 4 0 0 0 .8-2.4c0-.9-.2-1.6-.7-2.2a11 11 0 0 0-2.1-1.4l-3.2-1-3.8-1c-2.8-.7-5-1.7-6.6-3.2a7.2 7.2 0 0 1-2.4-5.7 8 8 0 0 1 1.7-5 10 10 0 0 1 4.3-3.5c2-.8 4-1.2 6.4-1.2 2.3 0 4.4.4 6.2 1.2 1.8.8 3.2 2 4.3 3.4 1 1.4 1.5 3 1.5 5h-5.8z"/></svg>
</file>

<file path="public/test-payouts.html">
<!DOCTYPE html>
<html>
<head>
    <title>Test Payouts API - Optimized</title>
</head>
<body>
    <h1>Test Payouts API - Optimized Version</h1>
    <div id="result">Loading...</div>
    <div id="timing"></div>
    
    <script>
        async function testPayoutsAPI() {
            const startTime = performance.now();
            try {
                console.log('Fetching payouts...');
                const response = await fetch('/api/payouts', {
                    headers: {
                        'x-telegram-id': '87654321'
                    }
                });
                
                const endTime = performance.now();
                const duration = endTime - startTime;
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const data = await response.json();
                console.log('Payouts data:', data);
                
                document.getElementById('result').innerHTML = `
                    <h2>Success!</h2>
                    <p><strong>Response time:</strong> ${duration.toFixed(2)}ms</p>
                    <p><strong>Months found:</strong> ${data.months ? data.months.length : 0}</p>
                    <pre>${JSON.stringify(data, null, 2)}</pre>
                `;
                
                document.getElementById('timing').innerHTML = `
                    <h3>Performance:</h3>
                    <p>API response time: ${duration.toFixed(2)}ms</p>
                `;
            } catch (error) {
                const endTime = performance.now();
                const duration = endTime - startTime;
                
                console.error('Error:', error);
                document.getElementById('result').innerHTML = `
                    <h2>Error!</h2>
                    <p><strong>Time to error:</strong> ${duration.toFixed(2)}ms</p>
                    <p>${error.message}</p>
                `;
            }
        }
        
        // Test the API when page loads
        testPayoutsAPI();
    </script>
</body>
</html>
</file>

<file path="public/test.html">
<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–µ—Å—Ç - –ü—É—Ç—ë–≤–æ–π —É—á—ë—Ç</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            text-align: center;
        }
        .status {
            background: #e8f5e8;
            padding: 15px;
            border-radius: 5px;
            margin: 20px 0;
        }
        .test-link {
            display: inline-block;
            background: #007bff;
            color: white;
            padding: 10px 20px;
            text-decoration: none;
            border-radius: 5px;
            margin: 10px 5px;
        }
        .test-link:hover {
            background: #0056b3;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üöÄ –¢–µ—Å—Ç–æ–≤–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ - –ü—É—Ç—ë–≤–æ–π —É—á—ë—Ç</h1>
        
        <div class="status">
            <h3>‚úÖ –°—Ç–∞—Ç—É—Å —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è:</h3>
            <p>–≠—Ç–∞ —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ —É—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è —Å Vercel!</p>
            <p>–í—Ä–µ–º—è –∑–∞–≥—Ä—É–∑–∫–∏: <span id="loadTime"></span></p>
        </div>
        
        <h3>üîó –¢–µ—Å—Ç–æ–≤—ã–µ —Å—Å—ã–ª–∫–∏:</h3>
        <a href="/" class="test-link">–ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ Next.js</a>
        <a href="/api/hello" class="test-link">API —Ç–µ—Å—Ç</a>
        
        <h3>üìã –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø—Ä–æ–µ–∫—Ç–µ:</h3>
        <ul>
            <li>Framework: Next.js 15</li>
            <li>Hosting: Vercel</li>
            <li>Region: Frankfurt (fra1)</li>
            <li>Build: Standalone</li>
        </ul>
        
        <div style="margin-top: 30px; padding: 15px; background: #f8f9fa; border-radius: 5px;">
            <small>
                <strong>–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞:</strong> –ï—Å–ª–∏ –≤—ã –≤–∏–¥–∏—Ç–µ —ç—Ç—É —Å—Ç—Ä–∞–Ω–∏—Ü—É, –∑–Ω–∞—á–∏—Ç Vercel —É—Å–ø–µ—à–Ω–æ –æ–±—Å–ª—É–∂–∏–≤–∞–µ—Ç —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ñ–∞–π–ª—ã. 
                –ï—Å–ª–∏ –≥–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ Next.js –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç, –ø—Ä–æ–±–ª–µ–º–∞ –≤ —Å–±–æ—Ä–∫–µ –∏–ª–∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ Next.js.
            </small>
        </div>
    </div>
    
    <script>
        document.getElementById('loadTime').textContent = new Date().toLocaleString('ru-RU');
    </script>
</body>
</html>
</file>

<file path="public/trash.svg">
<?xml version="1.0" encoding="UTF-8"?>
<svg version="1.1" xmlns="http://www.w3.org/2000/svg" width="1024" height="1024">
<path d="M0 0 C4.62803031 1.85121213 6.5619111 4.73397886 9 9 C9.49745268 12.27629989 9.49745268 12.27629989 9.49384212 15.90321255 C9.49864789 16.57663442 9.50345366 17.25005629 9.50840506 17.94388488 C9.51964967 20.19902162 9.50241675 22.4530278 9.4853363 24.70811462 C9.48763122 26.34172837 9.49169565 27.97534043 9.49737698 29.60894591 C9.5079521 34.09703362 9.49370407 38.58475368 9.47551024 43.07280433 C9.46029013 47.91337551 9.46821519 52.7539133 9.47354126 57.59449768 C9.47981373 65.98237605 9.47203874 74.37014645 9.45528984 82.75800896 C9.4315158 94.89308767 9.43446308 107.02804991 9.44491828 119.16314215 C9.46162713 138.86129241 9.46418517 158.55941404 9.4543457 178.25756836 C9.45376276 179.43662263 9.45317982 180.61567689 9.45257921 181.83046008 C9.44585017 194.9864827 9.43677765 208.14250285 9.42626953 221.29852295 C9.42252954 226.06970209 9.41886997 230.84088129 9.4152832 235.61206055 C9.41439229 236.78937663 9.41350137 237.96669272 9.41258346 239.17968505 C9.3982979 258.80259435 9.40340625 278.4254483 9.42320591 298.0483523 C9.43454085 310.15448998 9.42872627 322.26038801 9.40092707 334.36650027 C9.3830537 342.65964073 9.38288488 350.95265905 9.39671569 359.24580687 C9.40407857 364.03255604 9.40315223 368.81893922 9.38043022 373.60564804 C9.35976883 377.98717272 9.36204546 382.36806292 9.38258684 386.7495826 C9.38593 388.33498736 9.38079381 389.92043729 9.36634438 391.50577974 C8.88155689 401.86663117 8.88155689 401.86663117 13.23362571 410.80022997 C21.05695808 416.11405264 31.25811712 415.41669969 40.29730225 415.34298706 C41.7166135 415.34231153 43.13592588 415.34295605 44.5552361 415.34479439 C48.42772464 415.34598676 52.29992968 415.3284473 56.17235398 415.30763102 C60.35909256 415.28842903 64.54584458 415.28674587 68.73262024 415.28276062 C76.9224581 415.27213666 85.11216364 415.2451929 93.3019394 415.21233229 C99.957787 415.18592729 106.61362834 415.1654828 113.26950836 415.14926529 C114.21794582 415.14694963 115.16638327 415.14463397 116.14356126 415.14224813 C118.07043523 415.13756984 119.99730924 415.13290548 121.92418328 415.12825491 C139.97442779 415.08399666 158.02457144 415.02122143 176.07473531 414.95204844 C191.56005827 414.89313267 207.04535982 414.84998622 222.53076172 414.81835938 C240.5240365 414.78160243 258.51724334 414.73519228 276.5104506 414.67330945 C278.42888526 414.66673729 280.34731996 414.66017719 282.2657547 414.6536293 C283.68154466 414.6487889 283.68154466 414.6487889 285.12593643 414.64385071 C291.77525312 414.62178003 298.4245651 414.60660217 305.07390594 414.59408188 C313.17479476 414.57863734 321.27556624 414.55256513 329.37637392 414.51287393 C333.50888748 414.49289168 337.64127164 414.4776695 341.77383614 414.47536659 C345.55739976 414.47312129 349.34064654 414.45709759 353.1241124 414.43012632 C355.13949122 414.41929706 357.15493225 414.42308285 359.17033553 414.42740333 C365.49583877 414.36790029 370.49820993 414.28006003 376 411 C380.12213305 405.7930951 381.12463759 402.02160461 381.13028526 395.49157906 C381.13222869 394.82439627 381.13417212 394.15721349 381.13617444 393.46981305 C381.14151886 391.21822952 381.13972865 388.96670686 381.13803101 386.71511841 C381.140448 385.09092066 381.14330994 383.46672352 381.14658034 381.84252727 C381.15435031 377.36673518 381.15595365 372.89095842 381.15663147 368.41516042 C381.15846817 363.59298182 381.16607326 358.77081224 381.17311096 353.94863892 C381.18464658 345.5885746 381.19288562 337.22851231 381.19923019 328.86844254 C381.20954431 315.66007401 381.23010434 302.45173074 381.25234985 289.24337769 C381.25982984 284.72712144 381.26724352 280.21086508 381.27463722 275.69460869 C381.27741307 274.00154575 381.27741307 274.00154575 381.280245 272.27427951 C381.30117997 259.42064843 381.32000494 246.56701456 381.33789062 233.71337891 C381.33952881 232.53808474 381.34116699 231.36279058 381.34285481 230.15188144 C381.36914942 211.09860067 381.3877872 192.04531795 381.40448253 172.9920267 C381.42188863 153.44380019 381.45071767 133.89561184 381.4893719 114.3474158 C381.51280095 102.28223683 381.52676908 90.21712006 381.52869953 78.15191816 C381.53080507 69.88727205 381.54370207 61.62268787 381.56517886 53.35806955 C381.57723487 48.58586517 381.58434129 43.81378378 381.57846642 39.04156494 C381.57318768 34.67556079 381.58159067 30.30980797 381.60102279 25.94384585 C381.60561374 24.36176396 381.6051069 22.77965764 381.59907441 21.19758059 C381.59161959 19.05145126 381.60249857 16.90617131 381.61803246 14.76010323 C381.61938898 13.56674956 381.62074551 12.3733959 381.62214315 11.14388001 C382.15696042 6.69404316 383.74128909 4.07360636 387.125 1.1875 C391.17857843 -0.48680413 394.67711329 -0.6621323 399 0 C402.4375 1.5 402.4375 1.5 405 4 C407.77326214 11.68326662 407.27895668 19.71751866 407.25396729 27.77658081 C407.25627321 29.3932815 407.25945062 31.00998113 407.26342177 32.62667859 C407.27176045 37.05874321 407.26764868 41.49072156 407.26144934 45.92278647 C407.256922 50.70680049 407.26391006 55.49079972 407.26940918 60.27481079 C407.27830221 69.64311668 407.27638144 79.01139052 407.2705839 88.37969767 C407.26606653 95.99479425 407.26545484 103.60988186 407.26763153 111.2249794 C407.267938 112.30894986 407.26824446 113.39292032 407.26856022 114.50973836 C407.26919967 116.71185278 407.2698481 118.9139672 407.2705054 121.11608161 C407.27620857 141.76589393 407.26965128 162.41568849 407.25890467 183.06549789 C407.2499717 200.77853744 407.25151913 218.49155077 407.26074219 236.20458984 C407.2714494 256.77758406 407.27565658 277.3505627 407.26951766 297.92355931 C407.26888057 300.11816923 407.26825183 302.31277915 407.26763153 304.50738907 C407.26732298 305.58715327 407.26701443 306.66691747 407.26669653 307.7794018 C407.26497076 315.38307826 407.26788221 322.98674484 407.27259064 330.59041977 C407.27820458 339.86017575 407.2766723 349.12989786 407.26602915 358.39964996 C407.26077899 363.12793552 407.25870451 367.85616465 407.26532745 372.58444977 C407.27130271 376.91591652 407.2679858 381.24727472 407.25737235 385.57873167 C407.25514497 387.14258904 407.25625968 388.70645565 407.26112393 390.27030705 C407.30770597 406.49573272 405.67077782 417.71079497 394.26953125 429.73828125 C384.67321312 439.30156558 372.21398769 441.42543984 358.98997056 441.53031152 C357.0318994 441.51590402 357.0318994 441.51590402 355.03427124 441.50120544 C353.59102954 441.50510986 352.14779172 441.51075935 350.70456278 441.51797634 C346.78426133 441.5325852 342.86436752 441.52263788 338.94407988 441.50823963 C334.6986374 441.49704995 330.45324842 441.50909857 326.20780945 441.51808167 C317.90956906 441.53196138 309.61148162 441.52449741 301.31324862 441.50940608 C291.63712105 441.49248343 281.96103091 441.49576405 272.28489311 441.49950016 C255.01444223 441.50536893 237.74406443 441.491245 220.47363281 441.46655273 C203.73760236 441.44262743 187.00166949 441.43555265 170.265625 441.44604492 C152.01226706 441.45746804 133.75895417 441.45936755 115.50559676 441.44494683 C113.55734675 441.44342108 111.60909673 441.44190073 109.66084671 441.44038582 C108.7024263 441.439628 107.74400589 441.43887019 106.75654244 441.43808941 C100.02081775 441.43335794 93.28511326 441.43518988 86.54938889 441.43945122 C78.33607585 441.44439045 70.12285484 441.4383374 61.90956281 441.41855692 C57.72360311 441.40872215 53.53778321 441.40353836 49.35181618 441.41144943 C45.5126178 441.41855644 41.67370026 441.41158573 37.83453865 441.3938458 C35.80387791 441.38794761 33.77319056 441.39657494 31.74254262 441.40589231 C17.39498402 441.30762988 4.41056025 438.63200922 -6.375 428.6953125 C-17.73588027 416.84285568 -18.60634632 400.80467197 -18.50120544 385.23446655 C-18.50510887 383.60800716 -18.51075759 381.9815512 -18.51797634 380.35510314 C-18.53259794 375.93329517 -18.5226301 371.51184816 -18.50823963 367.09005237 C-18.49705815 362.30351772 -18.5090956 357.51703078 -18.51808167 352.73049927 C-18.53196439 343.37528999 -18.52449634 334.02021633 -18.50940608 324.6650136 C-18.49249768 313.76598076 -18.49576201 302.86698124 -18.49950016 291.96793933 C-18.50536891 272.52596216 -18.49124214 253.08404991 -18.46655273 233.64208984 C-18.44260176 214.77943493 -18.43556258 195.91686662 -18.44604492 177.05419922 C-18.45744999 156.49436067 -18.45939184 135.93456209 -18.44494683 115.37472403 C-18.44342101 113.18368062 -18.44190066 110.9926372 -18.44038582 108.80159378 C-18.439628 107.72362663 -18.43887019 106.64565948 -18.43808941 105.53502666 C-18.433346 97.93739103 -18.43519819 90.33977327 -18.43945122 82.74213791 C-18.44437352 73.49147136 -18.43841199 64.24088672 -18.41855692 54.99023895 C-18.40867636 50.27047403 -18.40358829 45.55083393 -18.41144943 40.83106232 C-18.41849556 36.51240457 -18.41172679 32.19399896 -18.3938458 27.87537451 C-18.38979466 26.31183114 -18.39081233 24.74826487 -18.39736467 23.18472998 C-18.4055028 21.06138546 -18.3952185 18.93889313 -18.38031673 16.81560326 C-18.3792876 15.63575179 -18.37825848 14.45590031 -18.37719816 13.24029577 C-17.79216422 8.21460052 -16.10981267 5.00411622 -12.375 1.625 C-8.0588127 -0.45316426 -4.70665253 -0.70599788 0 0 Z " fill="#66402D" transform="translate(314,343)"/>
<path d="M0 0 C6.9488137 -0.00214761 13.89762547 -0.00539583 20.84643817 -0.00967932 C69.56159849 -0.0390163 118.2751035 0.04190235 166.98858172 0.47701991 C170.13651977 0.5039421 173.28446611 0.52750993 176.43243796 0.55010331 C181.33245539 0.58581772 186.23228865 0.63123362 191.13214785 0.68431914 C192.91416009 0.70226261 194.6962066 0.71713005 196.4782725 0.72856295 C213.21675881 0.84078009 229.71713102 1.53021187 242.30831534 14.12139618 C250.62544872 23.65669557 253.45808274 33.1509538 253.47628409 45.62530243 C253.47961249 46.42620804 253.48294089 47.22711365 253.48637015 48.05228913 C253.49141059 49.737347 253.49377937 51.42241476 253.49361807 53.10748017 C253.49581145 55.67934279 253.51401632 58.25078077 253.53292471 60.82256806 C253.5358579 62.46514473 253.5378432 64.10772342 253.53878409 65.75030243 C253.5459696 66.51500351 253.55315512 67.27970459 253.56055838 68.06757843 C253.53922652 73.06680978 253.09622604 76.94480924 249.87081534 80.87139618 C246.28029914 83.74380914 242.00673922 83.33796272 237.64092642 83.43313324 C236.83529517 83.45359688 236.02966391 83.47406051 235.19961959 83.49514425 C232.43306266 83.56197773 229.66642203 83.61966189 226.89962393 83.6755954 C225.91065705 83.6965577 224.92169018 83.71751999 223.9027546 83.7391175 C192.9089601 84.37694329 161.90534915 84.268319 130.90657852 84.25669659 C124.56671859 84.25438192 118.22686133 84.25413864 111.8870011 84.25521195 C110.97133002 84.25536518 110.05565894 84.25551842 109.11224025 84.25567629 C107.24972577 84.25599615 105.38721129 84.25632036 103.52469681 84.25664888 C86.2049021 84.25947605 68.88511275 84.25626143 51.56531893 84.25084852 C36.84862624 84.24639062 22.13194147 84.24715348 7.41524893 84.25176728 C-9.84331054 84.25717576 -27.10186534 84.25919381 -44.36042553 84.25615501 C-46.21768794 84.25583661 -48.07495036 84.25552223 -49.93221277 84.25521195 C-50.84503273 84.25505767 -51.75785268 84.2549034 -52.69833385 84.25474445 C-58.99241763 84.25389731 -65.2864983 84.25532731 -71.58058161 84.2576915 C-135.99695349 84.2792991 -135.99695349 84.2792991 -167.54836386 83.84898078 C-169.97970261 83.81712245 -172.41110711 83.78989179 -174.84255284 83.76765001 C-178.12483113 83.73578705 -181.40624405 83.68509554 -184.68817514 83.62844574 C-186.11584911 83.61948623 -186.11584911 83.61948623 -187.57236499 83.61034572 C-192.42070985 83.50279729 -195.76973725 83.28569992 -199.69168466 80.12139618 C-202.07105157 77.4915696 -203.56227547 75.53728496 -203.89090341 71.94170868 C-203.55087175 66.17088555 -201.90284724 63.03875672 -197.69168466 59.12139618 C-194.10126687 57.77451031 -190.41928659 57.99062722 -186.62458032 57.98273098 C-185.90915963 57.97988877 -185.19373893 57.97704655 -184.45663881 57.9741182 C-182.0470405 57.96576226 -179.63749021 57.96450229 -177.22787851 57.9631778 C-175.48788417 57.95861306 -173.74789093 57.95361317 -172.00789899 57.94821423 C-167.21687621 57.93461367 -162.42586055 57.92720922 -157.6348235 57.92078757 C-152.47191956 57.91279206 -147.30903046 57.89909136 -142.14613718 57.88607514 C-133.19785647 57.86430035 -124.24957428 57.84615952 -115.30128092 57.8304702 C-102.36346796 57.80778072 -89.42567143 57.77963661 -76.48787239 57.75015093 C-55.49836263 57.70246372 -34.50884617 57.65920259 -13.51932138 57.61871064 C6.87293653 57.57936145 27.26518848 57.53793661 47.65743643 57.49371064 C48.91391067 57.49098637 50.17038492 57.48826209 51.46493414 57.48545527 C57.76814568 57.47177588 64.07135712 57.45805559 70.37456852 57.44431496 C122.68580503 57.33033245 174.99705444 57.22352701 227.30831534 57.12139618 C227.34221307 54.88452227 227.36637719 52.64749946 227.38644034 50.41045868 C227.40094229 49.16474091 227.41544424 47.91902314 227.43038565 46.63555634 C227.23867249 41.11651787 225.908513 37.31425965 222.62081534 32.80889618 C217.08305946 28.76783108 211.20974599 27.67462576 204.49304682 27.73828614 C203.74531639 27.73332662 202.99758595 27.72836711 202.22719702 27.7232573 C199.73152386 27.71034453 197.23638953 27.71867192 194.74070364 27.726987 C192.92942223 27.72209607 191.11814394 27.71590532 189.30687094 27.70852911 C184.33698337 27.69213252 179.36725446 27.69444697 174.3973493 27.69990408 C169.03460302 27.70257458 163.67189901 27.68804219 158.30916983 27.67580903 C147.80620401 27.65475447 137.30329338 27.65021416 126.80030895 27.65199691 C118.26414684 27.6533044 109.72800196 27.64950108 101.19184309 27.64207184 C98.73328642 27.63997266 96.27472975 27.63787506 93.81617308 27.63577902 C91.98066356 27.63421373 91.98066356 27.63421373 90.10807305 27.63261682 C66.96556913 27.61371472 43.82309691 27.61476471 20.68058848 27.62158614 C-0.49397998 27.62716295 -21.66842749 27.60633019 -42.84296768 27.57322568 C-64.58358341 27.53949982 -86.32414119 27.52431888 -108.06478357 27.5289427 C-120.27110914 27.53118833 -132.47732289 27.52593036 -144.68362612 27.50105011 C-155.07407816 27.48005145 -165.46435707 27.47643095 -175.85481619 27.49534971 C-181.15622531 27.50451586 -186.45731147 27.50562332 -191.75869554 27.48499405 C-196.61271016 27.46631443 -201.46613661 27.47075389 -206.32012863 27.49353987 C-208.07508597 27.49773318 -209.83008814 27.49350108 -211.58499812 27.47994393 C-221.59737494 27.40786948 -229.53198351 27.64133714 -237.3530339 34.59943736 C-240.27097695 37.91694877 -239.8291742 41.68805674 -239.86746591 45.87920868 C-239.89068584 47.24120294 -239.91480403 48.60318211 -239.93973154 49.96514618 C-239.97463995 52.09773266 -240.00407918 54.22977153 -240.0176124 56.36260712 C-240.13778005 72.22473743 -240.13778005 72.22473743 -244.69168466 79.12139618 C-247.61796788 81.88046321 -250.16462457 82.3497757 -254.06668466 82.62139618 C-258.29505096 82.46609725 -260.89216883 81.25296083 -264.28152841 78.80108368 C-269.34861141 72.76550006 -268.13350416 63.62787717 -268.12918466 56.24639618 C-268.1295875 55.54986939 -268.12999033 54.8533426 -268.13040537 54.13570893 C-268.07810905 38.5015909 -266.24348787 25.71606322 -254.69168466 14.12139618 C-254.02781748 13.45495087 -253.36395029 12.78850556 -252.67996591 12.10186493 C-238.70364563 -0.9408701 -219.54460351 0.81133831 -201.56277841 0.70733368 C-199.39804424 0.68828171 -197.23331549 0.66860454 -195.06859201 0.64837372 C-189.04094037 0.59534369 -183.01326794 0.55602461 -176.98549265 0.52010071 C-173.09257276 0.49617113 -169.19968864 0.46892127 -165.30679697 0.44079316 C-110.20557693 0.04638289 -55.10239131 0.01700381 0 0 Z " fill="#68422F" transform="translate(515.6916846632957,236.8786038160324)"/>
<path d="M0 0 C3.33642424 1.89718241 6.65548261 3.91510869 9 7 C9.81224273 10.29906733 10.12567106 13.37790325 10.12863445 16.76831722 C10.1318589 17.70463889 10.13508335 18.64096056 10.1384055 19.60565561 C10.1368569 20.62588188 10.1353083 21.64610815 10.13371277 22.69725037 C10.13597833 23.78759758 10.13824388 24.87794479 10.14057809 26.00133282 C10.14691755 29.66162517 10.14608876 33.32188049 10.14526367 36.98217773 C10.14825516 39.60368905 10.15165767 42.22519992 10.15544128 44.84671021 C10.16374396 51.23221145 10.16649594 57.61770346 10.16705366 64.00320964 C10.16752894 69.19325807 10.16958426 74.38330345 10.17275429 79.57335091 C10.18155927 94.28853781 10.18617383 109.00371743 10.18542381 123.71890699 C10.18538386 124.51203145 10.1853439 125.30515592 10.18530273 126.12231445 C10.18526185 126.91640723 10.18522097 127.7105 10.18517885 128.52865619 C10.18477227 141.40238493 10.1943453 154.27608443 10.2084411 167.1498047 C10.22280085 180.36887912 10.22971153 193.58793927 10.22884732 206.80702168 C10.22851525 214.2284052 10.231267 221.64975807 10.24202538 229.07113457 C10.25207556 236.04865573 10.25179914 243.02611107 10.24450874 250.00363541 C10.24346049 252.56669903 10.24583999 255.12976666 10.2518692 257.69282341 C10.25955787 261.18721454 10.25496491 264.68137991 10.24723816 268.17576599 C10.25238172 269.19376154 10.25752529 270.21175709 10.26282471 271.26060098 C10.23105937 277.74608481 9.97675064 282.71913388 5.5625 287.8125 C2.48830684 290.43681123 0.68955645 290.93494751 -3.3125 291.3125 C-7.78768692 290.93324687 -9.64980002 289.96949544 -13 287 C-16.33222044 281.00711803 -16.42522234 275.74846831 -16.38095093 268.98631287 C-16.3856309 267.8860897 -16.39031087 266.78586654 -16.39513266 265.65230328 C-16.40708615 261.97047167 -16.39762373 258.28901202 -16.38818359 254.60717773 C-16.39224911 251.96565669 -16.39748245 249.32416116 -16.40411377 246.68264771 C-16.41744029 240.25594569 -16.41457834 233.82934889 -16.40587585 227.40264278 C-16.39909603 222.17926328 -16.39818386 216.95591323 -16.4014473 211.73253059 C-16.401907 210.98863919 -16.40236669 210.24474778 -16.40284032 209.47831421 C-16.40379951 207.96704633 -16.40477215 206.45577845 -16.4057581 204.94451059 C-16.41430867 190.78007613 -16.40448278 176.61569996 -16.388357 162.45127506 C-16.37495135 150.29992568 -16.37728457 138.14866228 -16.39111328 125.99731445 C-16.40717022 111.88142976 -16.41348764 97.76559611 -16.40427649 83.64970356 C-16.40332085 82.1443536 -16.40237774 80.63900362 -16.4014473 79.13365364 C-16.40098447 78.39301717 -16.40052164 77.65238069 -16.40004479 76.88930069 C-16.39745545 71.67223023 -16.40182464 66.45519219 -16.40888596 61.23812675 C-16.4173023 54.88029058 -16.41501794 48.52256551 -16.39904372 42.16474205 C-16.39116314 38.92142543 -16.38968248 35.67833216 -16.39799118 32.43501091 C-16.40616966 28.91872277 -16.39592911 25.40295814 -16.38095093 21.88670349 C-16.38764309 20.86229029 -16.39433526 19.83787708 -16.40123022 18.78242105 C-16.35697834 13.43897085 -16.05007266 9.59298812 -13 5 C-8.6224943 1.04956803 -5.9550502 -0.57260098 0 0 Z " fill="#66402C" transform="translate(450,380)"/>
<path d="M0 0 C3.66195958 2.07280731 5.66024277 3.49036416 8 7 C9.30470169 14.31577045 9.13801265 21.9038841 9.10247803 29.31161499 C9.1013656 30.39554366 9.10025317 31.47947232 9.09910703 32.59624732 C9.09410072 36.19879553 9.08175594 39.8012789 9.06933594 43.40380859 C9.06409851 45.99826989 9.05927219 48.59273205 9.05482483 51.18719482 C9.04167451 58.21146877 9.02080817 65.23570667 8.99825954 72.25995588 C8.98419614 76.64830317 8.97170817 81.03665405 8.9595108 85.42500687 C8.92543713 97.58613747 8.88950521 109.74725907 8.84641647 121.90836143 C8.84229441 123.07281928 8.84229441 123.07281928 8.83808906 124.26080153 C8.83533239 125.0388814 8.83257572 125.81696127 8.82973552 126.61861932 C8.82415025 128.19512772 8.81856785 129.77163612 8.81298828 131.34814453 C8.8102191 132.13013476 8.80744991 132.91212499 8.80459681 133.7178119 C8.75999778 146.41397734 8.72898322 159.11013699 8.70378849 171.80635433 C8.67770444 184.85502477 8.64047221 197.90362427 8.59196877 210.95223105 C8.56501215 218.27343883 8.54284223 225.59459142 8.53295135 232.91584396 C8.52359912 239.79255989 8.49901829 246.66907503 8.46401787 253.5457077 C8.45360319 256.07209054 8.44831011 258.59850033 8.44845009 261.12490463 C8.44786091 264.56692059 8.42900681 268.00836272 8.40545654 271.45028687 C8.41170473 272.9580011 8.41170473 272.9580011 8.41807914 274.49617422 C8.36395207 279.45463947 8.30594727 283.01328351 5 287 C0.90423386 289.91307398 -2.75608584 291.14512332 -7.75 290.5625 C-12.23933031 288.40416812 -15.05587116 286.10221953 -17.12000465 281.50617123 C-18.32976541 276.68611352 -18.28245302 272.10278598 -18.26742554 267.15126038 C-18.27195665 266.05668076 -18.27648776 264.96210113 -18.28115618 263.83435243 C-18.29381914 260.16564845 -18.29217857 256.49709256 -18.29052734 252.82836914 C-18.29651132 250.1984793 -18.30331656 247.56859121 -18.31088257 244.93870544 C-18.32747804 238.53629068 -18.33299142 232.13391275 -18.33410732 225.73147828 C-18.33505831 220.52715632 -18.33917114 215.32284649 -18.34550858 210.11852837 C-18.3631156 195.35897313 -18.37234808 180.59944695 -18.37084763 165.83988113 C-18.37076772 165.0445978 -18.3706878 164.24931447 -18.37060547 163.42993164 C-18.37052371 162.63367606 -18.37044195 161.83742049 -18.37035771 161.01703595 C-18.36954455 148.10844291 -18.38869108 135.19996648 -18.4168822 122.29140718 C-18.44560924 109.03273961 -18.45942266 95.77412892 -18.45769465 82.51542944 C-18.45703077 75.07331156 -18.4625222 67.63131599 -18.48405075 60.18922615 C-18.50416324 53.19192761 -18.50359075 46.19489156 -18.48901749 39.19758034 C-18.48692239 36.6284828 -18.49167177 34.05936928 -18.5037384 31.49029922 C-18.51913653 27.98513465 -18.50991756 24.48086802 -18.49447632 20.97572327 C-18.50476344 19.95743173 -18.51505057 18.9391402 -18.52564943 17.88999134 C-18.46548197 11.71606307 -17.60105286 8.05929405 -14 3 C-9.78751392 -1.00628047 -5.50501742 -1.60145961 0 0 Z " fill="#684331" transform="translate(575,381)"/>
<path d="M0 0 C2.63116432 0.0011953 5.26232907 0.00164422 7.89349365 0.00138855 C13.37661162 0.00231773 18.8596734 0.01090156 24.34277344 0.0246582 C30.64241766 0.04040711 36.94200072 0.04565473 43.24166322 0.04492265 C49.35950024 0.04430824 55.47731464 0.04956074 61.59514618 0.05771446 C64.17370232 0.06087457 66.7522602 0.06286225 69.33081818 0.06360817 C113.5934288 0.09045146 113.5934288 0.09045146 128.09375 13.74609375 C136.80957618 23.0010432 140.16881877 34.14003397 139.90625 46.5703125 C139.39355174 51.01844465 138.25795376 53.07813365 135.08984375 56.12890625 C130.99650475 58.93747461 126.2384931 58.78288388 121.484375 58.23046875 C118.609375 56.91796875 118.609375 56.91796875 116.484375 54.23046875 C115.19387644 50.6288046 114.35443623 46.95211792 113.484375 43.23046875 C111.57432979 35.73094765 111.57432979 35.73094765 106.484375 30.23046875 C99.27953343 26.92205422 92.30233599 26.79680151 84.48828125 26.82641602 C83.21395233 26.81955276 81.93962341 26.81268951 80.62667847 26.80561829 C77.15556939 26.78778519 73.68471445 26.78883622 70.21357346 26.79456067 C67.3061179 26.79766623 64.3987102 26.79154511 61.49126148 26.78552192 C54.62857335 26.77151129 47.76600981 26.77300961 40.90332031 26.78442383 C33.84303359 26.79590778 26.78312661 26.7818171 19.7228899 26.75502735 C13.64106239 26.73282131 7.55935366 26.72624379 1.47748852 26.73210377 C-2.14619363 26.73546214 -5.7696323 26.73313319 -9.39328003 26.71585274 C-13.43560596 26.69741386 -17.47719956 26.71162082 -21.51953125 26.72875977 C-22.70733185 26.7190918 -23.89513245 26.70942383 -25.118927 26.69946289 C-31.99499787 26.76038015 -37.61323497 27.50209658 -43.515625 31.23046875 C-47.66145445 35.59449975 -48.43170575 40.61332205 -49.734375 46.3125 C-51.11273931 51.46069071 -52.98679967 55.21125186 -57.515625 58.23046875 C-62.70499844 58.9936119 -67.08478343 59.18436313 -71.515625 56.23046875 C-75.11559425 50.83051488 -77.31697635 46.1270797 -76.08203125 39.484375 C-72.6122792 25.67715478 -67.12195368 14.51852301 -55.0390625 6.609375 C-49.48102364 3.41694772 -44.17106205 1.7226423 -37.81738281 1.07299805 C-37.04929417 0.99209018 -36.28120552 0.91118231 -35.48984146 0.82782269 C-23.69583529 -0.27159746 -11.83213286 -0.03582488 0 0 Z " fill="#66402C" transform="translate(476.515625,173.76953125)"/>
<path d="M0 0 C4.62803031 1.85121213 6.5619111 4.73397886 9 9 C9.49745268 12.27629989 9.49745268 12.27629989 9.49384212 15.90321255 C9.49864789 16.57663442 9.50345366 17.25005629 9.50840506 17.94388488 C9.51964967 20.19902162 9.50241675 22.4530278 9.4853363 24.70811462 C9.48763122 26.34172837 9.49169565 27.97534043 9.49737698 29.60894591 C9.5079521 34.09703362 9.49370407 38.58475368 9.47551024 43.07280433 C9.46029013 47.91337551 9.46821519 52.7539133 9.47354126 57.59449768 C9.47981373 65.98237605 9.47203874 74.37014645 9.45528984 82.75800896 C9.4315158 94.89308767 9.43446308 107.02804991 9.44491828 119.16314215 C9.46162713 138.86129241 9.46418517 158.55941404 9.4543457 178.25756836 C9.45376276 179.43662263 9.45317982 180.61567689 9.45257921 181.83046008 C9.44585017 194.9864827 9.43677765 208.14250285 9.42626953 221.29852295 C9.42252954 226.06970209 9.41886997 230.84088129 9.4152832 235.61206055 C9.41439229 236.78937663 9.41350137 237.96669272 9.41258346 239.17968505 C9.3982979 258.80259435 9.40340625 278.4254483 9.42320591 298.0483523 C9.43454085 310.15448998 9.42872627 322.26038801 9.40092707 334.36650027 C9.3830537 342.65964073 9.38288488 350.95265905 9.39671569 359.24580687 C9.40407857 364.03255604 9.40315223 368.81893922 9.38043022 373.60564804 C9.35976883 377.98717272 9.36204546 382.36806292 9.38258684 386.7495826 C9.38593 388.33498736 9.38079381 389.92043729 9.36634438 391.50577974 C8.88155689 401.86663117 8.88155689 401.86663117 13.23362571 410.80022997 C21.05695808 416.11405264 31.25811712 415.41669969 40.29730225 415.34298706 C41.7166135 415.34231153 43.13592588 415.34295605 44.5552361 415.34479439 C48.42772464 415.34598676 52.29992968 415.3284473 56.17235398 415.30763102 C60.35909256 415.28842903 64.54584458 415.28674587 68.73262024 415.28276062 C76.9224581 415.27213666 85.11216364 415.2451929 93.3019394 415.21233229 C99.957787 415.18592729 106.61362834 415.1654828 113.26950836 415.14926529 C114.21794582 415.14694963 115.16638327 415.14463397 116.14356126 415.14224813 C118.07043523 415.13756984 119.99730924 415.13290548 121.92418328 415.12825491 C139.97442779 415.08399666 158.02457144 415.02122143 176.07473531 414.95204844 C191.56005827 414.89313267 207.04535982 414.84998622 222.53076172 414.81835938 C240.5240365 414.78160243 258.51724334 414.73519228 276.5104506 414.67330945 C278.42888526 414.66673729 280.34731996 414.66017719 282.2657547 414.6536293 C283.68154466 414.6487889 283.68154466 414.6487889 285.12593643 414.64385071 C291.77525312 414.62178003 298.4245651 414.60660217 305.07390594 414.59408188 C313.17479476 414.57863734 321.27556624 414.55256513 329.37637392 414.51287393 C333.50888748 414.49289168 337.64127164 414.4776695 341.77383614 414.47536659 C345.55739976 414.47312129 349.34064654 414.45709759 353.1241124 414.43012632 C355.13949122 414.41929706 357.15493225 414.42308285 359.17033553 414.42740333 C365.49583877 414.36790029 370.49820993 414.28006003 376 411 C380.12213305 405.7930951 381.12463759 402.02160461 381.13028526 395.49157906 C381.13222869 394.82439627 381.13417212 394.15721349 381.13617444 393.46981305 C381.14151886 391.21822952 381.13972865 388.96670686 381.13803101 386.71511841 C381.140448 385.09092066 381.14330994 383.46672352 381.14658034 381.84252727 C381.15435031 377.36673518 381.15595365 372.89095842 381.15663147 368.41516042 C381.15846817 363.59298182 381.16607326 358.77081224 381.17311096 353.94863892 C381.18464658 345.5885746 381.19288562 337.22851231 381.19923019 328.86844254 C381.20954431 315.66007401 381.23010434 302.45173074 381.25234985 289.24337769 C381.25982984 284.72712144 381.26724352 280.21086508 381.27463722 275.69460869 C381.27741307 274.00154575 381.27741307 274.00154575 381.280245 272.27427951 C381.30117997 259.42064843 381.32000494 246.56701456 381.33789062 233.71337891 C381.33952881 232.53808474 381.34116699 231.36279058 381.34285481 230.15188144 C381.36914942 211.09860067 381.3877872 192.04531795 381.40448253 172.9920267 C381.42188863 153.44380019 381.45071767 133.89561184 381.4893719 114.3474158 C381.51280095 102.28223683 381.52676908 90.21712006 381.52869953 78.15191816 C381.53080507 69.88727205 381.54370207 61.62268787 381.56517886 53.35806955 C381.57723487 48.58586517 381.58434129 43.81378378 381.57846642 39.04156494 C381.57318768 34.67556079 381.58159067 30.30980797 381.60102279 25.94384585 C381.60561374 24.36176396 381.6051069 22.77965764 381.59907441 21.19758059 C381.59161959 19.05145126 381.60249857 16.90617131 381.61803246 14.76010323 C381.61938898 13.56674956 381.62074551 12.3733959 381.62214315 11.14388001 C382.15696042 6.69404316 383.74128909 4.07360636 387.125 1.1875 C391.17857843 -0.48680413 394.67711329 -0.6621323 399 0 C402.4375 1.5 402.4375 1.5 405 4 C407.77326214 11.68326662 407.27895668 19.71751866 407.25396729 27.77658081 C407.25627321 29.3932815 407.25945062 31.00998113 407.26342177 32.62667859 C407.27176045 37.05874321 407.26764868 41.49072156 407.26144934 45.92278647 C407.256922 50.70680049 407.26391006 55.49079972 407.26940918 60.27481079 C407.27830221 69.64311668 407.27638144 79.01139052 407.2705839 88.37969767 C407.26606653 95.99479425 407.26545484 103.60988186 407.26763153 111.2249794 C407.267938 112.30894986 407.26824446 113.39292032 407.26856022 114.50973836 C407.26919967 116.71185278 407.2698481 118.9139672 407.2705054 121.11608161 C407.27620857 141.76589393 407.26965128 162.41568849 407.25890467 183.06549789 C407.2499717 200.77853744 407.25151913 218.49155077 407.26074219 236.20458984 C407.2714494 256.77758406 407.27565658 277.3505627 407.26951766 297.92355931 C407.26888057 300.11816923 407.26825183 302.31277915 407.26763153 304.50738907 C407.26732298 305.58715327 407.26701443 306.66691747 407.26669653 307.7794018 C407.26497076 315.38307826 407.26788221 322.98674484 407.27259064 330.59041977 C407.27820458 339.86017575 407.2766723 349.12989786 407.26602915 358.39964996 C407.26077899 363.12793552 407.25870451 367.85616465 407.26532745 372.58444977 C407.27130271 376.91591652 407.2679858 381.24727472 407.25737235 385.57873167 C407.25514497 387.14258904 407.25625968 388.70645565 407.26112393 390.27030705 C407.30770597 406.49573272 405.67077782 417.71079497 394.26953125 429.73828125 C384.67321312 439.30156558 372.21398769 441.42543984 358.98997056 441.53031152 C357.0318994 441.51590402 357.0318994 441.51590402 355.03427124 441.50120544 C353.59102954 441.50510986 352.14779172 441.51075935 350.70456278 441.51797634 C346.78426133 441.5325852 342.86436752 441.52263788 338.94407988 441.50823963 C334.6986374 441.49704995 330.45324842 441.50909857 326.20780945 441.51808167 C317.90956906 441.53196138 309.61148162 441.52449741 301.31324862 441.50940608 C291.63712105 441.49248343 281.96103091 441.49576405 272.28489311 441.49950016 C255.01444223 441.50536893 237.74406443 441.491245 220.47363281 441.46655273 C203.73760236 441.44262743 187.00166949 441.43555265 170.265625 441.44604492 C152.01226706 441.45746804 133.75895417 441.45936755 115.50559676 441.44494683 C113.55734675 441.44342108 111.60909673 441.44190073 109.66084671 441.44038582 C108.7024263 441.439628 107.74400589 441.43887019 106.75654244 441.43808941 C100.02081775 441.43335794 93.28511326 441.43518988 86.54938889 441.43945122 C78.33607585 441.44439045 70.12285484 441.4383374 61.90956281 441.41855692 C57.72360311 441.40872215 53.53778321 441.40353836 49.35181618 441.41144943 C45.5126178 441.41855644 41.67370026 441.41158573 37.83453865 441.3938458 C35.80387791 441.38794761 33.77319056 441.39657494 31.74254262 441.40589231 C17.39498402 441.30762988 4.41056025 438.63200922 -6.375 428.6953125 C-17.73588027 416.84285568 -18.60634632 400.80467197 -18.50120544 385.23446655 C-18.50510887 383.60800716 -18.51075759 381.9815512 -18.51797634 380.35510314 C-18.53259794 375.93329517 -18.5226301 371.51184816 -18.50823963 367.09005237 C-18.49705815 362.30351772 -18.5090956 357.51703078 -18.51808167 352.73049927 C-18.53196439 343.37528999 -18.52449634 334.02021633 -18.50940608 324.6650136 C-18.49249768 313.76598076 -18.49576201 302.86698124 -18.49950016 291.96793933 C-18.50536891 272.52596216 -18.49124214 253.08404991 -18.46655273 233.64208984 C-18.44260176 214.77943493 -18.43556258 195.91686662 -18.44604492 177.05419922 C-18.45744999 156.49436067 -18.45939184 135.93456209 -18.44494683 115.37472403 C-18.44342101 113.18368062 -18.44190066 110.9926372 -18.44038582 108.80159378 C-18.439628 107.72362663 -18.43887019 106.64565948 -18.43808941 105.53502666 C-18.433346 97.93739103 -18.43519819 90.33977327 -18.43945122 82.74213791 C-18.44437352 73.49147136 -18.43841199 64.24088672 -18.41855692 54.99023895 C-18.40867636 50.27047403 -18.40358829 45.55083393 -18.41144943 40.83106232 C-18.41849556 36.51240457 -18.41172679 32.19399896 -18.3938458 27.87537451 C-18.38979466 26.31183114 -18.39081233 24.74826487 -18.39736467 23.18472998 C-18.4055028 21.06138546 -18.3952185 18.93889313 -18.38031673 16.81560326 C-18.3792876 15.63575179 -18.37825848 14.45590031 -18.37719816 13.24029577 C-17.79216422 8.21460052 -16.10981267 5.00411622 -12.375 1.625 C-8.0588127 -0.45316426 -4.70665253 -0.70599788 0 0 Z M-15 7 C-16.42342671 9.84685343 -16.12948568 12.249225 -16.13422108 15.43387604 C-16.13657331 16.10516049 -16.13892554 16.77644494 -16.14134905 17.46807134 C-16.14805823 19.73967582 -16.14758025 22.01122334 -16.14717102 24.28283691 C-16.15046848 25.91910753 -16.15419379 27.55537734 -16.1583125 29.1916461 C-16.16835449 33.70564886 -16.17205283 38.21963833 -16.17470181 42.73365068 C-16.17859848 47.59548034 -16.18817738 52.4572994 -16.19691467 57.31912231 C-16.21669934 69.07075603 -16.22674879 80.82239063 -16.23564246 92.57403684 C-16.24002294 98.10562779 -16.24539045 103.63721779 -16.25063133 109.16880798 C-16.26764722 127.55400646 -16.28214112 145.93920434 -16.28938007 164.32440948 C-16.29129004 169.09810894 -16.29321036 173.87180838 -16.29516602 178.64550781 C-16.29564976 179.83201838 -16.2961335 181.01852896 -16.2966319 182.24099439 C-16.30493108 201.45912456 -16.33026453 220.67719246 -16.36274669 239.89529544 C-16.39581138 259.61864474 -16.41382839 279.3419624 -16.41702431 299.06533957 C-16.41919019 310.14221651 -16.42794992 321.21900271 -16.45348549 332.29585266 C-16.47518457 341.73046183 -16.48324686 351.16495823 -16.47351871 360.59958953 C-16.46897145 365.4129638 -16.470885 370.22610537 -16.49028015 375.03944778 C-16.50789447 379.44896512 -16.50692815 383.85807968 -16.49138286 388.26760119 C-16.48900413 389.8599075 -16.49334412 391.45224156 -16.50521151 393.04450542 C-16.6067533 407.57246967 -13.06471742 418.21531998 -3.375 429.1875 C4.62655809 436.74569999 14.66491072 439.11891722 25.3463335 439.13142776 C26.58374249 439.13526891 27.82115148 439.13911005 29.09605771 439.1430676 C30.45595036 439.14228751 31.81584295 439.14140876 33.17573547 439.14044189 C34.63070526 439.14302788 36.08567434 439.14604169 37.54064244 439.1494453 C41.53028 439.15749081 45.51989954 439.15930349 49.50954425 439.16004276 C53.8157244 439.16189754 58.1218953 439.16944689 62.42807007 439.17617798 C71.83918259 439.18974335 81.25029085 439.19578292 90.66141152 439.20018864 C96.53927656 439.2029535 102.41713996 439.20719124 108.29500389 439.21169281 C124.57441892 439.223882 140.85383265 439.23418274 157.13325214 439.2375679 C158.17455745 439.23778747 159.21586275 439.23800703 160.28872276 439.23823325 C161.85437078 439.23856067 161.85437078 439.23856067 163.45164806 439.2388947 C165.56664232 439.23933816 167.68163659 439.23978473 169.79663086 439.24023438 C171.37028896 439.24056652 171.37028896 439.24056652 172.97573813 439.24090537 C189.97875509 439.24485426 206.98172922 439.26231261 223.98472963 439.2855939 C241.44821287 439.30931246 258.91167461 439.32176994 276.37517422 439.32293582 C286.1776384 439.32385217 295.98004672 439.32959474 305.7824955 439.34775543 C314.12818917 439.36316306 322.47380972 439.36827287 330.81951491 439.36001733 C335.0759426 439.35611349 339.33222306 439.35702749 343.58863258 439.37107468 C347.48903723 439.38382911 351.38918423 439.38260267 355.28958859 439.37048396 C356.69668368 439.36852966 358.10379711 439.37159305 359.51086644 439.38032833 C373.8903444 439.46390971 384.19527943 436.60981125 394.75 426.625 C401.22652908 419.83290918 405.24485345 412.60454505 405.26006222 403.12054443 C405.26386789 402.43754697 405.26767356 401.75454951 405.27159455 401.05085516 C405.28191808 398.75745947 405.27800283 396.46431094 405.27415466 394.17089844 C405.27860663 392.51197442 405.28392053 390.85305253 405.29002339 389.19413376 C405.30421823 384.63163454 405.3058664 380.0692034 405.30542648 375.50668526 C405.30707332 370.58773511 405.32013713 365.66881312 405.33161926 360.74987793 C405.35447608 349.99398337 405.36239019 339.23810854 405.36744571 328.48219299 C405.37070107 321.76917222 405.37722246 315.05615718 405.3844471 308.34313965 C405.40401169 289.76393824 405.42041746 271.18474216 405.42332363 252.60552979 C405.42360499 250.82196032 405.42360499 250.82196032 405.42389202 249.00235915 C405.42425828 246.59180196 405.42462198 244.18124477 405.42498314 241.77068758 C405.42516595 240.57405599 405.42534876 239.3774244 405.42553711 238.14453125 C405.42571766 236.94644317 405.42589821 235.74835509 405.42608423 234.51396132 C405.42962849 215.08569533 405.45666727 195.65754 405.494035 176.22931242 C405.53207523 156.29231525 405.55148078 136.35537306 405.55178314 116.41833878 C405.55236858 105.2203655 405.56091633 94.02252432 405.58978081 82.82458496 C405.61423711 73.2928991 405.6216164 63.76139354 405.60653328 54.22968483 C405.5993415 49.36420849 405.60031918 44.49908859 405.62294388 39.63365173 C405.6434445 35.18249237 405.64101772 30.73196553 405.62006903 26.28081369 C405.61655702 24.667825 405.62155609 23.05479149 405.63577347 21.44186163 C405.65382394 19.25361902 405.64122876 17.06762815 405.62082577 14.87945557 C405.62164022 13.66288395 405.62245468 12.44631233 405.62329382 11.19287491 C404.82640199 7.1107296 403.12557839 5.64112475 400 3 C399.67 2.67 399.34 2.34 399 2 C395.21896039 1.44279416 391.52021759 1.15996224 388.10546875 3.046875 C385.95886179 4.82265691 384.25294365 6.4941127 383 9 C382.90321275 11.13002699 382.87338164 13.26317921 382.87250805 15.39540386 C382.8700423 16.39608104 382.8700423 16.39608104 382.86752674 17.41697392 C382.86318131 19.67438078 382.86599627 21.93172403 382.86869812 24.18913269 C382.8669972 25.81516661 382.86484808 27.44120011 382.86228687 29.06723291 C382.85767795 32.61399046 382.85627132 36.16073054 382.85725212 39.70749092 C382.85884073 45.47742528 382.85365173 51.24734222 382.84762573 57.01727295 C382.83950242 65.39481285 382.83456534 73.77234969 382.83133507 82.14989281 C382.82584555 95.38813437 382.80895515 108.62635007 382.78999329 121.86457825 C382.7836361 126.39085288 382.77732772 130.91712759 382.77101612 135.44340229 C382.76943236 136.57466592 382.7678486 137.70592956 382.76621684 138.8714739 C382.74826982 151.75716889 382.73204867 164.64286572 382.71704102 177.52856445 C382.71566514 178.70689011 382.71428927 179.88521577 382.71287171 181.09924827 C382.69094288 200.1932768 382.68018617 219.28729871 382.67267027 238.38133761 C382.66460307 257.97248952 382.64132477 277.5635845 382.6047166 297.15470392 C382.58267184 309.24516554 382.573033 321.33551015 382.57921693 333.42599086 C382.58238824 341.71123232 382.57108307 349.99637377 382.54832252 358.28158429 C382.53563747 363.06419103 382.52950567 367.84657502 382.54073906 372.62919044 C382.5508899 377.0071221 382.54269491 381.38462087 382.5198761 385.76250128 C382.51487224 387.34666733 382.51662793 388.93087209 382.52580877 390.51501944 C382.60447165 405.2460142 382.60447165 405.2460142 378 411 C373.46798855 415.20040086 370.24604221 416.1239799 364.1659193 416.13422108 C362.9409745 416.13867892 361.7160297 416.14313676 360.45396537 416.14772969 C359.08740818 416.1476404 357.72085099 416.14745054 356.35429382 416.14717102 C354.90817488 416.15046966 353.46205686 416.15419523 352.01594001 416.1583125 C348.03234794 416.16834034 344.04877093 416.17205054 340.06516802 416.17470181 C335.77262583 416.17860246 331.4800956 416.18818087 327.18756104 416.19691467 C316.81717247 416.21668443 306.44678292 416.22674532 296.07638022 416.23564246 C291.19529117 416.24002397 286.3142032 416.24539109 281.43311501 416.25063133 C265.21218815 416.26764308 248.99126198 416.2821384 232.77032757 416.28938007 C228.56018256 416.29129003 224.35003756 416.29321035 220.13989258 416.29516602 C218.57023945 416.29589163 218.57023945 416.29589163 216.96887616 416.2966319 C200.00815439 416.3049365 183.04750304 416.33028092 166.08681204 416.36274669 C148.68223567 416.39579119 131.27769514 416.41382641 113.87308723 416.41702431 C104.09749822 416.41919168 94.32201196 416.42797362 84.54645348 416.45348549 C76.22322541 416.47515675 67.90012504 416.48326052 59.57687195 416.47351871 C55.32902401 416.46896378 51.08143974 416.47092919 46.8336277 416.49028015 C42.94554389 416.50783972 39.05791753 416.50697326 35.16982935 416.49138286 C33.76268281 416.48899578 32.35550518 416.49338713 30.9484063 416.50521151 C17.91597561 416.60795153 17.91597561 416.60795153 13 412 C8.24515348 406.85962538 7.87500018 403.23366358 7.87530136 396.37132454 C7.87395713 395.70328751 7.87261289 395.03525048 7.87122792 394.3469699 C7.86790695 392.0984879 7.87171167 389.8500736 7.87542725 387.60159302 C7.87444125 385.97724528 7.87300432 384.35289777 7.87115407 382.72855079 C7.86809141 379.19169949 7.86820536 375.654867 7.87071037 372.11801529 C7.87476554 366.3638077 7.87200329 360.60961487 7.86836243 354.85540771 C7.86427005 347.58495736 7.86203275 340.3145103 7.86194643 333.04405878 C7.86174385 318.76014163 7.84929311 304.47625848 7.83233643 290.19235229 C7.82973062 287.9447378 7.82713181 285.6971233 7.8245399 283.44950879 C7.82060145 280.04309405 7.81665494 276.63667933 7.81267868 273.23026464 C7.79772924 260.38446813 7.78410595 247.53867058 7.77197266 234.69287109 C7.7708591 233.51840474 7.76974553 232.34393839 7.76859823 231.13388215 C7.75101665 212.0942646 7.74815456 193.0546683 7.74982306 174.01504399 C7.7511012 154.47693742 7.7333901 134.93891009 7.69880509 115.40083396 C7.67813027 103.34398987 7.67283641 91.28733535 7.6871334 79.23048113 C7.69557963 70.97094704 7.68589468 62.71156062 7.6618239 54.45205773 C7.6484903 49.68369047 7.6433725 44.9156772 7.65994453 40.14731216 C7.67494282 35.78361823 7.66703958 31.42059258 7.640775 27.05695747 C7.63534231 25.47690586 7.63839015 23.89679805 7.65069196 22.31678499 C7.66617832 20.17049993 7.65095972 18.02652718 7.6280632 15.88035774 C7.62746611 14.68792587 7.62686903 13.49549401 7.62625384 12.26692784 C6.78167389 7.86107581 5.12489628 6.18137181 2 3 C-4.63435084 -0.31717542 -10.2544462 2.01716851 -15 7 Z " fill="#E4DCD9" transform="translate(314,343)"/>
<path d="M0 0 C6.9488137 -0.00214761 13.89762547 -0.00539583 20.84643817 -0.00967932 C69.56159849 -0.0390163 118.2751035 0.04190235 166.98858172 0.47701991 C170.13651977 0.5039421 173.28446611 0.52750993 176.43243796 0.55010331 C181.33245539 0.58581772 186.23228865 0.63123362 191.13214785 0.68431914 C192.91416009 0.70226261 194.6962066 0.71713005 196.4782725 0.72856295 C213.21675881 0.84078009 229.71713102 1.53021187 242.30831534 14.12139618 C250.62544872 23.65669557 253.45808274 33.1509538 253.47628409 45.62530243 C253.47961249 46.42620804 253.48294089 47.22711365 253.48637015 48.05228913 C253.49141059 49.737347 253.49377937 51.42241476 253.49361807 53.10748017 C253.49581145 55.67934279 253.51401632 58.25078077 253.53292471 60.82256806 C253.5358579 62.46514473 253.5378432 64.10772342 253.53878409 65.75030243 C253.5459696 66.51500351 253.55315512 67.27970459 253.56055838 68.06757843 C253.53922652 73.06680978 253.09622604 76.94480924 249.87081534 80.87139618 C246.28029914 83.74380914 242.00673922 83.33796272 237.64092642 83.43313324 C236.83529517 83.45359688 236.02966391 83.47406051 235.19961959 83.49514425 C232.43306266 83.56197773 229.66642203 83.61966189 226.89962393 83.6755954 C225.91065705 83.6965577 224.92169018 83.71751999 223.9027546 83.7391175 C192.9089601 84.37694329 161.90534915 84.268319 130.90657852 84.25669659 C124.56671859 84.25438192 118.22686133 84.25413864 111.8870011 84.25521195 C110.97133002 84.25536518 110.05565894 84.25551842 109.11224025 84.25567629 C107.24972577 84.25599615 105.38721129 84.25632036 103.52469681 84.25664888 C86.2049021 84.25947605 68.88511275 84.25626143 51.56531893 84.25084852 C36.84862624 84.24639062 22.13194147 84.24715348 7.41524893 84.25176728 C-9.84331054 84.25717576 -27.10186534 84.25919381 -44.36042553 84.25615501 C-46.21768794 84.25583661 -48.07495036 84.25552223 -49.93221277 84.25521195 C-50.84503273 84.25505767 -51.75785268 84.2549034 -52.69833385 84.25474445 C-58.99241763 84.25389731 -65.2864983 84.25532731 -71.58058161 84.2576915 C-135.99695349 84.2792991 -135.99695349 84.2792991 -167.54836386 83.84898078 C-169.97970261 83.81712245 -172.41110711 83.78989179 -174.84255284 83.76765001 C-178.12483113 83.73578705 -181.40624405 83.68509554 -184.68817514 83.62844574 C-186.11584911 83.61948623 -186.11584911 83.61948623 -187.57236499 83.61034572 C-192.42070985 83.50279729 -195.76973725 83.28569992 -199.69168466 80.12139618 C-202.07105157 77.4915696 -203.56227547 75.53728496 -203.89090341 71.94170868 C-203.55087175 66.17088555 -201.90284724 63.03875672 -197.69168466 59.12139618 C-194.10126687 57.77451031 -190.41928659 57.99062722 -186.62458032 57.98273098 C-185.90915963 57.97988877 -185.19373893 57.97704655 -184.45663881 57.9741182 C-182.0470405 57.96576226 -179.63749021 57.96450229 -177.22787851 57.9631778 C-175.48788417 57.95861306 -173.74789093 57.95361317 -172.00789899 57.94821423 C-167.21687621 57.93461367 -162.42586055 57.92720922 -157.6348235 57.92078757 C-152.47191956 57.91279206 -147.30903046 57.89909136 -142.14613718 57.88607514 C-133.19785647 57.86430035 -124.24957428 57.84615952 -115.30128092 57.8304702 C-102.36346796 57.80778072 -89.42567143 57.77963661 -76.48787239 57.75015093 C-55.49836263 57.70246372 -34.50884617 57.65920259 -13.51932138 57.61871064 C6.87293653 57.57936145 27.26518848 57.53793661 47.65743643 57.49371064 C48.91391067 57.49098637 50.17038492 57.48826209 51.46493414 57.48545527 C57.76814568 57.47177588 64.07135712 57.45805559 70.37456852 57.44431496 C122.68580503 57.33033245 174.99705444 57.22352701 227.30831534 57.12139618 C227.34221307 54.88452227 227.36637719 52.64749946 227.38644034 50.41045868 C227.40094229 49.16474091 227.41544424 47.91902314 227.43038565 46.63555634 C227.23867249 41.11651787 225.908513 37.31425965 222.62081534 32.80889618 C217.08305946 28.76783108 211.20974599 27.67462576 204.49304682 27.73828614 C203.74531639 27.73332662 202.99758595 27.72836711 202.22719702 27.7232573 C199.73152386 27.71034453 197.23638953 27.71867192 194.74070364 27.726987 C192.92942223 27.72209607 191.11814394 27.71590532 189.30687094 27.70852911 C184.33698337 27.69213252 179.36725446 27.69444697 174.3973493 27.69990408 C169.03460302 27.70257458 163.67189901 27.68804219 158.30916983 27.67580903 C147.80620401 27.65475447 137.30329338 27.65021416 126.80030895 27.65199691 C118.26414684 27.6533044 109.72800196 27.64950108 101.19184309 27.64207184 C98.73328642 27.63997266 96.27472975 27.63787506 93.81617308 27.63577902 C91.98066356 27.63421373 91.98066356 27.63421373 90.10807305 27.63261682 C66.96556913 27.61371472 43.82309691 27.61476471 20.68058848 27.62158614 C-0.49397998 27.62716295 -21.66842749 27.60633019 -42.84296768 27.57322568 C-64.58358341 27.53949982 -86.32414119 27.52431888 -108.06478357 27.5289427 C-120.27110914 27.53118833 -132.47732289 27.52593036 -144.68362612 27.50105011 C-155.07407816 27.48005145 -165.46435707 27.47643095 -175.85481619 27.49534971 C-181.15622531 27.50451586 -186.45731147 27.50562332 -191.75869554 27.48499405 C-196.61271016 27.46631443 -201.46613661 27.47075389 -206.32012863 27.49353987 C-208.07508597 27.49773318 -209.83008814 27.49350108 -211.58499812 27.47994393 C-221.59737494 27.40786948 -229.53198351 27.64133714 -237.3530339 34.59943736 C-240.27097695 37.91694877 -239.8291742 41.68805674 -239.86746591 45.87920868 C-239.89068584 47.24120294 -239.91480403 48.60318211 -239.93973154 49.96514618 C-239.97463995 52.09773266 -240.00407918 54.22977153 -240.0176124 56.36260712 C-240.13778005 72.22473743 -240.13778005 72.22473743 -244.69168466 79.12139618 C-247.61796788 81.88046321 -250.16462457 82.3497757 -254.06668466 82.62139618 C-258.29505096 82.46609725 -260.89216883 81.25296083 -264.28152841 78.80108368 C-269.34861141 72.76550006 -268.13350416 63.62787717 -268.12918466 56.24639618 C-268.1295875 55.54986939 -268.12999033 54.8533426 -268.13040537 54.13570893 C-268.07810905 38.5015909 -266.24348787 25.71606322 -254.69168466 14.12139618 C-254.02781748 13.45495087 -253.36395029 12.78850556 -252.67996591 12.10186493 C-238.70364563 -0.9408701 -219.54460351 0.81133831 -201.56277841 0.70733368 C-199.39804424 0.68828171 -197.23331549 0.66860454 -195.06859201 0.64837372 C-189.04094037 0.59534369 -183.01326794 0.55602461 -176.98549265 0.52010071 C-173.09257276 0.49617113 -169.19968864 0.46892127 -165.30679697 0.44079316 C-110.20557693 0.04638289 -55.10239131 0.01700381 0 0 Z M-259.62918466 22.30889618 C-261.028831 24.34636699 -261.028831 24.34636699 -260.69168466 28.12139618 C-261.35168466 28.12139618 -262.01168466 28.12139618 -262.69168466 28.12139618 C-266.25012388 36.26984344 -266.21720389 44.10829824 -266.19266123 52.85162079 C-266.19168245 55.31445736 -266.23353275 57.77423708 -266.27762216 60.23663056 C-266.28282592 61.81670226 -266.28551741 63.39678467 -266.28543466 64.97686493 C-266.30182993 65.70511979 -266.31822519 66.43337464 -266.33511728 67.18369782 C-266.25782696 72.92513925 -264.62159154 75.24376449 -260.69168466 79.12139618 C-257.49790385 80.71828659 -254.16647151 80.49488575 -250.69168466 80.12139618 C-247.88152541 78.89958781 -246.28001843 77.99882167 -244.57376474 75.45415986 C-243.36319364 72.25266334 -243.45231236 69.46632051 -243.45340341 66.04717743 C-243.43797284 64.64287101 -243.42166842 63.23857398 -243.40457529 61.83428681 C-243.38820292 59.64014555 -243.37914312 57.44669635 -243.38626474 55.2524997 C-243.40778735 37.93853538 -243.40778735 37.93853538 -237.69168466 32.12139618 C-229.99258766 25.50790277 -221.47595328 26.4269809 -211.87610239 26.49993622 C-210.03793171 26.49560571 -208.19976511 26.48908834 -206.36160904 26.48057616 C-201.31739299 26.46358709 -196.27367347 26.47776431 -191.22948354 26.49709094 C-185.78703961 26.51251644 -180.34465658 26.4991165 -174.90221018 26.48934662 C-164.24378124 26.47481725 -153.58554272 26.48705663 -142.92713182 26.50845987 C-130.51870977 26.53246348 -118.11033142 26.53075592 -105.70189132 26.52815396 C-82.89679052 26.52435192 -60.09177911 26.54729787 -37.28670973 26.58250143 C-16.46757908 26.61450215 4.35146601 26.62654359 25.17062002 26.62041962 C26.50770975 26.62003278 27.84479947 26.61964632 29.18188919 26.61926025 C30.17343713 26.61897323 30.17343713 26.61897323 31.18501635 26.61868042 C52.57318433 26.6125463 73.96132016 26.6177935 95.349482 26.63577902 C97.20425454 26.63733825 97.20425454 26.63733825 99.09649723 26.63892898 C101.58007091 26.6410199 104.06364457 26.64313087 106.54721821 26.64526215 C115.20023927 26.65216244 123.85324818 26.65282629 132.50627142 26.6513797 C143.04720501 26.64994128 153.58806169 26.6596077 164.12896974 26.68332607 C169.50890815 26.69520056 174.88873926 26.70230151 180.26869017 26.6964885 C185.19089845 26.69132713 190.11287978 26.69996793 195.03504919 26.7197631 C196.81820966 26.72451348 198.60139215 26.72418941 200.38454939 26.71835274 C202.80418611 26.7111964 205.22306563 26.7224101 207.64264494 26.73828614 C208.3385298 26.73183433 209.03441466 26.72538253 209.75138694 26.71873522 C215.76208531 26.79300524 219.60752463 28.61387715 224.05831534 32.55889618 C227.31850413 36.27188898 228.5326531 38.95417792 228.72237784 43.88702118 C228.76104971 44.77647431 228.79972159 45.66592743 228.83956534 46.58233368 C228.88597159 47.96291962 228.88597159 47.96291962 228.93331534 49.37139618 C228.97198721 50.30725556 229.01065909 51.24311493 229.05050284 52.20733368 C229.14456378 54.51182672 229.23020932 56.81631631 229.30831534 59.12139618 C228.42226612 59.12025702 227.53621691 59.11911786 226.62331772 59.11794418 C174.13196144 59.05083886 121.6406097 58.99935113 69.14921912 58.9682002 C62.84930516 58.96444799 56.54939128 58.96056503 50.24947745 58.95660126 C48.99525541 58.95581433 47.74103338 58.9550274 46.44880462 58.95421662 C26.12922743 58.94115565 5.80967565 58.91749799 -14.50988645 58.8899378 C-35.35299739 58.86190286 -56.19609501 58.84522397 -77.03922403 58.8391307 C-89.90496551 58.8350103 -102.77063518 58.82198701 -115.63635456 58.79764678 C-124.45374017 58.7818132 -133.27108854 58.77699043 -142.08848733 58.78089205 C-147.17889863 58.7828173 -152.26918424 58.77982486 -157.3595733 58.76377976 C-162.0187546 58.74920084 -166.67772548 58.7484308 -171.33691638 58.7586995 C-173.02344045 58.759969 -174.70997756 58.75614647 -176.39647592 58.74674664 C-178.68825942 58.73471478 -180.97928242 58.74119147 -183.27105421 58.7522527 C-184.54425648 58.75111354 -185.81745874 58.74997438 -187.1292429 58.74880069 C-192.30614019 59.29025195 -196.1931743 60.77657919 -200.12918466 64.30889618 C-202.16060761 67.96545748 -202.61398775 71.0853348 -201.69168466 75.12139618 C-200.09733377 78.04542311 -198.19027045 80.55257228 -194.97412139 81.7733382 C-191.77433475 82.26128657 -188.65994396 82.2497592 -185.42269701 82.25282395 C-184.68543666 82.25487658 -183.94817631 82.25692922 -183.18857473 82.25904405 C-180.70461956 82.26472306 -178.22071967 82.26325569 -175.73675913 82.26183808 C-173.94329425 82.26442119 -172.14982995 82.26743419 -170.35636646 82.27084148 C-165.41730005 82.27892091 -160.47824816 82.28070157 -155.53917593 82.28143895 C-150.21665106 82.28328783 -144.89413376 82.29083425 -139.57161325 82.29757416 C-127.9292576 82.31116399 -116.28690538 82.31718301 -104.64454311 82.32158482 C-97.37857261 82.32434574 -90.11260345 82.32858278 -82.84663385 82.33308899 C-62.73881038 82.34528175 -42.63098797 82.35558155 -22.52316087 82.35896409 C-21.23589984 82.35918365 -19.9486388 82.35940322 -18.62236985 82.35962944 C-16.68680402 82.35995685 -16.68680402 82.35995685 -14.71213585 82.36029088 C-12.09724587 82.36073435 -9.48235589 82.36118092 -6.86746591 82.36163056 C-5.57038436 82.36185199 -4.2733028 82.36207342 -2.93691574 82.36230156 C18.09116986 82.3662515 39.11922085 82.38371149 60.14729308 82.40699008 C81.72390684 82.43068366 103.30050322 82.443165 124.87713021 82.444332 C136.99676251 82.44524981 149.1163497 82.45102867 161.2359696 82.46915162 C171.55373601 82.48452561 181.87144336 82.48968901 192.18921904 82.48141351 C197.45572764 82.47749763 202.72211721 82.47848233 207.98861128 82.49247086 C212.80733677 82.50515334 217.6258531 82.50406224 222.44457807 82.49188015 C224.19018153 82.48991333 225.93579952 82.49304673 227.68138252 82.50172451 C230.0503925 82.5127583 232.41865661 82.5053709 234.7876454 82.49333298 C236.7631156 82.49422861 236.7631156 82.49422861 238.7784943 82.49514234 C243.99921 81.94236009 247.20658283 80.38580755 250.64791495 76.43633759 C252.59282325 72.55338435 252.90404648 69.33244787 252.87472159 65.08233368 C252.88092016 64.32022583 252.88711874 63.55811799 252.89350516 62.77291596 C252.90058177 61.16431681 252.89746703 59.55564408 252.88473135 57.94707978 C252.87096805 55.5232901 252.90483661 53.10344802 252.94308096 50.67998993 C253.01315806 36.52796102 249.42163826 25.66361723 239.53487784 15.25420868 C234.42818179 10.39763653 228.80605335 7.71466382 222.30831534 5.12139618 C221.58469494 4.77513351 220.86107455 4.42887084 220.11552626 4.07211536 C216.63144498 2.89216025 213.41277364 2.84400662 209.77965933 2.86692059 C209.02645857 2.86371411 208.27325782 2.86050763 207.49723279 2.85720399 C204.96494501 2.84888068 202.4328923 2.85483645 199.90060049 2.86069977 C198.07001247 2.85768012 196.23942571 2.85379158 194.40884119 2.84910721 C189.37151393 2.83879381 184.33425758 2.84101755 179.29692441 2.8452878 C173.86657553 2.84774908 168.43624398 2.83874812 163.0059014 2.83125031 C152.36282305 2.81848301 141.71976991 2.81671228 131.07668519 2.81905057 C122.42416622 2.82083221 113.77165492 2.81908739 105.11913687 2.81482613 C103.88853197 2.81423094 102.65792706 2.81363575 101.3900311 2.81302253 C98.89012827 2.81181079 96.39022545 2.81059665 93.89032263 2.80938015 C73.10345154 2.79973672 52.31659171 2.79930392 31.52971953 2.80468407 C30.86847864 2.80485515 30.20723776 2.80502624 29.52595927 2.80520251 C28.18876692 2.80554917 26.85157457 2.8058977 25.51438223 2.8062481 C4.72253194 2.81160149 -16.06927589 2.80368666 -36.86111826 2.78521454 C-60.22482459 2.76448179 -83.5885048 2.75380568 -106.95222086 2.75779003 C-119.32077396 2.75970219 -131.68928842 2.75721337 -144.05783457 2.74307549 C-154.59167351 2.73115685 -165.12545003 2.72976199 -175.65928984 2.74186566 C-181.03198261 2.74775192 -186.40456126 2.74886082 -191.77724642 2.73686326 C-196.70115877 2.72599594 -201.62486181 2.72911805 -206.54876441 2.74312494 C-208.32474288 2.7457696 -210.10073779 2.74341264 -211.8767001 2.73538908 C-232.38573955 2.64920571 -245.72916428 6.61532478 -259.62918466 22.30889618 Z " fill="#FCFAFA" transform="translate(515.6916846632957,236.8786038160324)"/>
<path d="M0 0 C4.62822743 1.85129097 6.56215732 4.73354673 9 9 C9.50320601 12.2907666 9.50320601 12.2907666 9.50780869 15.9383831 C9.51726431 16.95419423 9.51726431 16.95419423 9.52691096 17.9905268 C9.54316646 20.25842665 9.53101071 22.52526928 9.51898193 24.79318237 C9.52485772 26.43591342 9.53248504 28.07863897 9.541713 29.7213546 C9.56199423 34.23431968 9.55741389 38.74697079 9.54880548 43.25996065 C9.54386624 48.12701251 9.56193857 52.99398494 9.57722473 57.86100769 C9.6005543 66.29307744 9.6092845 74.72506115 9.60811615 83.15716171 C9.60644798 95.34856288 9.62677073 107.53984922 9.65247145 119.73121978 C9.6935708 139.51058624 9.71687003 159.28993207 9.72900391 179.06933594 C9.74082932 198.28387434 9.76102012 217.4983739 9.79248047 236.71289062 C9.79441657 237.89715153 9.79635267 239.08141243 9.79834744 240.30156003 C9.80811191 246.24261274 9.81804104 252.18366517 9.82805204 258.12471747 C9.91089832 307.41645925 9.96486882 356.70820271 10 406 C9.34 406 8.68 406 8 406 C6.8719274 402.61578219 6.87397312 400.06047497 6.87250805 396.49157906 C6.87086422 395.82439627 6.86922038 395.15721349 6.86752674 394.46981305 C6.86319053 392.2182274 6.86599344 389.96670582 6.86869812 387.71511841 C6.86699675 386.09092085 6.86484743 384.4667237 6.86228687 382.84252727 C6.85768188 379.30293413 6.85627055 375.76335848 6.85725212 372.22376251 C6.85884201 366.46538096 6.85364904 360.70701683 6.84762573 354.94863892 C6.83950589 346.58857351 6.83456658 338.22851116 6.83133507 329.86844254 C6.82584431 316.66007448 6.80895316 303.45173233 6.78999329 290.24337769 C6.78363631 285.7271214 6.77732793 281.21086504 6.77101612 276.69460869 C6.76943236 275.56590006 6.7678486 274.43719143 6.76621684 273.27427951 C6.74827343 260.42064784 6.73204993 247.56701433 6.71704102 234.71337891 C6.71497721 232.95043766 6.71497721 232.95043766 6.71287171 231.15188144 C6.69093353 212.09859778 6.68018367 193.04532076 6.67267027 173.9920267 C6.66460616 154.44379317 6.64133902 134.89561674 6.6047166 115.3474158 C6.58266133 103.28221719 6.57303619 91.21713592 6.57921693 79.15191816 C6.58238559 70.88725815 6.57110071 62.62269851 6.54832252 54.35806955 C6.53562414 49.58582976 6.52952167 44.81381351 6.54073906 40.04156494 C6.55087012 35.67549638 6.54273633 31.30986279 6.5198761 26.94384585 C6.51486126 25.36176414 6.51664861 23.77964373 6.52580877 22.19758059 C6.53726208 20.05122711 6.5242464 17.9063691 6.50501537 15.76010323 C6.50403856 14.56674956 6.50306176 13.3733959 6.50205535 12.14388001 C5.89858212 8.36491934 4.64999533 6.70892993 2 4 C-1.45739557 2.27130221 -5.21975568 2.51033105 -9 3 C-11.87029869 4.79393668 -13.49131638 5.98263276 -15 9 C-15.10037406 11.15209281 -15.13392573 13.3073821 -15.1386652 15.46180916 C-15.14150742 16.13608957 -15.14434964 16.81036999 -15.14727798 17.50508314 C-15.15566507 19.7867769 -15.15689632 22.06842015 -15.15821838 24.35012817 C-15.16278101 25.99352607 -15.16778058 27.63692279 -15.17318195 29.28031814 C-15.18680661 33.81362327 -15.19419389 38.34692087 -15.20060861 42.88024116 C-15.20859361 47.76233288 -15.22229789 52.64440884 -15.23532104 57.52648926 C-15.25711084 65.9908003 -15.27524614 74.45511292 -15.29092598 82.91943741 C-15.31360186 95.15755391 -15.34174782 107.39565298 -15.37124526 119.63375472 C-15.4189492 139.48743686 -15.46220577 159.34112613 -15.50268555 179.19482422 C-15.54202623 198.48519444 -15.58344902 217.77555833 -15.62768555 237.06591797 C-15.63040982 238.25421676 -15.63313409 239.44251555 -15.63594092 240.6668234 C-15.64962016 246.62794257 -15.66334048 252.58906165 -15.67708123 258.55018067 C-15.79109002 308.03344059 -15.89788961 357.5167142 -16 407 C-16.33 407 -16.66 407 -17 407 C-17.9372922 403.03579589 -18.12714991 399.34855436 -18.13142776 395.27951145 C-18.1334804 394.61369732 -18.13553303 393.9478832 -18.13764787 393.26189288 C-18.14331007 391.02699871 -18.14186159 388.79216631 -18.14044189 386.55726624 C-18.14302596 384.94030465 -18.14603923 383.32334371 -18.1494453 381.70638365 C-18.15751335 377.25984393 -18.15930475 372.81332037 -18.16004276 368.3667742 C-18.16189359 363.57256044 -18.16944096 358.77835504 -18.17617798 353.98414612 C-18.18975922 343.50090374 -18.19578535 333.01766519 -18.20018864 322.53441548 C-18.20295073 315.99090891 -18.20718795 309.44740381 -18.21169281 302.90389824 C-18.22388391 284.79221852 -18.23418438 266.68053998 -18.2375679 248.56885624 C-18.23778747 247.40973761 -18.23800703 246.25061897 -18.23823325 245.05637553 C-18.23845153 243.89446917 -18.23866981 242.73256282 -18.2388947 241.53544718 C-18.23933817 239.1809394 -18.23978473 236.82643161 -18.24023438 234.47192383 C-18.2404558 233.30400421 -18.24067723 232.13608459 -18.24090537 230.93277346 C-18.24485573 211.99667098 -18.2623177 193.06060693 -18.2855939 174.1245193 C-18.30928989 154.69037723 -18.32176891 135.25625447 -18.32293582 115.82209772 C-18.32385343 104.90749578 -18.32962754 93.99294395 -18.34775543 83.07835579 C-18.3631326 73.78718014 -18.3682909 64.49607007 -18.36001733 55.20488412 C-18.35610271 50.46290766 -18.35707999 45.7210634 -18.37107468 40.97910309 C-18.3837646 36.63966934 -18.3826595 32.30046779 -18.37048396 27.96103459 C-18.36851846 26.38975305 -18.3716446 24.81845534 -18.38032833 23.24719656 C-18.39137661 21.11329123 -18.38396467 18.98021179 -18.3719368 16.84632969 C-18.37253389 15.66051542 -18.37313097 14.47470115 -18.37374616 13.25295311 C-17.79530757 8.21843017 -16.115665 5.00941119 -12.375 1.625 C-8.0588127 -0.45316426 -4.70665253 -0.70599788 0 0 Z " fill="#FCFCFB" transform="translate(314,343)"/>
<path d="M0 0 C6.9488137 -0.00214761 13.89762547 -0.00539583 20.84643817 -0.00967932 C69.56159849 -0.0390163 118.2751035 0.04190235 166.98858172 0.47701991 C170.13651977 0.5039421 173.28446611 0.52750993 176.43243796 0.55010331 C181.33245539 0.58581772 186.23228865 0.63123362 191.13214785 0.68431914 C192.91416009 0.70226261 194.6962066 0.71713005 196.4782725 0.72856295 C213.21675881 0.84078009 229.71713102 1.53021187 242.30831534 14.12139618 C247.46755331 20.03628012 251.99745901 26.69169358 252.55831534 34.68389618 C252.47581534 35.48827118 252.39331534 36.29264618 252.30831534 37.12139618 C250.05299198 34.52777433 248.70675105 31.87766053 247.37081534 28.74639618 C242.13687187 16.74949206 234.23528891 10.88148878 222.30831534 6.12139618 C221.58469494 5.77513351 220.86107455 5.42887084 220.11552626 5.07211536 C216.63144498 3.89216025 213.41277364 3.84400662 209.77965933 3.86692059 C209.02645857 3.86371411 208.27325782 3.86050763 207.49723279 3.85720399 C204.96494501 3.84888068 202.4328923 3.85483645 199.90060049 3.86069977 C198.07001247 3.85768012 196.23942571 3.85379158 194.40884119 3.84910721 C189.37151393 3.83879381 184.33425758 3.84101755 179.29692441 3.8452878 C173.86657553 3.84774908 168.43624398 3.83874812 163.0059014 3.83125031 C152.36282305 3.81848301 141.71976991 3.81671228 131.07668519 3.81905057 C122.42416622 3.82083221 113.77165492 3.81908739 105.11913687 3.81482613 C103.88853197 3.81423094 102.65792706 3.81363575 101.3900311 3.81302253 C98.89012827 3.81181079 96.39022545 3.81059665 93.89032263 3.80938015 C73.10345154 3.79973672 52.31659171 3.79930392 31.52971953 3.80468407 C30.86847864 3.80485515 30.20723776 3.80502624 29.52595927 3.80520251 C28.18876692 3.80554917 26.85157457 3.8058977 25.51438223 3.8062481 C4.72253194 3.81160149 -16.06927589 3.80368666 -36.86111826 3.78521454 C-60.22482459 3.76448179 -83.5885048 3.75380568 -106.95222086 3.75779003 C-119.32077396 3.75970219 -131.68928842 3.75721337 -144.05783457 3.74307549 C-154.59167351 3.73115685 -165.12545003 3.72976199 -175.65928984 3.74186566 C-181.03198261 3.74775192 -186.40456126 3.74886082 -191.77724642 3.73686326 C-196.70115877 3.72599594 -201.62486181 3.72911805 -206.54876441 3.74312494 C-208.32474288 3.7457696 -210.10073779 3.74341264 -211.8767001 3.73538908 C-227.99233382 3.66766774 -241.2446867 4.83160999 -253.27371591 16.66045868 C-258.28117492 21.67479815 -258.28117492 21.67479815 -260.69168466 28.12139618 C-261.35168466 28.12139618 -262.01168466 28.12139618 -262.69168466 28.12139618 C-262.83605966 29.23514618 -262.98043466 30.34889618 -263.12918466 31.49639618 C-263.69168466 35.12139618 -263.69168466 35.12139618 -264.69168466 37.12139618 C-264.82704569 39.76158958 -264.90433767 42.37415683 -264.92996591 45.01592743 C-264.93803766 45.80029679 -264.94610941 46.58466614 -264.95442575 47.39280427 C-264.96826528 49.05467245 -264.97898803 50.71656905 -264.98685068 52.37847626 C-265.00404819 54.91377754 -265.04793121 57.44776933 -265.09207529 59.98272431 C-265.10220382 61.5979491 -265.11071942 63.21318497 -265.11746591 64.82842743 C-265.134974 65.58380295 -265.15248209 66.33917847 -265.17052072 67.11744416 C-265.155278 70.83706159 -264.82226491 72.91842597 -262.79007334 76.07720673 C-259.8449927 78.94621897 -259.11471723 79.1005913 -254.87918466 79.30889618 C-251.41899777 79.25227494 -248.71518145 78.95381848 -245.69168466 77.12139618 C-244.33459238 73.54113029 -244.56554684 69.83050312 -244.55105966 66.04717743 C-244.53272089 64.64286448 -244.5131496 63.23856718 -244.49246591 61.83428681 C-244.46363027 59.64008966 -244.44168757 57.44689801 -244.44119638 55.2524997 C-244.42759456 46.65517438 -244.3513019 39.13693061 -238.69168466 32.12139618 C-235.98963658 29.55115532 -233.2294673 27.37673841 -229.69168466 26.12139618 C-228.34815053 26.41088696 -227.01202748 26.73984182 -225.69168466 27.12139618 C-226.37875498 27.5197165 -227.06582529 27.91803681 -227.77371591 28.32842743 C-228.6747706 28.85823212 -229.57582529 29.38803681 -230.50418466 29.93389618 C-231.39750498 30.4559665 -232.29082529 30.97803681 -233.21121591 31.51592743 C-236.71678026 33.78488326 -238.35981482 35.12578667 -239.69168466 39.12139618 C-239.7965929 41.37231889 -239.84687929 43.62593663 -239.86746591 45.87920868 C-239.89068584 47.24120294 -239.91480403 48.60318211 -239.93973154 49.96514618 C-239.97463995 52.09773266 -240.00407918 54.22977153 -240.0176124 56.36260712 C-240.13778005 72.22473743 -240.13778005 72.22473743 -244.69168466 79.12139618 C-247.61796788 81.88046321 -250.16462457 82.3497757 -254.06668466 82.62139618 C-258.29505096 82.46609725 -260.89216883 81.25296083 -264.28152841 78.80108368 C-269.34861141 72.76550006 -268.13350416 63.62787717 -268.12918466 56.24639618 C-268.1295875 55.54986939 -268.12999033 54.8533426 -268.13040537 54.13570893 C-268.07810905 38.5015909 -266.24348787 25.71606322 -254.69168466 14.12139618 C-254.02781748 13.45495087 -253.36395029 12.78850556 -252.67996591 12.10186493 C-238.70364563 -0.9408701 -219.54460351 0.81133831 -201.56277841 0.70733368 C-199.39804424 0.68828171 -197.23331549 0.66860454 -195.06859201 0.64837372 C-189.04094037 0.59534369 -183.01326794 0.55602461 -176.98549265 0.52010071 C-173.09257276 0.49617113 -169.19968864 0.46892127 -165.30679697 0.44079316 C-110.20557693 0.04638289 -55.10239131 0.01700381 0 0 Z " fill="#F3F0EE" transform="translate(515.6916846632957,236.8786038160324)"/>
<path d="M0 0 C3.33642424 1.89718241 6.65548261 3.91510869 9 7 C9.81224273 10.29906733 10.12567106 13.37790325 10.12863445 16.76831722 C10.1318589 17.70463889 10.13508335 18.64096056 10.1384055 19.60565561 C10.1368569 20.62588188 10.1353083 21.64610815 10.13371277 22.69725037 C10.13597833 23.78759758 10.13824388 24.87794479 10.14057809 26.00133282 C10.14691755 29.66162517 10.14608876 33.32188049 10.14526367 36.98217773 C10.14825516 39.60368905 10.15165767 42.22519992 10.15544128 44.84671021 C10.16374396 51.23221145 10.16649594 57.61770346 10.16705366 64.00320964 C10.16752894 69.19325807 10.16958426 74.38330345 10.17275429 79.57335091 C10.18155927 94.28853781 10.18617383 109.00371743 10.18542381 123.71890699 C10.18538386 124.51203145 10.1853439 125.30515592 10.18530273 126.12231445 C10.18526185 126.91640723 10.18522097 127.7105 10.18517885 128.52865619 C10.18477227 141.40238493 10.1943453 154.27608443 10.2084411 167.1498047 C10.22280085 180.36887912 10.22971153 193.58793927 10.22884732 206.80702168 C10.22851525 214.2284052 10.231267 221.64975807 10.24202538 229.07113457 C10.25207556 236.04865573 10.25179914 243.02611107 10.24450874 250.00363541 C10.24346049 252.56669903 10.24583999 255.12976666 10.2518692 257.69282341 C10.25955787 261.18721454 10.25496491 264.68137991 10.24723816 268.17576599 C10.25238172 269.19376154 10.25752529 270.21175709 10.26282471 271.26060098 C10.23105937 277.74608481 9.97675064 282.71913388 5.5625 287.8125 C2.48830684 290.43681123 0.68955645 290.93494751 -3.3125 291.3125 C-7.78768692 290.93324687 -9.64980002 289.96949544 -13 287 C-16.33222044 281.00711803 -16.42522234 275.74846831 -16.38095093 268.98631287 C-16.3856309 267.8860897 -16.39031087 266.78586654 -16.39513266 265.65230328 C-16.40708615 261.97047167 -16.39762373 258.28901202 -16.38818359 254.60717773 C-16.39224911 251.96565669 -16.39748245 249.32416116 -16.40411377 246.68264771 C-16.41744029 240.25594569 -16.41457834 233.82934889 -16.40587585 227.40264278 C-16.39909603 222.17926328 -16.39818386 216.95591323 -16.4014473 211.73253059 C-16.401907 210.98863919 -16.40236669 210.24474778 -16.40284032 209.47831421 C-16.40379951 207.96704633 -16.40477215 206.45577845 -16.4057581 204.94451059 C-16.41430867 190.78007613 -16.40448278 176.61569996 -16.388357 162.45127506 C-16.37495135 150.29992568 -16.37728457 138.14866228 -16.39111328 125.99731445 C-16.40717022 111.88142976 -16.41348764 97.76559611 -16.40427649 83.64970356 C-16.40332085 82.1443536 -16.40237774 80.63900362 -16.4014473 79.13365364 C-16.40098447 78.39301717 -16.40052164 77.65238069 -16.40004479 76.88930069 C-16.39745545 71.67223023 -16.40182464 66.45519219 -16.40888596 61.23812675 C-16.4173023 54.88029058 -16.41501794 48.52256551 -16.39904372 42.16474205 C-16.39116314 38.92142543 -16.38968248 35.67833216 -16.39799118 32.43501091 C-16.40616966 28.91872277 -16.39592911 25.40295814 -16.38095093 21.88670349 C-16.38764309 20.86229029 -16.39433526 19.83787708 -16.40123022 18.78242105 C-16.35697834 13.43897085 -16.05007266 9.59298812 -13 5 C-8.6224943 1.04956803 -5.9550502 -0.57260098 0 0 Z M-13 8 C-13.33 8.33 -13.66 8.66 -14 9 C-14.09936557 10.45480993 -14.12922782 11.91442572 -14.13142776 13.37262344 C-14.13526891 14.32249799 -14.13911005 15.27237254 -14.1430676 16.25103116 C-14.14220112 17.3069366 -14.14133463 18.36284205 -14.14044189 19.45074463 C-14.14341302 20.56288102 -14.14638414 21.67501741 -14.1494453 22.8208549 C-14.15817513 26.57881957 -14.15964415 30.33675254 -14.16113281 34.09472656 C-14.16575799 36.776384 -14.17076127 39.45803849 -14.17617798 42.13969421 C-14.18978201 49.44758722 -14.19578948 56.75547477 -14.20018864 64.06337833 C-14.20294805 68.62421091 -14.20718489 73.18504136 -14.21169281 77.7458725 C-14.22388909 90.36638379 -14.2341871 102.98689337 -14.2375679 115.60741043 C-14.23778747 116.41577537 -14.23800703 117.22414031 -14.23823325 118.05700116 C-14.23845153 118.86733656 -14.23866981 119.67767197 -14.2388947 120.51256299 C-14.23933817 122.15469694 -14.23978474 123.79683089 -14.24023438 125.43896484 C-14.2404558 126.25352562 -14.24067723 127.0680864 -14.24090537 127.90733084 C-14.24485312 141.10532872 -14.26230482 154.30327137 -14.2855939 167.50124791 C-14.30929588 181.04224452 -14.32176926 194.58321341 -14.32293582 208.1242311 C-14.32385333 215.73066064 -14.3296245 223.33701828 -14.34775543 230.94342804 C-14.36314102 237.42109824 -14.36828612 243.89867432 -14.36001733 250.37635931 C-14.35610504 253.68230232 -14.35869358 256.98801565 -14.37107468 260.29394341 C-14.38370772 263.87656742 -14.37796412 267.45870081 -14.36749268 271.0413208 C-14.37554908 272.08830336 -14.38360548 273.13528592 -14.39190602 274.21399522 C-14.39107495 281.12172867 -14.39107495 281.12172867 -11 287 C-6.97387033 289.68408645 -3.73183082 289.80610406 1 289 C4.57339883 287.07643127 6.69607513 284.9117746 8 281 C8.09514949 279.46880936 8.13444544 277.93382633 8.1398077 276.39969158 C8.14549894 275.44993503 8.15119018 274.50017848 8.15705389 273.52164143 C8.1588237 271.95338139 8.1588237 271.95338139 8.16062927 270.35343933 C8.16571709 269.24438321 8.17080491 268.13532709 8.17604691 266.9926632 C8.19180826 263.25707297 8.20030611 259.52150214 8.20874023 255.78588867 C8.21584715 253.79551124 8.22296028 251.80513379 8.23058056 249.81475826 C8.26389959 241.10764835 8.28542307 232.40052665 8.30378041 223.69337389 C8.30857548 221.42660766 8.31355877 219.15984191 8.31858563 216.89307618 C8.34955253 202.81915713 8.3762397 188.74523397 8.39300442 174.6712904 C8.39695395 171.41163819 8.40095695 168.15198605 8.4050293 164.89233398 C8.40603766 164.08215713 8.40704602 163.27198028 8.40808494 162.43725262 C8.42509811 149.30788809 8.46621531 136.17871184 8.51705229 123.04943927 C8.56880563 109.57278799 8.59794347 96.09623361 8.6052013 82.61948377 C8.609866 75.05151209 8.62464276 67.48384893 8.6649456 59.91597557 C8.69922154 53.47198612 8.71319496 47.02836086 8.70052146 40.58428546 C8.69468883 37.29617541 8.70186248 34.00899847 8.7286911 30.72097015 C8.75622994 27.155841 8.74692521 23.59265439 8.72825623 20.0275116 C8.74505115 18.98869707 8.76184608 17.94988254 8.77914995 16.87958878 C8.71577205 12.04878023 8.55454507 8.94100228 5.1168375 5.35838795 C1.13238226 2.34350789 -0.84631064 2.18566989 -5.65625 2.4609375 C-9.197623 3.27545329 -10.85683612 5.16549294 -13 8 Z " fill="#F0ECEA" transform="translate(450,380)"/>
<path d="M0 0 C2.63116432 0.0011953 5.26232907 0.00164422 7.89349365 0.00138855 C13.37661162 0.00231773 18.8596734 0.01090156 24.34277344 0.0246582 C30.64241766 0.04040711 36.94200072 0.04565473 43.24166322 0.04492265 C49.35950024 0.04430824 55.47731464 0.04956074 61.59514618 0.05771446 C64.17370232 0.06087457 66.7522602 0.06286225 69.33081818 0.06360817 C113.5934288 0.09045146 113.5934288 0.09045146 128.09375 13.74609375 C136.80957618 23.0010432 140.16881877 34.14003397 139.90625 46.5703125 C139.39355174 51.01844465 138.25795376 53.07813365 135.08984375 56.12890625 C131.02385568 58.91870828 126.21287842 58.82775339 121.484375 58.23046875 C118.04634292 56.2965757 116.79161038 55.27034235 115.671875 51.48046875 C115.61 50.73796875 115.548125 49.99546875 115.484375 49.23046875 C117.484375 51.23046875 119.484375 53.23046875 121.484375 55.23046875 C125.81225528 55.69544762 129.47265842 55.67309475 133.484375 53.91796875 C135.74927437 52.30434475 135.74927437 52.30434475 136.484375 49.23046875 C137.42481608 36.51138859 135.66667226 27.24028268 127.3984375 17.265625 C119.26078772 8.61314432 108.43951579 3.81962766 96.60108757 3.04077721 C93.26579049 2.96444613 89.9355367 2.94878721 86.59936523 2.95581055 C84.70473793 2.94814415 84.70473793 2.94814415 82.77183533 2.94032288 C79.32922513 2.92701466 75.88672529 2.92634553 72.44409442 2.92888618 C69.55470542 2.92996251 66.66533814 2.92505515 63.77595383 2.92028075 C56.94656636 2.90921155 50.11723388 2.90873207 43.2878418 2.91479492 C36.28342656 2.92081854 29.27921303 2.90855892 22.27483219 2.88722485 C16.22857794 2.86949801 10.1823872 2.86362521 4.13610798 2.8668626 C0.53962628 2.86865973 -3.05671187 2.86619995 -6.65316963 2.85214806 C-36.04125994 1.88680975 -36.04125994 1.88680975 -61.34375 14.890625 C-65.50795338 19.33875134 -68.06260757 24.7022918 -70.515625 30.23046875 C-70.88300781 31.00132812 -71.25039063 31.7721875 -71.62890625 32.56640625 C-72.77848214 36.02019814 -72.89131472 39.09457013 -72.953125 42.73046875 C-72.99308594 44.01953125 -73.03304688 45.30859375 -73.07421875 46.63671875 C-72.38211712 51.08940058 -71.00568661 52.47947901 -67.515625 55.23046875 C-63.6538791 56.54510565 -62.06737505 56.45329089 -58.265625 54.91796875 C-55.49408022 53.36416054 -55.49408022 53.36416054 -53.515625 51.23046875 C-53.2045876 49.19720573 -52.96512193 47.15268729 -52.765625 45.10546875 C-51.7249082 37.85247319 -49.59980165 33.68574818 -44.04407501 28.98551369 C-37.68658976 24.32465987 -31.63902278 24.52185325 -23.97460938 24.58349609 C-22.6169569 24.57671043 -21.25931365 24.56780199 -19.90168762 24.5569458 C-16.23415379 24.53425772 -12.56732751 24.54294454 -8.89978218 24.55884123 C-5.05047918 24.57155515 -1.20123425 24.55974494 2.64807129 24.5519104 C9.11070564 24.54282972 15.57305371 24.55475993 22.03564453 24.57861328 C29.49307845 24.60582181 36.94982875 24.5970065 44.40724611 24.56948125 C50.82537298 24.5467458 57.2432948 24.54361165 63.66144896 24.5566746 C67.48802098 24.56444489 71.31427232 24.56557805 75.14082336 24.54899216 C78.73955889 24.53448153 82.33741845 24.54468709 85.93605995 24.57346344 C87.87628114 24.58316083 89.81657697 24.5684303 91.75675964 24.55282593 C99.89756833 24.65101062 105.26437615 25.9131233 111.03279877 31.81461143 C114.52633503 35.84706609 115.61413771 38.10897738 115.546875 43.35546875 C115.53785156 44.26554687 115.52882813 45.175625 115.51953125 46.11328125 C115.50212891 47.16128906 115.50212891 47.16128906 115.484375 48.23046875 C114.33304086 46.03877243 113.49832906 44.30621933 113.046875 41.85546875 C112.04941023 37.20063316 110.08339636 33.35469826 106.484375 30.23046875 C99.54424917 26.63504324 92.11688854 26.79750434 84.48828125 26.82641602 C83.21395233 26.81955276 81.93962341 26.81268951 80.62667847 26.80561829 C77.15556939 26.78778519 73.68471445 26.78883622 70.21357346 26.79456067 C67.3061179 26.79766623 64.3987102 26.79154511 61.49126148 26.78552192 C54.62857335 26.77151129 47.76600981 26.77300961 40.90332031 26.78442383 C33.84303359 26.79590778 26.78312661 26.7818171 19.7228899 26.75502735 C13.64106239 26.73282131 7.55935366 26.72624379 1.47748852 26.73210377 C-2.14619363 26.73546214 -5.7696323 26.73313319 -9.39328003 26.71585274 C-13.43560596 26.69741386 -17.47719956 26.71162082 -21.51953125 26.72875977 C-22.70733185 26.7190918 -23.89513245 26.70942383 -25.118927 26.69946289 C-31.99499787 26.76038015 -37.61323497 27.50209658 -43.515625 31.23046875 C-47.66145445 35.59449975 -48.43170575 40.61332205 -49.734375 46.3125 C-51.11273931 51.46069071 -52.98679967 55.21125186 -57.515625 58.23046875 C-62.70499844 58.9936119 -67.08478343 59.18436313 -71.515625 56.23046875 C-75.11559425 50.83051488 -77.31697635 46.1270797 -76.08203125 39.484375 C-72.6122792 25.67715478 -67.12195368 14.51852301 -55.0390625 6.609375 C-49.48102364 3.41694772 -44.17106205 1.7226423 -37.81738281 1.07299805 C-37.04929417 0.99209018 -36.28120552 0.91118231 -35.48984146 0.82782269 C-23.69583529 -0.27159746 -11.83213286 -0.03582488 0 0 Z " fill="#ECE7E4" transform="translate(476.515625,173.76953125)"/>
<path d="M0 0 C0.33 0 0.66 0 1 0 C1.776465 8.38582196 -0.96193079 14.09877841 -6.08984375 20.68359375 C-8.30465633 23.23157472 -10.59015584 25.636499 -13 28 C-13.53109375 28.52722656 -14.0621875 29.05445313 -14.609375 29.59765625 C-23.81696879 37.35766442 -38.62852402 37.58462473 -49.96572876 37.50120544 C-51.40897046 37.50510986 -52.85220828 37.51075935 -54.29543722 37.51797634 C-58.21573867 37.5325852 -62.13563248 37.52263788 -66.05592012 37.50823963 C-70.3013626 37.49704995 -74.54675158 37.50909857 -78.79219055 37.51808167 C-87.09043094 37.53196138 -95.38851838 37.52449741 -103.68675138 37.50940608 C-113.36287895 37.49248343 -123.03896909 37.49576405 -132.71510689 37.49950016 C-149.98555777 37.50536893 -167.25593557 37.491245 -184.52636719 37.46655273 C-201.26239764 37.44262743 -217.99833051 37.43555265 -234.734375 37.44604492 C-252.98773294 37.45746804 -271.24104583 37.45936755 -289.49440324 37.44494683 C-291.44265325 37.44342108 -293.39090327 37.44190073 -295.33915329 37.44038582 C-296.77678391 37.4392491 -296.77678391 37.4392491 -298.24345756 37.43808941 C-304.97918225 37.43335794 -311.71488674 37.43518988 -318.45061111 37.43945122 C-326.66392415 37.44439045 -334.87714516 37.4383374 -343.09043719 37.41855692 C-347.27639689 37.40872215 -351.46221679 37.40353836 -355.64818382 37.41144943 C-359.4873822 37.41855644 -363.32629974 37.41158573 -367.16546135 37.3938458 C-369.19612209 37.38794761 -371.22680944 37.39657494 -373.25745738 37.40589231 C-387.67254642 37.30716739 -400.46318192 34.57333817 -411.3671875 24.734375 C-416.51007237 19.27159777 -420.7924106 12.77455615 -421.125 5.125 C-421.08375 4.42375 -421.0425 3.7225 -421 3 C-420.73574219 3.52980469 -420.47148437 4.05960938 -420.19921875 4.60546875 C-419.80347656 5.39566406 -419.40773438 6.18585937 -419 7 C-418.51144531 7.98613281 -418.02289063 8.97226562 -417.51953125 9.98828125 C-411.48880083 21.73233523 -405.55466022 28.22794803 -393 33 C-388.51531077 33.76842765 -384.19965255 34.12610331 -379.6536665 34.13142776 C-378.41625751 34.13526891 -377.17884852 34.13911005 -375.90394229 34.1430676 C-374.54404964 34.14228751 -373.18415705 34.14140876 -371.82426453 34.14044189 C-370.36929474 34.14302788 -368.91432566 34.14604169 -367.45935756 34.1494453 C-363.46972 34.15749081 -359.48010046 34.15930349 -355.49045575 34.16004276 C-351.1842756 34.16189754 -346.8781047 34.16944689 -342.57192993 34.17617798 C-333.16081741 34.18974335 -323.74970915 34.19578292 -314.33858848 34.20018864 C-308.46072344 34.2029535 -302.58286004 34.20719124 -296.70499611 34.21169281 C-280.42558108 34.223882 -264.14616735 34.23418274 -247.86674786 34.2375679 C-246.82544255 34.23778747 -245.78413725 34.23800703 -244.71127724 34.23823325 C-243.14562922 34.23856067 -243.14562922 34.23856067 -241.54835194 34.2388947 C-239.43335768 34.23933816 -237.31836341 34.23978473 -235.20336914 34.24023438 C-233.62971104 34.24056652 -233.62971104 34.24056652 -232.02426187 34.24090537 C-215.02124491 34.24485426 -198.01827078 34.26231261 -181.01527037 34.2855939 C-163.55178713 34.30931246 -146.08832539 34.32176994 -128.62482578 34.32293582 C-118.8223616 34.32385217 -109.01995328 34.32959474 -99.2175045 34.34775543 C-90.87181083 34.36316306 -82.52619028 34.36827287 -74.18048509 34.36001733 C-69.9240574 34.35611349 -65.66777694 34.35702749 -61.41136742 34.37107468 C-57.51096277 34.38382911 -53.61081577 34.38260267 -49.71041141 34.37048396 C-48.30331632 34.36852966 -46.89620289 34.37159305 -45.48913356 34.38032833 C-32.10802147 34.45810667 -21.76175135 32.31341914 -11.8359375 22.9609375 C-5.7657008 16.5269413 -0.7134135 9.03657099 0 0 Z " fill="#FEFEFE" transform="translate(719,747)"/>
<path d="M0 0 C3.66195958 2.07280731 5.66024277 3.49036416 8 7 C9.30470169 14.31577045 9.13801265 21.9038841 9.10247803 29.31161499 C9.1013656 30.39554366 9.10025317 31.47947232 9.09910703 32.59624732 C9.09410072 36.19879553 9.08175594 39.8012789 9.06933594 43.40380859 C9.06409851 45.99826989 9.05927219 48.59273205 9.05482483 51.18719482 C9.04167451 58.21146877 9.02080817 65.23570667 8.99825954 72.25995588 C8.98419614 76.64830317 8.97170817 81.03665405 8.9595108 85.42500687 C8.92543713 97.58613747 8.88950521 109.74725907 8.84641647 121.90836143 C8.84229441 123.07281928 8.84229441 123.07281928 8.83808906 124.26080153 C8.83533239 125.0388814 8.83257572 125.81696127 8.82973552 126.61861932 C8.82415025 128.19512772 8.81856785 129.77163612 8.81298828 131.34814453 C8.8102191 132.13013476 8.80744991 132.91212499 8.80459681 133.7178119 C8.75999778 146.41397734 8.72898322 159.11013699 8.70378849 171.80635433 C8.67770444 184.85502477 8.64047221 197.90362427 8.59196877 210.95223105 C8.56501215 218.27343883 8.54284223 225.59459142 8.53295135 232.91584396 C8.52359912 239.79255989 8.49901829 246.66907503 8.46401787 253.5457077 C8.45360319 256.07209054 8.44831011 258.59850033 8.44845009 261.12490463 C8.44786091 264.56692059 8.42900681 268.00836272 8.40545654 271.45028687 C8.41170473 272.9580011 8.41170473 272.9580011 8.41807914 274.49617422 C8.36395207 279.45463947 8.30594727 283.01328351 5 287 C0.90423386 289.91307398 -2.75608584 291.14512332 -7.75 290.5625 C-12.23933031 288.40416812 -15.05587116 286.10221953 -17.12000465 281.50617123 C-18.32976541 276.68611352 -18.28245302 272.10278598 -18.26742554 267.15126038 C-18.27195665 266.05668076 -18.27648776 264.96210113 -18.28115618 263.83435243 C-18.29381914 260.16564845 -18.29217857 256.49709256 -18.29052734 252.82836914 C-18.29651132 250.1984793 -18.30331656 247.56859121 -18.31088257 244.93870544 C-18.32747804 238.53629068 -18.33299142 232.13391275 -18.33410732 225.73147828 C-18.33505831 220.52715632 -18.33917114 215.32284649 -18.34550858 210.11852837 C-18.3631156 195.35897313 -18.37234808 180.59944695 -18.37084763 165.83988113 C-18.37076772 165.0445978 -18.3706878 164.24931447 -18.37060547 163.42993164 C-18.37052371 162.63367606 -18.37044195 161.83742049 -18.37035771 161.01703595 C-18.36954455 148.10844291 -18.38869108 135.19996648 -18.4168822 122.29140718 C-18.44560924 109.03273961 -18.45942266 95.77412892 -18.45769465 82.51542944 C-18.45703077 75.07331156 -18.4625222 67.63131599 -18.48405075 60.18922615 C-18.50416324 53.19192761 -18.50359075 46.19489156 -18.48901749 39.19758034 C-18.48692239 36.6284828 -18.49167177 34.05936928 -18.5037384 31.49029922 C-18.51913653 27.98513465 -18.50991756 24.48086802 -18.49447632 20.97572327 C-18.50476344 19.95743173 -18.51505057 18.9391402 -18.52564943 17.88999134 C-18.46548197 11.71606307 -17.60105286 8.05929405 -14 3 C-9.78751392 -1.00628047 -5.50501742 -1.60145961 0 0 Z M-15 7 C-16.18731282 9.37462565 -16.12843569 10.81175444 -16.13422108 13.46164322 C-16.13867892 14.40592532 -16.14313676 15.35020743 -16.14772969 16.32310414 C-16.14754533 17.36763273 -16.14736097 18.41216132 -16.14717102 19.48834229 C-16.15084771 20.59246043 -16.1545244 21.69657857 -16.1583125 22.83415484 C-16.16938538 26.55903753 -16.17319927 30.28389235 -16.17700195 34.00878906 C-16.18326385 36.66926746 -16.18989728 39.32974283 -16.19691467 41.99021912 C-16.21668987 49.99244549 -16.22674677 57.99467314 -16.23564246 65.99691784 C-16.24002377 69.76376181 -16.245391 73.53060436 -16.25063133 77.2974472 C-16.26764491 89.81677076 -16.28213946 102.33609344 -16.28938007 114.85542679 C-16.29129002 118.10527803 -16.29321035 121.35512926 -16.29516602 124.60498047 C-16.29564976 125.41273221 -16.2961335 126.22048394 -16.2966319 127.05271301 C-16.30493358 140.14005903 -16.33027221 153.22731369 -16.36274669 166.31461981 C-16.39580376 179.74604134 -16.41382762 193.17741642 -16.41702431 206.60887885 C-16.41919071 214.1521952 -16.42795808 221.69537834 -16.45348549 229.23865509 C-16.4751741 235.66249161 -16.48325207 242.08616257 -16.47351871 248.51003155 C-16.4689685 251.78781858 -16.47307571 255.06519192 -16.49028015 258.34294701 C-16.50789278 261.89682972 -16.50094438 265.44984083 -16.48774719 269.00372314 C-16.49871644 270.03932884 -16.50968568 271.07493454 -16.52098733 272.14192224 C-16.46767087 278.07393022 -15.9822828 281.49945764 -12 286 C-8.28612182 288.47591878 -5.30417439 288.53907468 -1 288 C3.2533329 286.20414833 5.10994649 284.1753953 7 280 C7.44799228 276.38262058 7.40879329 272.78528318 7.38768005 269.14416504 C7.39306559 268.03677805 7.39845113 266.92939107 7.40399987 265.7884469 C7.41832999 262.07044075 7.41116307 258.3527881 7.40405273 254.63476562 C7.40975361 251.97221241 7.41661587 249.30968475 7.42485046 246.6471405 C7.44204886 240.16168516 7.44287642 233.67632666 7.43763756 227.19085443 C7.43359693 221.92022047 7.43503813 216.64961514 7.44038582 211.37898254 C7.44150845 210.2539798 7.44150845 210.2539798 7.44265376 209.10624972 C7.44418523 207.58265904 7.44572358 206.05906836 7.44726873 204.5354777 C7.46099728 190.24709414 7.45555337 175.95876534 7.44408352 161.67038304 C7.43414844 148.59547455 7.44709588 135.52070753 7.47101771 122.44582087 C7.49539269 109.02220638 7.50502068 95.59865783 7.49836498 82.17502165 C7.49486949 74.6379456 7.49712666 67.1009784 7.51461601 59.56391907 C7.52931792 53.14852547 7.52999984 46.73331736 7.5125451 40.31792748 C7.50401631 37.04430726 7.50408812 33.77108795 7.51719666 30.49747276 C7.53032011 26.94994404 7.51893476 23.40332391 7.50120544 19.85583496 C7.51081045 18.81936278 7.52041546 17.7828906 7.53031152 16.71501017 C7.48521746 12.34600555 7.44914591 9.74381363 5.15617466 5.94651031 C1.08708682 2.27309665 -1.39809033 1.51020227 -6.70703125 1.60546875 C-10.58307419 2.27238585 -12.32149114 4.1875657 -15 7 Z " fill="#F0EDEC" transform="translate(575,381)"/>
<path d="M0 0 C0.33 0 0.66 0 1 0 C1.04954105 5.17780166 1.08578636 10.35546446 1.10986328 15.53344727 C1.11990351 17.29388839 1.13353844 19.05431291 1.15087891 20.81469727 C1.17521436 23.34916285 1.18650296 25.88340739 1.1953125 28.41796875 C1.20563507 29.20149216 1.21595764 29.98501556 1.22659302 30.7922821 C1.22762686 35.8594095 0.83301787 39.76849998 -2.4375 43.75 C-6.0280162 46.62241296 -10.30157612 46.21656654 -14.66738892 46.31173706 C-15.47302017 46.33220069 -16.27865142 46.35266432 -17.10869575 46.37374806 C-19.87525268 46.44058155 -22.64189331 46.4982657 -25.40869141 46.55419922 C-26.89214172 46.58564266 -26.89214172 46.58564266 -28.40556073 46.61772132 C-59.39935524 47.25554711 -90.40296619 47.14692282 -121.40173682 47.13530041 C-127.74159675 47.13298574 -134.081454 47.13274245 -140.42131424 47.13381577 C-141.33698532 47.133969 -142.2526564 47.13412223 -143.19607509 47.13428011 C-145.05858957 47.13459996 -146.92110405 47.13492418 -148.78361852 47.1352527 C-166.10341323 47.13807986 -183.42320258 47.13486525 -200.74299641 47.12945233 C-215.45968909 47.12499444 -230.17637387 47.1257573 -244.89306641 47.13037109 C-262.15162587 47.13577957 -279.41018067 47.13779762 -296.66874087 47.13475883 C-298.52600328 47.13444042 -300.38326569 47.13412605 -302.24052811 47.13381577 C-303.15334806 47.13366149 -304.06616802 47.13350721 -305.00664919 47.13334826 C-311.30073297 47.13250113 -317.59481364 47.13393112 -323.88889694 47.13629532 C-388.30526883 47.15790292 -388.30526883 47.15790292 -419.8566792 46.7275846 C-422.28801795 46.69572627 -424.71942244 46.66849561 -427.15086818 46.64625382 C-430.43314647 46.61439087 -433.71455939 46.56369936 -436.99649048 46.50704956 C-438.42416445 46.49809005 -438.42416445 46.49809005 -439.88068032 46.48894954 C-444.72902519 46.38140111 -448.07805259 46.16430373 -452 43 C-454.37936691 40.37017342 -455.87059081 38.41588878 -456.19921875 34.8203125 C-455.96510369 30.84704542 -455.1993255 27.70391092 -452.875 24.4375 C-450 22 -450 22 -446.1875 21.625 C-445.135625 21.74875 -444.08375 21.8725 -443 22 C-443.556875 22.2475 -444.11375 22.495 -444.6875 22.75 C-448.04043581 24.56239774 -451.26557246 26.53114492 -453 30 C-453.50690256 35.77404399 -453.50690256 35.77404399 -451.25 40.9375 C-447.19950275 44.65045581 -443.07473361 44.12636878 -437.73101234 44.13142776 C-436.99375199 44.1334804 -436.25649164 44.13553303 -435.49689007 44.13764787 C-433.01293489 44.14332688 -430.529035 44.14185951 -428.04507446 44.14044189 C-426.25160959 44.143025 -424.45814529 44.14603801 -422.66468179 44.1494453 C-417.72561538 44.15752473 -412.7865635 44.15930539 -407.84749126 44.16004276 C-402.52496639 44.16189164 -397.20244909 44.16943807 -391.87992859 44.17617798 C-380.23757293 44.1897678 -368.59522072 44.19578683 -356.95285845 44.20018864 C-349.68688795 44.20294956 -342.42091879 44.2071866 -335.15494919 44.21169281 C-315.04712571 44.22388556 -294.93930331 44.23418536 -274.83147621 44.2375679 C-273.54421517 44.23778747 -272.25695413 44.23800703 -270.93068518 44.23823325 C-268.99511936 44.23856067 -268.99511936 44.23856067 -267.02045119 44.2388947 C-264.40556121 44.23933817 -261.79067123 44.23978473 -259.17578125 44.24023438 C-257.87869969 44.2404558 -256.58161814 44.24067723 -255.24523108 44.24090537 C-234.21714547 44.24485532 -213.18909449 44.2623153 -192.16102226 44.2855939 C-170.5844085 44.30928748 -149.00781212 44.32176882 -127.43118513 44.32293582 C-115.31155282 44.32385362 -103.19196563 44.32963249 -91.07234573 44.34775543 C-80.75457933 44.36312943 -70.43687197 44.36829283 -60.11909629 44.36001733 C-54.8525877 44.35610144 -49.58619813 44.35708614 -44.31970406 44.37107468 C-39.50097857 44.38375716 -34.68246224 44.38266606 -29.86373727 44.37048396 C-28.11813381 44.36851714 -26.37251581 44.37165054 -24.62693281 44.38032833 C-22.25792284 44.39136212 -19.88965873 44.38397472 -17.52066994 44.3719368 C-15.54519973 44.37283243 -15.54519973 44.37283243 -13.52982104 44.37374616 C-8.74032523 43.86662253 -5.3056841 42.53364696 -2.15698242 38.83520508 C-0.63356863 35.10205369 -0.52160492 31.60874757 -0.48828125 27.63671875 C-0.47033005 26.84473587 -0.45237885 26.05275299 -0.43388367 25.23677063 C-0.37993162 22.72040038 -0.34593437 20.20421815 -0.3125 17.6875 C-0.27931349 15.97588538 -0.24482259 14.26429552 -0.20898438 12.55273438 C-0.12421418 8.36862558 -0.05733157 4.18457107 0 0 Z " fill="#F5F2F2" transform="translate(768,274)"/>
<path d="M0 0 C15.40426288 -0.02344928 30.80852441 -0.04103791 46.21280098 -0.05181217 C53.36664556 -0.05694972 60.52047899 -0.0639435 67.67431641 -0.07543945 C73.91581317 -0.08546446 80.15730186 -0.09187187 86.39880645 -0.09408849 C89.69797191 -0.09538244 92.99710913 -0.0989236 96.29626846 -0.10573006 C141.0513714 -0.19433956 141.0513714 -0.19433956 155.609375 13.515625 C164.32520118 22.77057445 167.68444377 33.90956522 167.421875 46.33984375 C166.90917674 50.7879759 165.77357876 52.8476649 162.60546875 55.8984375 C158.53948068 58.68823953 153.72850342 58.59728464 149 58 C145.56196792 56.06610695 144.30723538 55.0398736 143.1875 51.25 C143.125625 50.5075 143.06375 49.765 143 49 C146 52 146 52 149 55 C153.32788028 55.46497887 156.98828342 55.442626 161 53.6875 C163.26489937 52.073876 163.26489937 52.073876 164 49 C164.94044108 36.28091984 163.18229726 27.00981393 154.9140625 17.03515625 C146.7995086 8.40723262 135.98797389 3.61599156 124.20740128 2.80860901 C121.01794642 2.72973181 117.83350176 2.71009961 114.64306641 2.71289062 C113.4371283 2.70605759 112.23119019 2.69922455 110.9887085 2.69218445 C107.70812992 2.67513411 104.42765577 2.66652816 101.1470418 2.66114616 C97.70511055 2.65290738 94.26325989 2.63198113 90.82138062 2.61193848 C81.34569735 2.55901152 71.86996484 2.52539737 62.39419556 2.49217987 C53.6881829 2.46148632 44.98224032 2.42670415 36.27631891 2.37586927 C32.85300039 2.35635321 29.42976904 2.34110919 26.00639725 2.33552551 C22.19769134 2.32811465 18.38921322 2.30887958 14.58056641 2.28710938 C12.87871689 2.28858223 12.87871689 2.28858223 11.14248657 2.29008484 C10.10801392 2.28181168 9.07354126 2.27353851 8.00772095 2.26501465 C7.10775705 2.26208153 6.20779316 2.25914841 5.28055763 2.2561264 C3 2 3 2 0 0 Z " fill="#FEFEFE" transform="translate(449,174)"/>
<path d="M0 0 C0.26425781 0.52980469 0.52851563 1.05960938 0.80078125 1.60546875 C1.19652344 2.39566406 1.59226562 3.18585937 2 4 C2.48855469 4.98613281 2.97710937 5.97226562 3.48046875 6.98828125 C9.51119917 18.73233523 15.44533978 25.22794803 28 30 C34.97727682 31.39843227 42.04083695 31.15349331 49.12913513 31.15821838 C50.57885803 31.16278807 52.02857961 31.16778869 53.47829968 31.17318195 C57.45303221 31.18672615 61.42775622 31.19417061 65.40250576 31.20060861 C69.69213981 31.20862893 73.98175623 31.22232108 78.27137756 31.23532104 C85.70047387 31.25706066 93.12957199 31.27521433 100.5586834 31.29092598 C111.29990492 31.31364752 122.04110689 31.34178718 132.7823118 31.37124526 C150.20960222 31.41889316 167.63690065 31.46216494 185.06420898 31.50268555 C201.99227522 31.54205473 218.92033434 31.58348437 235.84838867 31.62768555 C236.89199806 31.63040982 237.93560745 31.63313409 239.01084136 31.63594092 C244.24637195 31.64962063 249.48190243 31.66334086 254.71743286 31.67708123 C298.14494041 31.79100199 341.57246334 31.89782107 385 32 C385 32.33 385 32.66 385 33 C340.07272207 33.06867358 295.14544969 33.12153259 250.21812961 33.15319599 C244.91348606 33.15694809 239.60884261 33.16083106 234.30419922 33.16479492 C233.24814469 33.16558185 232.19209017 33.16636878 231.10403399 33.16717956 C214.00681109 33.18023181 196.90961847 33.20388468 179.81241353 33.23145839 C162.2677946 33.25951759 144.72319152 33.27617735 127.17855108 33.28226548 C116.35345628 33.28638085 105.52844706 33.29937682 94.7033786 33.3237494 C87.27921213 33.33961292 79.85508987 33.34439895 72.43090768 33.34050413 C68.14819661 33.33858356 63.86563505 33.34151817 59.58295059 33.35761642 C55.65821787 33.37226114 51.73373459 33.37292286 47.80899017 33.36269668 C46.39293502 33.36143359 44.97686403 33.36520038 43.56083985 33.37464955 C29.19561538 33.46489602 19.75980372 30.83667006 9 21 C3.63864235 14.79014923 -0.49778926 8.4624175 0 0 Z " fill="#EFECEA" transform="translate(298,750)"/>
<path d="M0 0 C2.488503 1.02972538 3.80357133 1.7106207 5.33743113 3.97030753 C8.48103671 7.80807491 13.29294577 8.19230623 18 9 C22.79918755 9.39768943 27.56861019 9.41658892 32.38237 9.39872742 C33.81080031 9.40417652 35.23922614 9.41093207 36.6676448 9.41886932 C40.56498666 9.43679361 44.462137 9.43635007 48.3595103 9.43273985 C52.57274785 9.43211351 56.78592252 9.44875935 60.99913025 9.46325684 C68.28956767 9.48600267 75.57995743 9.497921 82.87042809 9.50238609 C93.41107927 9.50885758 103.95164446 9.53181252 114.49226091 9.55872939 C131.59565857 9.60196031 148.6990526 9.63194815 165.80249023 9.65356445 C182.41220889 9.67458522 199.02189788 9.70186991 215.6315918 9.73754883 C217.16854658 9.74084707 217.16854658 9.74084707 218.73655095 9.74421193 C223.87709471 9.75528186 229.01763819 9.76647462 234.15818155 9.77772844 C276.77209485 9.87086121 319.38602474 9.94248343 362 10 C362 10.33 362 10.66 362 11 C317.38682684 11.09151761 272.7736636 11.16201945 228.16041511 11.20426132 C222.89568023 11.20926426 217.63094554 11.21444154 212.36621094 11.21972656 C211.31807902 11.2207758 210.26994709 11.22182505 209.1900536 11.22290608 C192.20974654 11.24032031 175.22949354 11.2718636 158.24921857 11.30861118 C140.83118183 11.34599229 123.41317344 11.36822986 105.99509823 11.37635398 C95.24366523 11.38184762 84.49238503 11.39921061 73.74099906 11.43166587 C66.37245284 11.45277882 59.00398583 11.45920735 51.63541155 11.45400551 C47.38150362 11.45143871 43.12786307 11.45542566 38.87400246 11.4768219 C34.98025632 11.49626411 31.08695777 11.49728543 27.19319119 11.48359558 C25.78393267 11.48190322 24.37464642 11.48699746 22.96544264 11.49953273 C9.9482555 11.60859975 9.9482555 11.60859975 5 7 C3.09057963 5.10390117 1.63176524 3.15968929 0 1 C0 0.67 0 0.34 0 0 Z " fill="#EDE6E4" transform="translate(322,749)"/>
<path d="M0 0 C-2.75313975 1.51237497 -5.02891835 2.24765076 -8.125 2.6875 C-18.15947213 4.84244401 -26.09588106 12.9709362 -32 21 C-32.77484682 23.17446997 -32.77484682 23.17446997 -33 25 C-33.66 25 -34.32 25 -35 25 C-35.144375 26.11375 -35.28875 27.2275 -35.4375 28.375 C-36 32 -36 32 -37 34 C-37.13536102 36.6401934 -37.21265301 39.25276064 -37.23828125 41.89453125 C-37.246353 42.6789006 -37.25442474 43.46326996 -37.26274109 44.27140808 C-37.27658062 45.93327627 -37.28730337 47.59517287 -37.29516602 49.25708008 C-37.31236353 51.79238135 -37.35624655 54.32637314 -37.40039062 56.86132812 C-37.41051915 58.47655292 -37.41903476 60.09178879 -37.42578125 61.70703125 C-37.44328934 62.46240677 -37.46079742 63.21778229 -37.47883606 63.99604797 C-37.46359334 67.71566541 -37.13058024 69.79702979 -35.09838867 72.95581055 C-32.15330803 75.82482279 -31.42303256 75.97919512 -27.1875 76.1875 C-23.72731311 76.13087876 -21.02349679 75.8324223 -18 74 C-16.64290772 70.41973411 -16.87386217 66.70910693 -16.859375 62.92578125 C-16.84103623 61.5214683 -16.82146494 60.117171 -16.80078125 58.71289062 C-16.7719456 56.51869347 -16.75000291 54.32550182 -16.74951172 52.13110352 C-16.73590989 43.5337782 -16.65961724 36.01553443 -11 29 C-8.29795191 26.42975914 -5.53778264 24.25534223 -2 23 C-0.65646586 23.28949078 0.67965718 23.61844563 2 24 C1.31292969 24.39832031 0.62585938 24.79664063 -0.08203125 25.20703125 C-0.98308594 25.73683594 -1.88414062 26.26664062 -2.8125 26.8125 C-3.70582031 27.33457031 -4.59914063 27.85664063 -5.51953125 28.39453125 C-9.0250956 30.66348707 -10.66813016 32.00439048 -12 36 C-12.10490824 38.2509227 -12.15519463 40.50454045 -12.17578125 42.7578125 C-12.19900118 44.11980675 -12.22311936 45.48178593 -12.24804688 46.84375 C-12.28295528 48.97633647 -12.31239451 51.10837534 -12.32592773 53.24121094 C-12.44609539 69.10334125 -12.44609539 69.10334125 -17 76 C-19.92628321 78.75906703 -22.4729399 79.22837952 -26.375 79.5 C-30.6033663 79.34470107 -33.20048417 78.13156464 -36.58984375 75.6796875 C-41.65692675 69.64410388 -40.4418195 60.50648099 -40.4375 53.125 C-40.43790283 52.42847321 -40.43830566 51.73194641 -40.4387207 51.01431274 C-40.38642439 35.38019471 -38.5518032 22.59466704 -27 11 C-26.33613281 10.33355469 -25.67226563 9.66710937 -24.98828125 8.98046875 C-17.09041967 1.6101657 -10.81773591 -0.71587958 0 0 Z " fill="#E5DEDB" transform="translate(288,240)"/>
<path d="M0 0 C0.66 0 1.32 0 2 0 C1 2 0 4 -1 6 C-1.09662572 7.4847464 -1.13097265 8.97375954 -1.13422108 10.46164322 C-1.13867892 11.40592532 -1.14313676 12.35020743 -1.14772969 13.32310414 C-1.14754533 14.36763273 -1.14736097 15.41216132 -1.14717102 16.48834229 C-1.15268605 18.1445195 -1.15268605 18.1445195 -1.1583125 19.83415484 C-1.16938538 23.55903753 -1.17319927 27.28389235 -1.17700195 31.00878906 C-1.18326385 33.66926746 -1.18989728 36.32974283 -1.19691467 38.99021912 C-1.21668987 46.99244549 -1.22674677 54.99467314 -1.23564246 62.99691784 C-1.24002377 66.76376181 -1.245391 70.53060436 -1.25063133 74.2974472 C-1.26764491 86.81677076 -1.28213946 99.33609344 -1.28938007 111.85542679 C-1.29129002 115.10527803 -1.29321035 118.35512926 -1.29516602 121.60498047 C-1.29564976 122.41273221 -1.2961335 123.22048394 -1.2966319 124.05271301 C-1.30493358 137.14005903 -1.33027221 150.22731369 -1.36274669 163.31461981 C-1.39580376 176.74604134 -1.41382762 190.17741642 -1.41702431 203.60887885 C-1.41919071 211.1521952 -1.42795808 218.69537834 -1.45348549 226.23865509 C-1.4751741 232.66249161 -1.48325207 239.08616257 -1.47351871 245.51003155 C-1.4689685 248.78781858 -1.47307571 252.06519192 -1.49028015 255.34294701 C-1.50789278 258.89682972 -1.50094438 262.44984083 -1.48774719 266.00372314 C-1.49871644 267.03932884 -1.50968568 268.07493454 -1.52098733 269.14192224 C-1.46766393 275.07470281 -0.9441697 278.47355132 3 283 C6.07630837 285.15341586 9.31932466 285.49808973 13 286 C10 288 10 288 6.625 287.4375 C1.81032761 285.52823336 -0.97696504 283.27791377 -3.12000465 278.50617123 C-4.32976541 273.68611352 -4.28245302 269.10278598 -4.26742554 264.15126038 C-4.27195665 263.05668076 -4.27648776 261.96210113 -4.28115618 260.83435243 C-4.29381914 257.16564845 -4.29217857 253.49709256 -4.29052734 249.82836914 C-4.29651132 247.1984793 -4.30331656 244.56859121 -4.31088257 241.93870544 C-4.32747804 235.53629068 -4.33299142 229.13391275 -4.33410732 222.73147828 C-4.33505831 217.52715632 -4.33917114 212.32284649 -4.34550858 207.11852837 C-4.3631156 192.35897313 -4.37234808 177.59944695 -4.37084763 162.83988113 C-4.37076772 162.0445978 -4.3706878 161.24931447 -4.37060547 160.42993164 C-4.37052371 159.63367606 -4.37044195 158.83742049 -4.37035771 158.01703595 C-4.36954455 145.10844291 -4.38869108 132.19996648 -4.4168822 119.29140718 C-4.44560924 106.03273961 -4.45942266 92.77412892 -4.45769465 79.51542944 C-4.45703077 72.07331156 -4.4625222 64.63131599 -4.48405075 57.18922615 C-4.50416324 50.19192761 -4.50359075 43.19489156 -4.48901749 36.19758034 C-4.48692239 33.6284828 -4.49167177 31.05936928 -4.5037384 28.49029922 C-4.51913653 24.98513465 -4.50991756 21.48086802 -4.49447632 17.97572327 C-4.50476344 16.95743173 -4.51505057 15.9391402 -4.52564943 14.88999134 C-4.46556118 8.72419054 -3.55239496 5.07669752 0 0 Z " fill="#FBFAFB" transform="translate(561,384)"/>
<path d="M0 0 C9.09789444 7.77009363 16.33321318 17.89766403 17.43359375 30.11328125 C17.82446244 41.89856434 17.82446244 41.89856434 14.3125 46.0625 C10.46950773 49.76315922 6.47674128 50.03552757 1.3515625 49.96875 C-2.04852428 49.53926535 -3.66492979 48.24289368 -5.875 45.6875 C-6.6875 42.9375 -6.6875 42.9375 -6.875 40.6875 C-4.875 42.6875 -2.875 44.6875 -0.875 46.6875 C3.45288028 47.15247887 7.11328342 47.130126 11.125 45.375 C13.38989937 43.761376 13.38989937 43.761376 14.125 40.6875 C15.06544108 27.96841984 13.30729726 18.69731393 5.0390625 8.72265625 C-2.63071837 0.56764435 -12.00653589 -3.35977359 -22.875 -5.3125 C-22.875 -5.6425 -22.875 -5.9725 -22.875 -6.3125 C-14.40191561 -8.22051308 -6.82302341 -5.11438133 0 0 Z " fill="#F4F0EF" transform="translate(598.875,182.3125)"/>
<path d="M0 0 C17.20282008 -0.11693034 34.4055157 -0.20503544 51.60864258 -0.25906086 C59.59681503 -0.28481537 67.5847402 -0.3199128 75.57275391 -0.37719727 C82.53714067 -0.42711708 89.50134829 -0.45931104 96.465909 -0.47044247 C100.1518656 -0.47694687 103.83730983 -0.49217533 107.52310181 -0.52865028 C111.64323411 -0.56909077 115.76248224 -0.56994396 119.8828125 -0.56762695 C121.09769852 -0.58560333 122.31258453 -0.60357971 123.56428528 -0.62210083 C130.66240117 -0.57892898 135.57286936 0.22947998 141 5 C146.92014018 11.05142033 146.92014018 11.05142033 147.09765625 15.3828125 C147.08025391 16.74019531 147.08025391 16.74019531 147.0625 18.125 C147.05347656 19.03507812 147.04445313 19.94515625 147.03515625 20.8828125 C147.01775391 21.93082031 147.01775391 21.93082031 147 23 C145.84866586 20.80830368 145.01395406 19.07575058 144.5625 16.625 C143.56513609 11.97063507 141.59943523 8.12336024 138 5 C131.09615294 1.43638007 123.72378124 1.5583514 116.13647461 1.56762695 C114.87694977 1.5574353 113.61742493 1.54724365 112.31973267 1.53674316 C108.89266545 1.50934171 105.46576413 1.49991184 102.03860164 1.49388909 C98.44710102 1.48446112 94.85572219 1.45825444 91.26429749 1.43388367 C84.47538063 1.39033595 77.68648757 1.3617172 70.89747387 1.33856028 C63.16336353 1.31144544 55.42937643 1.26753801 47.69535434 1.22227156 C31.7969664 1.12959343 15.89855521 1.05783599 0 1 C0 0.67 0 0.34 0 0 Z " fill="#FBFAFA" transform="translate(445,199)"/>
<path d="M0 0 C-2.75313975 1.51237497 -5.02891835 2.24765076 -8.125 2.6875 C-18.15947213 4.84244401 -26.09588106 12.9709362 -32 21 C-32.77484682 23.17446997 -32.77484682 23.17446997 -33 25 C-33.66 25 -34.32 25 -35 25 C-35.144375 26.11375 -35.28875 27.2275 -35.4375 28.375 C-36 32 -36 32 -37 34 C-37.15691907 36.76931368 -37.25843134 39.51734107 -37.31640625 42.2890625 C-37.33718735 43.10748627 -37.35796844 43.92591003 -37.37937927 44.76913452 C-37.44484812 47.38766966 -37.50374726 50.00630639 -37.5625 52.625 C-37.60568776 54.39844807 -37.64930214 56.17188581 -37.69335938 57.9453125 C-37.80052676 62.29677046 -37.90180169 66.64833077 -38 71 C-41.46350617 65.80474075 -40.44100346 59.41087883 -40.4375 53.3125 C-40.43790283 52.60848053 -40.43830566 51.90446106 -40.4387207 51.17910767 C-40.38666111 35.48112216 -38.60406454 22.6471223 -27 11 C-26.33613281 10.33355469 -25.67226563 9.66710937 -24.98828125 8.98046875 C-17.09041967 1.6101657 -10.81773591 -0.71587958 0 0 Z " fill="#F0ECEA" transform="translate(288,240)"/>
<path d="M0 0 C3.47061642 2.97481408 5.85830231 5.65507456 6.53649902 10.22845459 C6.64971908 13.07467017 6.63709067 15.89431818 6.578125 18.7421875 C6.57246521 19.77691193 6.56680542 20.81163635 6.56097412 21.87771606 C6.53865852 25.16895629 6.48846966 28.45909114 6.4375 31.75 C6.41742884 33.9869634 6.39917915 36.22394393 6.3828125 38.4609375 C6.33880965 43.93266614 6.27194551 49.40375408 6.1875 54.875 C5.8575 54.875 5.5275 54.875 5.1875 54.875 C4.47007896 47.98826381 4.10221755 41.14183711 4.01171875 34.22265625 C3.99980499 33.4683432 3.98789124 32.71403015 3.97561646 31.93685913 C3.92669512 28.80676072 3.8791537 25.67708454 3.86157227 22.54663086 C3.84610212 20.22967895 3.80598137 17.91421365 3.76171875 15.59765625 C3.76362717 14.89552505 3.76553558 14.19339386 3.76750183 13.46998596 C3.64828527 8.68701737 2.56835293 6.24083921 -0.8125 2.875 C-4.27464977 1.14392512 -8.02740582 1.38680527 -11.8125 1.875 C-14.17435168 2.97208729 -15.77772046 4.2054373 -17.8125 5.875 C-17.51738433 3.02221517 -17.00017059 2.03921177 -14.8125 0.125 C-9.81368967 -1.95783764 -5.03712506 -2.01485003 0 0 Z " fill="#FBFAFA" transform="translate(316.8125,344.125)"/>
<path d="M0 0 C0.33 0 0.66 0 1 0 C1.776465 8.38582196 -0.96193079 14.09877841 -6.08984375 20.68359375 C-12.11370665 27.61361039 -17.71008875 33.14201775 -27 35 C-30.4375 35.125 -30.4375 35.125 -33 35 C-33 34.67 -33 34.34 -33 34 C-32.38253906 33.85304688 -31.76507812 33.70609375 -31.12890625 33.5546875 C-19.41993713 30.45368198 -10.74675906 23.80918427 -4.42578125 13.41015625 C-2.11554312 9.00812658 -0.39654301 5.02287809 0 0 Z " fill="#E9E3E0" transform="translate(719,747)"/>
<path d="M0 0 C14.92854742 -0.59802786 14.92854742 -0.59802786 21.6875 5.375 C26.99406785 11.39867161 27.40291441 15.49682326 27.1875 23.3125 C27.16719727 24.70952148 27.16719727 24.70952148 27.14648438 26.13476562 C27.11126882 28.42377646 27.06202099 30.71158458 27 33 C24.36 33 21.72 33 19 33 C19 32.67 19 32.34 19 32 C20.98 31.67 22.96 31.34 25 31 C25.60107666 18.10906865 25.60107666 18.10906865 20.3125 6.6875 C14.12736236 2.17402118 7.4310855 1.44160139 0 1 C0 0.67 0 0.34 0 0 Z " fill="#F3F0EF" transform="translate(718,263)"/>
<path d="M0 0 C0.33 0 0.66 0 1 0 C1.76027167 12.48535025 1.76027167 12.48535025 -0.0078125 16.0078125 C-3.29838193 19.29838193 -6.87997139 20.16675675 -11.375 20.3125 C-14.74744787 20.26855931 -15.95888404 20.02312773 -19 18.3125 C-21.18168017 15.78993231 -21.72608098 14.2870282 -22 11 C-20 13 -18 15 -16 17 C-11.67211972 17.46497887 -8.01171658 17.442626 -4 15.6875 C-1.36172833 13.46145828 -1.07822172 11.66729888 -0.68359375 8.30078125 C-0.60238281 7.31464844 -0.52117188 6.32851562 -0.4375 5.3125 C-0.35371094 4.31863281 -0.26992188 3.32476562 -0.18359375 2.30078125 C-0.09271484 1.16189453 -0.09271484 1.16189453 0 0 Z " fill="#D4C8C2" transform="translate(614,212)"/>
<path d="M0 0 C0.26425781 0.52980469 0.52851563 1.05960938 0.80078125 1.60546875 C1.19652344 2.39566406 1.59226562 3.18585937 2 4 C2.48855469 4.98613281 2.97710937 5.97226562 3.48046875 6.98828125 C7.61889243 15.04731684 11.52672993 22.10488021 20 26 C19.01 26.33 18.02 26.66 17 27 C9.16203596 22.73017578 4.04310516 15.82915765 0.625 7.75 C0.01387396 5.06104544 -0.16157456 2.74676752 0 0 Z " fill="#EEE9E7" transform="translate(298,750)"/>
<path d="M0 0 C0.33 0 0.66 0 1 0 C1.62108626 7.91884984 1.62108626 7.91884984 -0.6875 11.9375 C-4.20912938 15.07841269 -6.76722691 15.86551566 -11.4375 16.375 C-15.73533398 15.92259642 -17.76987645 14.84558503 -21 12 C-21.875 9.25 -21.875 9.25 -22 7 C-20 9 -18 11 -16 13 C-11.62852081 13.55095089 -8.04837674 13.51303542 -4.0625 11.5625 C-1.19630195 8.00146606 -0.6379142 4.45587832 0 0 Z " fill="#EEE9E7" transform="translate(458,655)"/>
<path d="M0 0 C1.051875 0.12375 2.10375 0.2475 3.1875 0.375 C2.3521875 0.74625 2.3521875 0.74625 1.5 1.125 C-1.85293581 2.93739774 -5.07807246 4.90614492 -6.8125 8.375 C-7.3299655 14.12710328 -7.3299655 14.12710328 -5.0625 19.25 C-3.01582225 21.18297343 -1.41406414 22.35295695 1.1875 23.375 C-1 23.75 -1 23.75 -3.8125 23.375 C-9.76267794 17.15435943 -9.76267794 17.15435943 -9.8671875 13.421875 C-9.55128433 9.38380842 -9.1055356 6.14525301 -6.6875 2.8125 C-3.8125 0.375 -3.8125 0.375 0 0 Z " fill="#F3F0EF" transform="translate(321.8125,295.625)"/>
<path d="M0 0 C6.81450521 -0.60843797 10.70402699 0.64327007 16 5 C21.91765976 10.99089812 21.91765976 10.99089812 22.09765625 15.3828125 C22.08605469 16.28773438 22.07445312 17.19265625 22.0625 18.125 C22.05347656 19.03507812 22.04445313 19.94515625 22.03515625 20.8828125 C22.02355469 21.58148438 22.01195312 22.28015625 22 23 C20.84866586 20.80830368 20.01395406 19.07575058 19.5625 16.625 C18.58336137 12.05568641 16.67670384 7.94926996 13 5 C9.82246213 3.77113557 9.82246213 3.77113557 6.3125 2.8125 C5.13300781 2.46832031 3.95351563 2.12414062 2.73828125 1.76953125 C1.38283203 1.38861328 1.38283203 1.38861328 0 1 C0 0.67 0 0.34 0 0 Z " fill="#ECE6E4" transform="translate(570,199)"/>
<path d="M0 0 C3.5 1.5625 3.5 1.5625 6 4 C6.875 7.75 6.875 7.75 7 11 C6.34 10.01 5.68 9.02 5 8 C2.89224818 5.25353551 1.3449421 3.26605933 -2.15234375 2.57421875 C-6.90979627 2.42381676 -10.13293247 3.00614127 -14 6 C-13.75 4.125 -13.75 4.125 -13 2 C-8.82477283 -0.61181612 -4.7805798 -0.65340105 0 0 Z " fill="#F4F1F0" transform="translate(713,343)"/>
<path d="M0 0 C3 1.25 3 1.25 5 3 C5.8125 5.1875 5.8125 5.1875 6 7 C5.195625 6.34 4.39125 5.68 3.5625 5 C-0.44919278 2.34450596 -4.32775273 2.13384364 -9 3 C-11.34576488 4.11291913 -12.97143135 5.33553342 -15 7 C-14.70488433 4.14721517 -14.18767059 3.16421177 -12 1.25 C-7.90899068 -0.45458722 -4.37311422 -0.58625082 0 0 Z " fill="#F4F1F0" transform="translate(314,343)"/>
<path d="M0 0 C0.33 0.66 0.66 1.32 1 2 C0.69449219 2.70769531 0.38898438 3.41539062 0.07421875 4.14453125 C-1.29351021 7.7802035 -1.22924496 10.812809 -1.1875 14.6875 C-1.1865332 15.70166992 -1.1865332 15.70166992 -1.18554688 16.73632812 C-1.1939798 20.49420957 -1.1939798 20.49420957 0 24 C-0.99 23.67 -1.98 23.34 -3 23 C-5.69400827 17.47728305 -5.07146999 12.41568058 -3.29296875 6.74609375 C-1.32391152 1.32391152 -1.32391152 1.32391152 0 0 Z " fill="#E8E2DF" transform="translate(405,202)"/>
<path d="M0 0 C5.31637797 -0.50632171 7.82517803 0.75291624 12 4 C12.54914063 4.4125 13.09828125 4.825 13.6640625 5.25 C15.65161541 7.85357808 15.29134972 9.96815874 15.1875 13.1875 C15.16042969 14.27417969 15.13335937 15.36085938 15.10546875 16.48046875 C15.07066406 17.31191406 15.03585937 18.14335937 15 19 C14.67 19 14.34 19 14 19 C13.98582031 18.33613281 13.97164063 17.67226563 13.95703125 16.98828125 C13.71931267 12.58727503 13.48278951 9.72418426 11 6 C7.14318949 3.42879299 3.53953118 2.66263309 -1 2 C-0.67 1.34 -0.34 0.68 0 0 Z " fill="#ECE6E3" transform="translate(444,380)"/>
<path d="M0 0 C0.4125 0.433125 0.825 0.86625 1.25 1.3125 C4.37334444 4.32429642 6.6495823 6.43193281 11.125 6.5 C14.48974261 6.06583966 16.98618939 5.5069053 20 4 C18.25 7.875 18.25 7.875 16 9 C10.01943696 9.8526261 6.07434905 9.05462379 1.21484375 5.484375 C0 4 0 4 0 0 Z " fill="#F1EEEC" transform="translate(250,310)"/>
<path d="M0 0 C0.33 0 0.66 0 1 0 C1.02578125 0.72445312 1.0515625 1.44890625 1.078125 2.1953125 C1.42905406 8.1770579 1.83890475 12.363351 6 17 C9.07630837 19.15341586 12.31932466 19.49808973 16 20 C13 22 13 22 9.625 21.4375 C5.16930896 19.67058804 2.17030516 17.34061033 0 13 C-0.07092842 10.7927077 -0.08415025 8.58332548 -0.0625 6.375 C-0.05347656 5.18648437 -0.04445313 3.99796875 -0.03515625 2.7734375 C-0.02355469 1.85820313 -0.01195312 0.94296875 0 0 Z " fill="#F5F2F1" transform="translate(558,650)"/>
<path d="M0 0 C0.66 0 1.32 0 2 0 C0.56023485 3.1503772 -1.2083515 5.67851605 -3.375 8.375 C-6.10461731 11.82263773 -8.62779207 15.29935563 -11 19 C-11.33 18.34 -11.66 17.68 -12 17 C-9.0219304 10.66146275 -4.82093108 5.04006431 0 0 Z " fill="#F4F1F0" transform="translate(416,184)"/>
<path d="M0 0 C2.9375 1.5625 2.9375 1.5625 5 3 C4.67 3.99 4.34 4.98 4 6 C3.525625 5.505 3.05125 5.01 2.5625 4.5 C-1.18198069 2.30810886 -4.75115862 2.5931128 -9 3 C-9.99 3.33 -10.98 3.66 -12 4 C-11 1 -11 1 -9.375 -0.25 C-5.94353932 -1.33361916 -3.48217013 -0.79417915 0 0 Z " fill="#EEE9E7" transform="translate(575,381)"/>
<path d="M0 0 C0.33 0 0.66 0 1 0 C1.47285018 7.26350415 1.48058756 12.10449006 -3 18 C-4.92119083 19.8415317 -6.86329734 21.397473 -9 23 C-9.66 22.67 -10.32 22.34 -11 22 C-10.52949219 21.64808594 -10.05898438 21.29617188 -9.57421875 20.93359375 C-3.61338231 16.20688493 -1.20729898 11.6742567 -0.3125 4.0625 C-0.19727993 2.709229 -0.0891201 1.35524008 0 0 Z " fill="#EEEAE8" transform="translate(696,736)"/>
<path d="M0 0 C0.680625 0.35578125 1.36125 0.7115625 2.0625 1.078125 C3.0834375 1.59632813 3.0834375 1.59632813 4.125 2.125 C6.07690091 3.3370675 7.5122163 4.64219147 9.0625 6.328125 C8.7325 7.318125 8.4025 8.308125 8.0625 9.328125 C6.64485006 8.39211254 5.22842432 7.4542458 3.8125 6.515625 C2.62914062 5.73251953 2.62914062 5.73251953 1.421875 4.93359375 C-0.74842481 3.45678378 -2.85163768 1.92122627 -4.9375 0.328125 C-1.9375 -0.671875 -1.9375 -0.671875 0 0 Z " fill="#E4DDDA" transform="translate(745.9375,242.671875)"/>
<path d="M0 0 C-0.66386719 0.38671875 -1.32773437 0.7734375 -2.01171875 1.171875 C-6.58517111 3.86921041 -10.97252628 6.50952278 -15 10 C-13.38356501 4.70984913 -10.48297319 2.58007385 -5.9375 -0.3125 C-3.55437451 -1.15812518 -2.3819215 -0.68833075 0 0 Z " fill="#EAE5E2" transform="translate(290,264)"/>
<path d="M0 0 C0.99 1.485 0.99 1.485 2 3 C1.45472656 2.80664062 0.90945313 2.61328125 0.34765625 2.4140625 C-5.0438052 0.55239547 -10.40921726 -0.87655666 -16 -2 C-16 -2.33 -16 -2.66 -16 -3 C-10.07769777 -4.87020071 -5.2376215 -2.90141623 0 0 Z " fill="#E7E0DD" transform="translate(592,179)"/>
<path d="M0 0 C0.66 0 1.32 0 2 0 C1 2 0 4 -1 6 C-1.22858114 8.0374763 -1.41024278 10.08040303 -1.5625 12.125 C-1.64628906 13.22070312 -1.73007812 14.31640625 -1.81640625 15.4453125 C-1.87699219 16.28835938 -1.93757812 17.13140625 -2 18 C-2.33 18 -2.66 18 -3 18 C-4.7610915 7.41430867 -4.7610915 7.41430867 -2.0625 2.8125 C-1.381875 1.884375 -0.70125 0.95625 0 0 Z " fill="#F6F4F3" transform="translate(561,384)"/>
<path d="M0 0 C0.33 0 0.66 0 1 0 C1.67090715 7.24579719 -0.41874318 11.75838097 -4 18 C-4.8284454 15.64050361 -5.17085948 14.44423466 -4.2578125 12.0703125 C-3.88398437 11.42835938 -3.51015625 10.78640625 -3.125 10.125 C-1.29092964 6.74778078 -0.38662561 3.86625609 0 0 Z " fill="#F5F2F1" transform="translate(719,747)"/>
<path d="M0 0 C1.1446875 1.175625 1.1446875 1.175625 2.3125 2.375 C6.50956557 6.47445939 9.24843811 7.34887979 15 8 C15 8.33 15 8.66 15 9 C10.43381483 9.35813217 7.07094368 9.60240582 3 7.3125 C0.81831983 4.78993231 0.27391902 3.2870282 0 0 Z " fill="#F5F2F1" transform="translate(592,223)"/>
<path d="M0 0 C4 2 4 2 5.75 3.0625 C9.10353662 4.45980692 12.39033025 4.63903303 16 5 C16 5.33 16 5.66 16 6 C6.30644837 6.76394015 6.30644837 6.76394015 3.15625 4.921875 C0 1.72892442 0 1.72892442 0 0 Z " fill="#F7F4F3" transform="translate(403,226)"/>
<path d="M0 0 C0.33 0.99 0.66 1.98 1 3 C-0.21484375 4.82421875 -0.21484375 4.82421875 -1.9375 6.6875 C-2.50339844 7.31011719 -3.06929687 7.93273437 -3.65234375 8.57421875 C-4.09707031 9.04472656 -4.54179688 9.51523437 -5 10 C-5.99 9.67 -6.98 9.34 -8 9 C-5.36 6.03 -2.72 3.06 0 0 Z " fill="#E2DBD7" transform="translate(713,763)"/>
<path d="M0 0 C0.33 0 0.66 0 1 0 C1.35882213 3.22939919 1.27258004 4.61209763 -0.625 7.3125 C-3.60457419 9.42956587 -5.42236811 9.32523926 -9 9 C-8.01 8.34 -7.02 7.68 -6 7 C-2.55621587 3.83866694 -2.55621587 3.83866694 0 0 Z " fill="#EAE4E2" transform="translate(767,310)"/>
<path d="M0 0 C-0.8353125 0.37125 -0.8353125 0.37125 -1.6875 0.75 C-5.23385622 2.66694931 -8.15738803 5.15738803 -11 8 C-10.64987213 5.40905378 -10.26229035 3.4225789 -8.875 1.1875 C-5.99131838 -0.63883169 -3.32254207 -0.18806842 0 0 Z " fill="#E9E3E0" transform="translate(325,296)"/>
<path d="M0 0 C2.65069433 2.47398137 4.71615844 4.57642251 6 8 C6 9.32 6 10.64 6 12 C5.34 12 4.68 12 4 12 C3.51801537 10.75108386 3.03954323 9.50081192 2.5625 8.25 C2.29566406 7.55390625 2.02882813 6.8578125 1.75390625 6.140625 C1.03853307 4.10940997 0.48634348 2.0964709 0 0 Z " fill="#E8E2DF" transform="translate(739,268)"/>
<path d="M0 0 C4.67461851 -0.32613618 7.16674383 0.29417212 11 3 C7.70303895 4.09898702 6.59505097 3.87124444 3.3125 3.0625 C2.10013672 2.77052734 2.10013672 2.77052734 0.86328125 2.47265625 C-0.05904297 2.23869141 -0.05904297 2.23869141 -1 2 C-0.67 1.34 -0.34 0.68 0 0 Z " fill="#F9F8F7" transform="translate(444,380)"/>
<path d="M0 0 C0.33 0 0.66 0 1 0 C1.38434723 3.36303824 1.0939434 4.83740565 -0.625 7.8125 C-3 10 -3 10 -6.25 10.3125 C-7.1575 10.209375 -8.065 10.10625 -9 10 C-8.01 9.34 -7.02 8.68 -6 8 C-2.31457424 5.4946036 -2.31457424 5.4946036 -0.1875 1.75 C-0.125625 1.1725 -0.06375 0.595 0 0 Z " fill="#E6E0DD" transform="translate(424,221)"/>
<path d="M0 0 C1.43655854 -0.08131463 2.8744483 -0.13933559 4.3125 -0.1875 C5.51326172 -0.23970703 5.51326172 -0.23970703 6.73828125 -0.29296875 C9.47851584 0.06198392 10.29171079 0.89366282 12 3 C11.67 3.99 11.34 4.98 11 6 C10.29875 5.360625 9.5975 4.72125 8.875 4.0625 C5.77158767 1.83613898 3.75379861 1.34919057 0 1 C0 0.67 0 0.34 0 0 Z " fill="#E6DFDC" transform="translate(308,344)"/>
<path d="M0 0 C0.9075 0.78375 1.815 1.5675 2.75 2.375 C5.05190236 4.30052496 7.21577207 5.82205741 10 7 C7 8 7 8 5.17578125 7.109375 C4.56089844 6.66078125 3.94601562 6.2121875 3.3125 5.75 C2.68988281 5.31171875 2.06726563 4.8734375 1.42578125 4.421875 C0.95527344 3.95265625 0.48476563 3.4834375 0 3 C0 2.01 0 1.02 0 0 Z " fill="#E7E0DD" transform="translate(308,769)"/>
<path d="M0 0 C1.37478516 0.01740234 1.37478516 0.01740234 2.77734375 0.03515625 C3.69644531 0.04417969 4.61554687 0.05320312 5.5625 0.0625 C6.27277344 0.07410156 6.98304688 0.08570313 7.71484375 0.09765625 C7.71484375 0.42765625 7.71484375 0.75765625 7.71484375 1.09765625 C7.09996094 1.21882813 6.48507812 1.34 5.8515625 1.46484375 C5.04332031 1.63242187 4.23507812 1.8 3.40234375 1.97265625 C2.60183594 2.13507813 1.80132813 2.2975 0.9765625 2.46484375 C-1.53816743 3.04244624 -1.53816743 3.04244624 -4.28515625 5.09765625 C-3.16461059 0.13523977 -3.16461059 0.13523977 0 0 Z " fill="#E2DBD7" transform="translate(703.28515625,343.90234375)"/>
<path d="M0 0 C0.66 0.33 1.32 0.66 2 1 C1.01 2.485 1.01 2.485 0 4 C-2.1640625 4.29296875 -2.1640625 4.29296875 -4.625 4.1875 C-5.44226563 4.16042969 -6.25953125 4.13335937 -7.1015625 4.10546875 C-8.04128906 4.05326172 -8.04128906 4.05326172 -9 4 C-9 3.67 -9 3.34 -9 3 C-8.43410156 2.86722656 -7.86820312 2.73445313 -7.28515625 2.59765625 C-6.18494141 2.33275391 -6.18494141 2.33275391 -5.0625 2.0625 C-4.33160156 1.88847656 -3.60070312 1.71445312 -2.84765625 1.53515625 C-1.00030102 1.16112431 -1.00030102 1.16112431 0 0 Z " fill="#E6DFDC" transform="translate(268,314)"/>
<path d="M0 0 C3 1 3 1 5 4 C4.67 4.99 4.34 5.98 4 7 C2 5.1875 2 5.1875 0 3 C0 2.01 0 1.02 0 0 Z " fill="#F0ECEA" transform="translate(755,250)"/>
</svg>
</file>

<file path="public/vercel.svg">
<svg fill="none" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1155 1000"><path d="m577.3 0 577.4 1000H0z" fill="#fff"/></svg>
</file>

<file path="public/version.json">
{
  "version": "2.5.0",
  "buildDate": "2025-01-31T15:30:00Z",
  "description": "–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è –ª–æ–≥–∏–∫–∞ –∏—Å—Ç–æ—Ä–∏–∏ –≤—ã–ø–ª–∞—Ç: –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∞ —Å—É–º–º, —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ—Å—Ç—å –ë–î –∏ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è, –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –ø–µ—Ä–µ–Ω–æ—Å—ã"
}
</file>

<file path="public/window.svg">
<svg fill="none" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path fill-rule="evenodd" clip-rule="evenodd" d="M1.5 2.5h13v10a1 1 0 0 1-1 1h-11a1 1 0 0 1-1-1zM0 1h16v11.5a2.5 2.5 0 0 1-2.5 2.5h-11A2.5 2.5 0 0 1 0 12.5zm3.75 4.5a.75.75 0 1 0 0-1.5.75.75 0 0 0 0 1.5M7 4.75a.75.75 0 1 1-1.5 0 .75.75 0 0 1 1.5 0m1.75.75a.75.75 0 1 0 0-1.5.75.75 0 0 0 0 1.5" fill="#666"/></svg>
</file>

<file path="scripts/check-month-status-table.js">
const { sql } = require('@vercel/postgres');
require('dotenv/config');

async function checkTable() {
  try {
    console.log('–ü—Ä–æ–≤–µ—Ä—è–µ–º —Ç–∞–±–ª–∏—Ü—É month_status...');
    
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã
    const tableExists = await sql.query(`
      SELECT EXISTS (
        SELECT FROM information_schema.tables 
        WHERE table_schema = 'public' 
        AND table_name = 'month_status'
      );
    `);
    console.log('–¢–∞–±–ª–∏—Ü–∞ month_status —Å—É—â–µ—Å—Ç–≤—É–µ—Ç:', tableExists.rows[0].exists);
    
    if (tableExists.rows[0].exists) {
      // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç—Ä—É–∫—Ç—É—Ä—É —Ç–∞–±–ª–∏—Ü—ã
      const columns = await sql.query(`
        SELECT column_name, data_type, is_nullable, column_default 
        FROM information_schema.columns 
        WHERE table_name = 'month_status' 
        ORDER BY ordinal_position
      `);
      console.log('–ö–æ–ª–æ–Ω–∫–∏ –≤ —Ç–∞–±–ª–∏—Ü–µ month_status:');
      columns.rows.forEach(col => {
        console.log(`  - ${col.column_name}: ${col.data_type} (nullable: ${col.is_nullable}, default: ${col.column_default})`);
      });
      
      // –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–∞–Ω–Ω—ã–µ –≤ —Ç–∞–±–ª–∏—Ü–µ
      const data = await sql.query('SELECT * FROM month_status LIMIT 5');
      console.log('–î–∞–Ω–Ω—ã–µ –≤ —Ç–∞–±–ª–∏—Ü–µ month_status:', data.rows);
    }
    
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤—Å–µ —Ç–∞–±–ª–∏—Ü—ã
    console.log('\n–í—Å–µ —Ç–∞–±–ª–∏—Ü—ã –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö:');
    const tables = await sql.query(`
      SELECT table_name 
      FROM information_schema.tables 
      WHERE table_schema = 'public' 
      ORDER BY table_name
    `);
    tables.rows.forEach(table => {
      console.log(`  - ${table.table_name}`);
    });
    
  } catch (error) {
    console.error('–û—à–∏–±–∫–∞:', error);
  }
}

checkTable();
</file>

<file path="scripts/create-fallback-user.js">
require('dotenv').config({ path: '.env.local' });
const { Pool } = require('pg');

const pool = new Pool({
  connectionString: process.env.DATABASE_URL,
});

async function createFallbackUser() {
  try {
    console.log('Checking for fallback user...');
    
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –ª–∏ fallback –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
    const checkResult = await pool.query(
      'SELECT * FROM users WHERE telegram_id = $1',
      [87654321]
    );
    
    if (checkResult.rows.length > 0) {
      console.log('Fallback user already exists:', checkResult.rows[0]);
      return;
    }
    
    // –°–æ–∑–¥–∞–µ–º fallback –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    const insertResult = await pool.query(
      `INSERT INTO users (telegram_id, first_name, last_name, username, display_name, role, created_at, updated_at)
       VALUES ($1, $2, $3, $4, $5, $6, NOW(), NOW())
       RETURNING *`,
      [87654321, 'Test', 'User', 'testuser', 'Test User', 'demo']
    );
    
    console.log('Fallback user created:', insertResult.rows[0]);
    
  } catch (error) {
    console.error('Error:', error);
  } finally {
    await pool.end();
  }
}

createFallbackUser();
</file>

<file path="scripts/fix-month-status-table.js">
const { sql } = require('@vercel/postgres');
const path = require('path');
require('dotenv').config({ path: path.join(__dirname, '..', '.env.local') });

async function fixTable() {
  try {
    console.log('üîß –ò—Å–ø—Ä–∞–≤–ª—è–µ–º —Ç–∞–±–ª–∏—Ü—É month_status...');
    
    // –£–¥–∞–ª—è–µ–º —Ç–∞–±–ª–∏—Ü—É –µ—Å–ª–∏ –æ–Ω–∞ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
    await sql.query('DROP TABLE IF EXISTS month_status');
    console.log('‚úÖ –°—Ç–∞—Ä–∞—è —Ç–∞–±–ª–∏—Ü–∞ —É–¥–∞–ª–µ–Ω–∞');
    
    // –°–æ–∑–¥–∞–µ–º —Ç–∞–±–ª–∏—Ü—É –∑–∞–Ω–æ–≤–æ
    await sql.query(`
      CREATE TABLE month_status (
        month TEXT PRIMARY KEY,
        closed BOOLEAN NOT NULL DEFAULT FALSE,
        updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
      )
    `);
    console.log('‚úÖ –¢–∞–±–ª–∏—Ü–∞ month_status —Å–æ–∑–¥–∞–Ω–∞ –∑–∞–Ω–æ–≤–æ');
    
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç—Ä—É–∫—Ç—É—Ä—É
    const columns = await sql.query(`
      SELECT column_name, data_type, is_nullable, column_default 
      FROM information_schema.columns 
      WHERE table_name = 'month_status' 
      ORDER BY ordinal_position
    `);
    console.log('üìã –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–∞–±–ª–∏—Ü—ã month_status:');
    columns.rows.forEach(col => {
      console.log(`  - ${col.column_name}: ${col.data_type} (nullable: ${col.is_nullable}, default: ${col.column_default})`);
    });
    
  } catch (error) {
    console.error('‚ùå –û—à–∏–±–∫–∞:', error);
  }
}

fixTable();
</file>

<file path="scripts/init-postgres.js">
// –ó–∞–≥—Ä—É–∂–∞–µ–º –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –∏–∑ .env.local
require('dotenv').config({ path: '.env.local' });

const { sql } = require('@vercel/postgres');

async function initPostgresTables() {
  try {
    console.log('–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è PostgreSQL —Ç–∞–±–ª–∏—Ü...');
    
    // –°–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã shifts
    await sql`
      CREATE TABLE IF NOT EXISTS shifts (
        id SERIAL PRIMARY KEY,
        date TEXT NOT NULL,
        hours REAL NOT NULL,
        steam_bath INTEGER NOT NULL DEFAULT 0,
        brand_steam INTEGER NOT NULL DEFAULT 0,
        intro_steam INTEGER NOT NULL DEFAULT 0,
        scrubbing INTEGER NOT NULL DEFAULT 0,
        masters INTEGER NOT NULL DEFAULT 1,
        total REAL NOT NULL,
        hourly_rate REAL NOT NULL,
        steam_bath_price REAL NOT NULL,
        brand_steam_price REAL NOT NULL,
        intro_steam_price REAL NOT NULL,
        scrubbing_price REAL NOT NULL
      )
    `;
    console.log('‚úÖ –¢–∞–±–ª–∏—Ü–∞ shifts —Å–æ–∑–¥–∞–Ω–∞');

    // –°–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã prices
    await sql`
      CREATE TABLE IF NOT EXISTS prices (
        id SERIAL PRIMARY KEY,
        name TEXT NOT NULL UNIQUE,
        price REAL NOT NULL
      )
    `;
    console.log('‚úÖ –¢–∞–±–ª–∏—Ü–∞ prices —Å–æ–∑–¥–∞–Ω–∞');

    // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–∞—á–∞–ª—å–Ω—ã—Ö —Ü–µ–Ω
    const defaultPrices = [
      { name: '–ü–æ—á–∞—Å–æ–≤–∞—è —Å—Ç–∞–≤–∫–∞', price: 400 },
      { name: '–ü—É—Ç–µ–≤–æ–µ –ø–∞—Ä–µ–Ω–∏–µ', price: 3500 },
      { name: '–§–∏—Ä–º–µ–Ω–Ω–æ–µ –ø–∞—Ä–µ–Ω–∏–µ', price: 4200 },
      { name: '–û–∑–Ω–∞–∫–æ–º–∏—Ç–µ–ª—å–Ω–æ–µ –ø–∞—Ä–µ–Ω–∏–µ', price: 2500 },
      { name: '–°–∫—Ä–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ', price: 1200 }
    ];

    for (const price of defaultPrices) {
      await sql`
        INSERT INTO prices (name, price)
        VALUES (${price.name}, ${price.price})
        ON CONFLICT (name) DO NOTHING
      `;
    }
    console.log('‚úÖ –ù–∞—á–∞–ª—å–Ω—ã–µ —Ü–µ–Ω—ã –¥–æ–±–∞–≤–ª–µ–Ω—ã');

    console.log('üéâ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è PostgreSQL –∑–∞–≤–µ—Ä—à–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ!');
  } catch (error) {
    console.error('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ PostgreSQL:', error);
    process.exit(1);
  }
}

// –ó–∞–ø—É—Å–∫ —Å–∫—Ä–∏–ø—Ç–∞
initPostgresTables();
</file>

<file path="scripts/migrate-users-auth-fields.js">
require('dotenv').config({ path: '.env.local' });
const { Pool } = require('pg');

const pool = new Pool({ connectionString: process.env.DATABASE_URL || process.env.POSTGRES_URL });

async function migrate() {
  try {
    console.log('üîß Migrating users table: adding auth-related columns...');

    await pool.query(`
      ALTER TABLE users 
      ADD COLUMN IF NOT EXISTS role TEXT DEFAULT 'master',
      ADD COLUMN IF NOT EXISTS browser_login TEXT,
      ADD COLUMN IF NOT EXISTS password_hash TEXT,
      ADD COLUMN IF NOT EXISTS password_set_at TIMESTAMP,
      ADD COLUMN IF NOT EXISTS last_login_at TIMESTAMP,
      ADD COLUMN IF NOT EXISTS is_blocked BOOLEAN DEFAULT FALSE,
      ADD COLUMN IF NOT EXISTS blocked_at TIMESTAMP;
    `);

    await pool.query(`
      CREATE UNIQUE INDEX IF NOT EXISTS idx_users_browser_login ON users(browser_login);
    `);

    console.log('‚úÖ Migration completed successfully.');
  } catch (err) {
    console.error('‚ùå Migration error:', err);
    process.exit(1);
  } finally {
    await pool.end();
  }
}

if (require.main === module) {
  migrate();
}

module.exports = { migrate };
</file>

<file path="scripts/setup-telegram-webhook.js">
// –°–∫—Ä–∏–ø—Ç –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ Telegram WebHook
// –ó–∞–ø—É—Å–∫: node scripts/setup-telegram-webhook.js

const dotenv = require('dotenv');

// –ó–∞–≥—Ä—É–∂–∞–µ–º –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
dotenv.config({ path: '.env.local' });

const BOT_TOKEN = process.env.TELEGRAM_BOT_TOKEN;
const WEBHOOK_URL = process.env.VERCEL_URL || 'https://pytuchet.vercel.app';

if (!BOT_TOKEN) {
  console.error('‚ùå –û—à–∏–±–∫–∞: TELEGRAM_BOT_TOKEN –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ .env.local');
  process.exit(1);
}

async function setWebhook() {
  const webhookUrl = `${WEBHOOK_URL}/api/telegram-webhook`;
  
  console.log('üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Telegram WebHook...');
  console.log('üìç URL:', webhookUrl);
  
  try {
    const response = await fetch(`https://api.telegram.org/bot${BOT_TOKEN}/setWebhook`, {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
      },
      body: JSON.stringify({
        url: webhookUrl,
        allowed_updates: ['message'],
      }),
    });

    const result = await response.json();
    
    if (result.ok) {
      console.log('‚úÖ WebHook —É—Å–ø–µ—à–Ω–æ –Ω–∞—Å—Ç—Ä–æ–µ–Ω!');
      console.log('üìã –†–µ–∑—É–ª—å—Ç–∞—Ç:', result.description);
    } else {
      console.error('‚ùå –û—à–∏–±–∫–∞ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ WebHook:', result.description);
    }
  } catch (error) {
    console.error('‚ùå –û—à–∏–±–∫–∞ –∑–∞–ø—Ä–æ—Å–∞:', error);
  }
}

async function getWebhookInfo() {
  console.log('\nüîç –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–µ–∫—É—â–∏—Ö –Ω–∞—Å—Ç—Ä–æ–µ–∫ WebHook...');
  
  try {
    const response = await fetch(`https://api.telegram.org/bot${BOT_TOKEN}/getWebhookInfo`);
    const result = await response.json();
    
    if (result.ok) {
      console.log('üìã –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ WebHook:');
      console.log('   URL:', result.result.url || '–ù–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω');
      console.log('   –°—Ç–∞—Ç—É—Å:', result.result.has_custom_certificate ? '–° —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–º' : '–ë–µ–∑ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞');
      console.log('   –û–∂–∏–¥–∞—é—â–∏–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è:', result.result.pending_update_count);
      
      if (result.result.last_error_date) {
        console.log('   –ü–æ—Å–ª–µ–¥–Ω—è—è –æ—à–∏–±–∫–∞:', new Date(result.result.last_error_date * 1000).toLocaleString());
        console.log('   –°–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ:', result.result.last_error_message);
      }
    }
  } catch (error) {
    console.error('‚ùå –û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏:', error);
  }
}

async function deleteWebhook() {
  console.log('\nüóëÔ∏è –£–¥–∞–ª–µ–Ω–∏–µ WebHook...');
  
  try {
    const response = await fetch(`https://api.telegram.org/bot${BOT_TOKEN}/deleteWebhook`);
    const result = await response.json();
    
    if (result.ok) {
      console.log('‚úÖ WebHook —É–¥–∞–ª–µ–Ω!');
    } else {
      console.error('‚ùå –û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è WebHook:', result.description);
    }
  } catch (error) {
    console.error('‚ùå –û—à–∏–±–∫–∞ –∑–∞–ø—Ä–æ—Å–∞:', error);
  }
}

// –û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è
async function main() {
  const command = process.argv[2];
  
  switch (command) {
    case 'set':
      await setWebhook();
      break;
    case 'info':
      await getWebhookInfo();
      break;
    case 'delete':
      await deleteWebhook();
      break;
    default:
      console.log('üìã –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:');
      console.log('   npx ts-node scripts/setup-telegram-webhook.ts set    - –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å WebHook');
      console.log('   npx ts-node scripts/setup-telegram-webhook.ts info   - –ü–æ–ª—É—á–∏—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ WebHook');
      console.log('   npx ts-node scripts/setup-telegram-webhook.ts delete - –£–¥–∞–ª–∏—Ç—å WebHook');
      break;
  }
}

main().catch(console.error);
</file>

<file path="src/app/admin/logs/page.tsx">
'use client';

import React, { useState, useEffect } from 'react';
import { useRouter } from 'next/navigation';
import Image from 'next/image';

interface LogEntry {
  timestamp: string;
  level: 'info' | 'error' | 'warning';
  message: string;
  details?: any;
}

export default function LogsPage() {
  const router = useRouter();
  const [logs, setLogs] = useState<LogEntry[]>([]);
  const [loading, setLoading] = useState(false);
  const [autoRefresh, setAutoRefresh] = useState(false);

  const loadLogs = async () => {
    try {
      setLoading(true);
      const response = await fetch('/api/admin/logs');
      if (response.ok) {
        const data = await response.json();
        setLogs(data.logs || []);
      } else {
        console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ª–æ–≥–æ–≤:', response.statusText);
      }
    } catch (error) {
      console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ª–æ–≥–æ–≤:', error);
    } finally {
      setLoading(false);
    }
  };

  const clearLogs = async () => {
    try {
      const response = await fetch('/api/admin/logs', {
        method: 'DELETE'
      });
      if (response.ok) {
        setLogs([]);
      }
    } catch (error) {
      console.error('–û—à–∏–±–∫–∞ –æ—á–∏—Å—Ç–∫–∏ –ª–æ–≥–æ–≤:', error);
    }
  };

  useEffect(() => {
    loadLogs();
  }, []);

  useEffect(() => {
    let interval: NodeJS.Timeout;
    if (autoRefresh) {
      interval = setInterval(loadLogs, 5000); // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–∞–∂–¥—ã–µ 5 —Å–µ–∫—É–Ω–¥
    }
    return () => {
      if (interval) clearInterval(interval);
    };
  }, [autoRefresh]);

  const formatTimestamp = (timestamp: string) => {
    return new Date(timestamp).toLocaleString('ru-RU');
  };

  const getLevelColor = (level: string) => {
    switch (level) {
      case 'error': return '#ff4444';
      case 'warning': return '#ffaa00';
      case 'info': return '#4444ff';
      default: return '#666';
    }
  };

  return (
    <div className="container">
      <div className="header">
        <div className="header-content">
          <div 
            className="logo"
            onClick={() => router.push('/')}
            style={{ cursor: 'pointer' }}
          >
            <Image
              src="/logo.svg"
              alt="–õ–æ–≥–æ—Ç–∏–ø"
              width={50}
              height={50}
            />
          </div>
          <div className="header-text">
            <h1>–°–∏—Å—Ç–µ–º–Ω—ã–µ –ª–æ–≥–∏</h1>
          </div>
        </div>
      </div>

      <div className="content">
        <div className="logs-controls">
          <div className="controls-left">
            <button 
              onClick={() => router.push('/admin')}
              className="btn btn-secondary"
            >
              ‚Üê –ù–∞–∑–∞–¥ –∫ –∞–¥–º–∏–Ω –ø–∞–Ω–µ–ª–∏
            </button>
          </div>
          
          <div className="controls-center">
            <button 
              onClick={loadLogs}
              className="btn btn-primary"
              disabled={loading}
            >
              {loading ? '–ó–∞–≥—Ä—É–∑–∫–∞...' : '–û–±–Ω–æ–≤–∏—Ç—å'}
            </button>
            
            <label className="auto-refresh-toggle">
              <input
                type="checkbox"
                checked={autoRefresh}
                onChange={(e) => setAutoRefresh(e.target.checked)}
              />
              –ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ (5—Å)
            </label>
          </div>
          
          <div className="controls-right">
            <button 
              onClick={clearLogs}
              className="btn btn-danger"
            >
              –û—á–∏—Å—Ç–∏—Ç—å –ª–æ–≥–∏
            </button>
          </div>
        </div>

        <div className="logs-container">
          {loading && logs.length === 0 ? (
            <div className="loading">–ó–∞–≥—Ä—É–∑–∫–∞ –ª–æ–≥–æ–≤...</div>
          ) : logs.length === 0 ? (
            <div className="no-logs">–õ–æ–≥–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç</div>
          ) : (
            <div className="logs-list">
              {logs.map((log, index) => (
                <div key={index} className="log-entry">
                  <div className="log-header">
                    <span 
                      className="log-level"
                      style={{ color: getLevelColor(log.level) }}
                    >
                      [{log.level.toUpperCase()}]
                    </span>
                    <span className="log-timestamp">
                      {formatTimestamp(log.timestamp)}
                    </span>
                  </div>
                  <div className="log-message">
                    {log.message}
                  </div>
                  {log.details && (
                    <div className="log-details">
                      <pre>{JSON.stringify(log.details, null, 2)}</pre>
                    </div>
                  )}
                </div>
              ))}
            </div>
          )}
        </div>
      </div>

      <style jsx>{`
        .container {
          max-width: 800px;
          margin: 0 auto;
          background: var(--background-card);
          border-radius: 15px;
          box-shadow: 0 20px 40px var(--shadow-light);
          overflow: hidden;
        }

        .header {
          background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
          color: var(--accent-color);
          padding: 5px !important;
          text-align: center;
        }

        .header-content {
          display: flex;
          align-items: center;
          justify-content: center;
          gap: 12px;
          flex-wrap: nowrap;
          max-width: 400px;
          margin: 0 auto;
        }

        .logo {
          width: 50px;
          height: 50px;
          flex-shrink: 0;
        }

        .header-text {
          text-align: left;
        }

        .header h1 {
          font-size: 2.5em;
          margin-bottom: 10px;
          text-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }

        .content {
          padding: 30px;
        }

        .logs-controls {
          display: flex;
          justify-content: space-between;
          align-items: center;
          margin-bottom: 20px;
          padding: 15px;
          background: #f5f5f5;
          border-radius: 8px;
          flex-wrap: wrap;
          gap: 10px;
        }

        .controls-left, .controls-center, .controls-right {
          display: flex;
          align-items: center;
          gap: 10px;
        }

        .auto-refresh-toggle {
          display: flex;
          align-items: center;
          gap: 5px;
          font-size: 14px;
          cursor: pointer;
        }

        .logs-container {
          background: #fff;
          border: 1px solid #ddd;
          border-radius: 8px;
          max-height: 70vh;
          overflow-y: auto;
        }

        .loading, .no-logs {
          text-align: center;
          padding: 40px;
          color: #666;
          font-size: 16px;
        }

        .logs-list {
          padding: 0;
        }

        .log-entry {
          border-bottom: 1px solid #eee;
          padding: 15px;
        }

        .log-entry:last-child {
          border-bottom: none;
        }

        .log-header {
          display: flex;
          justify-content: space-between;
          align-items: center;
          margin-bottom: 8px;
        }

        .log-level {
          font-weight: bold;
          font-family: monospace;
        }

        .log-timestamp {
          font-size: 12px;
          color: #666;
          font-family: monospace;
        }

        .log-message {
          font-family: monospace;
          font-size: 14px;
          line-height: 1.4;
          margin-bottom: 8px;
        }

        .log-details {
          background: #f8f8f8;
          border: 1px solid #ddd;
          border-radius: 4px;
          padding: 10px;
          margin-top: 8px;
        }

        .log-details pre {
          margin: 0;
          font-size: 12px;
          color: #333;
          white-space: pre-wrap;
          word-break: break-all;
        }

        .btn {
          padding: 8px 16px;
          border: none;
          border-radius: 4px;
          cursor: pointer;
          font-size: 14px;
          transition: background-color 0.2s;
        }

        .btn-primary {
          background: #007bff;
          color: white;
        }

        .btn-primary:hover:not(:disabled) {
          background: #0056b3;
        }

        .btn-primary:disabled {
          background: #ccc;
          cursor: not-allowed;
        }

        .btn-secondary {
          background: #6c757d;
          color: white;
        }

        .btn-secondary:hover {
          background: #545b62;
        }

        .btn-danger {
          background: #dc3545;
          color: white;
        }

        .btn-danger:hover {
          background: #c82333;
        }

        @media (max-width: 768px) {
          .logs-controls {
            flex-direction: column;
            align-items: stretch;
          }

          .controls-left, .controls-center, .controls-right {
            justify-content: center;
          }
        }
      `}</style>
    </div>
  );
}
</file>

<file path="src/app/api/admin/cleanup-users/route.ts">
import { NextRequest, NextResponse } from 'next/server';
import { cleanupUsersExceptTest } from '@/lib/db';

export async function POST(request: NextRequest) {
  try {
    await cleanupUsersExceptTest();
    
    return NextResponse.json({ 
      success: true, 
      message: '–í—Å–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –∫—Ä–æ–º–µ User Test —É–¥–∞–ª–µ–Ω—ã —É—Å–ø–µ—à–Ω–æ' 
    });
  } catch (error) {
    console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—á–∏—Å—Ç–∫–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π:', error);
    return NextResponse.json({ 
      success: false, 
      error: '–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—á–∏—Å—Ç–∫–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π' 
    }, { status: 500 });
  }
}
</file>

<file path="src/app/api/admin/create-test-user/route.ts">
import { NextResponse } from 'next/server';
import { createUser, getUserByTelegramId } from '@/lib/db';

export async function POST(request: Request) {
  try {
    const body = await request.json();
    const { telegram_id, first_name, last_name, username } = body;

    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è
    if (!telegram_id || !first_name) {
      return NextResponse.json(
        { error: 'telegram_id –∏ first_name –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã' },
        { status: 400 }
      );
    }

    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –ª–∏ —É–∂–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å —Ç–∞–∫–∏–º telegram_id
    const existingUser = await getUserByTelegramId(telegram_id);
    if (existingUser) {
      return NextResponse.json({
        success: true,
        message: '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç',
        user: existingUser
      });
    }

    // –°–æ–∑–¥–∞–µ–º —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    const testUser = await createUser({
      telegram_id,
      first_name,
      last_name,
      username
    });

    return NextResponse.json({
      success: true,
      message: '–¢–µ—Å—Ç–æ–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–æ–∑–¥–∞–Ω —É—Å–ø–µ—à–Ω–æ',
      user: testUser
    });

  } catch (error) {
    console.error('Error creating test user:', error);
    return NextResponse.json(
      { error: '–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è' },
      { status: 500 }
    );
  }
}
</file>

<file path="src/app/api/admin/month-status/route.ts">
import { NextRequest, NextResponse } from 'next/server';
import { getMonthStatuses, getMonthStatus, setMonthClosed } from '@/lib/db';

export async function GET(request: NextRequest) {
  try {
    const { searchParams } = new URL(request.url);
    const month = searchParams.get('month');

    if (month) {
      const closed = await getMonthStatus(month);
      return NextResponse.json({ month, closed });
    }

    const statuses = await getMonthStatuses();
    return NextResponse.json({ statuses });
  } catch (error) {
    console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ —Å—Ç–∞—Ç—É—Å–∞ –º–µ—Å—è—Ü–∞:', error);
    return NextResponse.json({ error: '–û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞' }, { status: 500 });
  }
}

export async function PATCH(request: NextRequest) {
  try {
    const body = await request.json();
    const { month, closed } = body || {};

    if (!month || typeof closed !== 'boolean') {
      return NextResponse.json({ error: '–ù—É–∂–Ω—ã –ø–æ–ª—è month –∏ closed' }, { status: 400 });
    }

    const updated = await setMonthClosed(month, closed);
    return NextResponse.json({ success: true, status: updated });
  } catch (error) {
    console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ —Å—Ç–∞—Ç—É—Å–∞ –º–µ—Å—è—Ü–∞:', error);
    return NextResponse.json({ error: '–û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞' }, { status: 500 });
  }
}
</file>

<file path="src/app/api/admin/month-totals/route.ts">
import { NextRequest, NextResponse } from 'next/server';
import { getMonthTotals } from '@/lib/db';

export async function GET(request: NextRequest) {
  try {
    const { searchParams } = new URL(request.url);
    const month = searchParams.get('month');
    if (!month) {
      return NextResponse.json({ error: '–¢—Ä–µ–±—É–µ—Ç—Å—è –ø–∞—Ä–∞–º–µ—Ç—Ä month –≤ —Ñ–æ—Ä–º–∞—Ç–µ YYYY-MM' }, { status: 400 });
    }

    const totals = await getMonthTotals(month);
    return NextResponse.json({ month, ...totals });
  } catch (error) {
    console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –∏—Ç–æ–≥–æ–≤ –º–µ—Å—è—Ü–∞:', error);
    return NextResponse.json({ error: '–û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞' }, { status: 500 });
  }
}
</file>

<file path="src/app/api/admin/months-with-shifts/route.ts">
import { NextResponse } from 'next/server';
import { getMonthsWithShiftsData } from '@/lib/db';

export async function GET() {
  try {
    const months = await getMonthsWithShiftsData();
    return NextResponse.json({ months });
  } catch (error) {
    console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –º–µ—Å—è—Ü–µ–≤ —Å–æ —Å–º–µ–Ω–∞–º–∏:', error);
    return NextResponse.json({ error: '–û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞' }, { status: 500 });
  }
}
</file>

<file path="src/app/api/admin/payouts/[id]/route.ts">
import { NextRequest, NextResponse } from 'next/server';
import { ensureDatabaseInitialized } from '@/lib/global-init';
import { requireAdmin } from '@/lib/auth-server';
import {
  getPayoutById,
  deletePayoutForce,
  getEarningsForMonth,
  getPayoutsForMonth,
  getPayoutHistoryForUserAndMonth,
  getMonthStatus
} from '@/lib/db';

type RouteParams = {
  id: string;
};

type RouteContext =
  | { params: RouteParams }
  | { params: Promise<RouteParams> };

export async function DELETE(request: NextRequest, context: RouteContext) {
  try {
    await ensureDatabaseInitialized();
    await requireAdmin(request);

    const resolvedParams = await Promise.resolve(context.params);

    const payoutId = Number(resolvedParams?.id);
    if (Number.isNaN(payoutId)) {
      return NextResponse.json({ error: '–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π ID –≤—ã–ø–ª–∞—Ç—ã' }, { status: 400 });
    }

    const existing = await getPayoutById(payoutId);
    if (!existing) {
      return NextResponse.json({ error: '–í—ã–ø–ª–∞—Ç–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞' }, { status: 404 });
    }

    const isClosed = await getMonthStatus(existing.month);
    if (isClosed) {
      return NextResponse.json(
        { error: '–ú–µ—Å—è—Ü –∑–∞–∫—Ä—ã—Ç, —É–¥–∞–ª–µ–Ω–∏–µ –≤—ã–ø–ª–∞—Ç –∑–∞–ø—Ä–µ—â–µ–Ω–æ' },
        { status: 403 }
      );
    }

    const deleted = await deletePayoutForce(payoutId);
    if (!deleted) {
      return NextResponse.json({ error: '–ù–µ —É–¥–∞–ª–æ—Å—å —É–¥–∞–ª–∏—Ç—å –≤—ã–ø–ª–∞—Ç—É' }, { status: 400 });
    }

    const earnings = await getEarningsForMonth(existing.user_id, existing.month);
    const totalPaid = await getPayoutsForMonth(existing.user_id, existing.month);
    const remaining = Math.max(0, earnings - totalPaid);
    const history = await getPayoutHistoryForUserAndMonth(existing.user_id, existing.month, 5);

    return NextResponse.json({
      payout: existing,
      summary: { earnings, totalPaid, remaining },
      history
    });
  } catch (error) {
    console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –≤—ã–ø–ª–∞—Ç—ã –∞–¥–º–∏–Ω–æ–º:', error);
    return NextResponse.json({ error: 'Internal server error' }, { status: 500 });
  }
}
</file>

<file path="src/app/api/admin/payouts/route.ts">
import { NextRequest, NextResponse } from 'next/server';
import { ensureDatabaseInitialized } from '@/lib/global-init';
import { requireAdmin } from '@/lib/auth-server';
import { 
  createPayoutWithCorrection, 
  getEarningsForMonth, 
  getPayoutsForMonth, 
  getUserById,
  getMonthStatus,
  getPayoutHistoryForUserAndMonth
} from '@/lib/db';

export async function POST(request: NextRequest) {
  try {
    await ensureDatabaseInitialized();
    const admin = await requireAdmin(request);

    const body = await request.json();
    const { userId, month, amount, method, comment, date, source } = body;

    if (!userId || !month || amount === undefined) {
      return NextResponse.json(
        { error: 'userId, month –∏ amount –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã' },
        { status: 400 }
      );
    }

    const parsedAmount = typeof amount === 'string' ? parseFloat(amount) : amount;
    if (Number.isNaN(parsedAmount) || parsedAmount <= 0) {
      return NextResponse.json(
        { error: '–°—É–º–º–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–º —á–∏—Å–ª–æ–º' },
        { status: 400 }
      );
    }

    const payoutDate = typeof date === 'string' && date.length > 0
      ? date
      : new Date().toISOString().split('T')[0];

    const isClosed = await getMonthStatus(month);
    if (isClosed) {
      return NextResponse.json(
        { error: '–ú–µ—Å—è—Ü –∑–∞–∫—Ä—ã—Ç, –≤—ã–ø–ª–∞—Ç—ã –∑–∞–ø—Ä–µ—â–µ–Ω—ã' },
        { status: 403 }
      );
    }

    const targetUser = await getUserById(Number(userId));
    if (!targetUser) {
      return NextResponse.json(
        { error: '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω' },
        { status: 404 }
      );
    }

    const { payout, overpayment } = await createPayoutWithCorrection({
      user_id: Number(userId),
      month,
      amount: parsedAmount,
      date: payoutDate,
      comment: (comment ?? '').trim() || null,
      initiated_by: admin.id,
      initiator_role: 'admin',
      method: method || 'cash',
      source: source || 'admin:manual'
    });

    const earnings = await getEarningsForMonth(Number(userId), month);
    const totalPaid = await getPayoutsForMonth(Number(userId), month);
    const remaining = Math.max(0, earnings - totalPaid);

    const history = await getPayoutHistoryForUserAndMonth(Number(userId), month, 5);

    return NextResponse.json({
      payout,
      overpayment,
      summary: {
        earnings,
        totalPaid,
        remaining
      },
      history
    }, { status: 201 });
  } catch (error) {
    console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –≤—ã–ø–ª–∞—Ç—ã –∞–¥–º–∏–Ω–æ–º:', error);
    return NextResponse.json(
      { error: 'Internal server error' },
      { status: 500 }
    );
  }
}
</file>

<file path="src/app/api/admin/reports/route.ts">
import { NextRequest, NextResponse } from 'next/server';
import { getMonthlyReportsForAllMasters } from '@/lib/db';

export async function GET(request: NextRequest) {
  try {
    const { searchParams } = new URL(request.url);
    const month = searchParams.get('month');

    const reports = await getMonthlyReportsForAllMasters(month || undefined);
    
    return NextResponse.json(reports);
  } catch (error) {
    console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –æ—Ç—á–µ—Ç–æ–≤:', error);
    return NextResponse.json(
      { error: '–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –æ—Ç—á–µ—Ç–æ–≤' },
      { status: 500 }
    );
  }
}
</file>

<file path="src/app/api/auth/login/route.ts">
import { NextRequest, NextResponse } from 'next/server';
import { getUserByBrowserLogin, updateUser } from '@/lib/db';
import { verifyPassword } from '@/lib/password';
import { signToken } from '@/lib/session';
import { checkRateLimit, getClientIp } from '@/lib/rateLimit';
import { addLog } from '@/lib/logging';

export async function POST(request: NextRequest) {
  try {
    const ip = getClientIp(request);
    const ipLimit = checkRateLimit(`login:ip:${ip}`, {
      windowMs: 60_000,
      max: 5,
      blockDurationMs: 5 * 60_000,
    });
    if (!ipLimit.allowed) {
      addLog('warn', 'Login rate limit exceeded (IP)', { ip });
      const retrySec = Math.ceil((ipLimit.retryAfterMs ?? 0) / 1000);
      const res = NextResponse.json({ error: '–°–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ –ø–æ–ø—ã—Ç–æ–∫. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.' }, { status: 429 });
      if (retrySec > 0) res.headers.set('Retry-After', String(retrySec));
      return res;
    }
    const { username, password } = await request.json();
    if (!username || typeof username !== 'string' || username.trim().length < 3) {
      return NextResponse.json({ error: '–ù–µ–≤–µ—Ä–Ω—ã–π –ª–æ–≥–∏–Ω' }, { status: 400 });
    }
    if (!password || typeof password !== 'string' || password.length < 8) {
      return NextResponse.json({ error: '–ù–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å' }, { status: 400 });
    }

    const login = username.trim();
    const user = await getUserByBrowserLogin(login);
    if (!user || !user.password_hash) {
      return NextResponse.json({ error: '–ù–µ–≤–µ—Ä–Ω—ã–µ —É—á–µ—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ' }, { status: 401 });
    }
    const userLimit = checkRateLimit(`login:user:${login}`, {
      windowMs: 60_000,
      max: 5,
      blockDurationMs: 5 * 60_000,
    });
    if (!userLimit.allowed) {
      addLog('warn', 'Login rate limit exceeded (user)', { username: login });
      const retrySec = Math.ceil((userLimit.retryAfterMs ?? 0) / 1000);
      const res = NextResponse.json({ error: '–°–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ –ø–æ–ø—ã—Ç–æ–∫ –¥–ª—è —ç—Ç–æ–≥–æ –ª–æ–≥–∏–Ω–∞. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.' }, { status: 429 });
      if (retrySec > 0) res.headers.set('Retry-After', String(retrySec));
      return res;
    }
    const ok = verifyPassword(password, user.password_hash);
    if (!ok) {
      return NextResponse.json({ error: '–ù–µ–≤–µ—Ä–Ω—ã–µ —É—á–µ—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ' }, { status: 401 });
    }

    // –û–±–Ω–æ–≤–ª—è–µ–º –¥–∞—Ç—É –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –≤—Ö–æ–¥–∞
    await updateUser(user.telegram_id, { last_login_at: new Date().toISOString() });

    const token = signToken({ user_id: user.id!, telegram_id: user.telegram_id });

    const response = NextResponse.json({ success: true, user: { id: user.id, display_name: user.display_name, username: user.username, telegram_id: user.telegram_id } });
    response.cookies.set('auth_token', token, {
      httpOnly: true,
      secure: process.env.NODE_ENV === 'production',
      sameSite: 'lax',
      path: '/',
      maxAge: 60 * 60 * 24,
    });
    return response;
  } catch (error) {
    console.error('Login error:', error);
    const isDev = process.env.NODE_ENV !== 'production';
    const msg = isDev ? ((error as any)?.message || '–í–Ω—É—Ç—Ä–µ–Ω–Ω—è—è –æ—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞') : '–í–Ω—É—Ç—Ä–µ–Ω–Ω—è—è –æ—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞';
    return NextResponse.json({ error: msg }, { status: 500 });
  }
}
</file>

<file path="src/app/api/auth/logout/route.ts">
import { NextRequest, NextResponse } from 'next/server';

export async function POST(_request: NextRequest) {
  const res = NextResponse.json({ success: true });
  res.cookies.set('auth_token', '', {
    httpOnly: true,
    secure: process.env.NODE_ENV === 'production',
    sameSite: 'lax',
    path: '/',
    maxAge: 0,
  });
  return res;
}
</file>

<file path="src/app/api/auth/me/route.ts">
import { NextRequest, NextResponse } from 'next/server';
import { getUserFromRequest } from '@/lib/auth-server';

export async function GET(request: NextRequest) {
  const user = await getUserFromRequest(request);
  if (!user) {
    return NextResponse.json({ authenticated: false }, { status: 401 });
  }
  return NextResponse.json({ authenticated: true, user });
}
</file>

<file path="src/app/api/hello/route.ts">
import { NextResponse } from 'next/server';

export async function GET() {
  return NextResponse.json({ message: 'Hello from API!' });
}
</file>

<file path="src/app/api/reports/[employeeId]/shifts/route.ts">
import { NextRequest, NextResponse } from 'next/server';
import { getShiftsForUserAndMonth, getMonthlyReportsForAllMasters } from '@/lib/db';

interface ShiftData {
  id: number;
  masterName: string;
  date: string;
  hours: number;
  steamBath: number;
  brandSteam: number;
  introSteam: number;
  scrubbing: number;
  masters: number;
  amount: number;
}

export async function GET(
  request: NextRequest,
  { params }: { params: Promise<{ employeeId: string }> }
) {
  try {
    const resolvedParams = await params;
    const employeeId = parseInt(resolvedParams.employeeId);
    const { searchParams } = new URL(request.url);
    const month = searchParams.get('month'); // YYYY-MM format

    if (isNaN(employeeId) || !month) {
      return NextResponse.json(
        { error: 'Employee ID and month are required' },
        { status: 400 }
      );
    }

    // –ü–æ–ª—É—á–∞–µ–º —Å–º–µ–Ω—ã —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞ –∑–∞ —É–∫–∞–∑–∞–Ω–Ω—ã–π –º–µ—Å—è—Ü
    const shifts = await getShiftsForUserAndMonth(employeeId, month);
    
    // –ü–æ–ª—É—á–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ –∏–∑ –æ—Ç—á—ë—Ç–æ–≤
    const reports = await getMonthlyReportsForAllMasters(month);
    const userReport = reports.find(report => report.user_id === employeeId);
    const masterName = userReport ? 
      (userReport.display_name || `${userReport.first_name} ${userReport.last_name || ''}`.trim()) : 
      '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π –º–∞—Å—Ç–µ—Ä';

    // –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –Ω–æ–≤–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä—ã —Ç–∞–±–ª–∏—Ü—ã
    const formattedShifts: ShiftData[] = shifts.map(shift => {
      return {
        id: shift.id!,
        masterName: masterName,
        date: shift.date,
        hours: shift.hours,
        steamBath: shift.steam_bath || 0,      // –ü
        brandSteam: shift.brand_steam || 0,    // –§
        introSteam: shift.intro_steam || 0,    // –û
        scrubbing: shift.scrubbing || 0,       // –°
        masters: shift.masters || 1,           // –ú–ê–°–¢–ï–†–ê
        amount: shift.total,                   // –ò–¢–û–ì–û
      };
    });

    return NextResponse.json({ shifts: formattedShifts });
  } catch (error) {
    console.error('Error fetching employee shifts:', error);
    return NextResponse.json(
      { error: 'Failed to fetch employee shifts' },
      { status: 500 }
    );
  }
}
</file>

<file path="src/app/api/telegram-webhook/route.ts">
import { NextRequest, NextResponse } from 'next/server';

// Telegram Bot API types
interface TelegramUpdate {
  update_id: number;
  message?: {
    message_id: number;
    from: {
      id: number;
      is_bot: boolean;
      first_name: string;
      username?: string;
      language_code?: string;
    };
    chat: {
      id: number;
      first_name: string;
      username?: string;
      type: string;
    };
    date: number;
    text?: string;
  };
}

interface TelegramMessage {
  chat_id: number;
  text: string;
  reply_markup?: {
    inline_keyboard: Array<Array<{
      text: string;
      web_app?: { url: string };
      url?: string;
    }>>;
  };
}

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏—è —á–µ—Ä–µ–∑ Telegram Bot API
async function sendTelegramMessage(message: TelegramMessage) {
  const botToken = process.env.TELEGRAM_BOT_TOKEN;
  
  if (!botToken) {
    throw new Error('TELEGRAM_BOT_TOKEN –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è');
  }

  const response = await fetch(`https://api.telegram.org/bot${botToken}/sendMessage`, {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
    },
    body: JSON.stringify(message),
  });

  if (!response.ok) {
    throw new Error(`–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏—è: ${response.statusText}`);
  }

  return response.json();
}

// –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–æ–º–∞–Ω–¥—ã /start
async function handleStartCommand(chatId: number, firstName: string) {
  const message: TelegramMessage = {
    chat_id: chatId,
    text: `–ü—Ä–∏–≤–µ—Ç, ${firstName}! üëã\n\n–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ —Å–∏—Å—Ç–µ–º—É —É—á–µ—Ç–∞ —Ä–∞–±–æ—á–∏—Ö —Å–º–µ–Ω –ü—É—Ç—ë–≤–æ–π —É—á—ë—Ç!\n\nüîπ –í–µ–¥–∏—Ç–µ —É—á–µ—Ç —Å–≤–æ–∏—Ö —Å–º–µ–Ω\nüîπ –û—Ç—Å–ª–µ–∂–∏–≤–∞–π—Ç–µ –∑–∞—Ä–∞–±–æ—Ç–æ–∫\nüîπ –ü—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞–π—Ç–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É\n\n–ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É –Ω–∏–∂–µ, —á—Ç–æ–±—ã –æ—Ç–∫—Ä—ã—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ:`,
    reply_markup: {
      inline_keyboard: [[
        {
          text: 'üöÄ –û—Ç–∫—Ä—ã—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ',
          web_app: { url: 'https://pytuchet.vercel.app/' }
        }
      ]]
    }
  };

  return sendTelegramMessage(message);
}

// –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–æ–º–∞–Ω–¥—ã /help
async function handleHelpCommand(chatId: number) {
  const message: TelegramMessage = {
    chat_id: chatId,
    text: `üìã –ü–æ–º–æ—â—å –ø–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é –±–æ—Ç–∞:\n\nüî∏ /start - –ù–∞—á–∞—Ç—å —Ä–∞–±–æ—Ç—É —Å –±–æ—Ç–æ–º\nüî∏ /app - –û—Ç–∫—Ä—ã—Ç—å –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ\nüî∏ /help - –ü–æ–∫–∞–∑–∞—Ç—å —ç—Ç–æ —Å–æ–æ–±—â–µ–Ω–∏–µ\n\nüí° –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏:\n‚Ä¢ –£—á–µ—Ç —Ä–∞–±–æ—á–∏—Ö —Å–º–µ–Ω\n‚Ä¢ –†–∞—Å—á–µ—Ç –∑–∞—Ä–∞–±–æ—Ç–∫–∞\n‚Ä¢ –ü—Ä–æ—Å–º–æ—Ç—Ä —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏\n‚Ä¢ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ü–µ–Ω–∞–º–∏ —É—Å–ª—É–≥\n\n–î–ª—è —Ä–∞–±–æ—Ç—ã —Å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ–º –Ω–∞–∂–º–∏—Ç–µ /app –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–Ω–æ–ø–∫—É "–û—Ç–∫—Ä—ã—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ".`,
    reply_markup: {
      inline_keyboard: [[
        {
          text: 'üöÄ –û—Ç–∫—Ä—ã—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ',
          web_app: { url: 'https://pytuchet.vercel.app/' }
        }
      ]]
    }
  };

  return sendTelegramMessage(message);
}

// –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–æ–º–∞–Ω–¥—ã /app
async function handleAppCommand(chatId: number) {
  const message: TelegramMessage = {
    chat_id: chatId,
    text: `üöÄ –û—Ç–∫—Ä—ã–≤–∞–µ–º –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ...\n\n–í—ã –±—É–¥–µ—Ç–µ –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω—ã –≤ —Å–∏—Å—Ç–µ–º—É —É—á–µ—Ç–∞ —Ä–∞–±–æ—á–∏—Ö —Å–º–µ–Ω.`,
    reply_markup: {
      inline_keyboard: [[
        {
          text: 'üì± –û—Ç–∫—Ä—ã—Ç—å –ü—É—Ç—ë–≤–æ–π —É—á—ë—Ç',
          web_app: { url: 'https://pytuchet.vercel.app/' }
        }
      ]]
    }
  };

  return sendTelegramMessage(message);
}

// –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω—ã—Ö –∫–æ–º–∞–Ω–¥
async function handleUnknownMessage(chatId: number) {
  const message: TelegramMessage = {
    chat_id: chatId,
    text: `‚ùì –ò–∑–≤–∏–Ω–∏—Ç–µ, —è –Ω–µ –ø–æ–Ω–∏–º–∞—é —ç—Ç—É –∫–æ–º–∞–Ω–¥—É.\n\n–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ:\nüî∏ /start - –ù–∞—á–∞—Ç—å —Ä–∞–±–æ—Ç—É\nüî∏ /help - –ü–æ–ª—É—á–∏—Ç—å –ø–æ–º–æ—â—å\nüî∏ /app - –û—Ç–∫—Ä—ã—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ`,
    reply_markup: {
      inline_keyboard: [[
        {
          text: 'üöÄ –û—Ç–∫—Ä—ã—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ',
          web_app: { url: 'https://pytuchet.vercel.app/' }
        }
      ]]
    }
  };

  return sendTelegramMessage(message);
}

// –û—Å–Ω–æ–≤–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ WebHook
export async function POST(request: NextRequest) {
  try {
    const update: TelegramUpdate = await request.json();
    
    console.log('üì® –ü–æ–ª—É—á–µ–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ—Ç Telegram:', JSON.stringify(update, null, 2));

    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏
    if (!update.message) {
      return NextResponse.json({ ok: true });
    }

    const { message } = update;
    const chatId = message.chat.id;
    const text = message.text;
    const firstName = message.from.first_name;

    // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –∫–æ–º–∞–Ω–¥—ã
    if (text) {
      if (text === '/start') {
        await handleStartCommand(chatId, firstName);
      } else if (text === '/help') {
        await handleHelpCommand(chatId);
      } else if (text === '/app') {
        await handleAppCommand(chatId);
      } else {
        await handleUnknownMessage(chatId);
      }
    }

    return NextResponse.json({ ok: true });
  } catch (error) {
    console.error('‚ùå –û—à–∏–±–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ WebHook:', error);
    return NextResponse.json(
      { error: '–í–Ω—É—Ç—Ä–µ–Ω–Ω—è—è –æ—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞' },
      { status: 500 }
    );
  }
}

// –û–±—Ä–∞–±–æ—Ç—á–∏–∫ GET –∑–∞–ø—Ä–æ—Å–æ–≤ (–¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏)
export async function GET() {
  return NextResponse.json({ 
    status: 'Telegram WebHook endpoint —Ä–∞–±–æ—Ç–∞–µ—Ç',
    timestamp: new Date().toISOString()
  });
}
</file>

<file path="src/app/api/user/register/route.ts">
import { NextRequest, NextResponse } from 'next/server';
import { updateUser, getUserByTelegramId, createUser } from '@/lib/db';

export async function POST(request: NextRequest) {
  try {
    // –ü–æ–ª—É—á–∞–µ–º telegram_id –∏–∑ –∑–∞–≥–æ–ª–æ–≤–∫–∞
    const telegramId = request.headers.get('x-telegram-id');
    
    if (!telegramId) {
      return NextResponse.json(
        { error: 'Telegram ID –Ω–µ –Ω–∞–π–¥–µ–Ω' },
        { status: 401 }
      );
    }

    const telegramIdNumber = parseInt(telegramId);
    if (isNaN(telegramIdNumber)) {
      return NextResponse.json(
        { error: '–ù–µ–≤–µ—Ä–Ω—ã–π Telegram ID' },
        { status: 400 }
      );
    }

    const body = await request.json();
    const { display_name } = body;

    // –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö
    if (!display_name || typeof display_name !== 'string') {
      return NextResponse.json(
        { error: '–ò–º—è –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –¥–ª—è –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è' },
        { status: 400 }
      );
    }

    const trimmedDisplayName = display_name.trim();
    if (trimmedDisplayName.length < 2) {
      return NextResponse.json(
        { error: '–ò–º—è –¥–æ–ª–∂–Ω–æ —Å–æ–¥–µ—Ä–∂–∞—Ç—å –º–∏–Ω–∏–º—É–º 2 —Å–∏–º–≤–æ–ª–∞' },
        { status: 400 }
      );
    }

    if (trimmedDisplayName.length > 50) {
      return NextResponse.json(
        { error: '–ò–º—è –Ω–µ –¥–æ–ª–∂–Ω–æ –ø—Ä–µ–≤—ã—à–∞—Ç—å 50 —Å–∏–º–≤–æ–ª–æ–≤' },
        { status: 400 }
      );
    }

    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
    let existingUser = await getUserByTelegramId(telegramIdNumber);
    
    if (existingUser && existingUser.display_name) {
      return NextResponse.json(
        { error: '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É–∂–µ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω' },
        { status: 400 }
      );
    }

    let updatedUser;
    
    if (existingUser) {
      // –û–±–Ω–æ–≤–ª—è–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å display_name
      updatedUser = await updateUser(telegramIdNumber, {
        display_name: trimmedDisplayName
      });
    } else {
      // –°–æ–∑–¥–∞–µ–º –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–¥–ª—è fallback –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π)
      updatedUser = await createUser({
        telegram_id: telegramIdNumber,
        first_name: 'New',
        last_name: 'User',
        username: 'newuser',
        display_name: trimmedDisplayName
      });
    }

    if (!updatedUser) {
      return NextResponse.json(
        { error: '–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è' },
        { status: 500 }
      );
    }

    return NextResponse.json({
      success: true,
      message: '–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ',
      user: updatedUser
    });

  } catch (error) {
    console.error('Registration error:', error);
    return NextResponse.json(
      { error: '–í–Ω—É—Ç—Ä–µ–Ω–Ω—è—è –æ—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞' },
      { status: 500 }
    );
  }
}
</file>

<file path="src/app/api/user/set-password/route.ts">
import { NextRequest, NextResponse } from 'next/server';
import { getUserByTelegramId, getUserByBrowserLogin, updateUser } from '@/lib/db';
import { hashPassword, verifyPassword } from '@/lib/password';

export async function POST(request: NextRequest) {
  try {
    const telegramId = request.headers.get('x-telegram-id');
    if (!telegramId) {
      return NextResponse.json({ error: '–¢—Ä–µ–±—É–µ—Ç—Å—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ Telegram' }, { status: 401 });
    }

    const telegramIdNumber = parseInt(telegramId, 10);
    if (isNaN(telegramIdNumber)) {
      return NextResponse.json({ error: '–ù–µ–≤–µ—Ä–Ω—ã–π Telegram ID' }, { status: 400 });
    }

    const body = await request.json().catch(() => null);
    if (!body || typeof body !== 'object') {
      return NextResponse.json({ error: '–ù–µ–≤–µ—Ä–Ω–æ–µ —Ç–µ–ª–æ –∑–∞–ø—Ä–æ—Å–∞' }, { status: 400 });
    }

    const { username, password, currentPassword } = body as { username?: string; password?: string; currentPassword?: string };

    // –í–∞–ª–∏–¥–∞—Ü–∏—è –ª–æ–≥–∏–Ω–∞
    const login = (username || '').trim();
    if (!login || login.length < 3) {
      return NextResponse.json({ error: '–õ–æ–≥–∏–Ω –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å –º–∏–Ω–∏–º—É–º 3 —Å–∏–º–≤–æ–ª–∞' }, { status: 400 });
    }
    if (login.length > 64) {
      return NextResponse.json({ error: '–õ–æ–≥–∏–Ω —Å–ª–∏—à–∫–æ–º –¥–ª–∏–Ω–Ω—ã–π' }, { status: 400 });
    }

    // –í–∞–ª–∏–¥–∞—Ü–∏—è –ø–∞—Ä–æ–ª—è
    if (!password || typeof password !== 'string' || password.length < 8) {
      return NextResponse.json({ error: '–ü–∞—Ä–æ–ª—å –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å –º–∏–Ω–∏–º—É–º 8 —Å–∏–º–≤–æ–ª–æ–≤' }, { status: 400 });
    }

    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    const user = await getUserByTelegramId(telegramIdNumber);
    if (!user) {
      return NextResponse.json({ error: '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω' }, { status: 404 });
    }

    // –ü—Ä–æ–≤–µ—Ä—è–µ–º —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç—å –ª–æ–≥–∏–Ω–∞ (–µ—Å–ª–∏ –ª–æ–≥–∏–Ω –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–∏—Ç –¥—Ä—É–≥–æ–º—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é)
    const existingByLogin = await getUserByBrowserLogin(login);
    if (existingByLogin && existingByLogin.id !== user.id) {
      return NextResponse.json({ error: '–õ–æ–≥–∏–Ω —É–∂–µ –∑–∞–Ω—è—Ç' }, { status: 409 });
    }

    // –ï—Å–ª–∏ –ø–∞—Ä–æ–ª—å —É–∂–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω, —Ç—Ä–µ–±—É–µ—Ç—Å—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ç–µ–∫—É—â–µ–≥–æ –ø–∞—Ä–æ–ª—è
    if (user.password_hash) {
      if (!currentPassword || typeof currentPassword !== 'string') {
        return NextResponse.json({ error: '–¢—Ä–µ–±—É–µ—Ç—Å—è —Ç–µ–∫—É—â–∏–π –ø–∞—Ä–æ–ª—å' }, { status: 400 });
      }
      const ok = verifyPassword(currentPassword, user.password_hash);
      if (!ok) {
        return NextResponse.json({ error: '–ù–µ–≤–µ—Ä–Ω—ã–π —Ç–µ–∫—É—â–∏–π –ø–∞—Ä–æ–ª—å' }, { status: 401 });
      }
    }

    // –•–µ—à–∏—Ä—É–µ–º –ø–∞—Ä–æ–ª—å
    const passwordHash = hashPassword(password);
    const nowIso = new Date().toISOString();

    // –û–±–Ω–æ–≤–ª—è–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    const updated = await updateUser(telegramIdNumber, {
      browser_login: login,
      password_hash: passwordHash,
      password_set_at: nowIso,
    });

    return NextResponse.json({ success: true, message: '–ü–∞—Ä–æ–ª—å —Å–æ—Ö—Ä–∞–Ω—ë–Ω', user: updated });
  } catch (error: any) {
    // –û–±—Ä–∞–±–æ—Ç–∫–∞ —É–Ω–∏–∫–∞–ª—å–Ω–æ–≥–æ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è
    const message = (error && error.message) || '–í–Ω—É—Ç—Ä–µ–Ω–Ω—è—è –æ—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞';
    if (message.includes('duplicate key') || message.includes('idx_users_browser_login')) {
      return NextResponse.json({ error: '–õ–æ–≥–∏–Ω —É–∂–µ –∑–∞–Ω—è—Ç' }, { status: 409 });
    }
    console.error('Set password error:', error);
    const isDev = process.env.NODE_ENV !== 'production';
    const msg = isDev ? (error?.message || '–í–Ω—É—Ç—Ä–µ–Ω–Ω—è—è –æ—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞') : '–í–Ω—É—Ç—Ä–µ–Ω–Ω—è—è –æ—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞';
    return NextResponse.json({ error: msg }, { status: 500 });
  }
}
</file>

<file path="src/app/api/version/route.ts">
import { NextResponse } from 'next/server';
import fs from 'fs';
import path from 'path';

export async function GET() {
  try {
    const versionPath = path.join(process.cwd(), 'version.json');
    
    if (!fs.existsSync(versionPath)) {
      return NextResponse.json({
        version: '1.0.0',
        buildDate: new Date().toISOString(),
        description: '–í–µ—Ä—Å–∏—è –Ω–µ –Ω–∞–π–¥–µ–Ω–∞'
      });
    }

    const versionData = JSON.parse(fs.readFileSync(versionPath, 'utf8'));
    return NextResponse.json(versionData);
  } catch (error) {
    console.error('–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –≤–µ—Ä—Å–∏–∏:', error);
    return NextResponse.json({
      version: '1.0.0',
      buildDate: new Date().toISOString(),
      description: '–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –≤–µ—Ä—Å–∏–∏'
    }, { status: 500 });
  }
}
</file>

<file path="src/app/login/page.tsx">
'use client';

import React from 'react';
import Image from 'next/image';
import { useRouter } from 'next/navigation';

export default function LoginPage() {
  const router = useRouter();
  const [username, setUsername] = React.useState('');
  const [password, setPassword] = React.useState('');
  const [error, setError] = React.useState<string | null>(null);
  const [loading, setLoading] = React.useState(false);

  // –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É–∂–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω —á–µ—Ä–µ–∑ cookie-—Å–µ—Å—Å–∏—é, —Å—Ä–∞–∑—É –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º –Ω–∞ –≥–ª–∞–≤–Ω—É—é
  React.useEffect(() => {
    const checkAuth = async () => {
      try {
        const res = await fetch('/api/auth/me', { method: 'GET' });
        if (res.ok) {
          const data = await res.json().catch(() => null);
          if (data?.authenticated) {
            router.replace('/');
          }
        }
      } catch {
        // –∏–≥–Ω–æ—Ä–∏—Ä—É–µ–º –æ—à–∏–±–∫–∏ —Å–µ—Ç–∏
      }
    };
    checkAuth();
  }, [router]);

  const handleLogin = async () => {
    setError(null);
    if (!username || username.trim().length < 3) {
      setError('–õ–æ–≥–∏–Ω –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å –º–∏–Ω–∏–º—É–º 3 —Å–∏–º–≤–æ–ª–∞');
      return;
    }
    if (!password || password.length < 8) {
      setError('–ü–∞—Ä–æ–ª—å –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å –º–∏–Ω–∏–º—É–º 8 —Å–∏–º–≤–æ–ª–æ–≤');
      return;
    }
    setLoading(true);
    try {
      const response = await fetch('/api/auth/login', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ username: username.trim(), password }),
      });

      const data = await response.json().catch(() => ({}));
      if (!response.ok) {
        throw new Error(data.error || '–ù–µ–≤–µ—Ä–Ω—ã–µ —É—á–µ—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ');
      }
      router.push('/');
    } catch (e) {
      setError(e instanceof Error ? e.message : '–û—à–∏–±–∫–∞ –≤—Ö–æ–¥–∞');
    } finally {
      setLoading(false);
    }
  };

  return (
    <>
      <style jsx global>{`
        * { margin: 0; padding: 0; box-sizing: border-box; }
        :root {
          --primary-color: #4A2B1B; --secondary-color: #7A3E2D; --accent-color: #E9D5B5;
          --background-main: #F2E5D3; --font-color: #2C1A0F; --primary-light: #5D3426; --primary-dark: #3A2015;
          --secondary-light: #8B4A38; --secondary-dark: #6A3424; --accent-light: #F0E2C8; --accent-dark: #DCC49F;
          --background-card: #FEFCF8; --background-section: rgba(233, 213, 181, 0.15);
          --shadow-light: rgba(74, 43, 27, 0.1); --shadow-medium: rgba(74, 43, 27, 0.15); --border-light: rgba(74, 43, 27, 0.2);
        }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: linear-gradient(135deg, var(--background-main) 0%, var(--accent-light) 100%); min-height: 100vh; padding: 20px; color: var(--font-color); }
        .container { max-width: 600px; margin: 0 auto; background: var(--background-card); border-radius: 15px; box-shadow: 0 20px 40px var(--shadow-light); overflow: hidden; }
        .header { background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%); color: var(--accent-color); padding: 24px; text-align: center; }
        .header-content { display: flex; align-items: center; justify-content: center; gap: 16px; }
        .logo { width: 64px; height: 64px; flex-shrink: 0; display: flex; align-items: center; justify-content: center; }
        .header h1 { font-size: 1.6em; text-shadow: 0 2px 4px rgba(0,0,0,0.3); }
        .content { padding: 24px; }
        .form-section { background: linear-gradient(135deg, var(--background-section) 0%, rgba(122, 62, 45, 0.08) 100%); border-radius: 12px; padding: 20px; border: 2px solid var(--primary-color); box-shadow: 0 8px 25px var(--shadow-medium); position: relative; }
        .input-group { display: flex; flex-direction: column; margin-bottom: 16px; }
        .input-label { font-weight: 600; color: var(--font-color); margin-bottom: 8px; font-size: 14px; text-transform: uppercase; letter-spacing: 0.5px; }
        .input-field { width: 100%; padding: 12px 14px; border: 2px solid var(--border-light); border-radius: 10px; font-size: 16px; background: var(--background-card); color: var(--font-color); transition: all 0.3s ease; box-shadow: 0 2px 4px var(--shadow-light); }
        .input-field:focus { outline: none; border-color: var(--primary-color); box-shadow: 0 0 0 4px rgba(74, 43, 27, 0.1), 0 4px 12px var(--shadow-medium); transform: translateY(-1px); }
        .btn { background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%); color: var(--accent-color); border: none; padding: 11px 22px; border-radius: 10px; font-size: 11px; font-weight: 700; cursor: pointer; transition: all 0.3s ease; text-transform: uppercase; letter-spacing: 0.5px; box-shadow: 0 4px 15px var(--shadow-medium); }
        .btn:hover { transform: translateY(-3px); box-shadow: 0 8px 25px rgba(74, 43, 27, 0.4); background: linear-gradient(135deg, var(--primary-light) 0%, var(--secondary-light) 100%); }
        .error { margin-top: 10px; color: #991b1b; }
        .hint { margin-top: 12px; font-size: 14px; opacity: 0.85; }
      `}</style>

      <div className="container">
        <div className="header">
          <div className="header-content">
            <div className="logo">
              <Image src="/logo.svg" alt="–õ–æ–≥–æ—Ç–∏–ø" width={64} height={64} priority />
            </div>
            <h1>–í—Ö–æ–¥ –≤ –ª–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç</h1>
          </div>
        </div>

        <div className="content">
          <div className="form-section">
            <div className="input-group">
              <label className="input-label">–õ–æ–≥–∏–Ω (Telegram username)</label>
              <input className="input-field" type="text" value={username} onChange={(e) => setUsername(e.target.value)} placeholder="username" />
            </div>
            <div className="input-group">
              <label className="input-label">–ü–∞—Ä–æ–ª—å</label>
              <input className="input-field" type="password" value={password} onChange={(e) => setPassword(e.target.value)} placeholder="–º–∏–Ω–∏–º—É–º 8 —Å–∏–º–≤–æ–ª–æ–≤" />
            </div>
            <div style={{ display: 'flex', gap: 12, marginTop: 12 }}>
              <button className="btn" onClick={handleLogin} disabled={loading}>{loading ? '–í—Ö–æ–¥...' : '–í–æ–π—Ç–∏'}</button>
            </div>
            {error && <div className="error">{error}</div>}
            <div className="hint">–ï—Å–ª–∏ –≤—Ö–æ–¥ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç, —Å–Ω–∞—á–∞–ª–∞ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –ø–∞—Ä–æ–ª—å –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ –∞–∫–∫–∞—É–Ω—Ç–∞.</div>
          </div>
        </div>
      </div>
    </>
  );
}
</file>

<file path="src/components/ui/Button.tsx">
import React from 'react';

interface ButtonProps {
  children: React.ReactNode;
  onClick?: () => void;
  variant?: 'primary' | 'secondary' | 'danger';
  size?: 'sm' | 'md' | 'lg';
  disabled?: boolean;
  type?: 'button' | 'submit' | 'reset';
  className?: string;
}

export const Button: React.FC<ButtonProps> = ({
  children,
  onClick,
  variant = 'primary',
  size = 'md',
  disabled = false,
  type = 'button',
  className = '',
}) => {
  const baseClasses = 'font-medium rounded-lg transition-colors focus:outline-none focus:ring-2 focus:ring-offset-2';
  
  const variantClasses = {
    primary: 'bg-blue-600 text-white hover:bg-blue-700 focus:ring-blue-500',
    secondary: 'bg-gray-200 text-gray-900 hover:bg-gray-300 focus:ring-gray-500',
    danger: 'bg-red-600 text-white hover:bg-red-700 focus:ring-red-500',
  };
  
  const sizeClasses = {
    sm: 'px-3 py-1.5 text-sm',
    md: 'px-4 py-2 text-base',
    lg: 'px-6 py-3 text-lg',
  };
  
  const disabledClasses = disabled ? 'opacity-50 cursor-not-allowed' : '';
  
  const classes = `${baseClasses} ${variantClasses[variant]} ${sizeClasses[size]} ${disabledClasses} ${className}`.trim();
  
  return (
    <button
      type={type}
      onClick={onClick}
      disabled={disabled}
      className={classes}
    >
      {children}
    </button>
  );
};
</file>

<file path="src/components/ui/Icons.tsx">
import React from 'react';

interface IconProps {
  className?: string;
}

export const ChevronDown: React.FC<IconProps> = ({ className = '' }) => (
  <svg
    className={`w-5 h-5 ${className}`}
    fill="none"
    stroke="currentColor"
    viewBox="0 0 24 24"
  >
    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M19 9l-7 7-7-7" />
  </svg>
);

export const ChevronUp: React.FC<IconProps> = ({ className = '' }) => (
  <svg
    className={`w-5 h-5 ${className}`}
    fill="none"
    stroke="currentColor"
    viewBox="0 0 24 24"
  >
    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M5 15l7-7 7 7" />
  </svg>
);
</file>

<file path="src/components/ui/Input.tsx">
import React from 'react';

interface InputProps {
  label?: string;
  type?: 'text' | 'email' | 'password' | 'number' | 'date' | 'time';
  placeholder?: string;
  value?: string;
  onChange?: (e: React.ChangeEvent<HTMLInputElement>) => void;
  required?: boolean;
  disabled?: boolean;
  error?: string;
  className?: string;
  step?: string;
}

export const Input: React.FC<InputProps> = ({
  label,
  type = 'text',
  placeholder,
  value,
  onChange,
  required = false,
  disabled = false,
  error,
  className = '',
  step,
}) => {
  const inputClasses = `
    w-full px-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500
    ${error ? 'border-red-500' : 'border-gray-300'}
    ${disabled ? 'bg-gray-100 cursor-not-allowed' : 'bg-white'}
    ${className}
  `.trim();

  return (
    <div className="mb-4">
      {label && (
        <label className="block text-sm font-medium text-gray-700 mb-1">
          {label}
          {required && <span className="text-red-500 ml-1">*</span>}
        </label>
      )}
      <input
        type={type}
        placeholder={placeholder}
        value={value}
        onChange={onChange}
        required={required}
        disabled={disabled}
        step={step}
        className={inputClasses}
      />
      {error && (
        <p className="mt-1 text-sm text-red-600">{error}</p>
      )}
    </div>
  );
};
</file>

<file path="src/components/ui/Select.tsx">
import React, { useState, useRef, useEffect } from 'react';

interface SelectProps {
  value: string;
  onValueChange: (value: string) => void;
  children: React.ReactNode;
}

interface SelectTriggerProps {
  className?: string;
  children: React.ReactNode;
}

interface SelectContentProps {
  children: React.ReactNode;
}

interface SelectItemProps {
  value: string;
  children: React.ReactNode;
}

interface SelectValueProps {
  placeholder?: string;
}

const SelectContext = React.createContext<{
  value: string;
  onValueChange: (value: string) => void;
  isOpen: boolean;
  setIsOpen: (open: boolean) => void;
}>({
  value: '',
  onValueChange: () => {},
  isOpen: false,
  setIsOpen: () => {},
});

export const Select: React.FC<SelectProps> = ({ value, onValueChange, children }) => {
  const [isOpen, setIsOpen] = useState(false);
  const selectRef = useRef<HTMLDivElement>(null);

  useEffect(() => {
    const handleClickOutside = (event: MouseEvent) => {
      if (selectRef.current && !selectRef.current.contains(event.target as Node)) {
        setIsOpen(false);
      }
    };

    document.addEventListener('mousedown', handleClickOutside);
    return () => document.removeEventListener('mousedown', handleClickOutside);
  }, []);

  return (
    <SelectContext.Provider value={{ value, onValueChange, isOpen, setIsOpen }}>
      <div ref={selectRef} className="relative">
        {children}
      </div>
    </SelectContext.Provider>
  );
};

export const SelectTrigger: React.FC<SelectTriggerProps> = ({ className = '', children }) => {
  const { isOpen, setIsOpen } = React.useContext(SelectContext);

  return (
    <button
      type="button"
      className={`flex items-center justify-between w-full px-3 py-2 text-sm bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 ${className}`}
      onClick={() => setIsOpen(!isOpen)}
    >
      {children}
      <svg
        className={`w-4 h-4 transition-transform ${isOpen ? 'rotate-180' : ''}`}
        fill="none"
        stroke="currentColor"
        viewBox="0 0 24 24"
      >
        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M19 9l-7 7-7-7" />
      </svg>
    </button>
  );
};

export const SelectContent: React.FC<SelectContentProps> = ({ children }) => {
  const { isOpen } = React.useContext(SelectContext);

  if (!isOpen) return null;

  return (
    <div className="absolute z-50 w-full mt-1 bg-white border border-gray-300 rounded-md shadow-lg max-h-60 overflow-auto">
      {children}
    </div>
  );
};

export const SelectItem: React.FC<SelectItemProps> = ({ value, children }) => {
  const { value: selectedValue, onValueChange, setIsOpen } = React.useContext(SelectContext);

  const handleClick = () => {
    onValueChange(value);
    setIsOpen(false);
  };

  return (
    <button
      type="button"
      className={`w-full px-3 py-2 text-sm text-left hover:bg-gray-100 focus:outline-none focus:bg-gray-100 ${
        selectedValue === value ? 'bg-blue-50 text-blue-600' : 'text-gray-900'
      }`}
      onClick={handleClick}
    >
      {children}
    </button>
  );
};

export const SelectValue: React.FC<SelectValueProps> = ({ placeholder }) => {
  const { value } = React.useContext(SelectContext);

  return (
    <span className={value ? 'text-gray-900' : 'text-gray-500'}>
      {value || placeholder}
    </span>
  );
};
</file>

<file path="src/components/NewPaymentForm.tsx">
'use client';

import React, { useState } from 'react';

interface NewPaymentFormProps {
  onSubmit: (data: { amount: number; comment: string }) => void;
  onCancel: () => void;
  isSubmitting?: boolean;
}

export function NewPaymentForm({ onSubmit, onCancel, isSubmitting }: NewPaymentFormProps) {
  const [amount, setAmount] = useState('');
  const [comment, setComment] = useState('');
  const [error, setError] = useState<string | null>(null);

  const handleSubmit = (event: React.FormEvent) => {
    event.preventDefault();
    const parsed = Number(amount.replace(/\s+/g, ''));
    if (!amount || Number.isNaN(parsed) || parsed <= 0) {
      setError('–í–≤–µ–¥–∏—Ç–µ —Å—É–º–º—É –±–æ–ª—å—à–µ –Ω—É–ª—è');
      return;
    }
    setError(null);
    onSubmit({ amount: parsed, comment: comment.trim() });
  };

  return (
    <form className="new-payment-card" onSubmit={handleSubmit}>
      <label className="new-payment-label">
        –°—É–º–º–∞ –≤—ã–ø–ª–∞—Ç—ã
        <input
          type="number"
          min="0"
          step="100"
          className={`new-payment-input ${error ? 'new-payment-input--error' : ''}`}
          value={amount}
          onChange={(e) => setAmount(e.target.value)}
          disabled={isSubmitting}
        />
      </label>
      {error && <div className="new-payment-error">{error}</div>}

      <label className="new-payment-label">
        –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π
        <input
          type="text"
          className="new-payment-input"
          value={comment}
          onChange={(e) => setComment(e.target.value)}
          disabled={isSubmitting}
        />
      </label>

      <div className="new-payment-actions">
        <button type="button" className="btn btn-cancel" onClick={onCancel} disabled={isSubmitting}>
          –û—Ç–º–µ–Ω–∞
        </button>
        <button type="submit" className="btn btn-save" disabled={isSubmitting}>
          {isSubmitting ? '–°–æ—Ö—Ä–∞–Ω—è–µ–º‚Ä¶' : '–°–æ—Ö—Ä–∞–Ω–∏—Ç—å'}
        </button>
      </div>

      <style jsx>{`
        .new-payment-card {
          background: #fff7ef;
          border-radius: 16px;
          padding: 20px;
          display: flex;
          flex-direction: column;
          gap: 16px;
        }
        .new-payment-label {
          display: flex;
          flex-direction: column;
          font-size: 13px;
          font-weight: 600;
          color: var(--primary-color, #2c1a0f);
          gap: 6px;
        }
        .new-payment-input {
          border: 1px solid rgba(44, 26, 15, 0.25);
          border-radius: 10px;
          padding: 10px 12px;
          font-size: 14px;
          width: 100%;
          background: #fff;
        }
        .new-payment-input--error {
          border-color: #dc2626;
        }
        .new-payment-error {
          font-size: 12px;
          color: #dc2626;
        }
        .new-payment-actions {
          display: flex;
          justify-content: space-between;
          gap: 12px;
        }
        .btn-cancel {
          flex: 1;
          border: 1px solid #6b3f27;
          color: #6b3f27;
          background: rgba(107, 63, 39, 0.05);
          border-radius: 8px;
          padding: 7px 10px;
          font-weight: 600;
        }
        .btn-save {
          flex: 1;
          border: none;
          background: #6b3f27;
          color: #fff;
          border-radius: 8px;
          padding: 7px 10px;
          font-weight: 600;
        }
        .btn:disabled {
          opacity: 0.6;
          cursor: not-allowed;
        }
        @media (max-width: 520px) {
          .new-payment-card {
            padding: 16px;
          }
          .new-payment-actions {
            flex-direction: row;
          }
        }
      `}</style>
    </form>
  );
}
</file>

<file path="src/components/TelegramWebApp.tsx">
'use client';

import { useEffect } from 'react';

export default function TelegramWebApp() {
  useEffect(() => {
    // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –Ω–∞—á–∞–ª—å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –¥–ª—è CSS –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö
    const setInitialViewportVars = () => {
      const html = document.documentElement;
      
      // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –Ω–∞—á–∞–ª—å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –µ—Å–ª–∏ –∏—Ö –Ω–µ—Ç
      if (!html.style.getPropertyValue('--tg-viewport-height')) {
        html.style.setProperty('--tg-viewport-height', `${window.innerHeight}px`);
      }
      if (!html.style.getPropertyValue('--tg-viewport-stable-height')) {
        html.style.setProperty('--tg-viewport-stable-height', `${window.innerHeight}px`);
      }
    };

    // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –Ω–∞—á–∞–ª—å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è —Å—Ä–∞–∑—É
    setInitialViewportVars();

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º Telegram Web App –µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–µ–Ω
    if (typeof window !== 'undefined' && (window as any).Telegram?.WebApp) {
      const tg = (window as any).Telegram.WebApp;
      
      // –ì–æ—Ç–æ–≤–∏–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
      tg.ready();
      if (tg.expand) {
        tg.expand();
      }

      // –û–±–Ω–æ–≤–ª—è–µ–º CSS –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ —Å —Ä–µ–∞–ª—å–Ω—ã–º–∏ –∑–Ω–∞—á–µ–Ω–∏—è–º–∏
      const updateViewportVars = () => {
        const html = document.documentElement;
        if (tg.viewportHeight) {
          html.style.setProperty('--tg-viewport-height', `${tg.viewportHeight}px`);
        }
        if (tg.viewportStableHeight) {
          html.style.setProperty('--tg-viewport-stable-height', `${tg.viewportStableHeight}px`);
        }
      };

      // –û–±–Ω–æ–≤–ª—è–µ–º –∑–Ω–∞—á–µ–Ω–∏—è
      updateViewportVars();

      // –°–ª—É—à–∞–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ä–∞–∑–º–µ—Ä–∞ –æ–∫–Ω–∞
      const handleResize = () => {
        updateViewportVars();
      };

      window.addEventListener('resize', handleResize);

      return () => {
        window.removeEventListener('resize', handleResize);
      };
    }
  }, []);

  return null;
}
</file>

<file path="src/components/Toast.tsx">
import { useState, useCallback } from 'react';

export type ToastVariant = 'success' | 'error' | 'info';

export interface ToastMessage {
  id: number;
  text: string;
  variant: ToastVariant;
}

export function useToast(defaultDuration = 4000) {
  const [toasts, setToasts] = useState<ToastMessage[]>([]);

  const hideToast = useCallback((id: number) => {
    setToasts((prev) => prev.filter((toast) => toast.id !== id));
  }, []);

  const showToast = useCallback(
    (text: string, variant: ToastVariant = 'info', duration = defaultDuration) => {
      const id = Date.now() + Math.random();
      setToasts((prev) => [...prev, { id, text, variant }]);
      if (duration > 0) {
        setTimeout(() => hideToast(id), duration);
      }
    },
    [defaultDuration, hideToast]
  );

  return { toasts, showToast, hideToast };
}

export function ToastContainer({
  toasts,
  onDismiss
}: {
  toasts: ToastMessage[];
  onDismiss: (id: number) => void;
}) {
  if (toasts.length === 0) {
    return null;
  }

  return (
    <div className="toast-container">
      {toasts.map((toast) => (
        <div key={toast.id} className={`toast toast--${toast.variant}`}>
          <span>{toast.text}</span>
          <button type="button" onClick={() => onDismiss(toast.id)} aria-label="–ó–∞–∫—Ä—ã—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ">
            √ó
          </button>
        </div>
      ))}
      <style jsx>{`
        .toast-container {
          position: fixed;
          bottom: 24px;
          right: 24px;
          display: flex;
          flex-direction: column;
          gap: 12px;
          z-index: 1500;
        }
        .toast {
          min-width: 260px;
          max-width: 320px;
          padding: 12px 16px;
          border-radius: 12px;
          box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
          color: #1f2937;
          background: #fff;
          display: flex;
          justify-content: space-between;
          align-items: center;
          gap: 12px;
          font-size: 14px;
        }
        .toast button {
          border: none;
          background: transparent;
          font-size: 18px;
          color: inherit;
          cursor: pointer;
        }
        .toast--success {
          border-left: 4px solid #10b981;
        }
        .toast--error {
          border-left: 4px solid #ef4444;
        }
        .toast--info {
          border-left: 4px solid #3b82f6;
        }
        @media (max-width: 640px) {
          .toast-container {
            left: 16px;
            right: 16px;
            bottom: 16px;
          }
          .toast {
            width: 100%;
            max-width: none;
          }
        }
      `}</style>
    </div>
  );
}
</file>

<file path="src/components/UserGreeting.tsx">
'use client';

import { useTelegramAuth } from '@/hooks/useTelegramAuth';

export default function UserGreeting() {
  const { user, loading, error } = useTelegramAuth();

  if (loading) {
    return (
      <div className="bg-blue-50 border border-blue-200 rounded-lg p-4 mb-6">
        <div className="flex items-center">
          <div className="animate-spin rounded-full h-4 w-4 border-b-2 border-blue-600 mr-2"></div>
          <span className="text-blue-700">–ó–∞–≥—Ä—É–∑–∫–∞...</span>
        </div>
      </div>
    );
  }

  if (error) {
    return (
      <div className="bg-red-50 border border-red-200 rounded-lg p-4 mb-6">
        <div className="flex items-center">
          <svg className="w-5 h-5 text-red-500 mr-2" fill="currentColor" viewBox="0 0 20 20">
            <path fillRule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clipRule="evenodd" />
          </svg>
          <span className="text-red-700">{error}</span>
        </div>
      </div>
    );
  }

  if (!user) {
    return null;
  }

  // –ò—Å–ø–æ–ª—å–∑—É–µ–º display_name –µ—Å–ª–∏ —É–∫–∞–∑–∞–Ω–æ, –∏–Ω–∞—á–µ fallback –Ω–∞ first_name + last_name
  const displayName = user.display_name || 
    (user.first_name + (user.last_name ? ` ${user.last_name}` : ''));

  return (
    <span>
      –ü—Ä–∏–≤–µ—Ç, {displayName}!
    </span>
  );
}
</file>

<file path="src/components/VersionDisplay.tsx">
'use client';

import { useState, useEffect } from 'react';

interface VersionInfo {
  version: string;
  buildDate: string;
  description: string;
}

export default function VersionDisplay() {
  const [versionInfo, setVersionInfo] = useState<VersionInfo | null>(null);
  const [showDetails, setShowDetails] = useState(false);

  useEffect(() => {
    // –ó–∞–≥—Ä—É–∂–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –≤–µ—Ä—Å–∏–∏
    console.log('VersionDisplay: –ó–∞–≥—Ä—É–∂–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –≤–µ—Ä—Å–∏–∏...');
    fetch('/version.json')
      .then(response => response.json())
      .then(data => {
        console.log('VersionDisplay: –í–µ—Ä—Å–∏—è –∑–∞–≥—Ä—É–∂–µ–Ω–∞:', data);
        setVersionInfo(data);
      })
      .catch(error => console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –≤–µ—Ä—Å–∏–∏:', error));
  }, []);

  if (!versionInfo) {
    return null;
  }

  const formatDate = (dateString: string) => {
    const date = new Date(dateString);
    return date.toLocaleDateString('ru-RU', {
      year: 'numeric',
      month: 'long',
      day: 'numeric',
      hour: '2-digit',
      minute: '2-digit'
    });
  };

  return (
    <div style={{
      position: 'fixed',
      bottom: '16px',
      right: '16px',
      zIndex: 1000
    }}>
      <div 
        style={{
          backgroundColor: 'var(--primary-color)',
          color: 'white',
          padding: '4px 12px',
          borderRadius: '8px',
          fontSize: '12px',
          cursor: 'pointer',
          transition: 'background-color 0.2s',
          userSelect: 'none'
        }}
        onClick={() => setShowDetails(!showDetails)}
        onMouseEnter={(e) => {
          e.currentTarget.style.backgroundColor = 'var(--primary-light)';
        }}
        onMouseLeave={(e) => {
          e.currentTarget.style.backgroundColor = 'var(--primary-color)';
        }}
      >
        v{versionInfo.version}
      </div>
      
      {showDetails && (
        <div style={{
          position: 'absolute',
          bottom: '100%',
          right: '0',
          marginBottom: '8px',
          backgroundColor: 'white',
          border: '1px solid #e5e5e5',
          borderRadius: '8px',
          boxShadow: '0 4px 6px rgba(0, 0, 0, 0.1)',
          padding: '16px',
          minWidth: '320px',
          maxWidth: '384px'
        }}>
          <div style={{ fontSize: '14px' }}>
            <div style={{
              fontWeight: '600',
              color: 'var(--font-color)',
              marginBottom: '8px'
            }}>
              –í–µ—Ä—Å–∏—è {versionInfo.version}
            </div>
            <div style={{
              color: '#666',
              marginBottom: '8px'
            }}>
              –°–±–æ—Ä–∫–∞: {formatDate(versionInfo.buildDate)}
            </div>
            <div style={{
              color: 'var(--font-color)',
              fontSize: '12px',
              lineHeight: '1.5'
            }}>
              {versionInfo.description}
            </div>
          </div>
          <div style={{
            position: 'absolute',
            top: '100%',
            right: '16px',
            width: '0',
            height: '0',
            borderLeft: '4px solid transparent',
            borderRight: '4px solid transparent',
            borderTop: '4px solid white'
          }}></div>
        </div>
      )}
    </div>
  );
}
</file>

<file path="src/contexts/ServicesContext.tsx">
'use client';

import React, { createContext, useContext, useState, useEffect, useCallback } from 'react';

export interface Price {
  id?: number;
  name: string;
  price: number;
}

interface ServicesContextType {
  prices: Price[];
  loading: boolean;
  error: string | null;
  refreshPrices: () => Promise<void>;
  addPrice: (price: Omit<Price, 'id'>) => Promise<void>;
  updatePrice: (id: number, price: Omit<Price, 'id'>) => Promise<void>;
  deletePrice: (id: number) => Promise<void>;
  getPrice: (name: string) => number;
}

const ServicesContext = createContext<ServicesContextType | undefined>(undefined);

export const useServices = () => {
  const context = useContext(ServicesContext);
  if (context === undefined) {
    throw new Error('useServices must be used within a ServicesProvider');
  }
  return context;
};

interface ServicesProviderProps {
  children: React.ReactNode;
}

export const ServicesProvider: React.FC<ServicesProviderProps> = ({ children }) => {
  const [prices, setPrices] = useState<Price[]>([]);
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState<string | null>(null);

  // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Ü–µ–Ω—ã –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é
  const getPrice = useCallback((name: string): number => {
    const price = prices.find(p => p.name === name);
    return price ? price.price : 0;
  }, [prices]);

  // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ —Ü–µ–Ω
  const refreshPrices = useCallback(async () => {
    try {
      setLoading(true);
      setError(null);
      
      const response = await fetch('/api/prices');
      if (!response.ok) {
        throw new Error(`–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ü–µ–Ω: ${response.status}`);
      }
      
      const data = await response.json();
      setPrices(data);
    } catch (err) {
      const errorMessage = err instanceof Error ? err.message : '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞';
      setError(errorMessage);
      console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Ü–µ–Ω:', err);
    } finally {
      setLoading(false);
    }
  }, []);

  // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –Ω–æ–≤–æ–π —Ü–µ–Ω—ã
  const addPrice = useCallback(async (newPrice: Omit<Price, 'id'>) => {
    try {
      setError(null);
      
      const response = await fetch('/api/prices', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify(newPrice),
      });

      if (!response.ok) {
        const errorData = await response.json();
        throw new Error(errorData.error || `–û—à–∏–±–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —É—Å–ª—É–≥–∏: ${response.status}`);
      }

      // –û–±–Ω–æ–≤–ª—è–µ–º –ª–æ–∫–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è
      await refreshPrices();
    } catch (err) {
      const errorMessage = err instanceof Error ? err.message : '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞';
      setError(errorMessage);
      console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ —Ü–µ–Ω—ã:', err);
      throw err;
    }
  }, [refreshPrices]);

  // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Ü–µ–Ω—ã
  const updatePrice = useCallback(async (id: number, updatedPrice: Omit<Price, 'id'>) => {
    try {
      setError(null);
      
      const response = await fetch(`/api/prices/${id}`, {
        method: 'PUT',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify(updatedPrice),
      });

      if (!response.ok) {
        const errorData = await response.json();
        throw new Error(errorData.error || `–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —É—Å–ª—É–≥–∏: ${response.status}`);
      }

      // –û–±–Ω–æ–≤–ª—è–µ–º –ª–æ–∫–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
      await refreshPrices();
    } catch (err) {
      const errorMessage = err instanceof Error ? err.message : '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞';
      setError(errorMessage);
      console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ —Ü–µ–Ω—ã:', err);
      throw err;
    }
  }, [refreshPrices]);

  // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è —Ü–µ–Ω—ã
  const deletePrice = useCallback(async (id: number) => {
    try {
      setError(null);
      
      const response = await fetch(`/api/prices?id=${id}`, {
        method: 'DELETE',
      });

      if (!response.ok) {
        const errorData = await response.json();
        throw new Error(errorData.error || `–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è —É—Å–ª—É–≥–∏: ${response.status}`);
      }

      // –û–±–Ω–æ–≤–ª—è–µ–º –ª–æ–∫–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ —É–¥–∞–ª–µ–Ω–∏—è
      await refreshPrices();
    } catch (err) {
      const errorMessage = err instanceof Error ? err.message : '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞';
      setError(errorMessage);
      console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ —Ü–µ–Ω—ã:', err);
      throw err;
    }
  }, [refreshPrices]);

  // –ó–∞–≥—Ä—É–∂–∞–µ–º —Ü–µ–Ω—ã –ø—Ä–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
  useEffect(() => {
    refreshPrices();
  }, [refreshPrices]);

  const value: ServicesContextType = {
    prices,
    loading,
    error,
    refreshPrices,
    addPrice,
    updatePrice,
    deletePrice,
    getPrice,
  };

  return (
    <ServicesContext.Provider value={value}>
      {children}
    </ServicesContext.Provider>
  );
};
</file>

<file path="src/lib/global-init.ts">
import { initDatabase } from './db';

// –ì–ª–æ–±–∞–ª—å–Ω–∞—è –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
declare global {
  var __db_initialized: boolean | undefined;
  var __db_init_promise: Promise<void> | undefined;
}

export async function ensureDatabaseInitialized(): Promise<void> {
  // –ï—Å–ª–∏ –±–∞–∑–∞ —É–∂–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞, –≤–æ–∑–≤—Ä–∞—â–∞–µ–º—Å—è —Å—Ä–∞–∑—É
  if (global.__db_initialized) {
    return;
  }

  // –ï—Å–ª–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —É–∂–µ –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ, –∂–¥–µ–º –µ—ë –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è
  if (global.__db_init_promise) {
    await global.__db_init_promise;
    return;
  }

  // –°–æ–∑–¥–∞–µ–º –ø—Ä–æ–º–∏—Å –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
  global.__db_init_promise = initDatabase();
  
  try {
    await global.__db_init_promise;
    global.__db_initialized = true;
    console.log('‚úÖ Database initialized globally');
  } catch (error) {
    // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –ø—Ä–æ–º–∏—Å –ø—Ä–∏ –æ—à–∏–±–∫–µ, —á—Ç–æ–±—ã –º–æ–∂–Ω–æ –±—ã–ª–æ –ø–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å —Å–Ω–æ–≤–∞
    global.__db_init_promise = undefined;
    console.error('‚ùå Failed to initialize database globally:', error);
    throw error;
  }
}
</file>

<file path="src/lib/logging.ts">
// –°–∏—Å—Ç–µ–º–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –¥–ª—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
export interface LogEntry {
  id: string;
  timestamp: string;
  level: 'info' | 'warn' | 'error' | 'debug';
  message: string;
  details?: any;
}

// –í—Ä–µ–º–µ–Ω–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –ª–æ–≥–æ–≤ –≤ –ø–∞–º—è—Ç–∏ (–¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏)
let logs: LogEntry[] = [];

export function addLog(level: LogEntry['level'], message: string, details?: any): LogEntry {
  const logEntry: LogEntry = {
    id: Math.random().toString(36).substr(2, 9),
    timestamp: new Date().toISOString(),
    level,
    message,
    details
  };
  
  logs.push(logEntry);
  
  // –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ª–æ–≥–æ–≤ –≤ –ø–∞–º—è—Ç–∏
  if (logs.length > 1000) {
    logs = logs.slice(-500);
  }
  
  // –¢–∞–∫–∂–µ –≤—ã–≤–æ–¥–∏–º –≤ –∫–æ–Ω—Å–æ–ª—å –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
  console.log(`[${logEntry.level.toUpperCase()}] ${logEntry.message}`, details || '');
  
  return logEntry;
}

export function getLogs(): LogEntry[] {
  return [...logs].reverse(); // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –∫–æ–ø–∏—é –≤ –æ–±—Ä–∞—Ç–Ω–æ–º –ø–æ—Ä—è–¥–∫–µ (–Ω–æ–≤—ã–µ —Å–≤–µ—Ä—Ö—É)
}

export function clearLogs(): void {
  logs = [];
}
</file>

<file path="src/lib/password.ts">
import crypto from 'crypto';

// –§–æ—Ä–º–∞—Ç —Ö—Ä–∞–Ω–µ–Ω–∏—è: scrypt$N$r$p$saltBase64$hashBase64
export function hashPassword(password: string, opts?: { N?: number; r?: number; p?: number }): string {
  // –°–Ω–∏–∂–∞–µ–º –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ —Å —Å—Ä–µ–¥–∞–º–∏ —Å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–æ–π –ø–∞–º—è—Ç—å—é
  const N = opts?.N ?? 4096; // cost
  const r = opts?.r ?? 8;     // block size
  const p = opts?.p ?? 1;     // parallelization
  const salt = crypto.randomBytes(16);
  const keyLen = 64;
  const hash = crypto.scryptSync(password, salt, keyLen, { N, r, p, maxmem: 256 * N * r + keyLen });
  return `scrypt$${N}$${r}$${p}$${salt.toString('base64')}$${Buffer.from(hash).toString('base64')}`;
}

export function verifyPassword(password: string, stored: string): boolean {
  try {
    const parts = stored.split('$');
    if (parts.length !== 6 || !stored.startsWith('scrypt')) return false;
    const N = parseInt(parts[1], 10);
    const r = parseInt(parts[2], 10);
    const p = parseInt(parts[3], 10);
    const salt = Buffer.from(parts[4], 'base64');
    const expected = Buffer.from(parts[5], 'base64');
    const keyLen = expected.length;
    // –ò—Å–ø–æ–ª—å–∑—É–µ–º —Ç–∞–∫–æ–π –∂–µ –∑–∞–ø–∞—Å –ø–æ –ø–∞–º—è—Ç–∏, –∫–∞–∫ –ø—Ä–∏ —Ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–∏, —á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å –æ—à–∏–±–æ–∫ –ª–∏–º–∏—Ç–∞ –ø–∞–º—è—Ç–∏
    const hash = crypto.scryptSync(password, salt, keyLen, { N, r, p, maxmem: 256 * N * r + keyLen });
    return crypto.timingSafeEqual(Buffer.from(hash), expected);
  } catch {
    return false;
  }
}
</file>

<file path="src/lib/rateLimit.ts">
import type { NextRequest } from 'next/server';

interface RateLimitOptions {
  windowMs: number;
  max: number;
  blockDurationMs?: number;
}

type RateRecord = {
  hits: number;
  resetAt: number;
  blockedUntil?: number;
};

// –ì–ª–æ–±–∞–ª—å–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –ª–∏–º–∏—Ç–æ–≤ –≤ –ø–∞–º—è—Ç–∏ (–¥–ª—è dev)
declare global {
  // eslint-disable-next-line no-var
  var __rate_limit_store: Map<string, RateRecord> | undefined;
}

const store: Map<string, RateRecord> = global.__rate_limit_store ??= new Map<string, RateRecord>();

export function checkRateLimit(
  key: string,
  opts: RateLimitOptions
): { allowed: boolean; remaining: number; resetMs: number; retryAfterMs?: number } {
  const now = Date.now();
  const rec = store.get(key);

  if (rec?.blockedUntil && now < rec.blockedUntil) {
    return {
      allowed: false,
      remaining: 0,
      resetMs: Math.max(0, (rec.resetAt ?? now) - now),
      retryAfterMs: rec.blockedUntil - now,
    };
  }

  if (!rec || now >= rec.resetAt) {
    const next: RateRecord = { hits: 1, resetAt: now + opts.windowMs };
    store.set(key, next);
    return { allowed: true, remaining: opts.max - 1, resetMs: opts.windowMs };
  }

  rec.hits += 1;

  if (rec.hits > opts.max) {
    rec.blockedUntil = now + (opts.blockDurationMs ?? opts.windowMs);
    store.set(key, rec);
    return {
      allowed: false,
      remaining: 0,
      resetMs: Math.max(0, rec.resetAt - now),
      retryAfterMs: rec.blockedUntil - now,
    };
  }

  store.set(key, rec);
  return {
    allowed: true,
    remaining: Math.max(0, opts.max - rec.hits),
    resetMs: Math.max(0, rec.resetAt - now),
  };
}

// –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ IP –∏–∑ –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤ (–ø–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è dev, –∑–∞ –ø—Ä–æ–∫—Å–∏ ‚Äî x-forwarded-for)
export function getClientIp(req: NextRequest): string {
  // –í dev –∏—Å–ø–æ–ª—å–∑—É–µ–º host –∫–∞–∫ —Å—Ç–∞–±–∏–ª—å–Ω—ã–π –∫–ª—é—á, –∑–∞—Ç–µ–º –ø—Ä–æ–±—É–µ–º –ø—Ä–æ–∫—Å–∏-–∑–∞–≥–æ–ª–æ–≤–∫–∏
  const host = req.headers.get('host');
  if (host) return `host:${host}`;
  const xff = req.headers.get('x-forwarded-for');
  if (xff) {
    const first = xff.split(',')[0].trim();
    if (first) return first;
  }
  const xrip = req.headers.get('x-real-ip');
  if (xrip) return xrip;
  // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω–µ–Ω–Ω—ã–µ –∑–∞–≥–æ–ª–æ–≤–∫–∏
  const cf = req.headers.get('cf-connecting-ip');
  if (cf) return cf;
  const fastly = req.headers.get('fastly-client-ip');
  if (fastly) return fastly;
  const trueClient = req.headers.get('true-client-ip');
  if (trueClient) return trueClient;
  return 'unknown';
}

// –Ø–≤–Ω–æ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ–º –∏–º–µ–Ω–æ–≤–∞–Ω–Ω—ã–µ —Å—É—â–Ω–æ—Å—Ç–∏ –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π —Ä–∞–±–æ—Ç—ã Turbopack
// (—É–¥–∞–ª–µ–Ω–æ: –ø–µ—Ä–µ—ç–∫—Å–ø–æ—Ä—Ç –≤—ã–∑—ã–≤–∞–ª –∫–æ–Ω—Ñ–ª–∏–∫—Ç –ø—Ä–∏ —Å–±–æ—Ä–∫–µ)

// –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ —ç–∫—Å–ø–æ—Ä—Ç –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é (–Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è, –Ω–æ –ø–æ–º–æ–≥–∞–µ—Ç —Å–±–æ—Ä—â–∏–∫—É)
export default {
  checkRateLimit,
  getClientIp,
};
</file>

<file path="src/lib/session.ts">
import crypto from 'crypto';

const DEFAULT_EXP_SECONDS = 60 * 60 * 24; // 24 —á–∞—Å–∞

function getSecret(): string {
  return process.env.AUTH_SECRET || process.env.NEXTAUTH_SECRET || 'dev-secret-change-me';
}

export interface SessionPayload {
  user_id: number;
  telegram_id?: number;
  exp: number; // unix seconds
}

export function signToken(payload: Omit<SessionPayload, 'exp'>, expSeconds: number = DEFAULT_EXP_SECONDS): string {
  const exp = Math.floor(Date.now() / 1000) + expSeconds;
  const full: SessionPayload = { ...payload, exp };
  const json = JSON.stringify(full);
  const data = Buffer.from(json).toString('base64url');
  const hmac = crypto.createHmac('sha256', getSecret()).update(data).digest('base64url');
  return `${data}.${hmac}`;
}

export function verifyToken(token: string): SessionPayload | null {
  try {
    const [data, sig] = token.split('.');
    if (!data || !sig) return null;
    const expected = crypto.createHmac('sha256', getSecret()).update(data).digest('base64url');
    if (!crypto.timingSafeEqual(Buffer.from(sig), Buffer.from(expected))) return null;
    const json = Buffer.from(data, 'base64url').toString('utf8');
    const payload = JSON.parse(json) as SessionPayload;
    if (payload.exp && Math.floor(Date.now() / 1000) > payload.exp) return null;
    return payload;
  } catch {
    return null;
  }
}
</file>

<file path="src/lib/startup.ts">
import { initDatabase } from './db';

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
let startupInitialized = false;

export async function initializeApp(): Promise<void> {
  if (startupInitialized) {
    return;
  }

  try {
    console.log('üöÄ Initializing application...');
    await initDatabase();
    startupInitialized = true;
    console.log('‚úÖ Application initialized successfully');
  } catch (error) {
    console.error('‚ùå Failed to initialize application:', error);
    throw error;
  }
}

// –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∏–º–ø–æ—Ä—Ç–µ –º–æ–¥—É–ª—è
initializeApp().catch(error => {
  console.error('Failed to initialize app on startup:', error);
});
</file>

<file path="telegram-bot/.gitignore">
# –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
node_modules/
npm-debug.log*
yarn-debug.log*
yarn-error.log*

# –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
.env
.env.local
.env.development.local
.env.test.local
.env.production.local

# –õ–æ–≥–∏
logs
*.log

# –í—Ä–µ–º–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã
.tmp/
.cache/

# IDE
.vscode/
.idea/
*.swp
*.swo

# OS
.DS_Store
Thumbs.db
</file>

<file path="telegram-bot/bot.js">
require('dotenv').config();
const TelegramBot = require('node-telegram-bot-api');

// –ó–∞–º–µ–Ω–∏—Ç–µ 'YOUR_BOT_TOKEN' –Ω–∞ —Ç–æ–∫–µ–Ω –≤–∞—à–µ–≥–æ –±–æ—Ç–∞, –ø–æ–ª—É—á–µ–Ω–Ω—ã–π –æ—Ç @BotFather
const token = process.env.BOT_TOKEN || 'YOUR_BOT_TOKEN';

// –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ç–æ–∫–µ–Ω
console.log('üîë –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–æ–∫–µ–Ω–∞...');
if (!token || token === 'YOUR_BOT_TOKEN') {
    console.error('‚ùå –û—à–∏–±–∫–∞: –¢–æ–∫–µ–Ω –±–æ—Ç–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω! –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ñ–∞–π–ª .env');
    process.exit(1);
}
console.log('‚úÖ –¢–æ–∫–µ–Ω –Ω–∞–π–¥–µ–Ω:', token.substring(0, 10) + '...');

// –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–µ—Ä–≤–µ—Ä–∞
const PORT = process.env.PORT || 3500;
const USE_WEBHOOK = process.env.USE_WEBHOOK === 'true';

// –°–æ–∑–¥–∞–µ–º —ç–∫–∑–µ–º–ø–ª—è—Ä –±–æ—Ç–∞
let bot;

if (USE_WEBHOOK) {
    // Webhook —Ä–µ–∂–∏–º (–¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞)
    bot = new TelegramBot(token, { webHook: true });
    bot.setWebHook(`${process.env.WEBHOOK_URL}/bot${token}`);
    
    // –°–æ–∑–¥–∞–µ–º Express —Å–µ—Ä–≤–µ—Ä –¥–ª—è webhook
    const express = require('express');
    const app = express();
    
    app.use(express.json());
    
    // Endpoint –¥–ª—è webhook
    app.post(`/bot${token}`, (req, res) => {
        bot.processUpdate(req.body);
        res.sendStatus(200);
    });
    
    // –ó–∞–ø—É—Å–∫–∞–µ–º —Å–µ—Ä–≤–µ—Ä
    app.listen(PORT, () => {
        console.log(`üåê Webhook —Å–µ—Ä–≤–µ—Ä –∑–∞–ø—É—â–µ–Ω –Ω–∞ –ø–æ—Ä—Ç—É ${PORT}`);
        console.log(`üì± –í–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ: https://pytuchet.vercel.app/`);
    });
} else {
    // Polling —Ä–µ–∂–∏–º (–¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏)
    bot = new TelegramBot(token, { polling: true });
    console.log('ü§ñ –ë–æ—Ç –∑–∞–ø—É—â–µ–Ω –≤ polling —Ä–µ–∂–∏–º–µ');
    console.log(`üì± –í–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ: https://pytuchet.vercel.app/`);
}

// URL –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
const webAppUrl = 'https://pytuchet.vercel.app/';

// –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–æ–º–∞–Ω–¥—ã /start
bot.onText(/\/start/, (msg) => {
    const chatId = msg.chat.id;
    const firstName = msg.from.first_name || '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å';
    
    console.log(`üì® –ü–æ–ª—É—á–µ–Ω–∞ –∫–æ–º–∞–Ω–¥–∞ /start –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è ${firstName} (ID: ${chatId})`);
    
    // –°–æ–∑–¥–∞–µ–º inline –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É —Å –∫–Ω–æ–ø–∫–æ–π –¥–ª—è –æ—Ç–∫—Ä—ã—Ç–∏—è –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
    const options = {
        reply_markup: {
            inline_keyboard: [
                [
                    {
                        text: 'üöÄ –û—Ç–∫—Ä—ã—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ',
                        web_app: { url: webAppUrl }
                    }
                ]
            ]
        }
    };
    
    // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ —Å –∫–Ω–æ–ø–∫–æ–π
    bot.sendMessage(chatId, `–ü—Ä–∏–≤–µ—Ç, ${firstName}! üëã\n\n–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –ü—É—Ç—ë–≤–æ–π —É—á—ë—Ç!\n\n–ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É –Ω–∏–∂–µ, —á—Ç–æ–±—ã –æ—Ç–∫—Ä—ã—Ç—å –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ:`, options);
});

// –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–æ–º–∞–Ω–¥—ã /help
bot.onText(/\/help/, (msg) => {
    const chatId = msg.chat.id;
    
    const helpText = `
ü§ñ *–ü–æ–º–æ—â—å –ø–æ –±–æ—Ç—É –ü—É—Ç—ë–≤–æ–π —É—á—ë—Ç*

–î–æ—Å—Ç—É–ø–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã:
‚Ä¢ /start - –ó–∞–ø—É—Å—Ç–∏—Ç—å –±–æ—Ç–∞ –∏ –ø–æ–ª—É—á–∏—Ç—å –∫–Ω–æ–ø–∫—É –¥–ª—è –æ—Ç–∫—Ä—ã—Ç–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
‚Ä¢ /app - –ü–æ–ª—É—á–∏—Ç—å —Å—Å—ã–ª–∫—É –Ω–∞ –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
‚Ä¢ /help - –ü–æ–∫–∞–∑–∞—Ç—å —ç—Ç–æ —Å–æ–æ–±—â–µ–Ω–∏–µ

–ü—Ä–æ—Å—Ç–æ –Ω–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É "–û—Ç–∫—Ä—ã—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ" –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ –≤–µ–±-–≤–µ—Ä—Å–∏–∏!
    `;
    
    bot.sendMessage(chatId, helpText, { parse_mode: 'Markdown' });
});

// –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–æ–º–∞–Ω–¥—ã /app
bot.onText(/\/app/, (msg) => {
    const chatId = msg.chat.id;
    
    const options = {
        reply_markup: {
            inline_keyboard: [
                [
                    {
                        text: 'üöÄ –û—Ç–∫—Ä—ã—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ',
                        web_app: { url: webAppUrl }
                    }
                ],
                [
                    {
                        text: 'üîó –û—Ç–∫—Ä—ã—Ç—å –≤ –±—Ä–∞—É–∑–µ—Ä–µ',
                        url: webAppUrl
                    }
                ]
            ]
        }
    };
    
    bot.sendMessage(chatId, 'üì± *–ü—É—Ç—ë–≤–æ–π —É—á—ë—Ç*\n\n–í—ã–±–µ—Ä–∏—Ç–µ —Å–ø–æ—Å–æ–± –æ—Ç–∫—Ä—ã—Ç–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è:', { 
        parse_mode: 'Markdown',
        ...options 
    });
});

// –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –≤—Å–µ—Ö –æ—Å—Ç–∞–ª—å–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
bot.on('message', (msg) => {
    const chatId = msg.chat.id;
    const messageText = msg.text;
    
    console.log(`üì© –ü–æ–ª—É—á–µ–Ω–æ —Å–æ–æ–±—â–µ–Ω–∏–µ: "${messageText}" –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è ID: ${chatId}`);
    
    // –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º –∫–æ–º–∞–Ω–¥—ã, –∫–æ—Ç–æ—Ä—ã–µ —É–∂–µ –æ–±—Ä–∞–±–æ—Ç–∞–Ω—ã
    if (messageText && !messageText.startsWith('/')) {
        const options = {
            reply_markup: {
                inline_keyboard: [
                    [
                        {
                            text: 'üöÄ –û—Ç–∫—Ä—ã—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ',
                            web_app: { url: webAppUrl }
                        }
                    ]
                ]
            }
        };
        
        bot.sendMessage(chatId, '–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–æ–º–∞–Ω–¥—É /start –¥–ª—è –Ω–∞—á–∞–ª–∞ —Ä–∞–±–æ—Ç—ã –∏–ª–∏ –Ω–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É –Ω–∏–∂–µ:', options);
    }
});

// –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
bot.on('error', (error) => {
    console.error('–û—à–∏–±–∫–∞ –±–æ—Ç–∞:', error);
});

// –û–±—Ä–∞–±–æ—Ç–∫–∞ polling –æ—à–∏–±–æ–∫
bot.on('polling_error', (error) => {
    console.error('–û—à–∏–±–∫–∞ polling:', error);
});
</file>

<file path="telegram-bot/package.json">
{
  "name": "telegram-bot",
  "version": "1.0.0",
  "description": "–ü—Ä–æ—Å—Ç–æ–π Telegram –±–æ—Ç –¥–ª—è –æ—Ç–∫—Ä—ã—Ç–∏—è –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –ü—É—Ç—ë–≤–æ–π —É—á—ë—Ç",
  "main": "bot.js",
  "scripts": {
    "start": "node bot.js",
    "dev": "node bot.js",
    "test": "echo \"Error: no test specified\" && exit 1"
  },
  "keywords": [
    "telegram",
    "bot",
    "webapp"
  ],
  "author": "",
  "license": "ISC",
  "type": "commonjs",
  "dependencies": {
    "dotenv": "^17.2.3",
    "express": "^5.1.0",
    "node-telegram-bot-api": "^0.66.0"
  }
}
</file>

<file path="telegram-bot/README.md">
# Telegram –ë–æ—Ç –¥–ª—è –ü—É—Ç—ë–≤–æ–π —É—á—ë—Ç

–ü—Ä–æ—Å—Ç–æ–π Telegram –±–æ—Ç, –∫–æ—Ç–æ—Ä—ã–π –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –∫–Ω–æ–ø–∫—É –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞ –∫ –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—é "–ü—É—Ç—ë–≤–æ–π —É—á—ë—Ç".

## üöÄ –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- **–ö–Ω–æ–ø–∫–∞ Web App**: –û—Ç–∫—Ä—ã–≤–∞–µ—Ç –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –ø—Ä—è–º–æ –≤ Telegram
- **–ö–æ–º–∞–Ω–¥—ã**: –ü—Ä–æ—Å—Ç—ã–µ –∫–æ–º–∞–Ω–¥—ã –¥–ª—è –Ω–∞–≤–∏–≥–∞—Ü–∏–∏
- **–ê–¥–∞–ø—Ç–∏–≤–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å**: –†–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ –≤—Å–µ—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö

## üìã –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

- Node.js (–≤–µ—Ä—Å–∏—è 14 –∏–ª–∏ –≤—ã—à–µ)
- npm –∏–ª–∏ yarn
- –¢–æ–∫–µ–Ω Telegram –±–æ—Ç–∞ –æ—Ç [@BotFather](https://t.me/BotFather)

## üõ† –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞

### 1. –°–æ–∑–¥–∞–Ω–∏–µ –±–æ—Ç–∞ –≤ Telegram

1. –û—Ç–∫—Ä–æ–π—Ç–µ [@BotFather](https://t.me/BotFather) –≤ Telegram
2. –û—Ç–ø—Ä–∞–≤—å—Ç–µ –∫–æ–º–∞–Ω–¥—É `/newbot`
3. –°–ª–µ–¥—É–π—Ç–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è–º –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –±–æ—Ç–∞
4. –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ –ø–æ–ª—É—á–µ–Ω–Ω—ã–π —Ç–æ–∫–µ–Ω

### 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞

1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ –ø–∞–ø–∫—É —Å –±–æ—Ç–æ–º:
   ```bash
   cd telegram-bot
   ```

2. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:
   ```bash
   npm install
   ```

3. –°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `.env` –Ω–∞ –æ—Å–Ω–æ–≤–µ `.env.example`:
   ```bash
   cp .env.example .env
   ```

4. –û—Ç–∫—Ä–æ–π—Ç–µ —Ñ–∞–π–ª `.env` –∏ –¥–æ–±–∞–≤—å—Ç–µ –≤–∞—à —Ç–æ–∫–µ–Ω –±–æ—Ç–∞:
   ```
   BOT_TOKEN=–≤–∞—à_—Ç–æ–∫–µ–Ω_–æ—Ç_botfather
   ```

### 3. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Web App –≤ BotFather

1. –û—Ç–∫—Ä–æ–π—Ç–µ [@BotFather](https://t.me/BotFather)
2. –û—Ç–ø—Ä–∞–≤—å—Ç–µ –∫–æ–º–∞–Ω–¥—É `/mybots`
3. –í—ã–±–µ—Ä–∏—Ç–µ –≤–∞—à–µ–≥–æ –±–æ—Ç–∞
4. –ù–∞–∂–º–∏—Ç–µ "Bot Settings" ‚Üí "Menu Button"
5. –í—ã–±–µ—Ä–∏—Ç–µ "Configure menu button"
6. –í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç –∫–Ω–æ–ø–∫–∏: "–û—Ç–∫—Ä—ã—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ"
7. –í–≤–µ–¥–∏—Ç–µ URL: `https://pytuchet.vercel.app/`

## üöÄ –ó–∞–ø—É—Å–∫

### –õ–æ–∫–∞–ª—å–Ω—ã–π –∑–∞–ø—É—Å–∫

```bash
npm start
```

–∏–ª–∏

```bash
npm run dev
```

### –ó–∞–ø—É—Å–∫ –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ

–î–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å PM2 –∏–ª–∏ –∞–Ω–∞–ª–æ–≥–∏—á–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã:

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ PM2
npm install -g pm2

# –ó–∞–ø—É—Å–∫ –±–æ—Ç–∞
pm2 start bot.js --name "pytuchet-bot"

# –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤
pm2 logs pytuchet-bot

# –û—Å—Ç–∞–Ω–æ–≤–∫–∞
pm2 stop pytuchet-bot
```

## üì± –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

–ü–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ –±–æ—Ç–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –º–æ–≥—É—Ç:

1. **–ó–∞–ø—É—Å—Ç–∏—Ç—å –±–æ—Ç–∞**: –û—Ç–ø—Ä–∞–≤–∏—Ç—å –∫–æ–º–∞–Ω–¥—É `/start`
2. **–û—Ç–∫—Ä—ã—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ**: –ù–∞–∂–∞—Ç—å –∫–Ω–æ–ø–∫—É "üöÄ –û—Ç–∫—Ä—ã—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ"
3. **–ü–æ–ª—É—á–∏—Ç—å –ø–æ–º–æ—â—å**: –û—Ç–ø—Ä–∞–≤–∏—Ç—å –∫–æ–º–∞–Ω–¥—É `/help`
4. **–ë—ã—Å—Ç—Ä—ã–π –¥–æ—Å—Ç—É–ø**: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫–æ–º–∞–Ω–¥—É `/app`

## ü§ñ –î–æ—Å—Ç—É–ø–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

- `/start` - –ó–∞–ø—É—Å–∫ –±–æ—Ç–∞ –∏ –ø–æ–ª—É—á–µ–Ω–∏–µ –∫–Ω–æ–ø–∫–∏ –¥–ª—è –æ—Ç–∫—Ä—ã—Ç–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
- `/app` - –ü–æ–ª—É—á–µ–Ω–∏–µ —Å—Å—ã–ª–∫–∏ –Ω–∞ –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Å –∫–Ω–æ–ø–∫–∞–º–∏
- `/help` - –ü–æ–∫–∞–∑–∞—Ç—å —Å–ø—Ä–∞–≤–∫—É –ø–æ –∫–æ–º–∞–Ω–¥–∞–º

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
telegram-bot/
‚îú‚îÄ‚îÄ bot.js              # –û—Å–Ω–æ–≤–Ω–æ–π —Ñ–∞–π–ª –±–æ—Ç–∞
‚îú‚îÄ‚îÄ package.json        # –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –∏ —Å–∫—Ä–∏–ø—Ç—ã
‚îú‚îÄ‚îÄ .env.example        # –ü—Ä–∏–º–µ—Ä —Ñ–∞–π–ª–∞ —Å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º–∏ –æ–∫—Ä—É–∂–µ–Ω–∏—è
‚îú‚îÄ‚îÄ .env               # –í–∞—à–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è (—Å–æ–∑–¥–∞–µ—Ç—Å—è –≤—Ä—É—á–Ω—É—é)
‚îú‚îÄ‚îÄ .gitignore         # –ò—Å–∫–ª—é—á–µ–Ω–∏—è –¥–ª—è git
‚îî‚îÄ‚îÄ README.md          # –≠—Ç–æ—Ç —Ñ–∞–π–ª
```

## üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∞

### –†–µ–∂–∏–º—ã —Ä–∞–±–æ—Ç—ã

–ë–æ—Ç –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –¥–≤–∞ —Ä–µ–∂–∏–º–∞ —Ä–∞–±–æ—Ç—ã:

1. **Polling —Ä–µ–∂–∏–º** (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é) - –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
2. **Webhook —Ä–µ–∂–∏–º** - –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞

#### Polling —Ä–µ–∂–∏–º (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏)
```bash
# –í —Ñ–∞–π–ª–µ .env
USE_WEBHOOK=false
```

#### Webhook —Ä–µ–∂–∏–º (–¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞)
```bash
# –í —Ñ–∞–π–ª–µ .env
USE_WEBHOOK=true
PORT=3500
WEBHOOK_URL=https://your-domain.com
```

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–æ—Ä—Ç–∞

–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é webhook —Å–µ—Ä–≤–µ—Ä –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –ø–æ—Ä—Ç 3500. –í—ã –º–æ–∂–µ—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å –µ–≥–æ:

```bash
# –í —Ñ–∞–π–ª–µ .env
PORT=3500
```

### –ò–∑–º–µ–Ω–µ–Ω–∏–µ URL –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

–ï—Å–ª–∏ –Ω—É–∂–Ω–æ –∏–∑–º–µ–Ω–∏—Ç—å URL –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è, –æ—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é `webAppUrl` –≤ —Ñ–∞–π–ª–µ `bot.js`:

```javascript
const webAppUrl = 'https://your-new-url.com/';
```

### –ö–∞—Å—Ç–æ–º–∏–∑–∞—Ü–∏—è —Å–æ–æ–±—â–µ–Ω–∏–π

–í—Å–µ —Ç–µ–∫—Å—Ç—ã —Å–æ–æ–±—â–µ–Ω–∏–π –º–æ–∂–Ω–æ –∏–∑–º–µ–Ω–∏—Ç—å –≤ —Ñ–∞–π–ª–µ `bot.js`. –ù–∞–π–¥–∏—Ç–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ —Å—Ç—Ä–æ–∫–∏ –∏ –∏–∑–º–µ–Ω–∏—Ç–µ –∏—Ö –ø–æ —Å–≤–æ–µ–º—É —É—Å–º–æ—Ç—Ä–µ–Ω–∏—é.

## üõ° –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- **–ù–∏–∫–æ–≥–¥–∞ –Ω–µ –∫–æ–º–º–∏—Ç—å—Ç–µ —Ñ–∞–π–ª `.env`** –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
- –•—Ä–∞–Ω–∏—Ç–µ —Ç–æ–∫–µ–Ω –±–æ—Ç–∞ –≤ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –¥–ª—è —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö

## üêõ –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –Ω–µ–ø–æ–ª–∞–¥–æ–∫

### –ë–æ—Ç –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å —Ç–æ–∫–µ–Ω–∞ –≤ —Ñ–∞–π–ª–µ `.env`
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –±–æ—Ç –∑–∞–ø—É—â–µ–Ω –±–µ–∑ –æ—à–∏–±–æ–∫
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –Ω–∞ –Ω–∞–ª–∏—á–∏–µ –æ—à–∏–±–æ–∫

### –û—à–∏–±–∫–∞ "address already in use" (–ø–æ—Ä—Ç –∑–∞–Ω—è—Ç)

–ï—Å–ª–∏ –≤—ã –ø–æ–ª—É—á–∞–µ—Ç–µ –æ—à–∏–±–∫—É `EADDRINUSE: address already in use :::3000`:

1. **–î–ª—è polling —Ä–µ–∂–∏–º–∞** (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é): —ç—Ç–∞ –æ—à–∏–±–∫–∞ –Ω–µ –¥–æ–ª–∂–Ω–∞ –≤–æ–∑–Ω–∏–∫–∞—Ç—å, —Ç–∞–∫ –∫–∞–∫ polling –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –ø–æ—Ä—Ç
2. **–î–ª—è webhook —Ä–µ–∂–∏–º–∞**: –∏–∑–º–µ–Ω–∏—Ç–µ –ø–æ—Ä—Ç –≤ —Ñ–∞–π–ª–µ `.env`:
   ```bash
   PORT=3500
   ```
3. **–ï—Å–ª–∏ –ø–æ—Ä—Ç 3500 —Ç–æ–∂–µ –∑–∞–Ω—è—Ç**, –≤—ã–±–µ—Ä–∏—Ç–µ –¥—Ä—É–≥–æ–π —Å–≤–æ–±–æ–¥–Ω—ã–π –ø–æ—Ä—Ç:
   ```bash
   PORT=3501
   ```

### Web App –Ω–µ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è

1. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ URL –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–Ω–æ –ø–æ HTTPS
3. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –Ω–∞—Å—Ç—Ä–æ–∏–ª–∏ Menu Button –≤ BotFather

### –û—à–∏–±–∫–∏ –ø—Ä–∏ —É—Å—Ç–∞–Ω–æ–≤–∫–µ

```bash
# –û—á–∏—Å—Ç–∫–∞ –∫—ç—à–∞ npm
npm cache clean --force

# –ü–µ—Ä–µ—É—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
rm -rf node_modules package-lock.json
npm install
```

## üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ï—Å–ª–∏ —É –≤–∞—Å –≤–æ–∑–Ω–∏–∫–ª–∏ –≤–æ–ø—Ä–æ—Å—ã –∏–ª–∏ –ø—Ä–æ–±–ª–µ–º—ã:

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–∞–∑–¥–µ–ª "–£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –Ω–µ–ø–æ–ª–∞–¥–æ–∫"
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤—Å–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –≤—ã–ø–æ–ª–Ω–µ–Ω—ã
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –±–æ—Ç–∞ –Ω–∞ –Ω–∞–ª–∏—á–∏–µ –æ—à–∏–±–æ–∫

## üìÑ –õ–∏—Ü–µ–Ω–∑–∏—è

ISC License

---

**–í–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ**: [https://pytuchet.vercel.app/](https://pytuchet.vercel.app/)
</file>

<file path=".vercelignore">
# Dependencies
node_modules
npm-debug.log*
yarn-debug.log*
yarn-error.log*

# Local env files
.env.local
.env.development.local
.env.test.local
.env.production.local

# IDE files
.vscode
.idea
*.swp
*.swo

# OS generated files
.DS_Store
.DS_Store?
._*
.Spotlight-V100
.Trashes
ehthumbs.db
Thumbs.db

# Logs
logs
*.log

# Scripts (–Ω–µ –Ω—É–∂–Ω—ã –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ)
scripts/

# Documentation
README.md
VERCEL_SETUP.md

# Git
.git
.gitignore

# Local databases
database.db
shifts.db
</file>

<file path="cookies.txt">
# Netscape HTTP Cookie File
# https://curl.se/docs/http-cookies.html
# This file was generated by libcurl! Edit at your own risk.

#HttpOnly_localhost	FALSE	/	FALSE	1762375590	auth_token	eyJ1c2VyX2lkIjoyOCwidGVsZWdyYW1faWQiOiI1NTU1NjY2NiIsImV4cCI6MTc2MjM3NTU5MH0.DevW-faucc0_x7jKnwDnbOHglSKSqhvAY3PhYyIsiFY
</file>

<file path="eslint.config.mjs">
import { defineConfig, globalIgnores } from "eslint/config";
import nextVitals from "eslint-config-next/core-web-vitals";
import nextTs from "eslint-config-next/typescript";

const eslintConfig = defineConfig([
  ...nextVitals,
  ...nextTs,
  // Override default ignores of eslint-config-next.
  globalIgnores([
    // Default ignores of eslint-config-next:
    ".next/**",
    "out/**",
    "build/**",
    "next-env.d.ts",
  ]),
]);

export default eslintConfig;
</file>

<file path="FINAL_SETUP_INSTRUCTIONS.md">
# üöÄ –§–∏–Ω–∞–ª—å–Ω—ã–µ —à–∞–≥–∏ –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ Telegram WebHook

## ‚úÖ –ß—Ç–æ —É–∂–µ —Å–¥–µ–ª–∞–Ω–æ:

1. ‚úÖ –°–æ–∑–¥–∞–Ω API endpoint `/api/telegram-webhook`
2. ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω—ã —Å–∫—Ä–∏–ø—Ç—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è WebHook –≤ package.json
3. ‚úÖ –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —É—Å–ø–µ—à–Ω–æ —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç–æ –Ω–∞ Vercel
4. ‚úÖ WebHook endpoint —Ä–∞–±–æ—Ç–∞–µ—Ç: https://pytuchet.vercel.app/api/telegram-webhook

## üîß –ß—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å:

### 1. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –≤ Vercel

1. –û—Ç–∫—Ä–æ–π—Ç–µ [Vercel Dashboard](https://vercel.com/dashboard)
2. –ù–∞–π–¥–∏—Ç–µ –ø—Ä–æ–µ–∫—Ç `pytuchet`
3. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ **Settings** ‚Üí **Environment Variables**
4. –î–æ–±–∞–≤—å—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é:
   - **Name**: `TELEGRAM_BOT_TOKEN`
   - **Value**: –≤–∞—à —Ç–æ–∫–µ–Ω –æ—Ç @BotFather
   - **Environment**: Production

### 2. –ü–æ–ª—É—á–∏—Ç—å —Ç–æ–∫–µ–Ω –±–æ—Ç–∞ (–µ—Å–ª–∏ –µ—â–µ –Ω–µ –ø–æ–ª—É—á–∏–ª–∏)

1. –ù–∞–π–¥–∏—Ç–µ [@BotFather](https://t.me/botfather) –≤ Telegram
2. –û—Ç–ø—Ä–∞–≤—å—Ç–µ `/newbot` –∏–ª–∏ `/mybots` –¥–ª—è —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ
3. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Ç–æ–∫–µ–Ω (—Ñ–æ—Ä–º–∞—Ç: `123456789:ABCdefGHIjklMNOpqrsTUVwxyz`)

### 3. –ü–æ–≤—Ç–æ—Ä–Ω—ã–π –¥–µ–ø–ª–æ–π –ø–æ—Å–ª–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö

```bash
vercel --prod
```

### 4. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å WebHook

–ü–æ—Å–ª–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Ç–æ–∫–µ–Ω–∞ –≤ Vercel:

```bash
# –°–æ–∑–¥–∞–π—Ç–µ .env.local —Å –≤–∞—à–∏–º —Ç–æ–∫–µ–Ω–æ–º
echo "TELEGRAM_BOT_TOKEN=–≤–∞—à_—Ç–æ–∫–µ–Ω_–∑–¥–µ—Å—å" > .env.local

# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ WebHook
npm run webhook:set

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç–∞—Ç—É—Å
npm run webhook:info
```

### 5. –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ä—ã–π –±–æ—Ç (–µ—Å–ª–∏ —Ä–∞–±–æ—Ç–∞–µ—Ç)

–ï—Å–ª–∏ —É –≤–∞—Å —Ä–∞–±–æ—Ç–∞–µ—Ç –±–æ—Ç –≤ —Ä–µ–∂–∏–º–µ polling:

```bash
# –û—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –ø—Ä–æ—Ü–µ—Å—Å –≤ —Ç–µ—Ä–º–∏–Ω–∞–ª–µ –∏–ª–∏
pkill -f "npm start"
```

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

1. –ù–∞–π–¥–∏—Ç–µ –≤–∞—à–µ–≥–æ –±–æ—Ç–∞ –≤ Telegram
2. –û—Ç–ø—Ä–∞–≤—å—Ç–µ `/start`
3. –î–æ–ª–∂–Ω–∞ –ø–æ—è–≤–∏—Ç—å—Å—è –∫–Ω–æ–ø–∫–∞ "üöÄ –û—Ç–∫—Ä—ã—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ"
4. –ü—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ –æ—Ç–∫—Ä–æ–µ—Ç—Å—è –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤ Vercel:
1. [Vercel Dashboard](https://vercel.com/dashboard) ‚Üí –≤–∞—à –ø—Ä–æ–µ–∫—Ç
2. **Functions** ‚Üí `api/telegram-webhook`
3. –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ WebHook:
```bash
npm run webhook:info
```

## üîÑ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ WebHook

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å WebHook
npm run webhook:set

# –ü–æ–ª—É—á–∏—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ WebHook
npm run webhook:info

# –£–¥–∞–ª–∏—Ç—å WebHook (–≤–µ—Ä–Ω—É—Ç—å—Å—è –∫ polling)
npm run webhook:delete
```

## üéØ –†–µ–∑—É–ª—å—Ç–∞—Ç

–ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –≤—Å–µ—Ö —à–∞–≥–æ–≤:

- ‚úÖ –ë–æ—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç —á–µ—Ä–µ–∑ WebHook –Ω–∞ Vercel
- ‚úÖ –ú–≥–Ω–æ–≤–µ–Ω–Ω–∞—è –¥–æ—Å—Ç–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ
- ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ–º
- ‚úÖ –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å production-—É—Ä–æ–≤–Ω—è

## üÜò –ü–æ–º–æ—â—å

–ï—Å–ª–∏ —á—Ç–æ-—Ç–æ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç:

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –≤ Vercel
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Ç–æ–∫–µ–Ω –±–æ—Ç–∞ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –≤ Vercel Dashboard
4. –ó–∞–ø—É—Å—Ç–∏—Ç–µ `npm run webhook:info` –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏

---

**–í–∞–∂–Ω–æ**: –ü–æ—Å–ª–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ WebHook —Å—Ç–∞—Ä—ã–π –±–æ—Ç –≤ —Ä–µ–∂–∏–º–µ polling –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ—Å—Ç–∞–Ω–µ—Ç –ø–æ–ª—É—á–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è. Telegram –±—É–¥–µ—Ç –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å –≤—Å–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –Ω–∞ WebHook URL.
</file>

<file path="postcss.config.mjs">
const config = {
  plugins: {
    "@tailwindcss/postcss": {},
  },
};

export default config;
</file>

<file path="README_WEBHOOK.md">
# ü§ñ Telegram Bot WebHook –¥–ª—è Vercel

## üìã –û–±–∑–æ—Ä

Telegram –±–æ—Ç —Ç–µ–ø–µ—Ä—å –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω –≤ Next.js –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç —á–µ—Ä–µ–∑ WebHook –Ω–∞ Vercel. –≠—Ç–æ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç:

- ‚ö° –ú–≥–Ω–æ–≤–µ–Ω–Ω—É—é –¥–æ—Å—Ç–∞–≤–∫—É —Å–æ–æ–±—â–µ–Ω–∏–π
- üöÄ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ
- üí∞ –≠–∫–æ–Ω–æ–º–∏—é —Ä–µ—Å—É—Ä—Å–æ–≤
- üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å production-—É—Ä–æ–≤–Ω—è

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```
Telegram ‚Üí WebHook ‚Üí Vercel Function ‚Üí Response
                         ‚Üì
                   Next.js API Route
                   /api/telegram-webhook
```

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–æ–≤

```
src/app/api/telegram-webhook/
‚îî‚îÄ‚îÄ route.ts                    # –û—Å–Ω–æ–≤–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ WebHook

scripts/
‚îî‚îÄ‚îÄ setup-telegram-webhook.js   # –°–∫—Ä–∏–ø—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ WebHook

package.json                    # –ù–æ–≤—ã–µ npm —Å–∫—Ä–∏–ø—Ç—ã
.env.example                    # –ü—Ä–∏–º–µ—Ä –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
TELEGRAM_WEBHOOK_SETUP.md       # –ü–æ–¥—Ä–æ–±–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
FINAL_SETUP_INSTRUCTIONS.md     # –§–∏–Ω–∞–ª—å–Ω—ã–µ —à–∞–≥–∏
```

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### 1. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –≤ Vercel

```bash
# –í Vercel Dashboard ‚Üí Settings ‚Üí Environment Variables
TELEGRAM_BOT_TOKEN=your_bot_token_here
```

### 2. –ü–æ–≤—Ç–æ—Ä–Ω—ã–π –¥–µ–ø–ª–æ–π

```bash
vercel --prod
```

### 3. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ WebHook

```bash
# –°–æ–∑–¥–∞–π—Ç–µ –ª–æ–∫–∞–ª—å–Ω—ã–π .env.local
echo "TELEGRAM_BOT_TOKEN=your_token" > .env.local

# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ WebHook
npm run webhook:set
```

## üõ†Ô∏è –î–æ—Å—Ç—É–ø–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

```bash
# WebHook —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ
npm run webhook:set      # –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å WebHook
npm run webhook:info     # –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å
npm run webhook:delete   # –£–¥–∞–ª–∏—Ç—å WebHook

# –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞
npm run dev             # –õ–æ–∫–∞–ª—å–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞
npm run build           # –°–±–æ—Ä–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞
vercel --prod           # –î–µ–ø–ª–æ–π –Ω–∞ Vercel
```

## ü§ñ –ö–æ–º–∞–Ω–¥—ã –±–æ—Ç–∞

| –ö–æ–º–∞–Ω–¥–∞ | –û–ø–∏—Å–∞–Ω–∏–µ |
|---------|----------|
| `/start` | –ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ + –∫–Ω–æ–ø–∫–∞ –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è |
| `/help` | –°–ø—Ä–∞–≤–∫–∞ –ø–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é |
| `/app` | –ü—Ä—è–º–∞—è —Å—Å—ã–ª–∫–∞ –Ω–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ |

## üîß API Endpoints

### WebHook Endpoint
- **URL**: `https://pytuchet.vercel.app/api/telegram-webhook`
- **Methods**: `POST` (WebHook), `GET` (–ø—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞)
- **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å**: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–æ–∫–µ–Ω–∞ —á–µ—Ä–µ–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏
curl https://pytuchet.vercel.app/api/telegram-webhook

# –û—Ç–≤–µ—Ç
{"status":"Telegram WebHook endpoint —Ä–∞–±–æ—Ç–∞–µ—Ç","timestamp":"..."}
```

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### Vercel Dashboard
1. –û—Ç–∫—Ä–æ–π—Ç–µ [Vercel Dashboard](https://vercel.com/dashboard)
2. –í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–æ–µ–∫—Ç `pytuchet`
3. **Functions** ‚Üí `api/telegram-webhook`
4. –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏

### WebHook —Å—Ç–∞—Ç—É—Å
```bash
npm run webhook:info
```

–ü—Ä–∏–º–µ—Ä –≤—ã–≤–æ–¥–∞:
```
üìã –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ WebHook:
   URL: https://pytuchet.vercel.app/api/telegram-webhook
   –°—Ç–∞—Ç—É—Å: –ë–µ–∑ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞
   –û–∂–∏–¥–∞—é—â–∏–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è: 0
```

## üîÑ –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Ä–µ–∂–∏–º–æ–≤

### WebHook ‚Üí Polling
```bash
npm run webhook:delete
cd telegram-bot && npm start
```

### Polling ‚Üí WebHook
```bash
# –û—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ polling –±–æ—Ç–∞
pkill -f "npm start"

# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ WebHook
npm run webhook:set
```

## üêõ –û—Ç–ª–∞–¥–∫–∞

### –¢–∏–ø–∏—á–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

1. **–ë–æ—Ç –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç**
   ```bash
   # –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
   npm run webhook:info
   
   # –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –≤ Vercel Dashboard
   ```

2. **WebHook –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω**
   ```bash
   # –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ —Ç–æ–∫–µ–Ω –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π
   echo $TELEGRAM_BOT_TOKEN
   
   # –ü–µ—Ä–µ—É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ WebHook
   npm run webhook:delete
   npm run webhook:set
   ```

3. **–û—à–∏–±–∫–∏ –≤ –ª–æ–≥–∞—Ö**
   - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ñ–æ—Ä–º–∞—Ç —Ç–æ–∫–µ–Ω–∞ (–¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å `:`)
   - –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç–æ –Ω–∞ Vercel
   - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å URL

### –õ–æ–≥–∏ –∏ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞

```bash
# –õ–æ–∫–∞–ª—å–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞
npm run dev
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ http://localhost:3000/api/telegram-webhook

# Production –ª–æ–≥–∏
# Vercel Dashboard ‚Üí Functions ‚Üí api/telegram-webhook
```

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- ‚úÖ –¢–æ–∫–µ–Ω –±–æ—Ç–∞ —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è Vercel
- ‚úÖ –ù–∏–∫–∞–∫–∏—Ö —Å–µ–∫—Ä–µ—Ç–æ–≤ –≤ –∫–æ–¥–µ
- ‚úÖ HTTPS –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω –¥–ª—è WebHook
- ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥—è—â–∏—Ö –¥–∞–Ω–Ω—ã—Ö

## üìà –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

- **Cold Start**: ~100-300ms (Vercel Functions)
- **Warm Response**: ~10-50ms
- **–ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ**: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ
- **–õ–∏–º–∏—Ç—ã**: –°–æ–≥–ª–∞—Å–Ω–æ –ø–ª–∞–Ω—É Vercel

## üéØ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. ‚úÖ WebHook –Ω–∞—Å—Ç—Ä–æ–µ–Ω –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç
2. üîÑ –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —á–µ—Ä–µ–∑ Vercel Dashboard
3. üìä –ê–Ω–∞–ª–∏–∑ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
4. üöÄ –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö –∫–æ–º–∞–Ω–¥ –±–æ—Ç–∞ (–ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏)

---

**–ì–æ—Ç–æ–≤–æ!** üéâ –í–∞—à Telegram –±–æ—Ç —Ç–µ–ø–µ—Ä—å —Ä–∞–±–æ—Ç–∞–µ—Ç —á–µ—Ä–µ–∑ WebHook –Ω–∞ Vercel —Å –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å—é –∏ –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç—å—é.
</file>

<file path="TELEGRAM_WEBHOOK_SETUP.md">
# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Telegram WebHook –¥–ª—è Vercel

–≠—Ç–æ—Ç –¥–æ–∫—É–º–µ–Ω—Ç –æ–ø–∏—Å—ã–≤–∞–µ—Ç, –∫–∞–∫ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å Telegram –±–æ—Ç–∞ –¥–ª—è —Ä–∞–±–æ—Ç—ã —á–µ—Ä–µ–∑ WebHook –Ω–∞ Vercel.

## –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ WebHook –Ω–∞–¥ Polling

- ‚úÖ –ú–≥–Ω–æ–≤–µ–Ω–Ω–∞—è –¥–æ—Å—Ç–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π
- ‚úÖ –ú–µ–Ω—å—à–µ –Ω–∞–≥—Ä—É–∑–∫–∏ –Ω–∞ —Å–µ—Ä–≤–µ—Ä
- ‚úÖ –ü–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è production —Å—Ä–µ–¥—ã
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ Vercel
- ‚úÖ –ù–µ —Ç—Ä–µ–±—É–µ—Ç –ø–æ—Å—Ç–æ—è–Ω–Ω–æ —Ä–∞–±–æ—Ç–∞—é—â–µ–≥–æ –ø—Ä–æ—Ü–µ—Å—Å–∞

## –®–∞–≥–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

### 1. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è

–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `.env.local` –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞:

```bash
# Telegram Bot Configuration
TELEGRAM_BOT_TOKEN=your_actual_bot_token_here

# Vercel Configuration (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è Vercel)
VERCEL_URL=https://pytuchet.vercel.app
```

### 2. –ü–æ–ª—É—á–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞ –±–æ—Ç–∞

1. –ù–∞–π–¥–∏—Ç–µ [@BotFather](https://t.me/botfather) –≤ Telegram
2. –û—Ç–ø—Ä–∞–≤—å—Ç–µ –∫–æ–º–∞–Ω–¥—É `/newbot` –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ –±–æ—Ç–∞
3. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Ç–æ–∫–µ–Ω –∏ –¥–æ–±–∞–≤—å—Ç–µ –≤ `.env.local`

### 3. –î–µ–ø–ª–æ–π –Ω–∞ Vercel

```bash
# –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –ø—Ä–æ–µ–∫—Ç —Å–æ–±–∏—Ä–∞–µ—Ç—Å—è
npm run build

# –î–µ–ø–ª–æ–π –Ω–∞ Vercel
vercel --prod
```

### 4. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ WebHook

–ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ –¥–µ–ø–ª–æ—è –Ω–∞—Å—Ç—Ä–æ–π—Ç–µ WebHook:

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å WebHook
npm run webhook:set

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å WebHook
npm run webhook:info

# –£–¥–∞–ª–∏—Ç—å WebHook (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
npm run webhook:delete
```

### 5. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è –≤ Vercel

1. –û—Ç–∫—Ä–æ–π—Ç–µ [Vercel Dashboard](https://vercel.com/dashboard)
2. –í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–æ–µ–∫—Ç `pytuchet`
3. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ Settings ‚Üí Environment Variables
4. –î–æ–±–∞–≤—å—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é:
   - Name: `TELEGRAM_BOT_TOKEN`
   - Value: –≤–∞—à —Ç–æ–∫–µ–Ω –±–æ—Ç–∞
   - Environment: Production

### 6. –ü–æ–≤—Ç–æ—Ä–Ω—ã–π –¥–µ–ø–ª–æ–π

–ü–æ—Å–ª–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è —Å–¥–µ–ª–∞–π—Ç–µ –ø–æ–≤—Ç–æ—Ä–Ω—ã–π –¥–µ–ø–ª–æ–π:

```bash
vercel --prod
```

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

1. –ù–∞–π–¥–∏—Ç–µ –≤–∞—à–µ–≥–æ –±–æ—Ç–∞ –≤ Telegram
2. –û—Ç–ø—Ä–∞–≤—å—Ç–µ –∫–æ–º–∞–Ω–¥—É `/start`
3. –ë–æ—Ç –¥–æ–ª–∂–µ–Ω –æ—Ç–≤–µ—Ç–∏—Ç—å —Å –∫–Ω–æ–ø–∫–æ–π –¥–ª—è –æ—Ç–∫—Ä—ã—Ç–∏—è –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

## –î–æ—Å—Ç—É–ø–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã –±–æ—Ç–∞

- `/start` - –ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ –∏ –∫–Ω–æ–ø–∫–∞ –¥–ª—è –æ—Ç–∫—Ä—ã—Ç–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
- `/help` - –°–ø—Ä–∞–≤–∫–∞ –ø–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é
- `/app` - –ü—Ä—è–º–∞—è —Å—Å—ã–ª–∫–∞ –Ω–∞ –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ

## API Endpoint

WebHook –Ω–∞—Å—Ç—Ä–æ–µ–Ω –Ω–∞ endpoint: `https://pytuchet.vercel.app/api/telegram-webhook`

–í—ã –º–æ–∂–µ—Ç–µ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –µ–≥–æ —Ä–∞–±–æ—Ç—É, –æ—Ç–ø—Ä–∞–≤–∏–≤ GET –∑–∞–ø—Ä–æ—Å:
```bash
curl https://pytuchet.vercel.app/api/telegram-webhook
```

## –û—Ç–ª–∞–¥–∫–∞

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤ Vercel

1. –û—Ç–∫—Ä–æ–π—Ç–µ [Vercel Dashboard](https://vercel.com/dashboard)
2. –í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–æ–µ–∫—Ç –∏ –ø–µ—Ä–µ–π–¥–∏—Ç–µ –≤ Functions
3. –ù–∞–π–¥–∏—Ç–µ —Ñ—É–Ω–∫—Ü–∏—é `api/telegram-webhook`
4. –ü—Ä–æ—Å–º–æ—Ç—Ä–∏—Ç–µ –ª–æ–≥–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

### –ü—Ä–æ–≤–µ—Ä–∫–∞ WebHook —Å—Ç–∞—Ç—É—Å–∞

```bash
npm run webhook:info
```

### –¢–∏–ø–∏—á–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

1. **WebHook –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç**
   - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ `TELEGRAM_BOT_TOKEN` —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –≤ Vercel
   - –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ URL –¥–æ—Å—Ç—É–ø–µ–Ω (https://pytuchet.vercel.app/api/telegram-webhook)

2. **–ë–æ—Ç –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç**
   - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –≤ Vercel Dashboard
   - –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ WebHook —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –ø—Ä–∞–≤–∏–ª—å–Ω–æ

3. **–û—à–∏–±–∫–∏ –≤ –ª–æ–≥–∞—Ö**
   - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ñ–æ—Ä–º–∞—Ç —Ç–æ–∫–µ–Ω–∞ –±–æ—Ç–∞
   - –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤—Å–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã

## –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –º–µ–∂–¥—É Polling –∏ WebHook

### –û—Ç–∫–ª—é—á–µ–Ω–∏–µ —Å—Ç–∞—Ä–æ–≥–æ –±–æ—Ç–∞ (Polling)

–ï—Å–ª–∏ —É –≤–∞—Å —Ä–∞–±–æ—Ç–∞–µ—Ç –±–æ—Ç –≤ —Ä–µ–∂–∏–º–µ polling, –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –µ–≥–æ:

```bash
# –í –ø–∞–ø–∫–µ telegram-bot
npm stop
```

### –£–¥–∞–ª–µ–Ω–∏–µ WebHook (–≤–æ–∑–≤—Ä–∞—Ç –∫ Polling)

```bash
npm run webhook:delete
```

–ü–æ—Å–ª–µ —ç—Ç–æ–≥–æ –º–æ–∂–µ—Ç–µ —Å–Ω–æ–≤–∞ –∑–∞–ø—É—Å—Ç–∏—Ç—å –±–æ—Ç–∞ –≤ —Ä–µ–∂–∏–º–µ polling.

## –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- –ù–∏–∫–æ–≥–¥–∞ –Ω–µ –∫–æ–º–º–∏—Ç—å—Ç–µ —Ç–æ–∫–µ–Ω –±–æ—Ç–∞ –≤ Git
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
- –†–µ–≥—É–ª—è—Ä–Ω–æ –ø—Ä–æ–≤–µ—Ä—è–π—Ç–µ –ª–æ–≥–∏ –Ω–∞ –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω—É—é –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å
- –ü—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –æ–±–Ω–æ–≤–∏—Ç–µ —Ç–æ–∫–µ–Ω –±–æ—Ç–∞ —á–µ—Ä–µ–∑ @BotFather
</file>

<file path="test-sync.html">
<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–µ—Å—Ç —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        .test-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .success {
            background-color: #d4edda;
            border-color: #c3e6cb;
        }
        .error {
            background-color: #f8d7da;
            border-color: #f5c6cb;
        }
        .test-step {
            margin: 10px 0;
            padding: 10px;
            background-color: #f8f9fa;
            border-radius: 3px;
        }
    </style>
</head>
<body>
    <h1>–¢–µ—Å—Ç —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö –º–µ–∂–¥—É –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞–º–∏</h1>
    
    <div class="test-section success">
        <h2>‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞</h2>
        <div class="test-step">
            <strong>1. ServicesProvider –æ–±–µ—Ä–Ω—É—Ç –≤–æ–∫—Ä—É–≥ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –≤ layout.tsx</strong><br>
            –°—Ç–∞—Ç—É—Å: ‚úÖ –£—Å–ø–µ—à–Ω–æ
        </div>
        <div class="test-step">
            <strong>2. –ö–æ–Ω—Ç–µ–∫—Å—Ç —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç –≤—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏</strong><br>
            –°—Ç–∞—Ç—É—Å: ‚úÖ –£—Å–ø–µ—à–Ω–æ (prices, addPrice, updatePrice, deletePrice, getPrice, refreshPrices)
        </div>
    </div>

    <div class="test-section success">
        <h2>‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã</h2>
        <div class="test-step">
            <strong>1. –ò–º–ø–æ—Ä—Ç useServices –∏ Price –∏–∑ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞</strong><br>
            –°—Ç–∞—Ç—É—Å: ‚úÖ –£—Å–ø–µ—à–Ω–æ
        </div>
        <div class="test-step">
            <strong>2. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ prices –∏ getPrice –∏–∑ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞</strong><br>
            –°—Ç–∞—Ç—É—Å: ‚úÖ –£—Å–ø–µ—à–Ω–æ
        </div>
        <div class="test-step">
            <strong>3. –£–¥–∞–ª–µ–Ω–∏–µ –ª–æ–∫–∞–ª—å–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–∏ getPrice</strong><br>
            –°—Ç–∞—Ç—É—Å: ‚úÖ –£—Å–ø–µ—à–Ω–æ
        </div>
        <div class="test-step">
            <strong>4. –£–¥–∞–ª–µ–Ω–∏–µ –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ Price</strong><br>
            –°—Ç–∞—Ç—É—Å: ‚úÖ –£—Å–ø–µ—à–Ω–æ
        </div>
    </div>

    <div class="test-section success">
        <h2>‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã —Ü–µ–Ω–æ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è</h2>
        <div class="test-step">
            <strong>1. –ò–º–ø–æ—Ä—Ç useServices –∏ Price –∏–∑ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞</strong><br>
            –°—Ç–∞—Ç—É—Å: ‚úÖ –£—Å–ø–µ—à–Ω–æ
        </div>
        <div class="test-step">
            <strong>2. –ó–∞–º–µ–Ω–∞ –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è services –Ω–∞ prices –∏–∑ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞</strong><br>
            –°—Ç–∞—Ç—É—Å: ‚úÖ –£—Å–ø–µ—à–Ω–æ
        </div>
        <div class="test-step">
            <strong>3. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–π –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –º–µ—Ç–æ–¥–æ–≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞</strong><br>
            –°—Ç–∞—Ç—É—Å: ‚úÖ –£—Å–ø–µ—à–Ω–æ (addPrice, updatePrice, deletePrice)
        </div>
        <div class="test-step">
            <strong>4. –£–¥–∞–ª–µ–Ω–∏–µ –ª–æ–∫–∞–ª—å–Ω—ã—Ö API –≤—ã–∑–æ–≤–æ–≤</strong><br>
            –°—Ç–∞—Ç—É—Å: ‚úÖ –£—Å–ø–µ—à–Ω–æ
        </div>
        <div class="test-step">
            <strong>5. –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–≤–µ—Ä–æ–∫ –Ω–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ id</strong><br>
            –°—Ç–∞—Ç—É—Å: ‚úÖ –£—Å–ø–µ—à–Ω–æ
        </div>
    </div>

    <div class="test-section success">
        <h2>‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è</h2>
        <div class="test-step">
            <strong>1. –ö–æ–º–ø–∏–ª—è—Ü–∏—è –±–µ–∑ –æ—à–∏–±–æ–∫</strong><br>
            –°—Ç–∞—Ç—É—Å: ‚úÖ –£—Å–ø–µ—à–Ω–æ
        </div>
        <div class="test-step">
            <strong>2. –°–µ—Ä–≤–µ—Ä –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –±–µ–∑ –æ—à–∏–±–æ–∫</strong><br>
            –°—Ç–∞—Ç—É—Å: ‚úÖ –£—Å–ø–µ—à–Ω–æ
        </div>
        <div class="test-step">
            <strong>3. API –∑–∞–ø—Ä–æ—Å—ã –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è —É—Å–ø–µ—à–Ω–æ</strong><br>
            –°—Ç–∞—Ç—É—Å: ‚úÖ –£—Å–ø–µ—à–Ω–æ (GET /api/prices, GET /api/shifts)
        </div>
        <div class="test-step">
            <strong>4. –°—Ç—Ä–∞–Ω–∏—Ü—ã –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –±–µ–∑ –æ—à–∏–±–æ–∫</strong><br>
            –°—Ç–∞—Ç—É—Å: ‚úÖ –£—Å–ø–µ—à–Ω–æ
        </div>
    </div>

    <div class="test-section success">
        <h2>‚úÖ –û–∂–∏–¥–∞–µ–º—ã–µ –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏</h2>
        <div class="test-step">
            <strong>1. –ï–¥–∏–Ω—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫ –¥–∞–Ω–Ω—ã—Ö</strong><br>
            –í—Å–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Ç–µ–ø–µ—Ä—å –∏—Å–ø–æ–ª—å–∑—É—é—Ç –æ–¥–∏–Ω —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π –∫–æ–Ω—Ç–µ–∫—Å—Ç –¥–ª—è –¥–∞–Ω–Ω—ã—Ö –æ —Ü–µ–Ω–∞—Ö
        </div>
        <div class="test-step">
            <strong>2. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è</strong><br>
            –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ —Ü–µ–Ω–∞—Ö –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ —Ü–µ–Ω–æ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—Ç—Ä–∞–∂–∞—é—Ç—Å—è –Ω–∞ –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ
        </div>
        <div class="test-step">
            <strong>3. –£–ø—Ä–æ—â–µ–Ω–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º</strong><br>
            –ù–µ—Ç –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è –ª–æ–≥–∏–∫–∏ –∑–∞–≥—Ä—É–∑–∫–∏ –∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö
        </div>
        <div class="test-step">
            <strong>4. –õ—É—á—à–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å</strong><br>
            –î–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –æ–¥–∏–Ω —Ä–∞–∑ –∏ –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –º–µ–∂–¥—É –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞–º–∏
        </div>
    </div>

    <h2>–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –¥–ª—è —Ä—É—á–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:</h2>
    <ol>
        <li>–û—Ç–∫—Ä–æ–π—Ç–µ –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è</li>
        <li>–ü–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É —Ü–µ–Ω–æ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è (/pricing)</li>
        <li>–ò–∑–º–µ–Ω–∏—Ç–µ —Ü–µ–Ω—É –ª—é–±–æ–π —É—Å–ª—É–≥–∏</li>
        <li>–í–µ—Ä–Ω–∏—Ç–µ—Å—å –Ω–∞ –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É</li>
        <li>–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –Ω–æ–≤–∞—è —Ü–µ–Ω–∞ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –≤ –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–µ</li>
        <li>–î–æ–±–∞–≤—å—Ç–µ –Ω–æ–≤—É—é —É—Å–ª—É–≥—É –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ —Ü–µ–Ω–æ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è</li>
        <li>–ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –æ–Ω–∞ –ø–æ—è–≤–∏–ª–∞—Å—å –≤ —Å–ø–∏—Å–∫–µ —É—Å–ª—É–≥ –Ω–∞ –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ</li>
    </ol>
</body>
</html>
</file>

<file path="tsconfig.json">
{
  "compilerOptions": {
    "target": "ES2017",
    "lib": ["dom", "dom.iterable", "esnext"],
    "allowJs": true,
    "skipLibCheck": true,
    "strict": true,
    "noEmit": true,
    "esModuleInterop": true,
    "module": "esnext",
    "moduleResolution": "bundler",
    "resolveJsonModule": true,
    "isolatedModules": true,
    "jsx": "react-jsx",
    "incremental": true,
    "plugins": [
      {
        "name": "next"
      }
    ],
    "paths": {
      "@/*": ["./src/*"]
    }
  },
  "include": [
    "next-env.d.ts",
    "**/*.ts",
    "**/*.tsx",
    ".next/types/**/*.ts",
    ".next/dev/types/**/*.ts",
    "**/*.mts"
  ],
  "exclude": ["node_modules"]
}
</file>

<file path="VERCEL_SETUP.md">
# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Vercel Postgres –¥–ª—è –ø—Ä–æ–µ–∫—Ç–∞ Pytuchet

## üöÄ –ü–æ—à–∞–≥–æ–≤–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è

### 1. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Vercel Postgres

1. **–í–æ–π–¥–∏—Ç–µ –≤ –ø–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è Vercel**
   - –ü–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ [vercel.com](https://vercel.com)
   - –í–æ–π–¥–∏—Ç–µ –≤ —Å–≤–æ–π –∞–∫–∫–∞—É–Ω—Ç

2. **–û—Ç–∫—Ä–æ–π—Ç–µ –≤–∞—à –ø—Ä–æ–µ–∫—Ç**
   - –ù–∞–π–¥–∏—Ç–µ –ø—Ä–æ–µ–∫—Ç `pytuchet` –≤ —Å–ø–∏—Å–∫–µ –ø—Ä–æ–µ–∫—Ç–æ–≤
   - –ù–∞–∂–º–∏—Ç–µ –Ω–∞ –Ω–µ–≥–æ

3. **–î–æ–±–∞–≤—å—Ç–µ Vercel Postgres**
   - –ü–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ –≤–∫–ª–∞–¥–∫—É **Storage**
   - –ù–∞–∂–º–∏—Ç–µ **Create Database**
   - –í—ã–±–µ—Ä–∏—Ç–µ **Postgres**
   - –í—ã–±–µ—Ä–∏—Ç–µ —Ä–µ–≥–∏–æ–Ω (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è —Ç–æ—Ç –∂–µ, —á—Ç–æ –∏ –¥–ª—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è)
   - –ù–∞–∂–º–∏—Ç–µ **Create**

4. **–ü–æ–¥–∫–ª—é—á–∏—Ç–µ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö –∫ –ø—Ä–æ–µ–∫—Ç—É**
   - –ü–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –Ω–∞–∂–º–∏—Ç–µ **Connect Project**
   - –í—ã–±–µ—Ä–∏—Ç–µ –≤–∞—à –ø—Ä–æ–µ–∫—Ç `pytuchet`
   - –ù–∞–∂–º–∏—Ç–µ **Connect**

### 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è

–ü–æ—Å–ª–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è Vercel –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–æ–±–∞–≤–∏—Ç —Å–ª–µ–¥—É—é—â–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è:

```
POSTGRES_URL
POSTGRES_PRISMA_URL
POSTGRES_URL_NO_SSL
POSTGRES_URL_NON_POOLING
POSTGRES_USER
POSTGRES_HOST
POSTGRES_PASSWORD
POSTGRES_DATABASE
```

### 3. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

–ü–æ—Å–ª–µ –¥–µ–ø–ª–æ—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –Ω–∞ Vercel:

#### –í–∞—Ä–∏–∞–Ω—Ç 1: –ß–µ—Ä–µ–∑ API —ç–Ω–¥–ø–æ–∏–Ω—Ç (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
```bash
curl -X POST https://–≤–∞—à-–¥–æ–º–µ–Ω.vercel.app/api/init-db
```

#### –í–∞—Ä–∏–∞–Ω—Ç 2: –ß–µ—Ä–µ–∑ Vercel CLI
```bash
# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ Vercel CLI –µ—Å–ª–∏ –µ—â–µ –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω
npm i -g vercel

# –í–æ–π–¥–∏—Ç–µ –≤ –∞–∫–∫–∞—É–Ω—Ç
vercel login

# –í—ã–ø–æ–ª–Ω–∏—Ç–µ –∫–æ–º–∞–Ω–¥—É –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
vercel env pull .env.production
npm run init-vercel
```

### 4. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã

1. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç–∞—Ç—É—Å –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö:**
   ```
   GET https://–≤–∞—à-–¥–æ–º–µ–Ω.vercel.app/api/init-db
   ```

2. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ API —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã:**
   ```
   GET https://–≤–∞—à-–¥–æ–º–µ–Ω.vercel.app/api/prices
   GET https://–≤–∞—à-–¥–æ–º–µ–Ω.vercel.app/api/shifts
   ```

### 5. –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã –∏ —Ä–µ—à–µ–Ω–∏—è

#### –û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –ø–æ–¥–∫–ª—é—á–µ–Ω–∞ –∫ –ø—Ä–æ–µ–∫—Ç—É
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö –ø—Ä–æ–µ–∫—Ç–∞
- –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–µ—Ä–µ—Å–æ–∑–¥–∞—Ç—å –¥–µ–ø–ª–æ–π

#### –û—à–∏–±–∫–∏ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ —Ç–∞–±–ª–∏—Ü
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –≤ Vercel Dashboard
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –µ—Å—Ç—å –ø—Ä–∞–≤–∞ –Ω–∞ —Å–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü
- –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –≤—ã–ø–æ–ª–Ω–∏—Ç—å –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é –ø–æ–≤—Ç–æ—Ä–Ω–æ

#### –¢–∞–±–ª–∏—Ü—ã –Ω–µ —Å–æ–∑–¥–∞—é—Ç—Å—è
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ä–µ–≥–∏–æ–Ω –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ —Ñ—É–Ω–∫—Ü–∏–π –≤ Vercel

### 6. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

- **Vercel Dashboard**: –ü—Ä–æ–≤–µ—Ä—è–π—Ç–µ –ª–æ–≥–∏ —Ñ—É–Ω–∫—Ü–∏–π
- **Postgres Dashboard**: –ú–æ–Ω–∏—Ç–æ—Ä—å—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
- **API —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã**: –†–µ–≥—É–ª—è—Ä–Ω–æ –ø—Ä–æ–≤–µ—Ä—è–π—Ç–µ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å

## üîß –ö–æ–º–∞–Ω–¥—ã –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏

```bash
# –õ–æ–∫–∞–ª—å–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞
npm run dev

# –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ª–æ–∫–∞–ª—å–Ω–æ–π PostgreSQL
npm run init-postgres

# –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Vercel Postgres (—Å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º–∏ –æ–∫—Ä—É–∂–µ–Ω–∏—è Vercel)
npm run init-vercel

# –ü—Ä–æ—Å–º–æ—Ç—Ä —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
npm run view-db

# –î–µ–ø–ª–æ–π –Ω–∞ Vercel
vercel --prod
```

## üìù –ü—Ä–∏–º–µ—á–∞–Ω–∏—è

- Vercel Postgres –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞–µ—Ç –ø—É–ª —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π
- –í—Å–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
- –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –¥–æ—Å—Ç—É–ø–Ω–∞ —Ç–æ–ª—å–∫–æ –∏–∑ —Ñ—É–Ω–∫—Ü–∏–π Vercel
- –î–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω–∞—è PostgreSQL –±–∞–∑–∞
</file>

<file path="public/logo.svg">
<?xml version="1.0" encoding="UTF-8"?>
<svg version="1.1" xmlns="http://www.w3.org/2000/svg" width="819" height="819">
<path d="M0 0 C0.01458252 0.61931396 0.02916504 1.23862793 0.04418945 1.87670898 C0.11947417 4.73087773 0.21586314 7.58397749 0.3125 10.4375 C0.34633789 11.89833008 0.34633789 11.89833008 0.38085938 13.38867188 C0.73613185 23.04562378 2.62290414 31.81744173 9.8125 38.6875 C15.86595931 43.07922538 21.68887963 43.83862851 29 43 C35.27389086 41.54224301 40.21670166 39.12209039 43.81640625 33.65625 C47.71678528 24.90292412 48.4187259 14.80964818 47.91015625 5.35546875 C48 3 48 3 50 0 C51.78942204 -0.3719368 51.78942204 -0.3719368 53.99220276 -0.36749268 C54.82650818 -0.37306183 55.6608136 -0.37863098 56.520401 -0.3843689 C57.89584328 -0.37054672 57.89584328 -0.37054672 59.29907227 -0.35644531 C60.26336151 -0.35848969 61.22765076 -0.36053406 62.22116089 -0.36264038 C65.41976667 -0.36565717 68.61786144 -0.34714549 71.81640625 -0.328125 C74.03075533 -0.32506909 76.24510633 -0.32319169 78.4594574 -0.32244873 C83.10414972 -0.31784015 87.7486692 -0.30339197 92.39331055 -0.28125 C98.3613994 -0.25295075 104.329352 -0.24203755 110.29750156 -0.2375679 C114.87067542 -0.2334207 119.44382144 -0.22360938 124.01698112 -0.21169281 C126.21831983 -0.20597647 128.41966125 -0.20122231 130.6210041 -0.19742584 C133.69082524 -0.19058754 136.76053604 -0.17696721 139.83032227 -0.16113281 C141.20880089 -0.15945602 141.20880089 -0.15945602 142.61512756 -0.15774536 C148.88531452 -0.11468548 148.88531452 -0.11468548 150 1 C150.10937945 2.75929597 150.15586752 4.52257586 150.17578125 6.28515625 C150.19962891 7.37376953 150.22347656 8.46238281 150.24804688 9.58398438 C150.29050563 11.87547078 150.32202867 14.16718991 150.34179688 16.45898438 C150.53970794 24.2971832 151.51877854 30.04545457 156.78125 36.0234375 C157.3484375 36.46945312 157.915625 36.91546875 158.5 37.375 C159.0671875 37.83648437 159.634375 38.29796875 160.21875 38.7734375 C166.62824902 43.18699604 173.49369882 42.86112897 181 42 C186.37885972 40.07457378 190.56270304 37.30019856 193.5625 32.375 C195.4415195 27.96338901 196.12537455 24.43331627 196.28125 19.6484375 C196.31863281 18.63265625 196.35601562 17.616875 196.39453125 16.5703125 C196.46510134 14.43230015 196.53541197 12.29427923 196.60546875 10.15625 C196.64285156 9.14304687 196.68023437 8.12984375 196.71875 7.0859375 C196.74904297 6.1582959 196.77933594 5.2306543 196.81054688 4.27490234 C197 2 197 2 198 0 C210.44014736 0.16977869 219.93304515 1.58347185 229.46875 10.33203125 C236.77270866 18.28812907 238.309984 26.37360056 238.125 36.875 C238.11597656 37.84953125 238.10695313 38.8240625 238.09765625 39.828125 C238.07421623 42.21900728 238.04140442 44.60937261 238 47 C231.375 47.125 231.375 47.125 228 46 C223.91354539 45.60206809 220.1769066 45.62552972 216.25 46.875 C210.25313754 52.53870343 208.032873 61.23211131 206 69 C198.78763107 69.9973143 191.7163465 70.1208628 184.44041252 70.07516479 C182.35817826 70.06222555 180.27600885 70.05584168 178.19374084 70.05102539 C173.77496452 70.03968397 169.35624237 70.02044211 164.9375 70 C159.80774354 69.97628922 154.67801836 69.9559371 149.54821968 69.94406128 C147.50988143 69.93764184 145.47164108 69.92513847 143.43333435 69.91235352 C137.17143198 69.89582809 131.19564834 70.13100703 125 71 C122.94328426 70.77147603 120.88668296 70.53874928 118.8359375 70.26171875 C114.95045497 69.90314116 111.08759159 69.8811769 107.1875 69.875 C106.4457251 69.87056885 105.7039502 69.8661377 104.93969727 69.86157227 C100.96423312 69.83934532 100.96423312 69.83934532 97.07202148 70.53515625 C94.56798397 71.09691982 92.60041162 70.87664048 90.0546875 70.5703125 C83.73264307 69.9168875 77.4762221 69.85220853 71.125 69.875 C70.02414062 69.87113281 68.92328125 69.86726563 67.7890625 69.86328125 C66.726875 69.86457031 65.6646875 69.86585938 64.5703125 69.8671875 C63.14356201 69.86887939 63.14356201 69.86887939 61.68798828 69.87060547 C58.96601479 69.93275327 58.96601479 69.93275327 56.21435547 70.57080078 C55.48361816 70.71243652 54.75288086 70.85407227 54 71 C53.67 70.67 53.34 70.34 53 70 C50.8273732 69.90043722 48.65146894 69.87200281 46.4765625 69.87060547 C45.79527283 69.86885315 45.11398315 69.86710083 44.41204834 69.86529541 C42.14967333 69.86087758 39.88737587 69.86381462 37.625 69.8671875 C36.0594074 69.86651444 34.4938149 69.8655444 32.92822266 69.86428833 C29.64289355 69.86281145 26.35759158 69.86496559 23.07226562 69.86962891 C18.85179484 69.8753262 14.63138764 69.87204714 10.41091919 69.86605644 C7.17683428 69.86245056 3.94276455 69.86358954 0.7086792 69.86618423 C-0.84792081 69.86685343 -2.40452218 69.86602534 -3.96112061 69.86370468 C-6.13297196 69.8611777 -8.30471896 69.86501935 -10.4765625 69.87060547 C-11.71486816 69.87140106 -12.95317383 69.87219666 -14.22900391 69.87301636 C-16.90854742 69.68388223 -16.90854742 69.68388223 -18 71 C-18.12492389 73.43299787 -18.18601507 75.83904923 -18.20532227 78.27368164 C-18.22017166 79.41506844 -18.22017166 79.41506844 -18.23532104 80.57951355 C-18.26702624 83.1063623 -18.2917289 85.63322988 -18.31640625 88.16015625 C-18.33696801 89.90751141 -18.35796426 91.65486151 -18.37937927 93.40220642 C-18.43468041 98.01026318 -18.48405408 102.61836541 -18.53222656 107.22650146 C-18.58238303 111.92513089 -18.63809958 116.62369394 -18.69335938 121.32226562 C-18.80103924 130.54812044 -18.90246223 139.77403278 -19 149 C-19.73532959 149.06421143 -20.47065918 149.12842285 -21.22827148 149.19458008 C-22.20352783 149.28118896 -23.17878418 149.36779785 -24.18359375 149.45703125 C-25.62690063 149.58428589 -25.62690063 149.58428589 -27.09936523 149.71411133 C-29.76598831 149.97693564 -32.40801721 150.32531761 -35.0625 150.6875 C-37.0115625 150.8421875 -37.0115625 150.8421875 -39 151 C-41.44181728 148.55818272 -41.25083994 147.94278666 -41.25396729 144.59501648 C-41.25960693 143.66866898 -41.26524658 142.74232147 -41.27105713 141.78790283 C-41.26700867 140.76823425 -41.26296021 139.74856567 -41.25878906 138.69799805 C-41.2622937 137.6261879 -41.26579834 136.55437775 -41.26940918 135.4500885 C-41.27824898 131.88723367 -41.27236483 128.32457581 -41.265625 124.76171875 C-41.26697209 122.28465232 -41.26891299 119.80758615 -41.27142334 117.33052063 C-41.27475761 111.45637157 -41.26773647 105.58229403 -41.2571218 99.70815545 C-41.24754187 93.72975581 -41.25707141 87.75144038 -41.26788712 81.77304363 C-41.27515093 76.64865417 -41.27279598 71.52430255 -41.26763153 66.39991188 C-41.26630411 63.95170891 -41.26791071 61.50350243 -41.27259064 59.05530357 C-41.32846064 21.57024678 -41.32846064 21.57024678 -28 8 C-19.78693738 0.40291708 -10.77539468 0 0 0 Z " fill="#E7D0B1" transform="translate(309,282)"/>
<path d="M0 0 C9.7399741 0.84155584 18.72045115 5.69105766 26 12 C26.80179688 12.69351562 27.60359375 13.38703125 28.4296875 14.1015625 C30.98870819 16.36501241 33.49968902 18.67198609 36 21 C36.680625 21.61488281 37.36125 22.22976563 38.0625 22.86328125 C42.40243826 26.94947312 45.95715052 31.43224803 49.4375 36.25 C49.87513672 36.85287842 50.31277344 37.45575684 50.76367188 38.0769043 C52.79531235 40.9637817 54.51712509 43.45306428 55 47 C55.66 47 56.32 47 57 47 C58.53815394 51.61446183 58.18443162 56.22980303 58.1875 61.0625 C58.19974609 62.08150391 58.21199219 63.10050781 58.22460938 64.15039062 C58.22654297 65.12298828 58.22847656 66.09558594 58.23046875 67.09765625 C58.23457764 67.98976807 58.23868652 68.88187988 58.24291992 69.80102539 C58 72 58 72 56 74 C55.5326333 76.8907496 55.16300658 79.71660569 54.875 82.625 C54.78863281 83.42679687 54.70226562 84.22859375 54.61328125 85.0546875 C54.40103673 87.03563635 54.19950069 89.01772718 54 91 C51 92 51 92 48 91 C46.68457031 89.15209961 46.68457031 89.15209961 45.328125 86.71484375 C41.73533619 80.47853511 37.76308345 74.53435037 33.75 68.5625 C33.03070312 67.48806641 32.31140625 66.41363281 31.5703125 65.30664062 C30.24813963 63.33204725 28.92501375 61.35809138 27.60058594 59.38500977 C26.3973305 57.59205638 25.19775501 55.79663252 24 54 C20.41642759 53.74984127 20.41642759 53.74984127 17 54 C17 56.64 17 59.28 17 62 C17.66 62 18.32 62 19 62 C19.25652344 62.49886719 19.51304687 62.99773437 19.77734375 63.51171875 C22.6280822 68.85805315 25.86317151 73.82239246 29.34936523 78.77587891 C32.31245585 82.98808586 35.16923325 87.26050482 38 91.5625 C42.41258947 98.24491513 47.1108467 104.65827217 52 111 C55.77762917 109.87893143 58.64211047 108.85455454 61.5625 106.1875 C62.15160156 105.65382813 62.74070312 105.12015625 63.34765625 104.5703125 C65.60969994 102.42056885 67.82066361 100.2338198 70 98 C74.12292479 93.77527459 78.34374624 89.75622883 82.8125 85.8984375 C85.33628915 83.70814906 87.82649555 81.48306795 90.3125 79.25 C91.13363281 78.51265625 91.95476562 77.7753125 92.80078125 77.015625 C94.1298707 75.79748973 95.42990703 74.54492277 96.66796875 73.234375 C98 72 98 72 100 72 C100.495 70.515 100.495 70.515 101 69 C102.98571881 67.19402298 105.0736672 65.56738173 107.1875 63.9140625 C109.36887224 61.61045819 109.75519304 60.13148907 110 57 C109.67 56.34 109.34 55.68 109 55 C105.76564143 54.64705568 104.30685423 54.80367146 101.52734375 56.58203125 C100.24537109 57.68611328 100.24537109 57.68611328 98.9375 58.8125 C97.97585938 59.63621094 97.01421875 60.45992188 96.0234375 61.30859375 C91.47984391 65.33018873 87.0023033 69.42040229 82.56005859 73.55322266 C79.33442986 76.54462733 76.07987709 79.50466485 72.83227539 82.47216797 C70.8534068 84.28424958 68.89760692 86.10239308 67 88 C65.68 88 64.36 88 63 88 C62.97315321 85.35409986 62.95323643 82.70846904 62.9375 80.0625 C62.92912109 79.30775391 62.92074219 78.55300781 62.91210938 77.77539062 C62.90347559 75.85005687 62.94775667 73.92464419 63 72 C63.33 71.67 63.66 71.34 64 71 C64.41548529 67.72522049 64.76917907 64.45266869 65.07421875 61.16601562 C65.89139033 53.6660426 68.54913029 49.21387537 74 44 C75.37933364 42.42044051 76.75382421 40.83664627 78.125 39.25 C82.9517171 33.85401893 88.30181283 29.44025403 94 25 C94.71671875 24.40574219 95.4334375 23.81148438 96.171875 23.19921875 C106.25571334 14.953975 116.80878402 9.04146808 129.125 4.875 C130.02573242 4.56755859 130.92646484 4.26011719 131.85449219 3.94335938 C136.42105085 2.4871556 139.26020338 1.78083697 144 3 C147.64455648 32.61359416 146.04113461 65.09886096 127 89.5 C125.68723964 91.01803756 124.35479944 92.51935951 123 94 C122.40960937 94.68191406 121.81921875 95.36382812 121.2109375 96.06640625 C110.64584612 107.55313326 97.08011749 113.34283732 82.2578125 117.26953125 C81.44795898 117.48577148 80.63810547 117.70201172 79.80371094 117.92480469 C78.21980615 118.34068319 76.63193457 118.74181776 75.04003906 119.12597656 C70.63570942 120.25584225 67.90931895 121.28457252 65 125 C60.09679191 133.77416185 61.74724454 146.86640203 61.55444336 156.6497364 C61.49890831 159.46550796 61.43850609 162.28114044 61.37695312 165.0967865 C61.24694701 171.08526952 61.1232485 177.07387471 61 183.0625 C60.85684035 189.98728872 60.71098563 196.91200821 60.56030273 203.8366375 C60.50171857 206.57968848 60.44701318 209.32279727 60.39257812 212.06593323 C60.22288445 220.19683663 59.98522143 228.31538013 59.51953125 236.43530273 C59.48061768 237.12295999 59.4417041 237.81061724 59.40161133 238.51911259 C58.59946351 251.45156668 58.59946351 251.45156668 55.23999023 254.70385742 C52.5948997 256.23440627 51.01221032 256.37370902 47.97265625 256.36328125 C47.01552734 256.36263672 46.05839844 256.36199219 45.07226562 256.36132812 C44.07904297 256.34521484 43.08582031 256.32910156 42.0625 256.3125 C40.5784668 256.31733398 40.5784668 256.31733398 39.06445312 256.32226562 C34.16280351 256.28600594 30.52413768 256.03862645 26 254 C26 253.34 26 252.68 26 252 C25.01 251.67 24.02 251.34 23 251 C22.94545591 248.64551325 22.9060721 246.29232125 22.875 243.9375 C22.85179687 242.62652344 22.82859375 241.31554687 22.8046875 239.96484375 C23.00166901 235.96611901 23.86345071 232.82217315 25 229 C25.5594894 225.36844398 25.86953528 221.71016375 26.2109375 218.05273438 C26.6091679 214.2043182 27.28993075 211.41571271 29 208 C29.54443186 205.84623118 29.54443186 205.84623118 29.88208008 203.53979492 C30.02611771 202.65809128 30.17015533 201.77638763 30.31855774 200.8679657 C30.467379 199.91509171 30.61620026 198.96221771 30.76953125 197.98046875 C30.93096115 196.98147049 31.09239105 195.98247223 31.25871277 194.95320129 C31.78304008 191.69895708 32.29802265 188.44331473 32.8125 185.1875 C33.16939448 182.95499375 33.52681819 180.72257204 33.88476562 178.49023438 C34.42094895 175.14386207 34.95633037 171.79737431 35.48880005 168.45040894 C36.51186849 162.02095037 37.55812806 155.59614615 38.63671875 149.17578125 C38.87346311 147.75564391 39.1100427 146.33547909 39.34643555 144.9152832 C39.76870031 142.38563805 40.19562061 139.85676364 40.62817383 137.32885742 C42.16873209 128.19982929 42.16873209 128.19982929 42 119 C38.43892823 114.7354171 32.72252356 112.89594532 27.6875 110.75 C26.85154297 110.38648438 26.01558594 110.02296875 25.15429688 109.6484375 C23.10571254 108.75876659 21.05436987 107.87620804 19 107 C19 106.34 19 105.68 19 105 C18.236875 104.731875 17.47375 104.46375 16.6875 104.1875 C14.07686496 103.03396359 12.92614911 102.01370135 11 100 C9.515 99.505 9.515 99.505 8 99 C6.68359375 97.40625 6.68359375 97.40625 5.4375 95.5 C3.68380605 92.74463406 3.68380605 92.74463406 1 91 C-3.57589528 83.67856756 -8.71143684 75.21756035 -9.625 66.5 C-9.74875 65.345 -9.8725 64.19 -10 63 C-10.66 62.67 -11.32 62.34 -12 62 C-16.41806176 41.33328889 -11.21833975 20.69543991 -2 2 C-1.34 1.34 -0.68 0.68 0 0 Z " fill="#E5CDAE" transform="translate(532,337)"/>
<path d="M0 0 C1.16917969 0.51691406 2.33835937 1.03382813 3.54296875 1.56640625 C12.70662546 5.79884983 21.27550199 10.46588239 25.44140625 20.09375 C26.73703814 24.51520707 25.24309729 27.47640583 23.375 31.5 C15.27591082 44.50417136 -3.47560127 50.30729123 -17.5625 53.6875 C-39.2756393 57.97854157 -63.56145469 57.28071263 -85 52 C-86.99712782 51.64986917 -88.99647708 51.31145947 -91 51 C-91 50.34 -91 49.68 -91 49 C-92.918125 48.6596875 -92.918125 48.6596875 -94.875 48.3125 C-100.40063852 47.09232746 -105.06925032 44.71448937 -110 42 C-111.03125 41.443125 -112.0625 40.88625 -113.125 40.3125 C-113.74375 39.879375 -114.3625 39.44625 -115 39 C-115 38.34 -115 37.68 -115 37 C-115.99 37 -116.98 37 -118 37 C-121.6462144 31.5894883 -123.72141413 26.63497784 -123 20 C-119.55536048 11.16500408 -111.76733856 6.21340719 -103.5 2.375 C-73.75425829 -10.0267097 -29.80713642 -13.19608727 0 0 Z " fill="#E7CFAF" transform="translate(360,449)"/>
<path d="M0 0 C4.19345227 1.23336832 5.97073569 4.57682192 8.3984375 8.0546875 C9.19169434 9.15792358 9.19169434 9.15792358 10.00097656 10.28344727 C11.52796385 12.4234296 13.0289055 14.57946249 14.5234375 16.7421875 C15.20148438 17.70382812 15.87953125 18.66546875 16.578125 19.65625 C30.34075677 40.14164199 40.78961018 68.87352235 36.5234375 93.7421875 C36.41644531 94.59425781 36.30945313 95.44632812 36.19921875 96.32421875 C35.3777001 100.28722474 34.43028808 102.13949798 31.0078125 104.4140625 C27.88686324 105.96653469 24.72163365 107.35695653 21.5234375 108.7421875 C12.66748752 113.35048726 3.57852136 119.59647639 -2.640625 127.48828125 C-4.4765625 129.7421875 -4.4765625 129.7421875 -7.4765625 130.7421875 C-9.4732497 128.7455003 -9.2346647 125.52717715 -9.4765625 122.83984375 C-9.4765625 118.14751699 -8.3919291 113.8061441 -7.38671875 109.23828125 C-6.22086307 103.73630509 -5.43177249 98.18658249 -4.6640625 92.6171875 C-4.51614258 91.62114502 -4.36822266 90.62510254 -4.21582031 89.59887695 C-4.08916992 88.65359131 -3.96251953 87.70830566 -3.83203125 86.734375 C-3.71496826 85.89245605 -3.59790527 85.05053711 -3.47729492 84.18310547 C-3.47641156 81.23914676 -4.1022512 79.33581471 -5.4765625 76.7421875 C-8.02431556 75.84832586 -8.02431556 75.84832586 -10.4765625 75.7421875 C-12.77689156 79.45206716 -13.06187426 83.30420285 -13.4765625 87.55078125 C-13.55777344 88.31334732 -13.63898437 89.07591339 -13.72265625 89.86158752 C-13.98127033 92.300253 -14.22951232 94.73982574 -14.4765625 97.1796875 C-14.80567287 100.36633721 -15.13942145 103.55247148 -15.4765625 106.73828125 C-15.5576123 107.50804291 -15.63866211 108.27780457 -15.72216797 109.07089233 C-16.43275077 115.66427403 -17.38040905 122.20097925 -18.4765625 128.7421875 C-23.203125 128.09375 -23.203125 128.09375 -25.6640625 124.9296875 C-27.01301913 122.55738446 -28.33349961 120.21882377 -29.4765625 117.7421875 C-30.1365625 117.7421875 -30.7965625 117.7421875 -31.4765625 117.7421875 C-31.4765625 117.0821875 -31.4765625 116.4221875 -31.4765625 115.7421875 C-32.9615625 115.2471875 -32.9615625 115.2471875 -34.4765625 114.7421875 C-34.4765625 114.0821875 -34.4765625 113.4221875 -34.4765625 112.7421875 C-35.1365625 112.7421875 -35.7965625 112.7421875 -36.4765625 112.7421875 C-36.4765625 112.0821875 -36.4765625 111.4221875 -36.4765625 110.7421875 C-37.1365625 110.7421875 -37.7965625 110.7421875 -38.4765625 110.7421875 C-38.4765625 110.0821875 -38.4765625 109.4221875 -38.4765625 108.7421875 C-39.06050781 108.47019531 -39.64445313 108.19820313 -40.24609375 107.91796875 C-42.44852681 106.75696638 -44.24352194 105.50861347 -46.1640625 103.9296875 C-47.06705078 103.20845703 -47.06705078 103.20845703 -47.98828125 102.47265625 C-52.46918129 97.26258088 -51.09401153 86.90981085 -50.74169922 80.35253906 C-49.31478673 66.30415197 -43.47899463 52.85258027 -36.4765625 40.7421875 C-35.96851074 39.85225098 -35.96851074 39.85225098 -35.45019531 38.94433594 C-28.33593286 26.68186076 -14.15801354 4.24293781 0 0 Z " fill="#E0C8AA" transform="translate(610.4765625,239.2578125)"/>
<path d="M0 0 C3.47256611 1.28161491 6.39063686 2.77858436 9.4375 4.875 C10.15808594 5.36742187 10.87867188 5.85984375 11.62109375 6.3671875 C12.40613281 6.90601563 13.19117188 7.44484375 14 8 C15.02552979 8.41169434 16.05105957 8.82338867 17.10766602 9.24755859 C20.55597374 12.52908314 20.47382849 13.41383778 20.71289062 18.01855469 C20.7254918 20.5697002 20.70431547 23.1211512 20.65625 25.671875 C20.65012816 27.03703986 20.64638098 28.40221724 20.64489746 29.76739502 C20.63569714 32.62927087 20.60688978 35.49001925 20.5625 38.3515625 C20.50614879 42.00081023 20.48409742 45.64916759 20.4751358 49.29880905 C20.46476271 52.79827663 20.43570997 56.29752589 20.40625 59.796875 C20.39775024 61.09921082 20.38925049 62.40154663 20.38049316 63.74334717 C20.16232862 77.68323827 16.89564214 88.63098789 7.16796875 98.9609375 C-1.33114265 106.95469633 -10.20983359 110.13110515 -21.71827698 110.79666138 C-23.70107277 110.91951726 -25.68291312 111.06434559 -27.66075134 111.2507019 C-38.6153163 112.27811663 -49.57393185 112.14490889 -60.56640625 112.1328125 C-62.73542797 112.13348724 -64.90444961 112.13445869 -67.07347107 112.13571167 C-71.5926893 112.13717778 -76.11188762 112.13506733 -80.63110352 112.13037109 C-86.42481581 112.12464355 -92.21848208 112.12797869 -98.01219273 112.13394356 C-102.47908375 112.13755235 -106.9459638 112.13640964 -111.41285515 112.13381577 C-113.55031273 112.13314897 -115.68777132 112.13396627 -117.82522774 112.13629532 C-120.80221339 112.13883038 -123.77912351 112.13497051 -126.75610352 112.12939453 C-128.07845505 112.13243088 -128.07845505 112.13243088 -129.42752075 112.13552856 C-130.23881943 112.13270874 -131.0501181 112.12988892 -131.88600159 112.12698364 C-132.58811547 112.12660662 -133.29022936 112.12622959 -134.01361942 112.12584114 C-136.11156788 111.99293195 -137.9804987 111.57016302 -140 111 C-139.91935365 107.7073118 -139.80649721 104.41650779 -139.6875 101.125 C-139.66494141 100.18785156 -139.64238281 99.25070312 -139.61914062 98.28515625 C-139.5659668 96.94130859 -139.5659668 96.94130859 -139.51171875 95.5703125 C-139.47244263 94.32918701 -139.47244263 94.32918701 -139.43237305 93.06298828 C-139 91 -139 91 -136 89 C-133.13031006 88.79745483 -133.13031006 88.79745483 -129.57714844 88.86474609 C-128.92663702 88.87419628 -128.2761256 88.88364647 -127.60590172 88.89338303 C-125.44011405 88.92716128 -123.27488873 88.97536263 -121.109375 89.0234375 C-119.58187456 89.04985576 -118.05435698 89.07529917 -116.52682495 89.099823 C-113.28299584 89.15354066 -110.03935229 89.21319392 -106.79571533 89.27746582 C-101.75770559 89.37665949 -96.71951901 89.45937752 -91.68115234 89.53808594 C-90.01083362 89.56432328 -88.34051501 89.59056838 -86.67019653 89.61682129 C-85.43724539 89.63616478 -85.43724539 89.63616478 -84.17938614 89.65589905 C-80.88820408 89.70811845 -77.5970598 89.76252637 -74.30591393 89.81697083 C-58.14691164 90.0862212 -58.14691164 90.0862212 -41.9864502 90.23419189 C-40.43488635 90.24457843 -38.88334814 90.26064015 -37.33190918 90.28289795 C-27.37487818 90.42349965 -17.90046738 89.94296395 -9 85 C0.62675447 75.35021501 -0.84174276 60.05227828 -0.83984375 47.4609375 C-0.85506597 42.43209395 -0.89372523 37.40366648 -0.9375 32.375 C-0.9651887 28.53277092 -0.98985562 24.6905801 -1.00868225 20.84829712 C-1.02087334 18.47210227 -1.0384113 16.09592719 -1.06199646 13.71981812 C-1.07179283 12.1112645 -1.07179283 12.1112645 -1.08178711 10.47021484 C-1.09004013 9.53172699 -1.09829315 8.59323914 -1.10679626 7.62631226 C-0.99940151 4.98528202 -0.58995698 2.57268757 0 0 Z " fill="#E4CDAE" transform="translate(529,442)"/>
<path d="M0 0 C0.556875 1.3303125 0.556875 1.3303125 1.125 2.6875 C7.45088848 13.86323632 23.0501323 18.50969357 34.78125 21.87109375 C46.04244302 24.94353318 57.28944762 27.62643175 69 28 C70.40958984 28.05994141 70.40958984 28.05994141 71.84765625 28.12109375 C87.3232076 28.46055746 102.72476845 26.93917058 117.56665039 22.5012207 C123.3900798 20.82863034 123.3900798 20.82863034 127.05859375 21.859375 C127.69925781 22.23578125 128.33992187 22.6121875 129 23 C126.30235446 31.90223027 119.30917391 36.72331074 111.53515625 41.1484375 C82.05433247 56.58922255 46.53758445 54.88593547 15 48 C15 47.34 15 46.68 15 46 C13.824375 46.1546875 13.824375 46.1546875 12.625 46.3125 C3.17086855 45.49748867 -4.00278045 38.86784377 -11 33 C-11.72960937 32.46761719 -12.45921875 31.93523438 -13.2109375 31.38671875 C-16.25476823 29.02741764 -16.78086222 26.48961515 -17.328125 22.76953125 C-17.81647718 15.61073227 -15.64734452 11.33885312 -11 6 C-5.24742268 0 -5.24742268 0 0 0 Z " fill="#E4CCAD" transform="translate(232,522)"/>
<path d="M0 0 C1.36125577 4.50133042 0.50923719 6.99850838 -1.1875 11.3125 C-3.67711372 18.14733471 -5.10955784 25.02156858 -6.3125 32.1875 C-6.48354248 33.17210205 -6.65458496 34.1567041 -6.83081055 35.17114258 C-9.59644518 52.43875955 -7.40092113 68.16915267 0 84 C9.01929191 103.61159735 14.49431048 123.6937247 7.265625 145.0234375 C5.28251524 149.68741785 2.89500628 153.847857 0 158 C-0.50917969 158.76570312 -1.01835937 159.53140625 -1.54296875 160.3203125 C-4.24273428 164.19298388 -6.18169932 166.86628219 -11 168 C-12.19139855 163.74725946 -11.68205685 160.92191278 -10.5625 156.6875 C-6.37321015 138.10722374 -10.23143366 122.29539816 -18.75 105.5625 C-20 103 -20 103 -20 101 C-20.66 100.67 -21.32 100.34 -22 100 C-32.03875516 82.77472651 -35.45241742 63.53531074 -31 44 C-27.75311702 32.94898382 -13.57586621 0 0 0 Z " fill="#E6D0B1" transform="translate(226,253)"/>
<path d="M0 0 C2.93432586 0.32603621 3.9454121 0.94200036 6 3.125 C12.73101834 10.24831696 22.79158681 14.22305033 32 17 C33.11117187 17.34933594 34.22234375 17.69867187 35.3671875 18.05859375 C64.63284686 26.3637133 100.93422059 25.17248239 128.3671875 11.296875 C134.65562236 7.76811113 134.65562236 7.76811113 140 3 C140.66 2.34 141.32 1.68 142 1 C144.125 1.375 144.125 1.375 146 2 C146.79666869 15.47697863 146.79666869 15.47697863 142 21 C127.78092025 36.82676465 104.1881491 40.33463192 84.09008789 41.54125977 C67.94610088 42.37253701 52.75934223 41.6475111 37 38 C35.94679565 37.79733521 35.94679565 37.79733521 34.87231445 37.59057617 C29.28347777 36.4793208 24.43446968 34.66226424 19.3125 32.1875 C18.59255859 31.85685547 17.87261719 31.52621094 17.13085938 31.18554688 C12.48728027 28.98016427 8.73117919 26.55490301 5 23 C5 22.34 5 21.68 5 21 C4.34 21 3.68 21 3 21 C-0.26830879 17.07802945 -0.47637869 13.20340048 -0.7890625 8.3046875 C-0.92606195 5.84107365 -0.92606195 5.84107365 -2 3 C-1.34 2.01 -0.68 1.02 0 0 Z " fill="#D8BFA2" transform="translate(215,564)"/>
<path d="M0 0 C4.50213765 1.41495755 6.70460873 3.70460873 10 7 C20.63752707 13.94695645 32.69652672 17.37503323 45 20 C45.69335449 20.15243164 46.38670898 20.30486328 47.10107422 20.46191406 C75.73234795 26.58632143 107.0624807 23.4785736 133.1875 10 C133.81213135 9.67999023 134.4367627 9.35998047 135.08032227 9.03027344 C138.97645158 6.90618368 141.4619133 4.62763757 144 1 C145.98 1.495 145.98 1.495 148 2 C149.3069269 7.410293 148.88714759 11.76854021 147 17 C144.98193879 20.03487355 142.64599399 22.50520567 140 25 C138.88625 26.0828125 138.88625 26.0828125 137.75 27.1875 C112.23991434 44.00096555 74.55948017 45.55523803 45.5 39.6875 C35.54099293 37.58730664 25.81895577 35.19589858 16.6875 30.625 C15.53636719 30.06039062 14.38523438 29.49578125 13.19921875 28.9140625 C9.89936144 26.9397889 7.59300636 24.82126396 5 22 C4.278125 21.2575 3.55625 20.515 2.8125 19.75 C-0.63935944 14.51269602 -1.4539889 8.20451498 -1 2 C-0.67 1.34 -0.34 0.68 0 0 Z " fill="#E0C8AA" transform="translate(237,494)"/>
<path d="M0 0 C6.50760797 1.57760193 10.18694512 7.04797474 13.5234375 12.48046875 C19.05476478 23.30332589 19.09840074 35.40446996 16 47 C14.03764779 52.84439681 11.33216826 58.33543884 8.625 63.86328125 C-0.83395282 83.22635598 -6.05912845 100.53467936 -6.625 122.25 C-6.66367188 123.48363281 -6.70234375 124.71726562 -6.7421875 125.98828125 C-6.8353276 128.99204937 -6.92114531 131.99582878 -7 135 C-8.32 135.33 -9.64 135.66 -11 136 C-22.73584526 122.09085007 -27.75012005 107.64427527 -26.30273438 89.55859375 C-24.92922639 77.9502359 -20.13579243 67.50775424 -15.02392578 57.12353516 C-12.99373459 52.91309095 -11.09982321 48.63991292 -9.1875 44.375 C-8.80239258 43.52123779 -8.41728516 42.66747559 -8.02050781 41.7878418 C-7.00479896 39.52903665 -5.99951614 37.26600758 -5 35 C-4.60425781 34.10539062 -4.20851562 33.21078125 -3.80078125 32.2890625 C-1.36025367 25.31272512 -1.66237119 17.74162524 -1.39453125 10.43554688 C-1.35714844 9.52482422 -1.31976563 8.61410156 -1.28125 7.67578125 C-1.25095703 6.84989502 -1.22066406 6.02400879 -1.18945312 5.1730957 C-1 3 -1 3 0 0 Z " fill="#E0CAAC" transform="translate(256,195)"/>
<path d="M0 0 C4.93918408 2.61486216 8.48734878 5.97469756 11 11 C11.11149426 13.91946312 11.16412684 16.81431362 11.16796875 19.734375 C11.17129715 20.60515686 11.17462555 21.47593872 11.17805481 22.37310791 C11.18312375 24.21911083 11.18546315 26.06512294 11.18530273 27.91113281 C11.18748047 30.7247652 11.20561215 33.53799998 11.22460938 36.3515625 C11.22754512 38.14583199 11.2295287 39.94010335 11.23046875 41.734375 C11.23765427 42.57208435 11.24483978 43.4097937 11.25224304 44.27288818 C11.2320784 49.47635538 11.17412616 54.65695677 7.44140625 58.6796875 C1.65096158 62.36342153 -3.24427127 62.55883785 -10 62 C-10 61.34 -10 60.68 -10 60 C-10.5775 59.95875 -11.155 59.9175 -11.75 59.875 C-14.38883153 58.84878774 -15.70834762 57.59605507 -17.18359375 55.18359375 C-19.09749677 50.06458997 -18.87233767 44.40243774 -19 39 C-19.02835937 38.01644531 -19.05671875 37.03289062 -19.0859375 36.01953125 C-19.12746712 33.00863375 -19.06817352 30.01039921 -19 27 C-19.00338379 26.32469238 -19.00676758 25.64938477 -19.01025391 24.95361328 C-19.07245087 10.20638468 -19.07245087 10.20638468 -14.6875 5.0625 C-10.14624773 0.73796693 -6.30616002 -0.65236138 0 0 Z " fill="#E5CFB0" transform="translate(337,254)"/>
<path d="M0 0 C4.35412188 2.30512335 7.39422397 4.82418226 10 9 C10.58695104 12.31366809 10.56077635 15.57913451 10.53125 18.9375 C10.5350769 19.89519287 10.53890381 20.85288574 10.54284668 21.83959961 C10.5455632 23.86019952 10.53822023 25.88083476 10.52148438 27.90136719 C10.50007119 30.98973175 10.52129501 34.07577007 10.546875 37.1640625 C10.54423168 39.13021345 10.53910661 41.09636297 10.53125 43.0625 C10.53934692 43.98345459 10.54744385 44.90440918 10.55578613 45.85327148 C10.49469762 50.04125026 10.38274136 52.38150924 8.13867188 56.0078125 C4.42534325 59.46680355 1.00640911 61.15976451 -4.0625 61.3125 C-10.13475177 60.83057526 -10.13475177 60.83057526 -13 59 C-18.12173898 52.7400968 -17.85766382 45.78994055 -18 38 C-18.02578125 36.91106445 -18.0515625 35.82212891 -18.078125 34.70019531 C-18.15823694 30.94594972 -18.2087562 27.19236457 -18.25 23.4375 C-18.2715918 22.1997583 -18.29318359 20.9620166 -18.31542969 19.68676758 C-18.31961914 18.51009521 -18.32380859 17.33342285 -18.328125 16.12109375 C-18.3374707 15.0633374 -18.34681641 14.00558105 -18.35644531 12.91577148 C-17.85558947 8.81870207 -16.28740906 6.13347972 -13.203125 3.41796875 C-8.67776676 0.56699306 -5.49689458 -0.9161491 0 0 Z " fill="#E7D0B0" transform="translate(486,255)"/>
<path d="M0 0 C0.72691764 0.00146656 1.45383528 0.00293312 2.20278072 0.00444412 C3.03708614 -0.00112503 3.87139156 -0.00669418 4.73097897 -0.0124321 C6.10642124 0.00139008 6.10642124 0.00139008 7.50965023 0.01549149 C8.47393948 0.01344711 9.43822872 0.01140274 10.43173885 0.00929642 C13.63034464 0.00627963 16.82843941 0.02479131 20.02698421 0.0438118 C22.2413333 0.04686771 24.4556843 0.04874511 26.67003536 0.04948807 C31.31472768 0.05409665 35.95924716 0.06854483 40.60388851 0.0906868 C46.57197736 0.11898605 52.53992996 0.12989925 58.50807953 0.1343689 C63.08125339 0.13851609 67.6543994 0.14832742 72.22755909 0.16024399 C74.4288978 0.16596033 76.63023921 0.17071449 78.83158207 0.17451096 C81.90140321 0.18134926 84.97111401 0.19496958 88.04090023 0.21080399 C89.41937885 0.21248077 89.41937885 0.21248077 90.82570553 0.21419144 C97.09589248 0.25725132 97.09589248 0.25725132 98.21057796 1.3719368 C98.31995741 3.13123277 98.36644548 4.89451266 98.38635921 6.65709305 C98.41020687 7.74570633 98.43405453 8.83431961 98.45862484 9.95592117 C98.5010836 12.24740757 98.53260663 14.5391267 98.55237484 16.83092117 C98.75028591 24.66912 99.7293565 30.41739137 104.99182796 36.3953743 C105.55901546 36.84138992 106.12620296 37.28740555 106.71057796 37.7469368 C107.27776546 38.20842117 107.84495296 38.66990555 108.42932796 39.1453743 C114.83882699 43.55893284 121.70427679 43.23306577 129.21057796 42.3719368 C134.58943769 40.44651058 138.773281 37.67213535 141.77307796 32.7469368 C143.65209746 28.33532581 144.33595252 24.80525306 144.49182796 20.0203743 C144.52921078 19.00459305 144.56659359 17.9888118 144.60510921 16.9422493 C144.6756793 14.80423695 144.74598993 12.66621603 144.81604671 10.5281868 C144.85342953 9.51498367 144.89081234 8.50178055 144.92932796 7.4578743 C144.95962093 6.5302327 144.9899139 5.60259109 145.02112484 4.64683914 C145.21057796 2.3719368 145.21057796 2.3719368 146.21057796 0.3719368 C158.65072532 0.54171548 168.14362311 1.95540864 177.67932796 10.70396805 C184.98328662 18.66006587 186.52056197 26.74553736 186.33557796 37.2469368 C186.32655453 38.22146805 186.31753109 39.1959993 186.30823421 40.2000618 C186.28479419 42.59094408 186.25198238 44.98130941 186.21057796 47.3719368 C179.58557796 47.4969368 179.58557796 47.4969368 176.21057796 46.3719368 C172.12412335 45.97400489 168.38748457 45.99746652 164.46057796 47.2469368 C158.46371551 52.91064023 156.24345096 61.60404811 154.21057796 69.3719368 C146.99820904 70.3692511 139.92692446 70.4927996 132.65099049 70.44710159 C130.56875623 70.43416235 128.48658681 70.42777848 126.40431881 70.42296219 C121.98554249 70.41162077 117.56682034 70.39237891 113.14807796 70.3719368 C108.0183215 70.34822602 102.88859633 70.3278739 97.75879765 70.31599808 C95.72045939 70.30957864 93.68221905 70.29707526 91.64391232 70.28429031 C85.38200994 70.26776489 79.40622631 70.50294382 73.21057796 71.3719368 C71.15386222 71.14341283 69.09726093 70.91068608 67.04651546 70.63365555 C63.16103294 70.27507796 59.29816956 70.25311369 55.39807796 70.2469368 C54.65630306 70.24250565 53.91452816 70.23807449 53.15027523 70.23350906 C49.17481108 70.21128212 49.17481108 70.21128212 45.28259945 70.90709305 C42.77856193 71.46885662 40.81098958 71.24857728 38.26526546 70.9422493 C31.94322103 70.2888243 25.68680007 70.22414533 19.33557796 70.2469368 C18.23471859 70.24306961 17.13385921 70.23920242 15.99964046 70.23521805 C14.93745296 70.23650711 13.87526546 70.23779617 12.78089046 70.2391243 C11.35413998 70.24081619 11.35413998 70.24081619 9.89856625 70.24254227 C7.17659276 70.30469007 7.17659276 70.30469007 4.42493343 70.94273758 C3.69419613 71.08437332 2.96345882 71.22600906 2.21057796 71.3719368 C1.88057796 71.0419368 1.55057796 70.7119368 1.21057796 70.3719368 C-0.96204884 70.27237402 -3.1379531 70.24393961 -5.31285954 70.24254227 C-5.99414921 70.24078995 -6.67543888 70.23903763 -7.3773737 70.23723221 C-9.63974871 70.23281438 -11.90204617 70.23575142 -14.16442204 70.2391243 C-15.73001464 70.23845124 -17.29560714 70.2374812 -18.86119938 70.23622513 C-22.14652848 70.23474825 -25.43183045 70.23690239 -28.71715641 70.2415657 C-32.9376272 70.24726299 -37.1580344 70.24398394 -41.37850285 70.23799324 C-44.61258776 70.23438736 -47.84665748 70.23552634 -51.08074284 70.23812103 C-52.63734285 70.23879023 -54.19394422 70.23796214 -55.75054264 70.23564148 C-57.92239399 70.2331145 -60.094141 70.23695615 -62.26598454 70.24254227 C-63.5042902 70.24333786 -64.74259586 70.24413345 -66.01842594 70.24495316 C-68.69796946 70.05581903 -68.69796946 70.05581903 -69.78942204 71.3719368 C-69.91434592 73.80493466 -69.9754371 76.21098602 -69.9947443 78.64561844 C-70.0095937 79.78700523 -70.0095937 79.78700523 -70.02474308 80.95145035 C-70.05644828 83.47829909 -70.08115093 86.00516668 -70.10582829 88.53209305 C-70.12639004 90.27944821 -70.1473863 92.02679831 -70.16880131 93.77414322 C-70.22410245 98.38219997 -70.27347611 102.99030221 -70.3216486 107.59843826 C-70.37180506 112.29706769 -70.42752162 116.99563074 -70.48278141 121.69420242 C-70.59046128 130.92005724 -70.69188427 140.14596958 -70.78942204 149.3719368 C-71.52475163 149.43614822 -72.26008121 149.50035965 -73.01769352 149.56651688 C-73.99294987 149.65312576 -74.96820621 149.73973465 -75.97301579 149.82896805 C-77.41632267 149.95622269 -77.41632267 149.95622269 -78.88878727 150.08604813 C-81.55541034 150.34887244 -84.19743925 150.69725441 -86.85192204 151.0594368 C-88.80098454 151.2141243 -88.80098454 151.2141243 -90.78942204 151.3719368 C-93.23123931 148.93011952 -93.04026197 148.31472346 -93.04338932 144.96695328 C-93.04902897 144.04060577 -93.05466862 143.11425827 -93.06047916 142.15983963 C-93.0564307 141.14017105 -93.05238224 140.12050247 -93.0482111 139.06993484 C-93.05171574 137.99812469 -93.05522038 136.92631454 -93.05883121 135.8220253 C-93.06767102 132.25917046 -93.06178686 128.69651261 -93.05504704 125.13365555 C-93.05639413 122.65658912 -93.05833503 120.17952295 -93.06084538 117.70245743 C-93.06417965 111.82830837 -93.05715851 105.95423083 -93.04654384 100.08009225 C-93.0369639 94.10169261 -93.04649344 88.12337718 -93.05730915 82.14498043 C-93.06457296 77.02059097 -93.06221802 71.89623935 -93.05705357 66.77184868 C-93.05572614 64.32364571 -93.05733274 61.87543923 -93.06201267 59.42724037 C-93.11058651 26.83742574 -93.11058651 26.83742574 -87.78942204 18.3719368 C-87.45942204 18.3719368 -87.12942204 18.3719368 -86.78942204 18.3719368 C-86.78942204 20.6819368 -86.78942204 22.9919368 -86.78942204 25.3719368 C-87.44942204 25.7019368 -88.10942204 26.0319368 -88.78942204 26.3719368 C-90.26480822 32.03245656 -89.96356516 37.98344622 -89.9947443 43.79332352 C-90.0046439 44.93536743 -90.0145435 46.07741135 -90.02474308 47.25406265 C-90.05627001 51.01989562 -90.08108075 54.78574119 -90.10582829 58.5516243 C-90.12640541 61.16622109 -90.14740208 63.78081462 -90.16880131 66.39540482 C-90.21861628 72.56818324 -90.26359639 78.74098697 -90.30682367 84.91381466 C-90.35629204 91.94407969 -90.41117441 98.97429922 -90.46650326 106.00452018 C-90.58015132 120.46028261 -90.68702743 134.91609033 -90.78942204 149.3719368 C-89.88192204 149.2069368 -88.97442204 149.0419368 -88.03942204 148.8719368 C-82.65731032 148.23874719 -77.2086522 148.3719368 -71.78942204 148.3719368 C-71.78942204 121.9719368 -71.78942204 95.5719368 -71.78942204 68.3719368 C2.46057796 68.3719368 76.71057796 68.3719368 153.21057796 68.3719368 C153.54057796 65.4019368 153.87057796 62.4319368 154.21057796 59.3719368 C156.64537783 52.19364238 160.32840882 46.81302137 167.21057796 43.3719368 C169.09339046 43.20396805 169.09339046 43.20396805 171.33557796 43.1844368 C172.06003109 43.17025711 172.78448421 43.15607742 173.53089046 43.14146805 C177.2300582 43.45961804 180.62410953 44.41276501 184.21057796 45.3719368 C185.08271329 31.27831642 185.08271329 31.27831642 180.21057796 18.3719368 C179.7658514 17.54564774 179.32112484 16.71935867 178.86292171 15.86803055 C174.39018446 9.11134235 166.00541986 4.96924047 158.21057796 3.3719368 C154.54650165 2.89132419 150.89779238 2.5952247 147.21057796 2.3719368 C147.23152523 2.98601395 147.2524725 3.60009109 147.27405453 4.23277664 C147.3582583 7.07065697 147.40956219 9.90827332 147.46057796 12.7469368 C147.49409359 13.71244461 147.52760921 14.67795242 147.56214046 15.67271805 C147.68258986 24.64619807 145.61641742 32.771981 139.21057796 39.3719368 C133.06005188 45.19000202 126.45770276 45.91075594 118.27698421 45.7469368 C111.69355921 44.94183005 106.31623057 41.91066522 101.77307796 37.1219368 C93.98855736 25.72995543 96.21057796 16.71528343 96.21057796 2.3719368 C63.87057796 2.3719368 31.53057796 2.3719368 -1.78942204 2.3719368 C-1.78942204 9.3019368 -1.78942204 16.2319368 -1.78942204 23.3719368 C-3.6681227 30.53883193 -5.67566179 35.11612765 -10.78942204 40.3719368 C-11.44942204 40.0419368 -12.10942204 39.7119368 -12.78942204 39.3719368 C-12.39110172 38.9800618 -11.99278141 38.5881868 -11.58239079 38.1844368 C-3.88960967 29.49964255 -3.2803947 16.86026553 -3.87926579 5.72740555 C-3.7661119 2.76080597 -3.15447767 0.65566775 0 0 Z " fill="#532D22" transform="translate(360.7894220352173,281.6280632019043)"/>
<path d="M0 0 C0.33 0 0.66 0 1 0 C1 2.31 1 4.62 1 7 C0.01 7.495 0.01 7.495 -1 8 C-2.47538619 13.66051977 -2.17414312 19.61150942 -2.20532227 25.42138672 C-2.21522186 26.56343063 -2.22512146 27.70547455 -2.23532104 28.88212585 C-2.26684798 32.64795882 -2.29165871 36.41380439 -2.31640625 40.1796875 C-2.33698337 42.7942843 -2.35798005 45.40887782 -2.37937927 48.02346802 C-2.42919425 54.19624644 -2.47417436 60.36905017 -2.51740164 66.54187787 C-2.56687 73.57214289 -2.62175238 80.60236242 -2.67708123 87.63258338 C-2.79072929 102.08834581 -2.89760539 116.54415353 -3 131 C-2.0925 130.835 -1.185 130.67 -0.25 130.5 C5.13211171 129.86681039 10.58076984 130 16 130 C16 103.6 16 77.2 16 50 C88.27 50 160.54 50 235 50 C235 50.33 235 50.66 235 51 C217.25163262 51.82816904 199.56270428 52.09912109 181.79833984 51.96289062 C180.61324326 51.95654602 180.61324326 51.95654602 179.40420532 51.95007324 C177.93100856 51.94200168 176.4578254 51.92975114 174.98471069 51.91223145 C171.51981876 51.89537597 168.16693846 52.06363238 164.73925781 52.53125 C161.22743888 52.97148847 158.32131598 52.73255058 154.8359375 52.26171875 C150.95045497 51.90314116 147.08759159 51.8811769 143.1875 51.875 C142.4457251 51.87056885 141.7039502 51.8661377 140.93969727 51.86157227 C136.96423312 51.83934532 136.96423312 51.83934532 133.07202148 52.53515625 C130.56798397 53.09691982 128.60041162 52.87664048 126.0546875 52.5703125 C119.73264307 51.9168875 113.4762221 51.85220853 107.125 51.875 C106.02414062 51.87113281 104.92328125 51.86726563 103.7890625 51.86328125 C102.726875 51.86457031 101.6646875 51.86585938 100.5703125 51.8671875 C99.14356201 51.86887939 99.14356201 51.86887939 97.68798828 51.87060547 C94.96601479 51.93275327 94.96601479 51.93275327 92.21435547 52.57080078 C91.48361816 52.71243652 90.75288086 52.85407227 90 53 C89.67 52.67 89.34 52.34 89 52 C86.8273732 51.90043722 84.65146894 51.87200281 82.4765625 51.87060547 C81.79527283 51.86885315 81.11398315 51.86710083 80.41204834 51.86529541 C78.14967333 51.86087758 75.88737587 51.86381462 73.625 51.8671875 C72.0594074 51.86651444 70.4938149 51.8655444 68.92822266 51.86428833 C65.64289355 51.86281145 62.35759158 51.86496559 59.07226562 51.86962891 C54.85179484 51.8753262 50.63138764 51.87204714 46.41091919 51.86605644 C43.17683428 51.86245056 39.94276455 51.86358954 36.7086792 51.86618423 C35.15207919 51.86685343 33.59547782 51.86602534 32.03887939 51.86370468 C29.86702804 51.8611777 27.69528104 51.86501935 25.5234375 51.87060547 C24.28513184 51.87140106 23.04682617 51.87219666 21.77099609 51.87301636 C19.09145258 51.68388223 19.09145258 51.68388223 18 53 C17.87507611 55.43299787 17.81398493 57.83904923 17.79467773 60.27368164 C17.77982834 61.41506844 17.77982834 61.41506844 17.76467896 62.57951355 C17.73297376 65.1063623 17.7082711 67.63322988 17.68359375 70.16015625 C17.66303199 71.90751141 17.64203574 73.65486151 17.62062073 75.40220642 C17.56531959 80.01026318 17.51594592 84.61836541 17.46777344 89.22650146 C17.41761697 93.92513089 17.36190042 98.62369394 17.30664062 103.32226562 C17.19896076 112.54812044 17.09753777 121.77403278 17 131 C16.26467041 131.06421143 15.52934082 131.12842285 14.77172852 131.19458008 C13.79647217 131.28118896 12.82121582 131.36779785 11.81640625 131.45703125 C10.37309937 131.58428589 10.37309937 131.58428589 8.90063477 131.71411133 C6.23401169 131.97693564 3.59198279 132.32531761 0.9375 132.6875 C-1.0115625 132.8421875 -1.0115625 132.8421875 -3 133 C-5.44181728 130.55818272 -5.25083994 129.94278666 -5.25396729 126.59501648 C-5.25960693 125.66866898 -5.26524658 124.74232147 -5.27105713 123.78790283 C-5.26700867 122.76823425 -5.26296021 121.74856567 -5.25878906 120.69799805 C-5.2622937 119.6261879 -5.26579834 118.55437775 -5.26940918 117.4500885 C-5.27824898 113.88723367 -5.27236483 110.32457581 -5.265625 106.76171875 C-5.26697209 104.28465232 -5.26891299 101.80758615 -5.27142334 99.33052063 C-5.27475761 93.45637157 -5.26773647 87.58229403 -5.2571218 81.70815545 C-5.24754187 75.72975581 -5.25707141 69.75144038 -5.26788712 63.77304363 C-5.27515093 58.64865417 -5.27279598 53.52430255 -5.26763153 48.39991188 C-5.26630411 45.95170891 -5.26791071 43.50350243 -5.27259064 41.05530357 C-5.32116448 8.46548894 -5.32116448 8.46548894 0 0 Z " fill="#502F25" transform="translate(273,300)"/>
<path d="M0 0 C1.16917969 0.51691406 2.33835937 1.03382813 3.54296875 1.56640625 C12.70662546 5.79884983 21.27550199 10.46588239 25.44140625 20.09375 C26.73703814 24.51520707 25.24309729 27.47640583 23.375 31.5 C15.27591082 44.50417136 -3.47560127 50.30729123 -17.5625 53.6875 C-39.2756393 57.97854157 -63.56145469 57.28071263 -85 52 C-86.99712782 51.64986917 -88.99647708 51.31145947 -91 51 C-91 50.34 -91 49.68 -91 49 C-92.918125 48.6596875 -92.918125 48.6596875 -94.875 48.3125 C-100.40063852 47.09232746 -105.06925032 44.71448937 -110 42 C-111.03125 41.443125 -112.0625 40.88625 -113.125 40.3125 C-113.74375 39.879375 -114.3625 39.44625 -115 39 C-115 38.34 -115 37.68 -115 37 C-115.99 37 -116.98 37 -118 37 C-121.6462144 31.5894883 -123.72141413 26.63497784 -123 20 C-119.55536048 11.16500408 -111.76733856 6.21340719 -103.5 2.375 C-73.75425829 -10.0267097 -29.80713642 -13.19608727 0 0 Z M-115.8125 12.5625 C-119.97382072 17.19940023 -121.85416657 19.91886311 -121.67578125 26.265625 C-120.07194307 32.75514363 -114.13600114 37.96156389 -108.5625 41.375 C-102.15943523 44.29569621 -95.69237276 46.82108794 -89 49 C-88.28070313 49.31453125 -87.56140625 49.6290625 -86.8203125 49.953125 C-60.67889104 59.65658892 -20.98576796 56.45043141 4 45 C11.06066391 41.34893166 19.91274581 36.71813547 23 29 C23.82516187 24.58385591 24.00604521 20.77703313 21.74609375 16.78515625 C19.96669302 14.63418693 18.11236155 12.82413278 16 11 C15.07380859 10.19949219 15.07380859 10.19949219 14.12890625 9.3828125 C-16.68422579 -13.80211726 -87.24558898 -13.46513004 -115.8125 12.5625 Z " fill="#431C14" transform="translate(360,449)"/>
<path d="M0 0 C1.36125577 4.50133042 0.50923719 6.99850838 -1.1875 11.3125 C-3.67711372 18.14733471 -5.10955784 25.02156858 -6.3125 32.1875 C-6.48354248 33.17210205 -6.65458496 34.1567041 -6.83081055 35.17114258 C-9.59644518 52.43875955 -7.40092113 68.16915267 0 84 C9.01929191 103.61159735 14.49431048 123.6937247 7.265625 145.0234375 C5.28251524 149.68741785 2.89500628 153.847857 0 158 C-0.50917969 158.76570312 -1.01835937 159.53140625 -1.54296875 160.3203125 C-4.24273428 164.19298388 -6.18169932 166.86628219 -11 168 C-12.19139855 163.74725946 -11.68205685 160.92191278 -10.5625 156.6875 C-6.37321015 138.10722374 -10.23143366 122.29539816 -18.75 105.5625 C-20 103 -20 103 -20 101 C-20.66 100.67 -21.32 100.34 -22 100 C-32.03875516 82.77472651 -35.45241742 63.53531074 -31 44 C-27.75311702 32.94898382 -13.57586621 0 0 0 Z M-3 3 C-11.0254979 10.36162399 -16.71437072 17.42294314 -22 27 C-22.39703125 27.66128906 -22.7940625 28.32257813 -23.203125 29.00390625 C-31.58649772 43.87441262 -33.52994415 62.1817439 -29.75 78.6875 C-29.20902375 80.47172901 -28.62967909 82.24511176 -28 84 C-27.74476563 84.71285156 -27.48953125 85.42570312 -27.2265625 86.16015625 C-25.44196137 90.53979664 -23.11299111 94.58024779 -20.75854492 98.67041016 C-16.41129106 106.2290769 -12.6601085 113.65083593 -10 122 C-9.75507813 122.76699219 -9.51015625 123.53398437 -9.2578125 124.32421875 C-5.99130272 137.14415096 -7.38088076 152.18502371 -10 165 C-2.99787706 162.26479573 1.34266053 153.85596939 4.375 147.3125 C10.92116569 132.04830991 9.80773591 112.30556161 4 97 C2.37412768 93.0764073 0.6636302 89.19287056 -1.0625 85.3125 C-12.28427738 60.07770054 -11.20840576 34.17917785 -2.48168945 8.14208984 C-1.76865381 5.83294584 -1.76865381 5.83294584 -3 3 Z " fill="#492118" transform="translate(226,253)"/>
<path d="M0 0 C6.50760797 1.57760193 10.18694512 7.04797474 13.5234375 12.48046875 C19.05476478 23.30332589 19.09840074 35.40446996 16 47 C14.03764779 52.84439681 11.33216826 58.33543884 8.625 63.86328125 C-0.83395282 83.22635598 -6.05912845 100.53467936 -6.625 122.25 C-6.66367188 123.48363281 -6.70234375 124.71726562 -6.7421875 125.98828125 C-6.8353276 128.99204937 -6.92114531 131.99582878 -7 135 C-8.32 135.33 -9.64 135.66 -11 136 C-22.70729477 122.12468768 -27.7563697 107.67036068 -26.32470703 89.62011719 C-25.48658359 82.85715424 -23.62963749 76.27925559 -21 70 C-20.01 69.505 -20.01 69.505 -19 69 C-19.28903262 70.50050978 -19.58139919 72.00037738 -19.875 73.5 C-20.03742188 74.3353125 -20.19984375 75.170625 -20.3671875 76.03125 C-20.85023069 78.29737854 -21.42628285 80.54387833 -22.04296875 82.77734375 C-25.58192003 96.8634322 -23.27807561 111.78517791 -16.109375 124.30078125 C-14.89676331 126.2010325 -13.6494589 128.07998294 -12.35546875 129.92578125 C-11 132 -11 132 -11 134 C-10.34 134 -9.68 134 -9 134 C-9.01571045 133.23034912 -9.0314209 132.46069824 -9.04760742 131.66772461 C-9.54164027 103.78717878 -4.6342086 83.75508792 7.77319336 58.95556641 C13.92207338 46.52346939 17.69022545 34.45003129 14.12109375 20.5859375 C11.58147495 13.96448914 7.62311852 6.31155926 1 3 C1.01160156 4.01320312 1.02320313 5.02640625 1.03515625 6.0703125 C1.04454209 7.42187314 1.05364143 8.7734358 1.0625 10.125 C1.07087891 10.79015625 1.07925781 11.4553125 1.08789062 12.140625 C1.10782292 16.20681354 0.78890161 20.0120092 0 24 C-0.33 24 -0.66 24 -1 24 C-1.02901394 20.5625177 -1.04680335 17.12506688 -1.0625 13.6875 C-1.07087891 12.71103516 -1.07925781 11.73457031 -1.08789062 10.72851562 C-1.09272461 9.32182617 -1.09272461 9.32182617 -1.09765625 7.88671875 C-1.10551147 6.59060669 -1.10551147 6.59060669 -1.11352539 5.26831055 C-1 3 -1 3 0 0 Z " fill="#401811" transform="translate(256,195)"/>
<path d="M0 0 C4.49316995 4.09671378 7.97813973 8.71434062 11 14 C11 14.66 11 15.32 11 16 C11.66 16 12.32 16 13 16 C14.53815394 20.61446183 14.18443162 25.22980303 14.1875 30.0625 C14.19974609 31.08150391 14.21199219 32.10050781 14.22460938 33.15039062 C14.22654297 34.12298828 14.22847656 35.09558594 14.23046875 36.09765625 C14.23457764 36.98976807 14.23868652 37.88187988 14.24291992 38.80102539 C14 41 14 41 12 43 C11.5326333 45.8907496 11.16300658 48.71660569 10.875 51.625 C10.78863281 52.42679687 10.70226562 53.22859375 10.61328125 54.0546875 C10.40103673 56.03563635 10.19950069 58.01772718 10 60 C7 61 7 61 4 60 C2.68457031 58.15209961 2.68457031 58.15209961 1.328125 55.71484375 C-2.26466381 49.47853511 -6.23691655 43.53435037 -10.25 37.5625 C-10.96929688 36.48806641 -11.68859375 35.41363281 -12.4296875 34.30664062 C-13.75186037 32.33204725 -15.07498625 30.35809138 -16.39941406 28.38500977 C-17.6026695 26.59205638 -18.80224499 24.79663252 -20 23 C-23.58357241 22.74984127 -23.58357241 22.74984127 -27 23 C-27 25.64 -27 28.28 -27 31 C-26.34 31 -25.68 31 -25 31 C-24.74347656 31.49886719 -24.48695313 31.99773437 -24.22265625 32.51171875 C-21.3719178 37.85805315 -18.13682849 42.82239246 -14.65063477 47.77587891 C-11.68754415 51.98808586 -8.83076675 56.26050482 -6 60.5625 C-1.58741053 67.24491513 3.1108467 73.65827217 8 80 C11.47988948 78.86546069 14.77259982 77.73783087 18 76 C15.78071806 78.90802461 14.07030857 80.95312762 11 83 C8.52691366 82.77580724 7.32944718 82.29515796 5.47677612 80.63531494 C2.02746996 76.39870538 -1.13085639 72.05841252 -4.1171875 67.484375 C-4.57803741 66.78789856 -5.03888733 66.09142212 -5.51370239 65.37384033 C-6.97196646 63.16882296 -8.42394662 60.95976776 -9.875 58.75 C-11.78582285 55.84680901 -13.70016661 52.94597669 -15.6171875 50.046875 C-16.30711037 49.00044579 -16.30711037 49.00044579 -17.01097107 47.93287659 C-20.36011345 42.88224042 -23.87735715 38.00595715 -27.57397461 33.2019043 C-29 31 -29 31 -29.6875 27.0625 C-28.98591411 23.93725374 -28.20381527 22.2956409 -26 20 C-20.06575342 20 -20.06575342 20 -17.48046875 22.42578125 C-15.87779662 24.55826235 -14.4320441 26.7491386 -13 29 C-11.77187728 30.83403282 -10.54262695 32.66731086 -9.3125 34.5 C-8.64863281 35.50546875 -7.98476563 36.5109375 -7.30078125 37.546875 C-2.96109812 44.0942627 1.53755553 50.53601794 6 57 C8.50944418 44.06885637 8.50944418 44.06885637 10 31 C10.07605469 30.05898438 10.15210938 29.11796875 10.23046875 28.1484375 C10.74171375 17.23266592 6.21903527 10.52896266 0 2 C0 1.34 0 0.68 0 0 Z " fill="#411B14" transform="translate(576,368)"/>
<path d="M0 0 C1 3 1 3 0.06640625 5.34765625 C-3.69680105 12.14097852 -7.88160216 18.15877498 -13 24 C-13.59296875 24.68835938 -14.1859375 25.37671875 -14.796875 26.0859375 C-25.39713062 37.54689764 -38.90613255 43.33919471 -53.7421875 47.26953125 C-54.95696777 47.5938916 -54.95696777 47.5938916 -56.19628906 47.92480469 C-57.78019385 48.34068319 -59.36806543 48.74181776 -60.95996094 49.12597656 C-65.36429058 50.25584225 -68.09068105 51.28457252 -71 55 C-75.90320809 63.77416185 -74.25275546 76.86640203 -74.44555664 86.6497364 C-74.50109169 89.46550796 -74.56149391 92.28114044 -74.62304688 95.0967865 C-74.75305299 101.08526952 -74.8767515 107.07387471 -75 113.0625 C-75.14315965 119.98728872 -75.28901437 126.91200821 -75.43969727 133.8366375 C-75.49828143 136.57968848 -75.55298682 139.32279727 -75.60742188 142.06593323 C-75.77711555 150.19683663 -76.01477857 158.31538013 -76.48046875 166.43530273 C-76.51938232 167.12295999 -76.5582959 167.81061724 -76.59838867 168.51911259 C-77.39962896 181.43693521 -77.39962896 181.43693521 -80.74902344 184.70825195 C-83.45952738 186.26370492 -85.09429134 186.34719259 -88.203125 186.29296875 C-89.67265625 186.2784668 -89.67265625 186.2784668 -91.171875 186.26367188 C-92.18765625 186.23853516 -93.2034375 186.21339844 -94.25 186.1875 C-95.28125 186.17396484 -96.3125 186.16042969 -97.375 186.14648438 C-99.91719792 186.11117607 -102.45833223 186.06186036 -105 186 C-105 185.67 -105 185.34 -105 185 C-104.42032471 184.9906543 -103.84064941 184.98130859 -103.2434082 184.97167969 C-100.59893054 184.9177593 -97.95618107 184.83415871 -95.3125 184.75 C-94.40048828 184.73582031 -93.48847656 184.72164062 -92.54882812 184.70703125 C-88.4716999 184.55877204 -85.5994318 184.30085551 -81.91796875 182.453125 C-77.03606184 176.20905669 -78.67420192 164.77753511 -78.46875 157.16796875 C-78.42680586 155.70541869 -78.3848542 154.24286885 -78.34289551 152.78031921 C-77.85187062 135.14652904 -77.65509445 117.50782542 -77.44775391 99.86889648 C-77.40465443 96.2257163 -77.35750619 92.58260472 -77.30812073 88.93950462 C-77.28230345 86.9446781 -77.26110952 84.94979336 -77.2401123 82.95491028 C-77.15606712 76.75204658 -76.98542699 70.55872151 -76.65039062 64.36401367 C-76.59129517 63.25313889 -76.53219971 62.1422641 -76.47131348 60.99772644 C-75.73719594 56.32846985 -73.60939033 53.00404184 -70 50 C-64.91931274 46.94696183 -59.58657986 45.75523713 -53.875 44.4375 C-52.10052282 44.02396744 -50.32703764 43.60614958 -48.5546875 43.18359375 C-47.77593262 43.00368896 -46.99717773 42.82378418 -46.19482422 42.63842773 C-43.12392765 41.74516917 -40.70966464 40.70966464 -38.4375 38.4375 C-37 37 -37 37 -34 36 C-33.01 36 -32.02 36 -31 36 C-30.67 35.01 -30.34 34.02 -30 33 C-29.154375 32.7525 -28.30875 32.505 -27.4375 32.25 C-14.27036603 27.46195128 -5.67510013 11.98076695 0 0 Z " fill="#5C362C" transform="translate(668,407)"/>
<path d="M0 0 C0.99 0.495 0.99 0.495 2 1 C0.75264433 1.6509259 -0.49801832 2.29551669 -1.75 2.9375 C-2.79414062 3.47697266 -2.79414062 3.47697266 -3.859375 4.02734375 C-7.56642537 5.71175167 -10.8292839 6.12464363 -14.88482666 6.12025452 C-16.35713745 6.12231651 -16.35713745 6.12231651 -17.85919189 6.12442017 C-18.92949646 6.12082489 -19.99980103 6.11722961 -21.10253906 6.11352539 C-22.8005365 6.11374443 -22.8005365 6.11374443 -24.53283691 6.1139679 C-28.27711905 6.11327084 -32.02135154 6.10548804 -35.765625 6.09765625 C-38.36065646 6.09579134 -40.95568828 6.09436778 -43.55072021 6.09336853 C-49.68464195 6.08993958 -55.81854318 6.08205683 -61.95245719 6.07201904 C-68.93669512 6.06083806 -75.9209339 6.05534245 -82.90517855 6.05032361 C-97.27012861 6.03987369 -111.63506367 6.02228661 -126 6 C-125.98839844 6.71285156 -125.97679687 7.42570313 -125.96484375 8.16015625 C-125.95582031 9.11792969 -125.94679688 10.07570313 -125.9375 11.0625 C-125.92589844 12.00222656 -125.91429687 12.94195313 -125.90234375 13.91015625 C-126.00921595 17.29159252 -126.52155391 20.65087739 -127 24 C-89.71 24 -52.42 24 -14 24 C-14 24.33 -14 24.66 -14 25 C-25.84617999 26.23685139 -37.67037753 26.14590319 -49.56640625 26.1328125 C-51.73542797 26.13348724 -53.90444961 26.13445869 -56.07347107 26.13571167 C-60.5926893 26.13717778 -65.11188762 26.13506733 -69.63110352 26.13037109 C-75.42481581 26.12464355 -81.21848208 26.12797869 -87.01219273 26.13394356 C-91.47908375 26.13755235 -95.9459638 26.13640964 -100.41285515 26.13381577 C-102.55031273 26.13314897 -104.68777132 26.13396627 -106.82522774 26.13629532 C-109.80221339 26.13883038 -112.77912351 26.13497051 -115.75610352 26.12939453 C-117.07845505 26.13243088 -117.07845505 26.13243088 -118.42752075 26.13552856 C-119.23881943 26.13270874 -120.0501181 26.12988892 -120.88600159 26.12698364 C-121.58811547 26.12660662 -122.29022936 26.12622959 -123.01361942 26.12584114 C-125.11156788 25.99293195 -126.9804987 25.57016302 -129 25 C-128.91935365 21.7073118 -128.80649721 18.41650779 -128.6875 15.125 C-128.66494141 14.18785156 -128.64238281 13.25070312 -128.61914062 12.28515625 C-128.58369141 11.38925781 -128.54824219 10.49335937 -128.51171875 9.5703125 C-128.48553467 8.74289551 -128.45935059 7.91547852 -128.43237305 7.06298828 C-128 5 -128 5 -125 3 C-122.13031006 2.79745483 -122.13031006 2.79745483 -118.57714844 2.86474609 C-117.92663702 2.87419628 -117.2761256 2.88364647 -116.60590172 2.89338303 C-114.44011405 2.92716128 -112.27488873 2.97536263 -110.109375 3.0234375 C-108.58187456 3.04985576 -107.05435698 3.07529917 -105.52682495 3.099823 C-102.28299584 3.15354066 -99.03935229 3.21319392 -95.79571533 3.27746582 C-90.75770559 3.37665949 -85.71951901 3.45937752 -80.68115234 3.53808594 C-79.01083362 3.56432328 -77.34051501 3.59056838 -75.67019653 3.61682129 C-74.43724539 3.63616478 -74.43724539 3.63616478 -73.17938614 3.65589905 C-69.88820408 3.70811845 -66.5970598 3.76252637 -63.30591393 3.81697083 C-47.14691164 4.0862212 -47.14691164 4.0862212 -30.9864502 4.23419189 C-29.43488635 4.24457843 -27.88334814 4.26064015 -26.33190918 4.28289795 C-17.21010882 4.41170548 -8.33581951 4.16790976 0 0 Z " fill="#4D291E" transform="translate(518,528)"/>
<path d="M0 0 C0 3.95059182 -1.26705917 4.7102426 -3.875 7.625 C-16.53168615 22.73329622 -25.69620724 41.32508025 -28 61 C-28.10731445 61.8343457 -28.21462891 62.66869141 -28.32519531 63.52832031 C-29.74116724 73.99793326 -29.74116724 73.99793326 -26.88818359 83.83105469 C-23.96572894 87.08498443 -20.43710419 89.40020893 -16.78369141 91.75976562 C-13.8322799 93.81193788 -11.37927054 96.31015266 -8.875 98.875 C-8.00617187 99.73867188 -7.13734375 100.60234375 -6.2421875 101.4921875 C-4.10435227 103.88328544 -2.60346989 106.23696518 -1 109 C-0.94402145 108.43703217 -0.88804291 107.87406433 -0.83036804 107.29403687 C-0.24393585 101.41994294 0.35900416 95.5477085 0.97143555 89.67626953 C1.19765746 87.4865969 1.41970674 85.29648892 1.63745117 83.10595703 C1.95168121 79.95220405 2.28102479 76.80033603 2.61328125 73.6484375 C2.75410881 72.1855983 2.75410881 72.1855983 2.89778137 70.69320679 C3.45215773 65.58388864 4.08514199 61.38231366 7 57 C9.9375 55.9375 9.9375 55.9375 13 56 C15.375 57.125 15.375 57.125 17 59 C17.25 61.6875 17.25 61.6875 17 64 C16.79375 63.38125 16.5875 62.7625 16.375 62.125 C14.45224112 59.15346355 12.33405473 58.86975341 9 58 C6.69967094 61.70987966 6.41468824 65.56201535 6 69.80859375 C5.91878906 70.57115982 5.83757813 71.33372589 5.75390625 72.11940002 C5.49529217 74.5580655 5.24705018 76.99763824 5 79.4375 C4.67088963 82.62414971 4.33714105 85.81028398 4 88.99609375 C3.9189502 89.76585541 3.83790039 90.53561707 3.75439453 91.32870483 C3.04381173 97.92208653 2.09615345 104.45879175 1 111 C-3.7265625 110.3515625 -3.7265625 110.3515625 -6.1875 107.1875 C-7.53645663 104.81519696 -8.85693711 102.47663627 -10 100 C-10.66 100 -11.32 100 -12 100 C-12 99.34 -12 98.68 -12 98 C-13.485 97.505 -13.485 97.505 -15 97 C-15 96.34 -15 95.68 -15 95 C-15.66 95 -16.32 95 -17 95 C-17 94.34 -17 93.68 -17 93 C-17.66 93 -18.32 93 -19 93 C-19 92.34 -19 91.68 -19 91 C-19.58394531 90.72800781 -20.16789063 90.45601563 -20.76953125 90.17578125 C-22.97196431 89.01477888 -24.76695944 87.76642597 -26.6875 86.1875 C-27.59048828 85.46626953 -27.59048828 85.46626953 -28.51171875 84.73046875 C-32.99261879 79.52039338 -31.61744903 69.16762335 -31.26513672 62.61035156 C-28.94992525 39.81639115 -15.76346864 16.23594318 0 0 Z " fill="#421C15" transform="translate(591,257)"/>
<path d="M0 0 C0.33 0 0.66 0 1 0 C1 2.31 1 4.62 1 7 C0.01 7.495 0.01 7.495 -1 8 C-2.47538619 13.66051977 -2.17414312 19.61150942 -2.20532227 25.42138672 C-2.21522186 26.56343063 -2.22512146 27.70547455 -2.23532104 28.88212585 C-2.26684798 32.64795882 -2.29165871 36.41380439 -2.31640625 40.1796875 C-2.33698337 42.7942843 -2.35798005 45.40887782 -2.37937927 48.02346802 C-2.42919425 54.19624644 -2.47417436 60.36905017 -2.51740164 66.54187787 C-2.56687 73.57214289 -2.62175238 80.60236242 -2.67708123 87.63258338 C-2.79072929 102.08834581 -2.89760539 116.54415353 -3 131 C-2.0925 130.835 -1.185 130.67 -0.25 130.5 C5.13211171 129.86681039 10.58076984 130 16 130 C16 103.6 16 77.2 16 50 C17.485 50.495 17.485 50.495 19 51 C18.67 51.66 18.34 52.32 18 53 C17.87790384 55.47072509 17.81437914 57.91517208 17.79467773 60.38720703 C17.77982834 61.52881287 17.77982834 61.52881287 17.76467896 62.69348145 C17.73303322 65.21489324 17.70829443 67.73632388 17.68359375 70.2578125 C17.66302687 72.00373836 17.64203047 73.74965922 17.62062073 75.49557495 C17.56537254 80.09539742 17.5159754 84.69526503 17.46777344 89.29516602 C17.41757845 93.98718289 17.36188195 98.67913405 17.30664062 103.37109375 C17.19902546 112.58067306 17.09758796 121.79030937 17 131 C16.26467041 131.06421143 15.52934082 131.12842285 14.77172852 131.19458008 C13.79647217 131.28118896 12.82121582 131.36779785 11.81640625 131.45703125 C10.37309937 131.58428589 10.37309937 131.58428589 8.90063477 131.71411133 C6.23401169 131.97693564 3.59198279 132.32531761 0.9375 132.6875 C-1.0115625 132.8421875 -1.0115625 132.8421875 -3 133 C-5.44181728 130.55818272 -5.25083994 129.94278666 -5.25396729 126.59501648 C-5.25960693 125.66866898 -5.26524658 124.74232147 -5.27105713 123.78790283 C-5.26700867 122.76823425 -5.26296021 121.74856567 -5.25878906 120.69799805 C-5.2622937 119.6261879 -5.26579834 118.55437775 -5.26940918 117.4500885 C-5.27824898 113.88723367 -5.27236483 110.32457581 -5.265625 106.76171875 C-5.26697209 104.28465232 -5.26891299 101.80758615 -5.27142334 99.33052063 C-5.27475761 93.45637157 -5.26773647 87.58229403 -5.2571218 81.70815545 C-5.24754187 75.72975581 -5.25707141 69.75144038 -5.26788712 63.77304363 C-5.27515093 58.64865417 -5.27279598 53.52430255 -5.26763153 48.39991188 C-5.26630411 45.95170891 -5.26791071 43.50350243 -5.27259064 41.05530357 C-5.32116448 8.46548894 -5.32116448 8.46548894 0 0 Z " fill="#462119" transform="translate(273,300)"/>
<path d="M0 0 C0.556875 1.3303125 0.556875 1.3303125 1.125 2.6875 C7.45088848 13.86323632 23.0501323 18.50969357 34.78125 21.87109375 C46.04244302 24.94353318 57.28944762 27.62643175 69 28 C70.40958984 28.05994141 70.40958984 28.05994141 71.84765625 28.12109375 C87.3232076 28.46055746 102.72476845 26.93917058 117.56665039 22.5012207 C123.3900798 20.82863034 123.3900798 20.82863034 127.05859375 21.859375 C127.69925781 22.23578125 128.33992187 22.6121875 129 23 C127.25 27.875 127.25 27.875 125 29 C125.66 27.02 126.32 25.04 127 23 C126.01902344 23.25394531 125.03804687 23.50789062 124.02734375 23.76953125 C122.66411412 24.11738985 121.30082978 24.46503411 119.9375 24.8125 C119.30005859 24.97814453 118.66261719 25.14378906 118.00585938 25.31445312 C115.67669846 25.90510159 113.3404942 26.45588803 111 27 C109.9076001 27.26167969 108.8152002 27.52335938 107.68969727 27.79296875 C98.75235251 29.77996527 90.34795174 30.47172775 81.22094727 30.39111328 C79.06657405 30.37503041 76.91408276 30.39107201 74.75976562 30.41015625 C64.86862392 30.42491453 55.64397314 29.14189937 46 27 C45.16573486 26.82162598 44.33146973 26.64325195 43.47192383 26.45947266 C9.77755465 19.00763966 9.77755465 19.00763966 0 6 C-0.6875 3.78515625 -0.6875 3.78515625 -1 2 C-7.27754061 5.6106116 -12.25170589 9.09817543 -15 16 C-15.62199052 19.00706695 -15.92189343 21.9325418 -16 25 C-16.33 25 -16.66 25 -17 25 C-17.78217465 18.0618212 -17.01020336 13.67418911 -12.78515625 8.05078125 C-5.77714286 0 -5.77714286 0 0 0 Z " fill="#4B251C" transform="translate(232,522)"/>
<path d="M0 0 C4.93918408 2.61486216 8.48734878 5.97469756 11 11 C11.11149426 13.91946312 11.16412684 16.81431362 11.16796875 19.734375 C11.17129715 20.60515686 11.17462555 21.47593872 11.17805481 22.37310791 C11.18312375 24.21911083 11.18546315 26.06512294 11.18530273 27.91113281 C11.18748047 30.7247652 11.20561215 33.53799998 11.22460938 36.3515625 C11.22754512 38.14583199 11.2295287 39.94010335 11.23046875 41.734375 C11.23765427 42.57208435 11.24483978 43.4097937 11.25224304 44.27288818 C11.2320784 49.47635538 11.17412616 54.65695677 7.44140625 58.6796875 C1.65096158 62.36342153 -3.24427127 62.55883785 -10 62 C-10 61.34 -10 60.68 -10 60 C-10.5775 59.95875 -11.155 59.9175 -11.75 59.875 C-14.38883153 58.84878774 -15.70834762 57.59605507 -17.18359375 55.18359375 C-19.09749677 50.06458997 -18.87233767 44.40243774 -19 39 C-19.02835937 38.01644531 -19.05671875 37.03289062 -19.0859375 36.01953125 C-19.12746712 33.00863375 -19.06817352 30.01039921 -19 27 C-19.00338379 26.32469238 -19.00676758 25.64938477 -19.01025391 24.95361328 C-19.07245087 10.20638468 -19.07245087 10.20638468 -14.6875 5.0625 C-10.14624773 0.73796693 -6.30616002 -0.65236138 0 0 Z M-15.14868164 8.60546875 C-17.47148572 12.86450447 -17.56454803 15.92595424 -17.49609375 20.6875 C-17.49754898 21.50822998 -17.49900421 22.32895996 -17.50050354 23.17456055 C-17.49885023 24.90254278 -17.48735281 26.63054061 -17.46655273 28.35839844 C-17.43758603 30.99217758 -17.44595758 33.62394225 -17.45898438 36.2578125 C-17.45274628 37.94271804 -17.44435479 39.62761727 -17.43359375 41.3125 C-17.43652939 42.09391357 -17.43946503 42.87532715 -17.44248962 43.68041992 C-17.35993088 48.50324046 -16.63013447 51.81002947 -14 56 C-10.87540675 58.81975489 -8.53377851 60.82165366 -4.3125 61.3125 C-0.20778565 60.9252628 2.9206508 59.7885632 6 57 C9.2121175 51.86608578 9.44141254 47.701518 9.3984375 41.83984375 C9.40130768 40.97235001 9.40417786 40.10485626 9.40713501 39.21107483 C9.40916879 37.38476912 9.40368708 35.55844129 9.39111328 33.73217773 C9.37502998 30.94270034 9.39099502 28.15466743 9.41015625 25.36523438 C9.40817408 23.58593432 9.40433094 21.80663515 9.3984375 20.02734375 C9.40451019 19.19702133 9.41058289 18.36669891 9.4168396 17.51121521 C9.36028761 12.84013505 8.97950977 9.82097319 6 6 C2.95895144 3.43020351 -0.15068357 2.13866391 -4.0625 1.5 C-9.05861552 2.35040264 -11.96993571 4.75095489 -15.14868164 8.60546875 Z " fill="#40150F" transform="translate(337,254)"/>
<path d="M0 0 C0.98518324 2.95554971 1.11146664 4.80201784 1.08229065 7.87846375 C1.07525116 8.88387207 1.06821167 9.8892804 1.06095886 10.92515564 C1.04801285 12.0271077 1.03506683 13.12905975 1.02172852 14.2644043 C1.01212097 15.42551727 1.00251343 16.58663025 0.99261475 17.78292847 C0.95957008 21.63008586 0.91925839 25.47713163 0.87890625 29.32421875 C0.85461048 31.9879376 0.83071625 34.651657 0.80735779 37.31538391 C0.75122538 43.61582785 0.68986632 49.91620966 0.62663645 56.21658593 C0.55490489 63.38939669 0.48898934 70.56225718 0.42356598 77.73512781 C0.28885574 92.49014897 0.14682978 107.24509435 0 122 C1.32 122.33 2.64 122.66 4 123 C1.03 123.495 1.03 123.495 -2 124 C-2.04677154 108.86600695 -2.08201408 93.73201724 -2.10362434 78.5979681 C-2.11392616 71.57057717 -2.1279655 64.54323121 -2.15087891 57.51586914 C-2.17298218 50.73372026 -2.18457013 43.95161813 -2.18975449 37.1694355 C-2.193449 34.58229398 -2.2006634 31.995155 -2.21146011 29.40803337 C-2.22598382 25.78360347 -2.22797754 22.15936644 -2.22705078 18.53491211 C-2.23783661 16.93160789 -2.23783661 16.93160789 -2.24884033 15.2959137 C-2.23362848 9.79574353 -1.84302736 5.19562781 0 0 Z " fill="#E4D8BC" transform="translate(272,307)"/>
<path d="M0 0 C3.47256611 1.28161491 6.39063686 2.77858436 9.4375 4.875 C10.15808594 5.36742187 10.87867188 5.85984375 11.62109375 6.3671875 C12.40613281 6.90601563 13.19117188 7.44484375 14 8 C15.02552979 8.41169434 16.05105957 8.82338867 17.10766602 9.24755859 C20.55597374 12.52908314 20.47382849 13.41383778 20.71289062 18.01855469 C20.7254918 20.5697002 20.70431547 23.1211512 20.65625 25.671875 C20.65012816 27.03703986 20.64638098 28.40221724 20.64489746 29.76739502 C20.63569714 32.62927087 20.60688978 35.49001925 20.5625 38.3515625 C20.50614879 42.00081023 20.48409742 45.64916759 20.4751358 49.29880905 C20.46476271 52.79827663 20.43570997 56.29752589 20.40625 59.796875 C20.39350037 61.75037872 20.39350037 61.75037872 20.38049316 63.74334717 C20.13808589 79.23225723 15.86169032 89.84183674 5 101 C4.34 100.67 3.68 100.34 3 100 C3.76183594 99.25169922 3.76183594 99.25169922 4.5390625 98.48828125 C13.04788515 89.61297373 18.13957464 79.2979563 18.11352539 66.92456055 C18.11344986 65.72369308 18.11337433 64.52282562 18.11329651 63.28556824 C18.10813522 61.99894791 18.10297394 60.71232758 18.09765625 59.38671875 C18.09578956 58.04865064 18.09436684 56.71058185 18.09336853 55.37251282 C18.08956314 51.8626413 18.07974988 48.35281161 18.06866455 44.84295654 C18.05840777 41.25663824 18.05386179 37.67031314 18.04882812 34.08398438 C18.03812572 27.05597247 18.02107321 20.02798825 18 13 C17.443125 12.69707031 16.88625 12.39414062 16.3125 12.08203125 C11.09638699 9.2184557 6.01098444 6.20866851 1 3 C1.00444122 3.82605743 1.00888245 4.65211487 1.01345825 5.50320435 C1.05358856 13.30087885 1.08401163 21.09851849 1.10362434 28.89627266 C1.1140465 32.90485171 1.12817696 36.91334519 1.15087891 40.921875 C1.17266335 44.79277255 1.18458042 48.66358795 1.18975449 52.53454208 C1.1934402 54.00887214 1.20063748 55.48319788 1.21146011 56.95749283 C1.22604972 59.02791186 1.22797486 61.09799458 1.22705078 63.16845703 C1.231492 64.34538116 1.23593323 65.5223053 1.24050903 66.7348938 C0.99102616 70.1218272 0.21094867 72.83934262 -1 76 C-1.99239552 72.81441726 -1.96664893 70.37040268 -1.56640625 67.07177734 C-0.9040902 60.64994283 -0.89105248 54.30218677 -0.9375 47.8515625 C-0.94128662 46.63600677 -0.94507324 45.42045105 -0.94897461 44.1680603 C-0.96109742 40.3203358 -0.97973631 36.47268969 -1 32.625 C-1.02659222 27.53385627 -1.04656501 22.44274946 -1.0625 17.3515625 C-1.07079834 16.18694489 -1.07909668 15.02232727 -1.08764648 13.82241821 C-1.09094971 12.73713837 -1.09425293 11.65185852 -1.09765625 10.53369141 C-1.10289307 9.58313873 -1.10812988 8.63258606 -1.11352539 7.65322876 C-1.00016821 5.00393134 -0.59177169 2.58102991 0 0 Z " fill="#411711" transform="translate(529,442)"/>
<path d="M0 0 C9.7399741 0.84155584 18.72045115 5.69105766 26 12 C26.80179688 12.69351562 27.60359375 13.38703125 28.4296875 14.1015625 C33.82153019 18.87063916 38.97434786 23.84800465 44 29 C43.67 29.66 43.34 30.32 43 31 C42.6189209 30.59273682 42.2378418 30.18547363 41.84521484 29.76586914 C30.35866389 17.60151901 19.34674929 7.86062634 3 3 C2.01 2.67 1.02 2.34 0 2 C-0.268125 2.83402344 -0.53625 3.66804688 -0.8125 4.52734375 C-1.85598101 7.57883919 -3.01006287 10.56139622 -4.20849609 13.55444336 C-11.3649706 31.71052072 -12.12792003 51.15542147 -7 70 C-5.36609872 74.2873832 -5.36609872 74.2873832 -2 77 C-2 78.98 -2 80.96 -2 83 C-5.24638016 80.10144629 -6.81736608 77.66142483 -8.25 73.5625 C-8.75273438 72.17224609 -8.75273438 72.17224609 -9.265625 70.75390625 C-9.99117968 68.03307622 -10.14228057 65.79987835 -10 63 C-10.66 62.67 -11.32 62.34 -12 62 C-16.41806176 41.33328889 -11.21833975 20.69543991 -2 2 C-1.34 1.34 -0.68 0.68 0 0 Z " fill="#441D15" transform="translate(532,337)"/>
<path d="M0 0 C3.41437991 1.31228836 6.63624609 2.80301712 9.875 4.5 C13.86847605 6.51440827 17.64626732 7.91156683 22 9 C24.4284262 9.76413411 26.85420597 10.53566236 29.27734375 11.31640625 C35.59866095 12.90353754 41.92181719 13.15100288 48.40234375 13.1328125 C49.16551407 13.13376923 49.92868439 13.13472595 50.71498108 13.13571167 C52.31072066 13.13638669 53.9064631 13.13458019 55.50219727 13.13037109 C57.95530222 13.12496074 60.40822839 13.13036547 62.86132812 13.13671875 C64.41666707 13.13605886 65.97200591 13.13477957 67.52734375 13.1328125 C68.63033058 13.13584885 68.63033058 13.13584885 69.75559998 13.13894653 C73.1653543 13.42800421 73.1653543 13.42800421 76 12 C78.87603739 11.62048166 81.73978161 11.29079366 84.625 11 C96.482617 9.81509148 96.482617 9.81509148 107.88671875 6.5234375 C110.30044647 5.92558258 111.67101622 6.21140504 114 7 C83.85624587 19.17727816 52.36697865 18.84868529 21 12 C21 11.34 21 10.68 21 10 C20.21625 10.103125 19.4325 10.20625 18.625 10.3125 C11.13389293 9.66671491 4.82667107 5.63111625 0 0 Z " fill="#715143" transform="translate(226,558)"/>
<path d="M0 0 C1.32 0.33 2.64 0.66 4 1 C5.3069269 6.410293 4.88714759 10.76854021 3 16 C0.98193879 19.03487355 -1.35400601 21.50520567 -4 24 C-4.7425 24.721875 -5.485 25.44375 -6.25 26.1875 C-17.62516232 33.68476607 -31.28833723 37.32340615 -44.625 39.25 C-45.7792749 39.41838379 -46.9335498 39.58676758 -48.12280273 39.76025391 C-56.44573463 40.87449382 -64.66759414 41.36287039 -73.0625 41.375 C-74.63862061 41.37741699 -74.63862061 41.37741699 -76.24658203 41.37988281 C-82.69946811 41.28655809 -88.72543935 40.5060332 -95 39 C-95 38.67 -95 38.34 -95 38 C-93.28623169 38.02356567 -93.28623169 38.02356567 -91.5378418 38.04760742 C-87.20083994 38.10289926 -82.86386737 38.13670146 -78.52661133 38.16479492 C-76.66783368 38.17966003 -74.80908962 38.19995805 -72.95043945 38.22631836 C-56.91138752 38.44769634 -40.73652205 37.71614342 -25.5 32.1875 C-24.76354248 31.92888184 -24.02708496 31.67026367 -23.26831055 31.40380859 C-14.090773 28.07915374 -3.77190825 24.12232303 1 15 C1.81545639 10.97708182 2.04781897 7.09876927 2 3 C0.71416016 3.92232422 0.71416016 3.92232422 -0.59765625 4.86328125 C-1.75236466 5.68002622 -2.90732622 6.49641337 -4.0625 7.3125 C-4.90458008 7.91868164 -4.90458008 7.91868164 -5.76367188 8.53710938 C-9.68743438 11.29495388 -13.46279117 13.40407901 -18 15 C-18.99 14.67 -19.98 14.34 -21 14 C-20.5059668 13.75354736 -20.01193359 13.50709473 -19.50292969 13.25317383 C-17.24561192 12.11842411 -14.99793864 10.9657108 -12.75 9.8125 C-11.97269531 9.42513672 -11.19539063 9.03777344 -10.39453125 8.63867188 C-5.91771843 6.32373875 -2.85034954 4.31383546 0 0 Z " fill="#542E23" transform="translate(381,495)"/>
<path d="M0 0 C0.33 0 0.66 0 1 0 C1.49690205 9.97764912 -0.02558962 19.19434322 -1.875 28.9375 C-2.28326271 31.1392545 -2.6884898 33.34155073 -3.09320068 35.54396057 C-3.35919303 36.99122222 -3.62632374 38.43827512 -3.89459229 39.88511658 C-4.65839751 44.02934037 -5.35469171 48.17529305 -5.9765625 52.34375 C-7.28832451 61.11726753 -8.91500719 69.83512303 -10.5 78.5625 C-16.92077604 101.75409724 -16.92077604 101.75409724 -14.87890625 123.86328125 C-13.40839326 125.42374309 -13.40839326 125.42374309 -11 127 C-12.65 126.67 -14.3 126.34 -16 126 C-16 125.34 -16 124.68 -16 124 C-16.99 123.67 -17.98 123.34 -19 123 C-19.05454409 120.64551325 -19.0939279 118.29232125 -19.125 115.9375 C-19.14820313 114.62652344 -19.17140625 113.31554687 -19.1953125 111.96484375 C-18.99833099 107.96611901 -18.13654929 104.82217315 -17 101 C-16.4405106 97.36844398 -16.13046472 93.71016375 -15.7890625 90.05273438 C-15.3908321 86.2043182 -14.71006925 83.41571271 -13 80 C-12.45556814 77.84623118 -12.45556814 77.84623118 -12.11791992 75.53979492 C-11.97388229 74.6581366 -11.82984467 73.77647827 -11.68144226 72.86810303 C-11.532621 71.91518372 -11.38379974 70.9622644 -11.23046875 69.98046875 C-11.06903885 68.98106262 -10.90760895 67.98165649 -10.74128723 66.95196533 C-10.21718061 63.69810071 -9.70228556 60.44285106 -9.1875 57.1875 C-8.8306897 54.9615718 -8.47326599 52.73574185 -8.11523438 50.51000977 C-7.40329325 46.07817927 -6.69485574 41.64581309 -5.98974609 37.21289062 C-5.122194 31.76042237 -4.24583498 26.30943337 -3.36328125 20.859375 C-3.24365524 20.12048538 -3.12402924 19.38159576 -3.0007782 18.62031555 C-2.7744332 17.22234798 -2.54806995 15.82438335 -2.32168579 14.42642212 C-1.54401374 9.6182236 -0.77208979 4.80909753 0 0 Z " fill="#451D15" transform="translate(574,465)"/>
<path d="M0 0 C4.35412188 2.30512335 7.39422397 4.82418226 10 9 C10.58695104 12.31366809 10.56077635 15.57913451 10.53125 18.9375 C10.5350769 19.89519287 10.53890381 20.85288574 10.54284668 21.83959961 C10.5455632 23.86019952 10.53822023 25.88083476 10.52148438 27.90136719 C10.50007119 30.98973175 10.52129501 34.07577007 10.546875 37.1640625 C10.54423168 39.13021345 10.53910661 41.09636297 10.53125 43.0625 C10.53934692 43.98345459 10.54744385 44.90440918 10.55578613 45.85327148 C10.49469762 50.04125026 10.38274136 52.38150924 8.13867188 56.0078125 C4.42534325 59.46680355 1.00640911 61.15976451 -4.0625 61.3125 C-10.13475177 60.83057526 -10.13475177 60.83057526 -13 59 C-18.12173898 52.7400968 -17.85766382 45.78994055 -18 38 C-18.02578125 36.91106445 -18.0515625 35.82212891 -18.078125 34.70019531 C-18.15823694 30.94594972 -18.2087562 27.19236457 -18.25 23.4375 C-18.2715918 22.1997583 -18.29318359 20.9620166 -18.31542969 19.68676758 C-18.31961914 18.51009521 -18.32380859 17.33342285 -18.328125 16.12109375 C-18.3374707 15.0633374 -18.34681641 14.00558105 -18.35644531 12.91577148 C-17.85558947 8.81870207 -16.28740906 6.13347972 -13.203125 3.41796875 C-8.67776676 0.56699306 -5.49689458 -0.9161491 0 0 Z M-15 8 C-17.60613253 13.21226506 -16.35626161 21.48206327 -16.4050293 27.28344727 C-16.42657838 29.21071322 -16.46064465 31.13788212 -16.50756836 33.06469727 C-16.57475712 35.84956375 -16.60206057 38.63240474 -16.62109375 41.41796875 C-16.64892441 42.27239059 -16.67675507 43.12681244 -16.70542908 44.00712585 C-16.68604204 49.6940736 -15.42632 52.59185161 -11.48597717 56.70796204 C-8.27851132 59.49681217 -5.33523056 59.27380349 -1.25390625 59.21484375 C1.87351354 58.91673614 3.61706865 58.03250027 6 56 C9.58200674 51.45322927 9.46743974 47.29763517 9.46875 41.75390625 C9.47636353 40.86517319 9.48397705 39.97644012 9.49182129 39.06077576 C9.50260174 37.18564659 9.50548376 35.31045748 9.50097656 33.43530273 C9.50000424 30.57498541 9.54164709 27.71735219 9.5859375 24.85742188 C9.59114502 23.03125557 9.59383269 21.20507998 9.59375 19.37890625 C9.61014526 18.52873428 9.62654053 17.67856232 9.64343262 16.80262756 C9.59501969 12.61834094 9.32565598 9.86013797 6.65039062 6.53881836 C2.46125859 2.52603427 -0.00684558 1.44700728 -5.640625 1.5390625 C-9.72634876 2.33726681 -12.32641966 4.92856544 -15 8 Z " fill="#653C2E" transform="translate(486,255)"/>
<path d="M0 0 C1.30785784 3.92357351 0.32637553 5.5849647 -0.9375 9.5 C-5.10669683 23.92047424 -4.33758728 38.36791251 2 52 C3.76460203 55.08076182 5.60699 58.01935248 7.64453125 60.92578125 C9 63 9 63 9 65 C9.66 65 10.32 65 11 65 C11 57.74 11 50.48 11 43 C11.66 43 12.32 43 13 43 C13 50.59 13 58.18 13 66 C11.02 66.495 11.02 66.495 9 67 C-2.70564588 53.12664192 -7.75731515 38.66875122 -6.32910156 20.62011719 C-5.60289877 14.83850862 -4.27582584 4.27582584 0 0 Z " fill="#421A13" transform="translate(236,264)"/>
<path d="M0 0 C0.66 0.33 1.32 0.66 2 1 C1.0479279 2.00596297 0.08812654 3.00461563 -0.875 4 C-1.40867187 4.556875 -1.94234375 5.11375 -2.4921875 5.6875 C-4 7 -4 7 -6 7 C-6.25136719 7.58265625 -6.50273438 8.1653125 -6.76171875 8.765625 C-8.1521763 11.27458941 -9.71127301 12.80546106 -11.8125 14.75 C-19.79396252 22.67352087 -21.71122331 28.68817405 -22.79394531 39.95507812 C-23.14279601 43.41713195 -23.60500063 46.86343283 -24.0625 50.3125 C-24.29646484 52.16294922 -24.29646484 52.16294922 -24.53515625 54.05078125 C-25 57 -25 57 -26 59 C-18.83169252 52.84954887 -11.92091857 46.42506007 -5 40 C-4.34 40.33 -3.68 40.66 -3 41 C-7.58564154 45.69540424 -12.25711382 50.19552488 -17.25 54.45703125 C-19.15095038 56.07991134 -19.15095038 56.07991134 -21.25 58.4375 C-23 60 -23 60 -27 60 C-27.02684679 57.35409986 -27.04676357 54.70846904 -27.0625 52.0625 C-27.07087891 51.30775391 -27.07925781 50.55300781 -27.08789062 49.77539062 C-27.09652441 47.85005687 -27.05224333 45.92464419 -27 44 C-26.505 43.505 -26.505 43.505 -26 43 C-25.58451471 39.72522049 -25.23082093 36.45266869 -24.92578125 33.16601562 C-24.10860967 25.6660426 -21.45086971 21.21387537 -16 16 C-14.53429671 14.36072658 -13.07670402 12.71418366 -11.625 11.0625 C-7.98823886 6.98713451 -4.24404523 3.43135572 0 0 Z " fill="#3E160F" transform="translate(622,365)"/>
<path d="M0 0 C0.33 0 0.66 0 1 0 C1.60818859 17.22109398 1.19562811 31.37698996 -9 46 C-9.50917969 46.76570313 -10.01835937 47.53140625 -10.54296875 48.3203125 C-13.24273428 52.19298388 -15.18169932 54.86628219 -20 56 C-21.19139855 51.74725946 -20.68205685 48.92191278 -19.5625 44.6875 C-16.72528903 32.10394395 -17.37672138 21.19698715 -21.22265625 9.01171875 C-22 6 -22 6 -21 3 C-13.67399739 18.31800545 -14.08664319 36.97309802 -19 53 C-3.43434168 38.34996864 -0.85298202 20.47156859 0 0 Z " fill="#431812" transform="translate(235,365)"/>
<path d="M0 0 C0 3.8801042 -1.25171273 4.91089207 -3.625 7.9375 C-15.85827275 24.44270927 -20.88444622 42.6210602 -19 63 C-18.36827459 67.17841237 -17.42616032 71.0253532 -16 75 C-15.74476563 75.71285156 -15.48953125 76.42570312 -15.2265625 77.16015625 C-13.69931908 80.90820776 -11.78877445 84.39670739 -9.77734375 87.90234375 C-9.17237061 88.95856934 -9.17237061 88.95856934 -8.55517578 90.03613281 C-7.74210572 91.44375038 -6.91920951 92.84574903 -6.08544922 94.24121094 C-3.79209532 98.1751578 -2.42452883 101.37335534 -2 106 C-4.20540114 103.79459886 -5.2400727 101.78605258 -6.625 99 C-7.07101563 98.113125 -7.51703125 97.22625 -7.9765625 96.3125 C-9 94 -9 94 -9 92 C-9.66 91.67 -10.32 91.34 -11 91 C-21.03875516 73.77472651 -24.45241742 54.53531074 -20 35 C-17.01736631 24.84837664 -12.12246964 15.67978288 -5.875 7.1875 C-5.19179687 6.25292969 -4.50859375 5.31835938 -3.8046875 4.35546875 C-2 2 -2 2 0 0 Z " fill="#451E16" transform="translate(215,262)"/>
<path d="M0 0 C3.125 1.0625 3.125 1.0625 5.125 3.0625 C5.5274257 6.13179441 5.73941564 8.10623153 5.125 11.0625 C3.17646539 13.47831642 1.60690701 15.092837 -0.75 17 C-1.34063232 17.50942139 -1.93126465 18.01884277 -2.53979492 18.54370117 C-3.73924721 19.57728727 -4.94618975 20.60224794 -6.16064453 21.61816406 C-8.56109506 23.64053167 -10.87109471 25.75735023 -13.1875 27.875 C-16.00046199 30.39945306 -18.83132038 32.89964433 -21.6875 35.375 C-24.21390743 37.5655864 -26.68214403 39.80684052 -29.12109375 42.09375 C-29.69819092 42.63346436 -30.27528809 43.17317871 -30.86987305 43.72924805 C-32.01967514 44.80739742 -33.16582287 45.8894604 -34.30786133 46.97583008 C-36.99706329 49.49581286 -39.42734902 51.68176599 -42.875 53.0625 C-42.875 53.7225 -42.875 54.3825 -42.875 55.0625 C-43.535 54.7325 -44.195 54.4025 -44.875 54.0625 C-42.06200694 50.19463454 -38.88973453 47.23180674 -35.28125 44.1484375 C-32.42775633 41.67479201 -29.65000836 39.12321025 -26.875 36.5625 C-22.80228358 32.80939996 -18.68494809 29.11864814 -14.4921875 25.5 C-13.10610228 24.26792425 -11.7942038 22.9532618 -10.5 21.625 C-8.875 20.0625 -8.875 20.0625 -6.875 20.0625 C-6.38 18.5775 -6.38 18.5775 -5.875 17.0625 C-3.88928119 15.25652298 -1.8013328 13.62988173 0.3125 11.9765625 C2.49387224 9.67295819 2.88019304 8.19398907 3.125 5.0625 C2.63 4.0725 2.63 4.0725 2.125 3.0625 C-1.38266783 2.61687977 -2.66494439 2.91769571 -5.62890625 4.9609375 C-7.01916016 6.18683594 -7.01916016 6.18683594 -8.4375 7.4375 C-14.23600287 12.50415299 -14.23600287 12.50415299 -17.875 14.0625 C-6.48073716 0.10452802 -6.48073716 0.10452802 0 0 Z " fill="#452018" transform="translate(638.875,388.9375)"/>
<path d="M0 0 C0.01458252 0.61931396 0.02916504 1.23862793 0.04418945 1.87670898 C0.11947417 4.73087773 0.21586314 7.58397749 0.3125 10.4375 C0.34633789 11.89833008 0.34633789 11.89833008 0.38085938 13.38867188 C0.73613185 23.04562378 2.62290414 31.81744173 9.8125 38.6875 C15.89507381 43.10034766 21.66588721 43.73768773 29 43 C32.41026371 42.1962185 35.70186847 41.17890659 39 40 C34.97346223 44.40942939 29.5985974 46.11587983 23.75 46.5625 C17.48421441 46.30187807 12.06982015 43.54094125 7 40 C4.49966409 37.21060791 2.68549157 34.33460563 1 31 C0.65163086 30.41653809 0.30326172 29.83307617 -0.05566406 29.23193359 C-1.25143631 26.40573145 -1.22658237 24.20507184 -1.1953125 21.140625 C-1.18886719 20.02558594 -1.18242187 18.91054688 -1.17578125 17.76171875 C-1.15902344 16.60285156 -1.14226562 15.44398438 -1.125 14.25 C-1.11597656 13.07566406 -1.10695313 11.90132813 -1.09765625 10.69140625 C-1.07410063 7.79406464 -1.04120652 4.89713559 -1 2 C-14.32546716 2.37298356 -22.43355622 5.72749723 -32 15 C-32 12 -32 12 -30.27734375 10.0625 C-20.70409271 1.62397488 -12.59817486 0 0 0 Z " fill="#471F17" transform="translate(309,282)"/>
<path d="M0 0 C4.49316995 4.09671378 7.97813973 8.71434062 11 14 C11 14.66 11 15.32 11 16 C11.66 16 12.32 16 13 16 C14.53815394 20.61446183 14.18443162 25.22980303 14.1875 30.0625 C14.19974609 31.08150391 14.21199219 32.10050781 14.22460938 33.15039062 C14.22750977 34.60928711 14.22750977 34.60928711 14.23046875 36.09765625 C14.23457764 36.98976807 14.23868652 37.88187988 14.24291992 38.80102539 C14 41 14 41 12 43 C11.5326333 45.8907496 11.16300658 48.71660569 10.875 51.625 C10.78863281 52.42679687 10.70226562 53.22859375 10.61328125 54.0546875 C10.40103673 56.03563635 10.19950069 58.01772718 10 60 C8.515 60.495 8.515 60.495 7 61 C6.34 60.34 5.68 59.68 5 59 C5.99 59 6.98 59 8 59 C8.34339295 54.6674038 8.6740733 50.33394421 9 46 C9.09539063 44.7521875 9.19078125 43.504375 9.2890625 42.21875 C9.55939406 38.48045076 9.78720505 34.74197908 10 31 C10.11794922 29.38351562 10.11794922 29.38351562 10.23828125 27.734375 C10.71787842 17.04620945 6.08929044 10.35102689 0 2 C0 1.34 0 0.68 0 0 Z " fill="#492118" transform="translate(576,368)"/>
<path d="M0 0 C2.93432586 0.32603621 3.9454121 0.94200036 6 3.125 C20.91739858 18.91181751 47.64487896 21.41497008 68 23 C68 23.33 68 23.66 68 24 C45.89701333 24.35270723 22.35566356 20.94992802 5 6 C3.67233757 4.99248312 2.34029357 3.99065177 1 3 C1.34773428 9.63093294 1.96089654 15.053928 5 21 C4.34 21 3.68 21 3 21 C-0.26830879 17.07802945 -0.47637869 13.20340048 -0.7890625 8.3046875 C-0.92606195 5.84107365 -0.92606195 5.84107365 -2 3 C-1.34 2.01 -0.68 1.02 0 0 Z " fill="#4E271E" transform="translate(215,564)"/>
<path d="M0 0 C1.81242052 -0.02687279 3.62495233 -0.04633715 5.4375 -0.0625 C6.44683594 -0.07410156 7.45617187 -0.08570313 8.49609375 -0.09765625 C11 0 11 0 12 1 C12.10937945 2.75929597 12.15586752 4.52257586 12.17578125 6.28515625 C12.19962891 7.37376953 12.22347656 8.46238281 12.24804688 9.58398438 C12.29050563 11.87547078 12.32202867 14.16718991 12.34179688 16.45898438 C12.53970794 24.2971832 13.51877854 30.04545457 18.78125 36.0234375 C19.63203125 36.69246094 19.63203125 36.69246094 20.5 37.375 C21.0671875 37.83648437 21.634375 38.29796875 22.21875 38.7734375 C26.76896705 41.906701 29.89751254 42.24815685 35.5 42.1875 C36.8096875 42.18105469 38.119375 42.17460937 39.46875 42.16796875 C42.20519436 42.03780602 44.41465687 41.82440789 47 41 C44.36311178 43.88802043 42.39094926 44.85180145 38.43359375 45.2734375 C29.92212891 45.56196173 23.71382918 44.01622233 17.15234375 38.42578125 C10.00025366 30.8870917 9.56850315 21.85378213 9.8125 11.9375 C9.82603516 10.88111328 9.83957031 9.82472656 9.85351562 8.73632812 C9.88852468 6.15732746 9.94231813 3.57859319 10 1 C6.7 1 3.4 1 0 1 C0 0.67 0 0.34 0 0 Z " fill="#37140E" transform="translate(447,282)"/>
<path d="M0 0 C35.64 0 71.28 0 108 0 C107.67 0.66 107.34 1.32 107 2 C106.11739502 1.99476318 105.23479004 1.98952637 104.32543945 1.98413086 C101.03604473 1.96704029 97.74669753 1.95452616 94.45727539 1.94506836 C93.03636936 1.94005435 91.61546844 1.93324148 90.19458008 1.92456055 C88.14663424 1.91236612 86.0987569 1.90674228 84.05078125 1.90234375 C82.82012939 1.89710693 81.58947754 1.89187012 80.3215332 1.88647461 C77.40743679 1.98607438 74.84252086 2.42207636 72 3 C71.505 2.505 71.505 2.505 71 2 C69.04259501 1.91121473 67.08195448 1.89312965 65.12255859 1.90234375 C63.23457047 1.90729858 63.23457047 1.90729858 61.30844116 1.91235352 C60.63103252 1.91647247 59.95362389 1.92059143 59.25568771 1.92483521 C57.13656354 1.93757136 55.01750185 1.94410845 52.89834595 1.94897461 C47.62897545 1.962368 42.35966338 1.98644495 37.09033203 2.01037598 C32.64850822 2.03017148 28.20670727 2.04579295 23.76485062 2.05593872 C21.68493832 2.06238684 19.60511985 2.07490107 17.52523804 2.08764648 C15.60888046 2.09260132 15.60888046 2.09260132 13.65380859 2.09765625 C11.97621964 2.10551147 11.97621964 2.10551147 10.26473999 2.11352539 C6.78396793 1.99248788 3.43691833 1.55039121 0 1 C0 0.67 0 0.34 0 0 Z " fill="#74513E" transform="translate(291,350)"/>
<path d="M0 0 C0.33 0 0.66 0 1 0 C3.60488557 21.16581936 3.99566022 44.91715032 -4 65 C-4.99 65.99 -4.99 65.99 -6 67 C-5.70833333 65.6875 -5.41666667 64.375 -5.125 63.0625 C-4.94453125 62.23234375 -4.7640625 61.4021875 -4.578125 60.546875 C-4.22411737 58.98732786 -3.84459104 57.43296732 -3.421875 55.890625 C-2.25636453 51.4616852 -1.92629348 47.4295047 -2.0078125 42.84765625 C-2.06383072 34.08080535 -1.53813023 25.37232494 -1 16.625 C-0.90326786 15.00262666 -0.80691154 13.38023086 -0.7109375 11.7578125 C-0.47827458 7.83827023 -0.24058253 3.9190638 0 0 Z " fill="#755445" transform="translate(675,340)"/>
<path d="M0 0 C0.33 0 0.66 0 1 0 C1.02570756 6.52464947 1.04301396 13.04928553 1.05493164 19.57397461 C1.05990874 21.78589364 1.06669282 23.99780946 1.07543945 26.2097168 C1.22158924 64.16567497 1.22158924 64.16567497 -2 74 C-4.15828529 76.10797351 -5.46936318 76.92694055 -8.47363281 77.34057617 C-9.37436523 77.32486572 -10.27509766 77.30915527 -11.203125 77.29296875 C-12.67265625 77.2784668 -12.67265625 77.2784668 -14.171875 77.26367188 C-15.18765625 77.23853516 -16.2034375 77.21339844 -17.25 77.1875 C-18.28125 77.17396484 -19.3125 77.16042969 -20.375 77.14648438 C-22.91719792 77.11117607 -25.45833223 77.06186036 -28 77 C-28 76.67 -28 76.34 -28 76 C-27.42032471 75.9906543 -26.84064941 75.98130859 -26.2434082 75.97167969 C-23.59893054 75.9177593 -20.95618107 75.83415871 -18.3125 75.75 C-17.40048828 75.73582031 -16.48847656 75.72164062 -15.54882812 75.70703125 C-11.4716999 75.55877204 -8.5994318 75.30085551 -4.91796875 73.453125 C-0.07906356 67.26405685 -1.68229172 55.9859817 -1.46484375 48.4375 C-1.42175974 47.03644823 -1.37834305 45.63540666 -1.33460999 44.234375 C-1.22116626 40.57177027 -1.11220191 36.90904588 -1.00421143 33.24627686 C-0.89291447 29.4987362 -0.77732426 25.75132814 -0.66210938 22.00390625 C-0.43723521 14.66939304 -0.21709927 7.3347479 0 0 Z " fill="#3E140E" transform="translate(591,516)"/>
<path d="M0 0 C0.33 0 0.66 0 1 0 C0.58565574 6.78959576 -2.20034548 11.94067123 -5.25 17.9375 C-12.30724327 32.27989558 -16.42351727 46.24784539 -19 62 C-19.66 62 -20.32 62 -21 62 C-20.92709073 42.02285867 -12.44654721 24.74028331 -3.23339844 7.45336914 C-2.00637962 5.01268979 -0.97656921 2.54996236 0 0 Z " fill="#4E281F" transform="translate(268,245)"/>
<path d="M0 0 C0.33 0 0.66 0 1 0 C0.57771564 10.32374122 -0.09223611 20.43595698 -1.58984375 30.6640625 C-2.13882956 35.12914708 -2.19014148 39.51054834 -2 44 C-1.59910156 43.57589844 -1.19820312 43.15179688 -0.78515625 42.71484375 C3.80193501 37.98213054 8.72112835 33.93820583 14 30 C14.66 30.33 15.32 30.66 16 31 C15.33613281 31.59167969 14.67226563 32.18335938 13.98828125 32.79296875 C8.45338745 37.69297943 8.45338745 37.69297943 3.1875 42.875 C0.95088173 45.04771489 -1.26733799 46.51655491 -4 48 C-5.99597423 46.00402577 -5.75783552 42.78807471 -6 40.1015625 C-6 35.39117035 -4.92437221 31.0318625 -3.90234375 26.44921875 C-2.74005234 21.0315021 -2.03829061 15.55272632 -1.3125 10.0625 C-1.11575684 8.5770166 -1.11575684 8.5770166 -0.91503906 7.06152344 C-0.60627695 4.70814356 -0.30103272 2.35437919 0 0 Z " fill="#441D15" transform="translate(607,322)"/>
<path d="M0 0 C4.50213765 1.41495755 6.70460873 3.70460873 10 7 C25.81319513 17.32698457 44.69656174 20.20364138 63 23 C63 23.33 63 23.66 63 24 C43.00586605 24.42828472 19.10837863 18.74513562 3.625 5.5625 C2.75875 4.716875 1.8925 3.87125 1 3 C1 6.63 1 10.26 1 14 C0.67 14 0.34 14 0 14 C-0.19456705 12.04235617 -0.38044247 10.08384679 -0.5625 8.125 C-0.66691406 7.03445313 -0.77132812 5.94390625 -0.87890625 4.8203125 C-1 2 -1 2 0 0 Z " fill="#441F16" transform="translate(237,494)"/>
<path d="M0 0 C5.93424658 0 5.93424658 0 8.51953125 2.42578125 C10.12220338 4.55826235 11.5679559 6.7491386 13 9 C14.22812272 10.83403282 15.45737305 12.66731086 16.6875 14.5 C17.68330078 16.00820313 17.68330078 16.00820313 18.69921875 17.546875 C23.03890188 24.0942627 27.53755553 30.53601794 32 37 C32.18175781 35.93458984 32.18175781 35.93458984 32.3671875 34.84765625 C32.53476562 33.92855469 32.70234375 33.00945312 32.875 32.0625 C33.03742187 31.14597656 33.19984375 30.22945313 33.3671875 29.28515625 C33.57601562 28.53105469 33.78484375 27.77695312 34 27 C34.66 26.67 35.32 26.34 36 26 C35.85915204 27.79206547 35.71216299 29.58364917 35.5625 31.375 C35.48128906 32.37273437 35.40007813 33.37046875 35.31640625 34.3984375 C35 37 35 37 34 39 C31.9375 39.625 31.9375 39.625 30 40 C29.66258789 39.42241943 29.32517578 38.84483887 28.97753906 38.24975586 C24.80369399 31.19088328 20.32312595 24.36774695 15.75 17.5625 C15.03070312 16.48806641 14.31140625 15.41363281 13.5703125 14.30664062 C12.24813963 12.33204725 10.92501375 10.35809138 9.60058594 8.38500977 C8.3973305 6.59205638 7.19775501 4.79663252 6 3 C2.43230448 2.26393501 2.43230448 2.26393501 -1 2 C-0.67 1.34 -0.34 0.68 0 0 Z " fill="#4F281F" transform="translate(550,388)"/>
<path d="M0 0 C2.875 0.875 2.875 0.875 4.875 2.875 C5 5.5 5 5.5 4.875 7.875 C4.565625 6.946875 4.565625 6.946875 4.25 6 C2.32724112 3.02846355 0.20905473 2.74475341 -3.125 1.875 C-5.46936576 5.63173751 -5.73225816 9.58956157 -6.16015625 13.89453125 C-6.24373886 14.67132736 -6.32732147 15.44812347 -6.41343689 16.24845886 C-6.67872857 18.72743196 -6.93344085 21.20735295 -7.1875 23.6875 C-7.44737288 26.15665433 -7.70941594 28.62556803 -7.97227478 31.09440613 C-8.13479403 32.62795432 -8.29520708 34.16172773 -8.45314026 35.695755 C-8.66745447 37.75668974 -8.89433932 39.81583842 -9.125 41.875 C-9.26736084 43.18299561 -9.40972168 44.49099121 -9.55639648 45.83862305 C-9.74403564 46.84062744 -9.9316748 47.84263184 -10.125 48.875 C-11.115 49.37 -11.115 49.37 -12.125 49.875 C-11.61402754 39.13113169 -10.80538365 28.4842515 -9.38232422 17.8203125 C-9.13832292 15.97571826 -8.91428287 14.1285157 -8.69140625 12.28125 C-8.54574219 11.2190625 -8.40007813 10.156875 -8.25 9.0625 C-8.06824219 7.69158203 -8.06824219 7.69158203 -7.8828125 6.29296875 C-6.53431049 1.99027419 -4.55845986 -0.18233839 0 0 Z " fill="#522A21" transform="translate(603.125,313.125)"/>
<path d="M0 0 C2.67855894 2.56887657 4.87661006 5.15171595 7 8.1875 C14.69751624 18.0935863 25.00659488 23.32122943 36.21484375 28.2734375 C44.24330854 31.86496281 44.24330854 31.86496281 47 36 C46.96856707 38.73990408 46.44521663 41.28417854 46 44 C45.67 44 45.34 44 45 44 C44.90234375 42.046875 44.8046875 40.09375 44.70703125 38.140625 C43.43535026 34.29045271 40.40261833 32.71135237 36.90307617 30.93652344 C34.51432951 29.83167489 32.10861591 28.78188839 29.6875 27.75 C28.85154297 27.38648438 28.01558594 27.02296875 27.15429688 26.6484375 C25.10571254 25.75876659 23.05436987 24.87620804 21 24 C21 23.34 21 22.68 21 22 C20.236875 21.731875 19.47375 21.46375 18.6875 21.1875 C16.07686496 20.03396359 14.92614911 19.01370135 13 17 C12.01 16.67 11.02 16.34 10 16 C8.68359375 14.40625 8.68359375 14.40625 7.4375 12.5 C5.68380605 9.74463406 5.68380605 9.74463406 3 8 C0 2.57692308 0 2.57692308 0 0 Z " fill="#452018" transform="translate(530,420)"/>
<path d="M0 0 C0.33 0 0.66 0 1 0 C1.02470254 5.64167969 1.04286121 11.28332795 1.05493164 16.92504883 C1.05996315 18.84465076 1.06678898 20.76424886 1.07543945 22.68383789 C1.08755669 25.44157864 1.09324011 28.19926876 1.09765625 30.95703125 C1.10281754 31.81649857 1.10797882 32.67596588 1.11329651 33.56147766 C1.11340981 34.76238289 1.11340981 34.76238289 1.11352539 35.98754883 C1.115746 36.6914827 1.11796661 37.39541656 1.12025452 38.12068176 C0.95074035 40.76982195 0.48716116 42.53758767 -1.4609375 44.38671875 C-7.28342442 48.34363333 -12.08165599 48.57228949 -19 48 C-19 47.34 -19 46.68 -19 46 C-19.61875 45.896875 -20.2375 45.79375 -20.875 45.6875 C-23 45 -23 45 -25 42 C-24.67 41.01 -24.34 40.02 -24 39 C-23.4225 39.78375 -22.845 40.5675 -22.25 41.375 C-19.26682546 44.8553703 -17.59563553 45.83025154 -13.0625 46.3125 C-9.61704247 45.9609227 -7.8478428 44.89856187 -5 43 C-4.34 43 -3.68 43 -3 43 C-1.01327169 37.98786788 -0.6646794 33.62622564 -0.5859375 28.3203125 C-0.56657135 27.50754852 -0.5472052 26.69478455 -0.5272522 25.85739136 C-0.46782117 23.28003188 -0.42121819 20.70262685 -0.375 18.125 C-0.33678657 16.36977298 -0.29773291 14.61456403 -0.2578125 12.859375 C-0.16215001 8.57306476 -0.07798551 4.28666681 0 0 Z " fill="#3C1C16" transform="translate(346,268)"/>
<path d="M0 0 C0.99 0.33 1.98 0.66 3 1 C2.67 1.66 2.34 2.32 2 3 C1.87790384 5.47072509 1.81437914 7.91517208 1.79467773 10.38720703 C1.78477814 11.14827759 1.77487854 11.90934814 1.76467896 12.69348145 C1.73303322 15.21489324 1.70829443 17.73632388 1.68359375 20.2578125 C1.66302687 22.00373836 1.64203047 23.74965922 1.62062073 25.49557495 C1.56537254 30.09539742 1.5159754 34.69526503 1.46777344 39.29516602 C1.41757845 43.98718289 1.36188195 48.67913405 1.30664062 53.37109375 C1.19902546 62.58067306 1.09758796 71.79030937 1 81 C0.01 80.67 -0.98 80.34 -2 80 C-1.34 80 -0.68 80 0 80 C0 53.6 0 27.2 0 0 Z " fill="#371D18" transform="translate(289,350)"/>
<path d="M0 0 C0.33 0 0.66 0 1 0 C1.16771906 19.69021726 0.69022656 39.32487154 0 59 C-0.33 59 -0.66 59 -1 59 C-1.33 43.49 -1.66 27.98 -2 12 C-1.67 12 -1.34 12 -1 12 C-0.67 8.04 -0.34 4.08 0 0 Z " fill="#B59D86" transform="translate(590,520)"/>
<path d="M0 0 C0.66 0 1.32 0 2 0 C2.05391993 1.79133978 2.09275571 3.58313899 2.125 5.375 C2.14820313 6.37273437 2.17140625 7.37046875 2.1953125 8.3984375 C2 11 2 11 0 13 C-0.4673667 15.8907496 -0.83699342 18.71660569 -1.125 21.625 C-1.21136719 22.42679687 -1.29773438 23.22859375 -1.38671875 24.0546875 C-1.59896327 26.03563635 -1.80049931 28.01772718 -2 30 C-2.99 30.33 -3.98 30.66 -5 31 C-5.66 30.34 -6.32 29.68 -7 29 C-6.01 29 -5.02 29 -4 29 C-3.93941406 28.20078125 -3.87882813 27.4015625 -3.81640625 26.578125 C-3.6408605 24.27712535 -3.46227883 21.97635602 -3.28125 19.67578125 C-3.10099973 17.32001038 -2.9331889 14.96323488 -2.78125 12.60546875 C-2.7090625 11.56003906 -2.636875 10.51460938 -2.5625 9.4375 C-2.50191406 8.48746094 -2.44132813 7.53742188 -2.37890625 6.55859375 C-1.99744223 3.98272843 -1.30044491 2.23760763 0 0 Z " fill="#411B13" transform="translate(588,398)"/>
<path d="M0 0 C2.08984375 0.42578125 2.08984375 0.42578125 4 1 C4.05423638 2.91635217 4.09289963 4.83314925 4.125 6.75 C4.14820313 7.81734375 4.17140625 8.8846875 4.1953125 9.984375 C4.00487687 12.92470106 3.52670104 14.52361878 2 17 C0.85770121 13.57310364 1.09138924 11.38897782 1.4375 7.8125 C1.53933594 6.72582031 1.64117187 5.63914062 1.74609375 4.51953125 C1.82988281 3.68808594 1.91367187 2.85664062 2 2 C1.34 2 0.68 2 0 2 C-0.18691406 2.57105469 -0.37382812 3.14210938 -0.56640625 3.73046875 C-2.63766369 7.00948938 -5.62824472 8.48220411 -8.9375 10.3125 C-9.88786133 10.8703418 -9.88786133 10.8703418 -10.85742188 11.43945312 C-12.52487792 12.38101348 -14.26041703 13.19950225 -16 14 C-16.99 13.67 -17.98 13.34 -19 13 C-18.26394531 12.61328125 -17.52789062 12.2265625 -16.76953125 11.828125 C-8.40261777 7.45689011 -8.40261777 7.45689011 -1.4375 1.1875 C-0.963125 0.795625 -0.48875 0.40375 0 0 Z " fill="#441F16" transform="translate(357,565)"/>
<path d="M0 0 C3.63 0 7.26 0 11 0 C11 0.33 11 0.66 11 1 C6.545 1.495 6.545 1.495 2 2 C2.02320313 3.27875 2.04640625 4.5575 2.0703125 5.875 C2.08908533 7.58332745 2.10728389 9.29166127 2.125 11 C2.14175781 11.83917969 2.15851563 12.67835938 2.17578125 13.54296875 C2.21835518 19.03500553 1.79077 23.78186225 0 29 C-0.99 29.33 -1.98 29.66 -3 30 C-2.68289063 28.9171875 -2.36578125 27.834375 -2.0390625 26.71875 C-0.69675592 21.34952368 -0.54858069 16.01118685 -0.375 10.5 C-0.33632813 9.48679687 -0.29765625 8.47359375 -0.2578125 7.4296875 C-0.16436757 4.9533969 -0.08113408 2.47672452 0 0 Z " fill="#DBC6A9" transform="translate(508,284)"/>
<path d="M0 0 C0.33 0 0.66 0 1 0 C1.10957031 1.08796875 1.21914063 2.1759375 1.33203125 3.296875 C2.70466917 19.40772229 2.70466917 19.40772229 9 34 C9.33 34 9.66 34 10 34 C10 35.98 10 37.96 10 40 C6.75361984 37.10144629 5.18263392 34.66142483 3.75 30.5625 C3.41484375 29.63566406 3.0796875 28.70882813 2.734375 27.75390625 C2.00882032 25.03307622 1.85771943 22.79987835 2 20 C1.34 19.67 0.68 19.34 0 19 C-1.31779753 12.53081214 -0.77900269 6.51965331 0 0 Z " fill="#441F17" transform="translate(520,380)"/>
<path d="M0 0 C1.32 0.33 2.64 0.66 4 1 C5.16063604 5.25566547 4.76173392 8.6835078 4 13 C3.67 13 3.34 13 3 13 C3 9.37 3 5.74 3 2 C2.23816406 2.60328125 1.47632813 3.2065625 0.69140625 3.828125 C-11.70416502 13.42269952 -11.70416502 13.42269952 -18 15 C-18.99 14.67 -19.98 14.34 -21 14 C-20.5059668 13.75354736 -20.01193359 13.50709473 -19.50292969 13.25317383 C-17.24561192 12.11842411 -14.99793864 10.9657108 -12.75 9.8125 C-11.97269531 9.42513672 -11.19539063 9.03777344 -10.39453125 8.63867188 C-5.91771843 6.32373875 -2.85034954 4.31383546 0 0 Z " fill="#421B12" transform="translate(381,495)"/>
<path d="M0 0 C0.66 0 1.32 0 2 0 C2 7.59 2 15.18 2 23 C0.68 23.33 -0.64 23.66 -2 24 C-3.32 22.35 -4.64 20.7 -6 19 C-5.01 19 -4.02 19 -3 19 C-2.67 19.99 -2.34 20.98 -2 22 C-1.34 22 -0.68 22 0 22 C0 14.74 0 7.48 0 0 Z " fill="#37120D" transform="translate(247,307)"/>
<path d="M0 0 C4.28661029 2.26938192 7.41854407 4.86967051 10 9 C9.75 11.3125 9.75 11.3125 9 13 C8.608125 12.0925 8.21625 11.185 7.8125 10.25 C5.81504205 6.66835126 4.5672091 5.01624862 1 3 C-2.8324023 2.24202025 -6.31447984 2.12867178 -9.84375 3.953125 C-13.1064919 6.48015059 -14.8748702 9.0620457 -16 13 C-16.66 12.01 -17.32 11.02 -18 10 C-14.70596067 2.79428897 -7.87714299 -1.31285717 0 0 Z " fill="#451E17" transform="translate(486,255)"/>
<path d="M0 0 C0.680625 0.70125 1.36125 1.4025 2.0625 2.125 C9.92829825 9.92432671 16.86286595 13.63041863 27.7421875 16.25390625 C28.48726563 16.50011719 29.23234375 16.74632812 30 17 C30.33 17.66 30.66 18.32 31 19 C21.63631065 18.6327965 12.68708957 14.21980479 5 9 C5 8.34 5 7.68 5 7 C4.01 7 3.02 7 2 7 C0.5393715 4.35261084 0 3.10551666 0 0 Z " fill="#4B271D" transform="translate(240,479)"/>
<path d="M0 0 C0.33 0 0.66 0 1 0 C1 2.31 1 4.62 1 7 C0.01 7.495 0.01 7.495 -1 8 C-1.90331936 12.00608834 -2.16863343 15.95926932 -2.31640625 20.0546875 C-2.35830078 21.16328125 -2.40019531 22.271875 -2.44335938 23.4140625 C-2.50233398 25.12722656 -2.50233398 25.12722656 -2.5625 26.875 C-2.60568359 28.0403125 -2.64886719 29.205625 -2.69335938 30.40625 C-2.79901629 33.27072625 -2.90111799 36.13528321 -3 39 C-3.33 39 -3.66 39 -4 39 C-5.28856642 26.13415987 -6.03601193 13.17036216 -1 1 C-0.67 0.67 -0.34 0.34 0 0 Z " fill="#512A21" transform="translate(273,300)"/>
<path d="M0 0 C1.19496094 0.54269531 2.38992187 1.08539062 3.62109375 1.64453125 C5.22645989 2.36741542 6.83193448 3.09005878 8.4375 3.8125 C9.22060547 4.16892578 10.00371094 4.52535156 10.81054688 4.89257812 C15.56015514 7.02306084 20.2744257 8.82264558 25.26977539 10.2956543 C27 11 27 11 28 13 C17.25963973 10.97828513 7.84197647 6.60385788 -2 2 C-1.34 1.34 -0.68 0.68 0 0 Z " fill="#4F291F" transform="translate(242,534)"/>
<path d="M0 0 C0 0.99 0 1.98 0 3 C-8.17443013 5.27904619 -15.61526036 4.89405005 -24 4 C-24 3.67 -24 3.34 -24 3 C-21.1259578 2.49387936 -18.25097127 1.99493459 -15.375 1.5 C-14.56675781 1.35691406 -13.75851562 1.21382812 -12.92578125 1.06640625 C-8.56122136 0.32123749 -4.44761871 -0.17272306 0 0 Z " fill="#876857" transform="translate(347,514)"/>
<path d="M0 0 C9.52801503 -0.50740908 17.14992367 0.36919945 26 4 C26 4.33 26 4.66 26 5 C17.19828026 4.38641858 8.64045258 2.70450615 0 1 C0 0.67 0 0.34 0 0 Z " fill="#471E16" transform="translate(334,445)"/>
<path d="M0 0 C0 0.33 0 0.66 0 1 C-9.405 1.495 -9.405 1.495 -19 2 C-19.33 5.63 -19.66 9.26 -20 13 C-20.33 13 -20.66 13 -21 13 C-21.33 9.04 -21.66 5.08 -22 1 C-15.9519817 -3.0320122 -6.94458874 -1.2626525 0 0 Z " fill="#492219" transform="translate(412,532)"/>
<path d="M0 0 C0.44601563 0.48597656 0.89203125 0.97195313 1.3515625 1.47265625 C3.41015584 3.38002591 4.95153853 3.672029 7.6875 4.1875 C8.49574219 4.34605469 9.30398438 4.50460937 10.13671875 4.66796875 C10.75160156 4.77753906 11.36648438 4.88710938 12 5 C12 5.33 12 5.66 12 6 C4.09991283 6.53864231 -4.84406639 5.24503174 -11 0 C-7.01611946 -0.83383546 -3.91159585 -1.26862568 0 0 Z " fill="#705041" transform="translate(250,597)"/>
<path d="M0 0 C0.99 0 1.98 0 3 0 C4.14530327 4.00856145 4.04171769 6.32490815 2 10 C1.01 10.33 0.02 10.66 -1 11 C-0.67 8.69 -0.34 6.38 0 4 C-2.31 5.98 -4.62 7.96 -7 10 C-4.94803598 5.89607196 -3.10143155 3.32836557 0 0 Z " fill="#593529" transform="translate(223,253)"/>
<path d="M0 0 C3.54029871 1.29873392 6.47011933 2.84877866 9.5625 5 C12.30415796 6.90062943 14.98063735 8.57590151 18 10 C18 10.66 18 11.32 18 12 C13.53817564 10.68925635 10.00381243 8.92933989 6.125 6.375 C5.15820312 5.74335938 4.19140625 5.11171875 3.1953125 4.4609375 C2.47085938 3.97882813 1.74640625 3.49671875 1 3 C0.67 4.32 0.34 5.64 0 7 C-1.33332095 4.3333581 -0.67102033 2.83319697 0 0 Z " fill="#4B261D" transform="translate(529,442)"/>
<path d="M0 0 C0.33 0 0.66 0 1 0 C1.20674944 5.78898419 0.59162079 10.42932723 -1 16 C0.65 14.68 2.3 13.36 4 12 C4.66 12.33 5.32 12.66 6 13 C3.79072873 16.48832306 1.91402949 17.73058503 -2 19 C-3.29384979 14.51865271 -2.61333104 11.18505684 -1.5625 6.6875 C-1.13130859 4.80611328 -1.13130859 4.80611328 -0.69140625 2.88671875 C-0.46324219 1.93410156 -0.23507813 0.98148437 0 0 Z " fill="#3A150F" transform="translate(217,402)"/>
<path d="M0 0 C0.33 0 0.66 0 1 0 C0.39297368 6.6772895 -1.77631394 12.70127996 -4 19 C-6.97 19.33 -9.94 19.66 -13 20 C-11 18 -11 18 -7.875 17.875 C-6.451875 17.936875 -6.451875 17.936875 -5 18 C-4.9175 16.700625 -4.835 15.40125 -4.75 14.0625 C-4.19661737 8.85905135 -2.35320007 4.62978432 0 0 Z " fill="#4A241B" transform="translate(519,332)"/>
<path d="M0 0 C0.66 0.33 1.32 0.66 2 1 C-11.87746986 15.20964335 -11.87746986 15.20964335 -18 18 C-16.89822514 14.69467543 -16.10316567 13.98696973 -13.5 11.8125 C-12.7884375 11.20921875 -12.076875 10.6059375 -11.34375 9.984375 C-10.5703125 9.32953125 -9.796875 8.6746875 -9 8 C-7.32937152 6.52530943 -5.66261168 5.04622309 -4 3.5625 C-3.236875 2.88316406 -2.47375 2.20382812 -1.6875 1.50390625 C-1.130625 1.00761719 -0.57375 0.51132812 0 0 Z " fill="#48231A" transform="translate(617,405)"/>
<path d="M0 0 C0.33 0 0.66 0 1 0 C0.73241093 8.29526121 -1.92345988 14.69802909 -7.6953125 20.7890625 C-8.12585938 21.18867188 -8.55640625 21.58828125 -9 22 C-9.66 21.67 -10.32 21.34 -11 21 C-10.61328125 20.52691406 -10.2265625 20.05382812 -9.828125 19.56640625 C-5.1182931 13.58585238 -1.69799223 7.46444109 0 0 Z " fill="#491F17" transform="translate(232,392)"/>
<path d="M0 0 C2.875 0.875 2.875 0.875 4.875 2.875 C5 5.5 5 5.5 4.875 7.875 C4.66875 7.25625 4.4625 6.6375 4.25 6 C2.32724112 3.02846355 0.20905473 2.74475341 -3.125 1.875 C-5.51573445 5.70017513 -5.68466552 9.47165524 -6.125 13.875 C-6.455 13.875 -6.785 13.875 -7.125 13.875 C-7.74192592 4.89530055 -7.74192592 4.89530055 -5.5 1.1875 C-3.125 -0.125 -3.125 -0.125 0 0 Z " fill="#411A12" transform="translate(603.125,313.125)"/>
<path d="M0 0 C-0.639375 0.103125 -1.27875 0.20625 -1.9375 0.3125 C-2.618125 0.539375 -3.29875 0.76625 -4 1 C-4.33 1.99 -4.66 2.98 -5 4 C-7.14453125 5.97265625 -7.14453125 5.97265625 -9.8125 8.0625 C-10.68519531 8.75472656 -11.55789063 9.44695312 -12.45703125 10.16015625 C-14.5989984 11.70987442 -16.59801842 12.91938824 -19 14 C-15.83546429 10.12344376 -12.60483254 6.47235378 -8.9375 3.0625 C-8.30714844 2.47597656 -7.67679688 1.88945312 -7.02734375 1.28515625 C-4.5247359 -0.30127531 -2.90886419 -0.2470266 0 0 Z " fill="#4F2A20" transform="translate(640,389)"/>
<path d="M0 0 C3.11521395 -0.45588497 5.220462 -0.5229199 7.88671875 1.265625 C10.36933686 3.40994085 12.68125386 5.68125386 15 8 C10.25779349 7.40722419 6.00706312 5.56522805 2 3 C1.34 2.01 0.68 1.02 0 0 Z " fill="#856756" transform="translate(224,589)"/>
<path d="M0 0 C6.1357176 0.61357176 11.36401097 2.76340325 16.0625 6.75 C17.5514582 10.32349968 16.69099179 13.23095385 16 17 C15.67 17 15.34 17 15 17 C14.938125 15.7625 14.87625 14.525 14.8125 13.25 C14.39801137 10.11093941 14.17356593 9.19526167 12 6.75 C8.1311099 4.49314744 4.14135035 2.69623936 0 1 C0 0.67 0 0.34 0 0 Z " fill="#3D160F" transform="translate(560,447)"/>
<path d="M0 0 C1.32 0 2.64 0 4 0 C2.65693216 4.02920351 0.60985797 4.8706069 -2.921875 6.9921875 C-5.40754338 8.19764322 -7.27152974 8.42632348 -10 8 C-9.67 7.01 -9.34 6.02 -9 5 C-6.10441559 3.5522078 -4.25811062 3 -1 3 C-0.67 2.01 -0.34 1.02 0 0 Z " fill="#A68D77" transform="translate(638,440)"/>
<path d="M0 0 C0.556875 0.7425 1.11375 1.485 1.6875 2.25 C6.34510633 7.78877509 10.0591424 9.58830015 17 11 C17 11.33 17 11.66 17 12 C7.62771169 12.31770469 7.62771169 12.31770469 4 10 C1.62505862 6.83860263 0 4.04488068 0 0 Z " fill="#431C14" transform="translate(469,304)"/>
<path d="M0 0 C6.75 -0.125 6.75 -0.125 9 1 C9 1.99 9 2.98 9 4 C11.64 4.66 14.28 5.32 17 6 C16.34 6.66 15.68 7.32 15 8 C12.68391382 7.04965754 10.3723643 6.09024942 8.0625 5.125 C7.40314453 4.85558594 6.74378906 4.58617187 6.06445312 4.30859375 C1.11328125 2.2265625 1.11328125 2.2265625 0 0 Z " fill="#755546" transform="translate(251,522)"/>
<path d="M0 0 C7.23820173 0.34467627 11.91590189 2.10214991 18 6 C17.67 6.99 17.34 7.98 17 9 C16.236875 8.4225 15.47375 7.845 14.6875 7.25 C10.20751276 4.22735801 5.08954158 2.70255128 0 1 C0 0.67 0 0.34 0 0 Z " fill="#532A22" transform="translate(356,450)"/>
<path d="M0 0 C1.19292257 2.38584514 2.36394368 4.77338031 3.5 7.1875 C4.70021344 10.0912513 4.70021344 10.0912513 7 11 C7 12.98 7 14.96 7 17 C2.94903704 13.64747893 1.32886495 9.97093927 0 5 C-0.1875 2 -0.1875 2 0 0 Z " fill="#613D31" transform="translate(523,403)"/>
<path d="M0 0 C0.66 0 1.32 0 2 0 C2 3.63 2 7.26 2 11 C1.01 11.33 0.02 11.66 -1 12 C-2.42857143 3.42857143 -2.42857143 3.42857143 0 0 Z " fill="#2E1009" transform="translate(588,398)"/>
<path d="M0 0 C0.33 0 0.66 0 1 0 C0.48446121 6.49850211 -0.46667709 12.66226532 -2 19 C-2.33 19 -2.66 19 -3 19 C-2.88638398 16.20743781 -2.7596411 13.41655882 -2.625 10.625 C-2.5940625 9.8309375 -2.563125 9.036875 -2.53125 8.21875 C-2.2265625 2.2265625 -2.2265625 2.2265625 0 0 Z " fill="#3E1610" transform="translate(561,547)"/>
<path d="M0 0 C0.66 0.33 1.32 0.66 2 1 C0.71480435 3.86697492 -0.57129254 5.97607712 -3 8 C-3.66 8 -4.32 8 -5 8 C-5 8.66 -5 9.32 -5 10 C-5.66 10 -6.32 10 -7 10 C-5.33248852 6.05860922 -2.77289351 3.2107188 0 0 Z " fill="#DBC8AB" transform="translate(609,380)"/>
<path d="M0 0 C0.33 0 0.66 0 1 0 C1.03738281 0.69867187 1.07476563 1.39734375 1.11328125 2.1171875 C1.21189453 3.48230469 1.21189453 3.48230469 1.3125 4.875 C1.37050781 5.77992188 1.42851563 6.68484375 1.48828125 7.6171875 C1.7882039 10.36221601 1.7882039 10.36221601 5 12 C7.0492094 12.45139459 7.0492094 12.45139459 9.1875 12.625 C10.445625 12.74875 11.70375 12.8725 13 13 C13 13.33 13 13.66 13 14 C11.39667209 14.08121924 9.79215974 14.13929134 8.1875 14.1875 C7.29417969 14.22230469 6.40085937 14.25710938 5.48046875 14.29296875 C3 14 3 14 1.1875 12.84375 C-0.47611355 10.26077106 -0.29488288 8.35501492 -0.1875 5.3125 C-0.16042969 4.31863281 -0.13335938 3.32476563 -0.10546875 2.30078125 C-0.07066406 1.54152344 -0.03585937 0.78226563 0 0 Z " fill="#EBDBBD" transform="translate(558,577)"/>
<path d="M0 0 C0.66 0.33 1.32 0.66 2 1 C1.0479279 2.00596297 0.08812654 3.00461563 -0.875 4 C-1.40867187 4.556875 -1.94234375 5.11375 -2.4921875 5.6875 C-4 7 -4 7 -6 7 C-6.268125 7.61875 -6.53625 8.2375 -6.8125 8.875 C-8 11 -8 11 -11 13 C-9.63422544 8.71506993 -7.79318655 6.56854295 -4.375 3.6875 C-3.55773437 2.99011719 -2.74046875 2.29273438 -1.8984375 1.57421875 C-0.95871094 0.79498047 -0.95871094 0.79498047 0 0 Z " fill="#4E2920" transform="translate(622,365)"/>
<path d="M0 0 C-0.42594588 1.44096586 -0.86626633 2.87768712 -1.3125 4.3125 C-1.55613281 5.11300781 -1.79976563 5.91351562 -2.05078125 6.73828125 C-3.04182023 9.09964573 -4.08074943 10.33879993 -6 12 C-6.66 11.67 -7.32 11.34 -8 11 C-7.34 10.4225 -6.68 9.845 -6 9.25 C-3.55709077 7.00346023 -3.55709077 7.00346023 -4 3 C-4.66 2.34 -5.32 1.68 -6 1 C-3 0 -3 0 0 0 Z " fill="#997E6B" transform="translate(359,545)"/>
<path d="M0 0 C5.28 0 10.56 0 16 0 C15.67 0.66 15.34 1.32 15 2 C10.05122578 3.05390562 4.88947792 3.46684337 0 2 C0 1.34 0 0.68 0 0 Z " fill="#583428" transform="translate(399,350)"/>
<path d="M0 0 C6.14587738 0.2410148 6.14587738 0.2410148 8.578125 2.40234375 C9.78844931 3.88046971 10.90220903 5.43647953 12 7 C11.01 7 10.02 7 9 7 C8.38125 6.0409375 8.38125 6.0409375 7.75 5.0625 C6.03600693 2.61163131 6.03600693 2.61163131 2.3125 2.25 C1.219375 2.1675 0.12625 2.085 -1 2 C-0.67 1.34 -0.34 0.68 0 0 Z " fill="#563127" transform="translate(550,388)"/>
<path d="M0 0 C-0.33 0.99 -0.66 1.98 -1 3 C-3.75078884 3.91692961 -5.35948913 4.10886083 -8.1875 4.0625 C-10.0746875 4.0315625 -10.0746875 4.0315625 -12 4 C-4.28571429 0 -4.28571429 0 0 0 Z " fill="#745345" transform="translate(338,579)"/>
<path d="M0 0 C0.88336837 2.4667645 1.1312406 3.63859372 0.22265625 6.140625 C-0.16019531 6.83671875 -0.54304688 7.5328125 -0.9375 8.25 C-1.31777344 8.95640625 -1.69804687 9.6628125 -2.08984375 10.390625 C-2.39019531 10.92171875 -2.69054687 11.4528125 -3 12 C-3.66 12 -4.32 12 -5 12 C-3.68938409 7.76570244 -2.05643741 3.92592596 0 0 Z " fill="#5E3A2F" transform="translate(259,264)"/>
<path d="M0 0 C1.39195915 4.17587745 -0.17676781 6.13474776 -2 10 C-2.33 8.68 -2.66 7.36 -3 6 C-3.99 6.495 -3.99 6.495 -5 7 C-3.70700306 4.11562221 -2.34058637 2.12780579 0 0 Z " fill="#EFE0C2" transform="translate(223,256)"/>
<path d="M0 0 C0.33 0 0.66 0 1 0 C1.4726477 8.19256018 1.4726477 8.19256018 -0.5 11.5625 C-0.995 12.036875 -1.49 12.51125 -2 13 C-3.32 12.67 -4.64 12.34 -6 12 C-4.7934375 11.2575 -4.7934375 11.2575 -3.5625 10.5 C-0.01911662 7.04304061 -0.2426059 4.85211791 0 0 Z " fill="#573025" transform="translate(589,579)"/>
<path d="M0 0 C0.33 0 0.66 0 1 0 C1 3.63 1 7.26 1 11 C0.34 11 -0.32 11 -1 11 C-1.33 11.66 -1.66 12.32 -2 13 C-1.85769192 11.58297487 -1.71099254 10.1663904 -1.5625 8.75 C-1.48128906 7.96109375 -1.40007813 7.1721875 -1.31640625 6.359375 C-1.02365007 4.17635361 -0.57935581 2.1226818 0 0 Z " fill="#4C241B" transform="translate(594,337)"/>
<path d="M0 0 C0.66 0.33 1.32 0.66 2 1 C-1.32307692 5.8 -1.32307692 5.8 -4.75 6.8125 C-5.4925 6.874375 -6.235 6.93625 -7 7 C-4.66666667 4.66666667 -2.33333333 2.33333333 0 0 Z " fill="#D9C7AB" transform="translate(227,525)"/>
<path d="M0 0 C-2.58926331 2.58926331 -4.02705279 2.37398043 -7.625 2.625 C-8.62789063 2.69976563 -9.63078125 2.77453125 -10.6640625 2.8515625 C-11.82035156 2.92503906 -11.82035156 2.92503906 -13 3 C-8.83099908 0.22066605 -4.8978425 -1.63261417 0 0 Z " fill="#59342A" transform="translate(360,511)"/>
<path d="M0 0 C3.8063457 0.67170806 7.35206816 1.72746564 11 3 C11 3.33 11 3.66 11 4 C3.375 3.125 3.375 3.125 0 2 C0 1.34 0 0.68 0 0 Z " fill="#7A5A4B" transform="translate(260,494)"/>
<path d="M0 0 C0.66 0.33 1.32 0.66 2 1 C0.35 2.98 -1.3 4.96 -3 7 C-3.99 6.34 -4.98 5.68 -6 5 C-4.02 3.35 -2.04 1.7 0 0 Z " fill="#DAC5A8" transform="translate(249,457)"/>
<path d="M0 0 C0 0.66 0 1.32 0 2 C-4.95 3.485 -4.95 3.485 -10 5 C-9 2 -9 2 -7.25 0.8125 C-4.70039426 -0.10819096 -2.69076919 -0.14948718 0 0 Z " fill="#D8C5A9" transform="translate(608,452)"/>
<path d="M0 0 C0.33 0 0.66 0 1 0 C1.33 2.97 1.66 5.94 2 9 C1.67 9 1.34 9 1 9 C0.67 10.98 0.34 12.96 0 15 C-0.33 15 -0.66 15 -1 15 C-1.10251672 9.87416389 -1.03590199 5.05002222 0 0 Z " fill="#C5AF96" transform="translate(606,341)"/>
<path d="M0 0 C0.33 0 0.66 0 1 0 C1.19658808 1.41543415 1.38187546 2.83244031 1.5625 4.25 C1.66691406 5.03890625 1.77132812 5.8278125 1.87890625 6.640625 C2.00027349 9.00532874 1.69633257 10.7511037 1 13 C0.34 13 -0.32 13 -1 13 C-0.67 8.71 -0.34 4.42 0 0 Z " fill="#643C30" transform="translate(248,294)"/>
<path d="M0 0 C8.03501094 -0.78774617 8.03501094 -0.78774617 12.0625 2.5 C12.701875 3.325 13.34125 4.15 14 5 C13.01 5 12.02 5 11 5 C11 4.34 11 3.68 11 3 C10.01 3 9.02 3 8 3 C8 2.34 8 1.68 8 1 C5.36 1 2.72 1 0 1 C0 0.67 0 0.34 0 0 Z " fill="#CDBAA0" transform="translate(478,257)"/>
<path d="M0 0 C2.5 2.3125 2.5 2.3125 5 5 C5 5.99 5 6.98 5 8 C3.0625 7.375 3.0625 7.375 1 6 C0.25 2.875 0.25 2.875 0 0 Z " fill="#A38A75" transform="translate(219,581)"/>
<path d="M0 0 C1.875 0.25 1.875 0.25 4 1 C5.25 3.0625 5.25 3.0625 6 5 C5.01 4.67 4.02 4.34 3 4 C3 3.34 3 2.68 3 2 C2.01 2 1.02 2 0 2 C-0.33 3.32 -0.66 4.64 -1 6 C-1.33 5.01 -1.66 4.02 -2 3 C-1.34 2.01 -0.68 1.02 0 0 Z " fill="#36140C" transform="translate(215,564)"/>
<path d="M0 0 C1.33855056 0.78281305 2.67073644 1.57651877 4 2.375 C5.11375 3.03628906 5.11375 3.03628906 6.25 3.7109375 C6.8275 4.13632812 7.405 4.56171875 8 5 C8 5.66 8 6.32 8 7 C3.64464931 5.83857315 1.35380297 4.92300495 -1 1 C-0.67 0.67 -0.34 0.34 0 0 Z " fill="#49241B" transform="translate(465,318)"/>
<path d="M0 0 C2.83082083 2.83082083 6 6.89167162 6 11 C5.34 11 4.68 11 4 11 C0 4.5 0 4.5 0 0 Z " fill="#3E160E" transform="translate(459,308)"/>
<path d="M0 0 C1.45606519 4.52092968 0.27032841 7.51648796 -1 12 C-1.33 12 -1.66 12 -2 12 C-2 8.7 -2 5.4 -2 2 C-1.34 2 -0.68 2 0 2 C0 1.34 0 0.68 0 0 Z " fill="#C7B299" transform="translate(219,272)"/>
<path d="M0 0 C0 0.66 0 1.32 0 2 C-4.455 3.485 -4.455 3.485 -9 5 C-9 4.34 -9 3.68 -9 3 C-2.25 0 -2.25 0 0 0 Z " fill="#DDCAAD" transform="translate(368,490)"/>
<path d="M0 0 C1.32 0 2.64 0 4 0 C3 3 3 3 0.5625 4.75 C-0.7059375 5.36875 -0.7059375 5.36875 -2 6 C-2.66 5.67 -3.32 5.34 -4 5 C-3.01 4.34 -2.02 3.68 -1 3 C-0.67 2.01 -0.34 1.02 0 0 Z " fill="#7C5C4D" transform="translate(638,440)"/>
<path d="M0 0 C0.66 0.33 1.32 0.66 2 1 C-0.31 3.31 -2.62 5.62 -5 8 C-5.33 7.34 -5.66 6.68 -6 6 C-5.67 5.34 -5.34 4.68 -5 4 C-4.34 4 -3.68 4 -3 4 C-2.67 3.01 -2.34 2.02 -2 1 C-1.34 0.67 -0.68 0.34 0 0 Z " fill="#502A1F" transform="translate(635,405)"/>
<path d="M0 0 C0.33 0 0.66 0 1 0 C1.66 2.97 2.32 5.94 3 9 C2.01 9.66 1.02 10.32 0 11 C0 7.37 0 3.74 0 0 Z " fill="#D4C1A7" transform="translate(604,356)"/>
<path d="M0 0 C0.33 0 0.66 0 1 0 C1 2.31 1 4.62 1 7 C0.01 7.33 -0.98 7.66 -2 8 C-1.125 1.125 -1.125 1.125 0 0 Z " fill="#917462" transform="translate(273,300)"/>
<path d="M0 0 C1.32 1.32 2.64 2.64 4 4 C3.01 4.495 3.01 4.495 2 5 C1.34444881 7.52733235 1.34444881 7.52733235 1 10 C0.67 10 0.34 10 0 10 C0 6.7 0 3.4 0 0 Z " fill="#E8D8BA" transform="translate(239,497)"/>
<path d="M0 0 C0.33 0 0.66 0 1 0 C1 2.97 1 5.94 1 9 C0.01 9.33 -0.98 9.66 -2 10 C-2.66 9.34 -3.32 8.68 -4 8 C-3.01 8 -2.02 8 -1 8 C-0.67 5.36 -0.34 2.72 0 0 Z " fill="#2D0E07" transform="translate(585,419)"/>
<path d="" fill="#372010" transform="translate(0,0)"/>
<path d="" fill="#372010" transform="translate(0,0)"/>
<path d="" fill="#372010" transform="translate(0,0)"/>
<path d="" fill="#372010" transform="translate(0,0)"/>
<path d="" fill="#372010" transform="translate(0,0)"/>
<path d="" fill="#372010" transform="translate(0,0)"/>
</svg>
</file>

<file path="scripts/check-and-create-tables.js">
require('dotenv').config({ path: '.env.local' });
const { sql } = require('@vercel/postgres');

async function checkAndCreateTables() {
  try {
    console.log('üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö —Ç–∞–±–ª–∏—Ü...');
    
    const result = await sql`
      SELECT table_name 
      FROM information_schema.tables 
      WHERE table_schema = 'public'
      ORDER BY table_name
    `;
    
    console.log('üìã –í—Å–µ —Ç–∞–±–ª–∏—Ü—ã –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö:');
    result.rows.forEach(row => {
      console.log(`  - ${row.table_name}`);
    });
    
    const existingTables = result.rows.map(row => row.table_name);
    
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∏ —Å–æ–∑–¥–∞–µ–º –Ω–µ–¥–æ—Å—Ç–∞—é—â–∏–µ —Ç–∞–±–ª–∏—Ü—ã
    if (!existingTables.includes('users')) {
      console.log('\n‚ö†Ô∏è  –°–æ–∑–¥–∞–µ–º —Ç–∞–±–ª–∏—Ü—É users...');
      await sql`
        CREATE TABLE users (
          id SERIAL PRIMARY KEY,
          name TEXT NOT NULL,
          telegram_id TEXT UNIQUE,
          role TEXT DEFAULT 'master',
          created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
        )
      `;
      console.log('‚úÖ –¢–∞–±–ª–∏—Ü–∞ users —Å–æ–∑–¥–∞–Ω–∞');
    }
    
    if (!existingTables.includes('payouts')) {
      console.log('\n‚ö†Ô∏è  –°–æ–∑–¥–∞–µ–º —Ç–∞–±–ª–∏—Ü—É payouts...');
      await sql`
        CREATE TABLE payouts (
          id SERIAL PRIMARY KEY,
          master_name TEXT NOT NULL,
          month TEXT NOT NULL,
          amount REAL NOT NULL,
          created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
        )
      `;
      console.log('‚úÖ –¢–∞–±–ª–∏—Ü–∞ payouts —Å–æ–∑–¥–∞–Ω–∞');
    }
    
    if (!existingTables.includes('month_status')) {
      console.log('\n‚ö†Ô∏è  –°–æ–∑–¥–∞–µ–º —Ç–∞–±–ª–∏—Ü—É month_status...');
      await sql`
        CREATE TABLE month_status (
          id SERIAL PRIMARY KEY,
          month TEXT NOT NULL UNIQUE,
          is_paid BOOLEAN NOT NULL DEFAULT false
        )
      `;
      console.log('‚úÖ –¢–∞–±–ª–∏—Ü–∞ month_status —Å–æ–∑–¥–∞–Ω–∞');
    }
    
    console.log('\nüéâ –í—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ —Ç–∞–±–ª–∏—Ü—ã –ø—Ä–æ–≤–µ—Ä–µ–Ω—ã –∏ —Å–æ–∑–¥–∞–Ω—ã!');
    
  } catch (error) {
    console.error('‚ùå –û—à–∏–±–∫–∞:', error);
    process.exit(1);
  }
}

checkAndCreateTables();
</file>

<file path="scripts/init-vercel-postgres.js">
require('dotenv').config({ path: '.env.local' });
const { sql } = require('@vercel/postgres');

async function initVercelPostgres() {
  try {
    console.log('üöÄ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Vercel Postgres...');
    
    // –°–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã shifts
    console.log('üìä –°–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã shifts...');
    await sql`
      CREATE TABLE IF NOT EXISTS shifts (
        id SERIAL PRIMARY KEY,
        date TEXT NOT NULL,
        hours REAL NOT NULL,
        steam_bath INTEGER NOT NULL DEFAULT 0,
        brand_steam INTEGER NOT NULL DEFAULT 0,
        intro_steam INTEGER NOT NULL DEFAULT 0,
        scrubbing INTEGER NOT NULL DEFAULT 0,
        masters INTEGER NOT NULL DEFAULT 1,
        total REAL NOT NULL,
        hourly_rate REAL NOT NULL,
        steam_bath_price REAL NOT NULL,
        brand_steam_price REAL NOT NULL,
        intro_steam_price REAL NOT NULL,
        scrubbing_price REAL NOT NULL
      )
    `;
    console.log('‚úÖ –¢–∞–±–ª–∏—Ü–∞ shifts —Å–æ–∑–¥–∞–Ω–∞');

    // –°–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã prices
    console.log('üí∞ –°–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã prices...');
    await sql`
      CREATE TABLE IF NOT EXISTS prices (
        id SERIAL PRIMARY KEY,
        name TEXT NOT NULL UNIQUE,
        price REAL NOT NULL
      )
    `;
    console.log('‚úÖ –¢–∞–±–ª–∏—Ü–∞ prices —Å–æ–∑–¥–∞–Ω–∞');

    // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–∞—á–∞–ª—å–Ω—ã—Ö —Ü–µ–Ω
    console.log('üíµ –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–∞—á–∞–ª—å–Ω—ã—Ö —Ü–µ–Ω...');
    const defaultPrices = [
      { name: '–ü–æ—á–∞—Å–æ–≤–∞—è —Å—Ç–∞–≤–∫–∞', price: 400 },
      { name: '–ü—É—Ç–µ–≤–æ–µ –ø–∞—Ä–µ–Ω–∏–µ', price: 3500 },
      { name: '–§–∏—Ä–º–µ–Ω–Ω–æ–µ –ø–∞—Ä–µ–Ω–∏–µ', price: 4200 },
      { name: '–û–∑–Ω–∞–∫–æ–º–∏—Ç–µ–ª—å–Ω–æ–µ –ø–∞—Ä–µ–Ω–∏–µ', price: 2500 },
      { name: '–°–∫—Ä–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ', price: 1200 }
    ];

    for (const price of defaultPrices) {
      await sql`
        INSERT INTO prices (name, price) 
        VALUES (${price.name}, ${price.price}) 
        ON CONFLICT (name) DO NOTHING
      `;
    }
    console.log('‚úÖ –ù–∞—á–∞–ª—å–Ω—ã–µ —Ü–µ–Ω—ã –¥–æ–±–∞–≤–ª–µ–Ω—ã');

    // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
    console.log('üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–∑–¥–∞–Ω–Ω—ã—Ö —Ç–∞–±–ª–∏—Ü...');
    const tablesResult = await sql`
      SELECT table_name 
      FROM information_schema.tables 
      WHERE table_schema = 'public'
    `;
    
    console.log('üìã –°–æ–∑–¥–∞–Ω–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã:');
    tablesResult.rows.forEach(row => {
      console.log(`  - ${row.table_name}`);
    });

    const pricesResult = await sql`SELECT COUNT(*) as count FROM prices`;
    const shiftsResult = await sql`SELECT COUNT(*) as count FROM shifts`;
    
    console.log(`üí∞ –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ü–µ–Ω: ${pricesResult.rows[0].count}`);
    console.log(`üìä –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–º–µ–Ω: ${shiftsResult.rows[0].count}`);
    
    console.log('üéâ Vercel Postgres —É—Å–ø–µ—à–Ω–æ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω!');
    
  } catch (error) {
    console.error('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ Vercel Postgres:', error);
    console.log('\nüí° –í–æ–∑–º–æ–∂–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è:');
    console.log('1. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è POSTGRES_* –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã –≤ Vercel');
    console.log('2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ Vercel Postgres –¥–æ–±–∞–≤–ª–µ–Ω –∫ –ø—Ä–æ–µ–∫—Ç—É');
    console.log('3. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —É –≤–∞—Å –µ—Å—Ç—å –ø—Ä–∞–≤–∞ –Ω–∞ —Å–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü');
    process.exit(1);
  }
}

// –ó–∞–ø—É—Å–∫ —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ —Å–∫—Ä–∏–ø—Ç –≤—ã–∑–≤–∞–Ω –Ω–∞–ø—Ä—è–º—É—é
if (require.main === module) {
  initVercelPostgres();
}

module.exports = { initVercelPostgres };
</file>

<file path="src/app/api/admin/create-test-shifts/route.ts">
import { NextResponse } from 'next/server';
import { addShift, getPrices, getUserByTelegramId } from '@/lib/db';

export async function POST(request: Request) {
  try {
    const body = await request.json();
    const { user_telegram_id } = body;

    // –ï—Å–ª–∏ –Ω–µ —É–∫–∞–∑–∞–Ω telegram_id, –∏—Å–ø–æ–ª—å–∑—É–µ–º fallback –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    const telegramId = user_telegram_id || 87654321;

    // –ü–æ–ª—É—á–∞–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    const user = await getUserByTelegramId(telegramId);
    if (!user) {
      return NextResponse.json(
        { error: `–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å telegram_id ${telegramId} –Ω–µ –Ω–∞–π–¥–µ–Ω` },
        { status: 404 }
      );
    }

    // –ü–æ–ª—É—á–∞–µ–º —Ç–µ–∫—É—â–∏–µ —Ü–µ–Ω—ã
    const prices = await getPrices();
    const priceMapping: { [key: string]: string } = {
      '–ü–æ—á–∞—Å–æ–≤–∞—è —Å—Ç–∞–≤–∫–∞': 'hourly_rate',
      '–ü—É—Ç–µ–≤–æ–µ –ø–∞—Ä–µ–Ω–∏–µ': 'steam_bath_price',
      '–§–∏—Ä–º–µ–Ω–Ω–æ–µ –ø–∞—Ä–µ–Ω–∏–µ': 'brand_steam_price',
      '–û–∑–Ω–∞–∫–æ–º–∏—Ç–µ–ª—å–Ω–æ–µ –ø–∞—Ä–µ–Ω–∏–µ': 'intro_steam_price',
      '–°–∫—Ä–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ': 'scrubbing_price',
      '–ó–∞–ø–∞—Ä–Ω–∏–∫': 'zaparnik_price'
    };
    
    const currentPrices: { [key: string]: number } = {
      hourly_rate: 0,
      steam_bath_price: 0,
      brand_steam_price: 0,
      intro_steam_price: 0,
      scrubbing_price: 0,
      zaparnik_price: 0
    };
    
    // –ó–∞–ø–æ–ª–Ω—è–µ–º —Ç–µ–∫—É—â–∏–µ —Ü–µ–Ω—ã
    prices.forEach(price => {
      const key = priceMapping[price.name];
      if (key) {
        currentPrices[key] = price.price;
      }
    });

    // –°–æ–∑–¥–∞–µ–º —Ç–µ—Å—Ç–æ–≤—ã–µ —Å–º–µ–Ω—ã –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 30 –¥–Ω–µ–π
    const testShifts = [];
    const today = new Date();
    
    for (let i = 0; i < 15; i++) {
      const shiftDate = new Date(today);
      shiftDate.setDate(today.getDate() - i * 2); // –ö–∞–∂–¥—ã–µ 2 –¥–Ω—è
      
      const hours = 8 + Math.floor(Math.random() * 4); // 8-11 —á–∞—Å–æ–≤
      const steamBath = Math.floor(Math.random() * 4); // 0-3
      const brandSteam = Math.floor(Math.random() * 3); // 0-2
      const introSteam = Math.floor(Math.random() * 2); // 0-1
      const scrubbing = Math.floor(Math.random() * 3); // 0-2
      const zaparnik = Math.floor(Math.random() * 2); // 0-1
      const masters = 2; // –í—Å–µ–≥–¥–∞ 2 –º–∞—Å—Ç–µ—Ä–∞
      
      // –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º –æ–±—â—É—é —Å—É–º–º—É
      const total = 
        hours * currentPrices.hourly_rate +
        steamBath * currentPrices.steam_bath_price +
        brandSteam * currentPrices.brand_steam_price +
        introSteam * currentPrices.intro_steam_price +
        scrubbing * currentPrices.scrubbing_price +
        zaparnik * currentPrices.zaparnik_price;

      const shift = {
        user_id: user.id!,
        date: shiftDate.toISOString().split('T')[0],
        hours,
        steam_bath: steamBath,
        brand_steam: brandSteam,
        intro_steam: introSteam,
        scrubbing,
        zaparnik,
        masters,
        total: Math.round(total),
        hourly_rate: currentPrices.hourly_rate,
        steam_bath_price: currentPrices.steam_bath_price,
        brand_steam_price: currentPrices.brand_steam_price,
        intro_steam_price: currentPrices.intro_steam_price,
        scrubbing_price: currentPrices.scrubbing_price,
        zaparnik_price: currentPrices.zaparnik_price
      };

      await addShift(shift);
      testShifts.push(shift);
    }

    return NextResponse.json({
      success: true,
      message: `–°–æ–∑–¥–∞–Ω–æ ${testShifts.length} —Ç–µ—Å—Ç–æ–≤—ã—Ö —Å–º–µ–Ω –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è ${user.first_name}`,
      shifts: testShifts.length,
      user: {
        id: user.id,
        telegram_id: user.telegram_id,
        name: `${user.first_name} ${user.last_name || ''}`
      }
    });

  } catch (error) {
    console.error('Error creating test shifts:', error);
    return NextResponse.json(
      { error: '–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ —Ç–µ—Å—Ç–æ–≤—ã—Ö —Å–º–µ–Ω', details: error instanceof Error ? error.message : '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞' },
      { status: 500 }
    );
  }
}
</file>

<file path="src/app/api/admin/fix-schema/route.ts">
import { NextResponse } from 'next/server';
import { sql } from '@vercel/postgres';

export async function POST() {
  try {
    // –î–æ–±–∞–≤–ª—è–µ–º –Ω–µ–¥–æ—Å—Ç–∞—é—â–∏–µ –∫–æ–ª–æ–Ω–∫–∏ –≤ users
    await sql.query(`
      ALTER TABLE users 
      ADD COLUMN IF NOT EXISTS display_name TEXT,
      ADD COLUMN IF NOT EXISTS updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
    `);

    // –î–æ–±–∞–≤–ª—è–µ–º –Ω–µ–¥–æ—Å—Ç–∞—é—â–∏–µ –∫–æ–ª–æ–Ω–∫–∏ –≤ shifts (–¥–ª—è –Ω–æ–≤—ã—Ö —É—Å–ª—É–≥)
    await sql.query(`
      ALTER TABLE shifts 
      ADD COLUMN IF NOT EXISTS zaparnik INTEGER NOT NULL DEFAULT 0,
      ADD COLUMN IF NOT EXISTS zaparnik_price REAL NOT NULL DEFAULT 0
    `);

    return NextResponse.json({
      success: true,
      message: '–°—Ö–µ–º–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –æ–±–Ω–æ–≤–ª–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ (users, shifts)'
    });

  } catch (error) {
    console.error('Error fixing schema:', error);
    return NextResponse.json(
      { error: '–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ —Å—Ö–µ–º—ã –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö' },
      { status: 500 }
    );
  }
}
</file>

<file path="src/app/api/admin/shifts/route.ts">
import { NextRequest, NextResponse } from 'next/server';
import { getShiftsWithUsers } from '@/lib/db';
import { requireAdmin } from '@/lib/auth-server';

export async function GET(request: NextRequest) {
  try {
    // –¢—Ä–µ–±—É–µ—Ç—Å—è —Ä–æ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
    await requireAdmin(request);
    // –î–ª—è –∞–¥–º–∏–Ω –ø–∞–Ω–µ–ª–∏ –ø–æ–ª—É—á–∞–µ–º –≤—Å–µ —Å–º–µ–Ω—ã —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è—Ö
    const shifts = await getShiftsWithUsers();
    return NextResponse.json(shifts);
  } catch (error) {
    if (error instanceof Error) {
      if (error.message === 'Unauthorized') {
        return NextResponse.json({ error: '–¢—Ä–µ–±—É–µ—Ç—Å—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è' }, { status: 401 });
      }
      if (error.message === 'Forbidden') {
        return NextResponse.json({ error: '–î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â–µ–Ω' }, { status: 403 });
      }
    }
    console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –≤—Å–µ—Ö —Å–º–µ–Ω –¥–ª—è –∞–¥–º–∏–Ω–∞:', error);
    return NextResponse.json({ error: '–û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞' }, { status: 500 });
  }
}
</file>

<file path="src/app/api/payouts/[id]/route.ts">
import { NextRequest, NextResponse } from 'next/server';
import { deletePayout, getPayoutById, getMonthStatus } from '@/lib/db';
import { getUserFromRequest, requireMasterForMutation } from '@/lib/auth-server';

// DELETE /api/payouts/[id] - —É–¥–∞–ª–∏—Ç—å –≤—ã–ø–ª–∞—Ç—É
export async function DELETE(
  request: NextRequest,
  { params }: { params: Promise<{ id: string }> }
) {
  try {
    // –†–∞–∑—Ä–µ—à–∞–µ–º —É–¥–∞–ª–µ–Ω–∏–µ —Ç–æ–ª—å–∫–æ –¥–ª—è –º–∞—Å—Ç–µ—Ä–∞ (–∞–¥–º–∏–Ω/–¥–µ–º–æ –∑–∞–ø—Ä–µ—â–µ–Ω—ã)
    try {
      await requireMasterForMutation(request);
    } catch {
      return NextResponse.json({ error: 'Forbidden' }, { status: 403 });
    }

    const user = await getUserFromRequest(request);
    if (!user) {
      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });
    }

    const resolvedParams = await params;
    const payoutId = parseInt(resolvedParams.id);
    if (isNaN(payoutId)) {
      return NextResponse.json({ error: 'Invalid payout ID' }, { status: 400 });
    }

    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –ª–∏ –≤—ã–ø–ª–∞—Ç–∞ –∏ –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–∏—Ç –ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
    const payout = await getPayoutById(payoutId);
    if (!payout || payout.user_id !== user.id) {
      return NextResponse.json({ 
        error: '–í—ã–ø–ª–∞—Ç–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞ –∏–ª–∏ –Ω–µ –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–∏—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é' 
      }, { status: 404 });
    }

    // –ü—Ä–æ–≤–µ—Ä–∫–∞: –º–µ—Å—è—Ü –∑–∞–∫—Ä—ã—Ç?
    const isClosed = await getMonthStatus(payout.month);
    if (isClosed) {
      return NextResponse.json({ 
        error: '–ú–µ—Å—è—Ü –∑–∞–∫—Ä—ã—Ç, —É–¥–∞–ª–µ–Ω–∏–µ –≤—ã–ø–ª–∞—Ç –∑–∞–ø—Ä–µ—â–µ–Ω–æ' 
      }, { status: 403 });
    }

    const success = await deletePayout(payoutId, user.id);
    
    if (!success) {
      return NextResponse.json({ 
        error: '–í—ã–ø–ª–∞—Ç–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞ –∏–ª–∏ –Ω–µ –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–∏—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é' 
      }, { status: 404 });
    }

    return NextResponse.json({ success: true });
  } catch (error) {
    console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –≤—ã–ø–ª–∞—Ç—ã:', error);
    return NextResponse.json({ error: 'Internal server error' }, { status: 500 });
  }
}
</file>

<file path="src/app/api/users/[id]/route.ts">
import { NextRequest, NextResponse } from 'next/server';
import { blockUser, unblockUser, deleteUser, getShifts, setUserRole } from '@/lib/db';
import { requireAdmin } from '@/lib/auth-server';

export async function PATCH(
  request: NextRequest,
  { params }: { params: Promise<{ id: string }> }
) {
  try {
    // –¢–æ–ª—å–∫–æ –∞–¥–º–∏–Ω—ã –º–æ–≥—É—Ç –≤—ã–ø–æ–ª–Ω—è—Ç—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è
    await requireAdmin(request);
    const { id: idParam } = await params;
    const userId = parseInt(idParam);
    if (isNaN(userId)) {
      return NextResponse.json({ error: '–ù–µ–≤–µ—Ä–Ω—ã–π ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è' }, { status: 400 });
    }

    const body = await request.json();
    const { action } = body;

    let result;
    switch (action) {
      case 'block':
        result = await blockUser(userId);
        break;
      case 'unblock':
        result = await unblockUser(userId);
        break;
      case 'set_role': {
        const role = body.role as 'admin' | 'demo' | 'master';
        if (!role || !['admin', 'demo', 'master'].includes(role)) {
          return NextResponse.json({ error: '–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è —Ä–æ–ª—å' }, { status: 400 });
        }
        result = await setUserRole(userId, role);
        break;
      }
      default:
        return NextResponse.json({ error: '–ù–µ–≤–µ—Ä–Ω–æ–µ –¥–µ–π—Å—Ç–≤–∏–µ' }, { status: 400 });
    }

    return NextResponse.json({
      success: true,
      user: result
    });
  } catch (error) {
    console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º:', error);
    return NextResponse.json({ error: '–û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞' }, { status: 500 });
  }
}

export async function DELETE(
  request: NextRequest,
  { params }: { params: Promise<{ id: string }> }
) {
  try {
    await requireAdmin(request);
    const { id: idParam } = await params;
    const userId = parseInt(idParam);
    if (isNaN(userId)) {
      return NextResponse.json({ error: '–ù–µ–≤–µ—Ä–Ω—ã–π ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è' }, { status: 400 });
    }

    await deleteUser(userId);

    return NextResponse.json({
      success: true,
      message: '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É—Å–ø–µ—à–Ω–æ —É–¥–∞–ª–µ–Ω'
    });
  } catch (error) {
    console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:', error);
    return NextResponse.json({ error: '–û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞' }, { status: 500 });
  }
}

export async function GET(
  request: NextRequest,
  { params }: { params: Promise<{ id: string }> }
) {
  try {
    await requireAdmin(request);
    const { id: idParam } = await params;
    const userId = parseInt(idParam);
    if (isNaN(userId)) {
      return NextResponse.json({ error: '–ù–µ–≤–µ—Ä–Ω—ã–π ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è' }, { status: 400 });
    }

    const shifts = await getShifts(userId);

    return NextResponse.json({
      success: true,
      shifts: shifts
    });
  } catch (error) {
    console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ —Å–º–µ–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:', error);
    return NextResponse.json({ error: '–û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞' }, { status: 500 });
  }
}
</file>

<file path="src/app/api/users/route.ts">
import { NextRequest, NextResponse } from 'next/server';
import { getAllUsers } from '@/lib/db';
import { requireAdmin } from '@/lib/auth-server';

export async function GET(request: NextRequest) {
  try {
    // –°–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –¥–æ—Å—Ç—É–ø–µ–Ω —Ç–æ–ª—å–∫–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É
    await requireAdmin(request);
    const users = await getAllUsers();
    return NextResponse.json({
      success: true,
      users: users
    });
  } catch (error) {
    console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π:', error);
    return NextResponse.json({ error: '–û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞' }, { status: 500 });
  }
}
</file>

<file path="src/app/register/page.tsx">
'use client';

import { useState, useEffect } from 'react';
import { useTelegramAuth } from '@/hooks/useTelegramAuth';
import { useRouter } from 'next/navigation';

export default function RegisterPage() {
  const [displayName, setDisplayName] = useState('');
  const [isLoading, setIsLoading] = useState(false);
  const [error, setError] = useState('');
  const { user, loading: authLoading } = useTelegramAuth();
  const router = useRouter();

  useEffect(() => {
    if (authLoading) return;
    
    if (!user) {
      router.push('/');
      return;
    }
    
    if (user && user.display_name) {
      router.push('/');
      return;
    }
  }, [user, authLoading, router]);

  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault();
    
    if (!user) {
      setError('–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω');
      return;
    }
    
    if (!displayName.trim()) {
      setError('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –≤–∞—à–µ –∏–º—è');
      return;
    }

    if (displayName.trim().length < 2) {
      setError('–ò–º—è –¥–æ–ª–∂–Ω–æ —Å–æ–¥–µ—Ä–∂–∞—Ç—å –º–∏–Ω–∏–º—É–º 2 —Å–∏–º–≤–æ–ª–∞');
      return;
    }

    setIsLoading(true);
    setError('');

    try {
      const response = await fetch('/api/user/register', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          'x-telegram-id': user.telegram_id.toString(),
        },
        body: JSON.stringify({
          display_name: displayName.trim(),
        }),
      });

      const data = await response.json();

      if (!response.ok) {
        throw new Error(data.error || '–û—à–∏–±–∫–∞ –ø—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏');
      }

      if (data.success) {
        // –û–±–Ω–æ–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ localStorage
        if (data.user && user) {
          const updatedUser = { ...user, display_name: data.user.display_name };
          localStorage.setItem('telegram_user', JSON.stringify(updatedUser));
        }
        
        // –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ–º –Ω–∞ –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
        router.push('/');
      } else {
        setError(data.error || '–û—à–∏–±–∫–∞ –ø—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏');
      }
    } catch (error) {
      console.error('Registration error:', error);
      setError(error instanceof Error ? error.message : '–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏');
    } finally {
      setIsLoading(false);
    }
  };

  // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∑–∞–≥—Ä—É–∑–∫—É –ø–æ–∫–∞ –ø—Ä–æ–≤–µ—Ä—è–µ–º –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é
  if (authLoading) {
    return (
      <>
        <style jsx global>{`
          * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
          }

          :root {
            --primary-color: #4A2B1B;
            --secondary-color: #7A3E2D;
            --accent-color: #E9D5B5;
            --background-main: #F2E5D3;
            --font-color: #2C1A0F;
            --primary-light: #5D3426;
            --primary-dark: #3A2015;
            --secondary-light: #8B4A38;
            --secondary-dark: #6A3424;
            --accent-light: #F0E2C8;
            --accent-dark: #DCC49F;
            --background-card: #FEFCF8;
            --background-section: rgba(233, 213, 181, 0.15);
            --shadow-light: rgba(74, 43, 27, 0.1);
            --shadow-medium: rgba(74, 43, 27, 0.15);
            --border-light: rgba(74, 43, 27, 0.2);
          }

          body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, var(--background-main) 0%, var(--accent-light) 100%);
            min-height: 100vh;
            padding: 20px;
            color: var(--font-color);
          }
        `}</style>
        <div style={{
          minHeight: '100vh',
          display: 'flex',
          alignItems: 'center',
          justifyContent: 'center'
        }}>
          <div style={{
            maxWidth: '500px',
            width: '100%',
            background: 'var(--background-card)',
            borderRadius: '15px',
            boxShadow: '0 20px 40px var(--shadow-light)',
            padding: '60px',
            textAlign: 'center'
          }}>
            <div style={{
              width: '48px',
              height: '48px',
              border: '4px solid var(--primary-color)',
              borderTop: '4px solid transparent',
              borderRadius: '50%',
              animation: 'spin 1s linear infinite',
              margin: '0 auto 20px'
            }}></div>
            <p style={{
              color: 'var(--primary-color)',
              fontSize: '1.2em',
              fontWeight: '600'
            }}>–ó–∞–≥—Ä—É–∑–∫–∞...</p>
          </div>
        </div>
        <style jsx>{`
          @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
          }
        `}</style>
      </>
    );
  }

  // –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω –∏–ª–∏ —É–∂–µ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω, –Ω–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Ñ–æ—Ä–º—É
  if (!user || user.display_name) {
    return null;
  }

  return (
    <>
      <style jsx global>{`
        * {
          margin: 0;
          padding: 0;
          box-sizing: border-box;
        }

        :root {
          --primary-color: #4A2B1B;
          --secondary-color: #7A3E2D;
          --accent-color: #E9D5B5;
          --background-main: #F2E5D3;
          --font-color: #2C1A0F;
          --primary-light: #5D3426;
          --primary-dark: #3A2015;
          --secondary-light: #8B4A38;
          --secondary-dark: #6A3424;
          --accent-light: #F0E2C8;
          --accent-dark: #DCC49F;
          --background-card: #FEFCF8;
          --background-section: rgba(233, 213, 181, 0.15);
          --shadow-light: rgba(74, 43, 27, 0.1);
          --shadow-medium: rgba(74, 43, 27, 0.15);
          --border-light: rgba(74, 43, 27, 0.2);
          --success-color: #22c55e;
          --error-color: #ef4444;
        }

        body {
          font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
          background: linear-gradient(135deg, var(--background-main) 0%, var(--accent-light) 100%);
          min-height: 100vh;
          padding: 20px;
          color: var(--font-color);
        }

        .register-container {
          min-height: 100vh;
          display: flex;
          align-items: center;
          justify-content: center;
          padding: 20px;
        }

        .register-card {
          max-width: 500px;
          width: 100%;
          background: var(--background-card);
          border-radius: 15px;
          box-shadow: 0 20px 40px var(--shadow-light);
          overflow: hidden;
          border: 2px solid var(--border-light);
        }

        .register-header {
          background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
          color: var(--accent-color);
          padding: 40px;
          text-align: center;
          position: relative;
        }

        .register-header::after {
          content: '';
          position: absolute;
          bottom: 0;
          left: 0;
          right: 0;
          height: 4px;
          background: linear-gradient(90deg, var(--accent-color) 0%, var(--accent-light) 100%);
        }

        .register-header h1 {
          font-size: 2.2em;
          margin-bottom: 10px;
          text-shadow: 0 2px 4px rgba(0,0,0,0.3);
          font-weight: 700;
        }

        .register-header p {
          font-size: 1.1rem;
          opacity: 0.9;
          line-height: 1.5;
        }

        .register-content {
          padding: 40px;
        }

        .form-group {
          margin-bottom: 25px;
        }

        .form-label {
          display: block;
          font-weight: 600;
          color: var(--font-color);
          margin-bottom: 10px;
          font-size: 14px;
          text-transform: uppercase;
          letter-spacing: 0.5px;
        }

        .form-input {
          width: 100%;
          padding: 16px 20px;
          border: 2px solid var(--border-light);
          border-radius: 12px;
          font-size: 16px;
          background: var(--background-card);
          color: var(--font-color);
          transition: all 0.3s ease;
          font-family: inherit;
        }

        .form-input:focus {
          outline: none;
          border-color: var(--primary-color);
          box-shadow: 0 0 0 3px rgba(74, 43, 27, 0.1);
          transform: translateY(-1px);
        }

        .form-input:disabled {
          opacity: 0.6;
          cursor: not-allowed;
          background: var(--background-section);
        }

        .form-help {
          margin-top: 8px;
          font-size: 13px;
          color: var(--secondary-color);
          opacity: 0.8;
        }

        .error-message {
          background: linear-gradient(135deg, rgba(239, 68, 68, 0.1) 0%, rgba(239, 68, 68, 0.05) 100%);
          border: 2px solid rgba(239, 68, 68, 0.3);
          border-radius: 10px;
          padding: 15px;
          margin-bottom: 20px;
        }

        .error-text {
          color: var(--error-color);
          font-size: 14px;
          font-weight: 500;
        }

        .submit-button {
          width: 100%;
          padding: 16px 24px;
          background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
          color: var(--accent-color);
          border: none;
          border-radius: 12px;
          font-size: 16px;
          font-weight: 600;
          cursor: pointer;
          transition: all 0.3s ease;
          text-transform: uppercase;
          letter-spacing: 0.5px;
          box-shadow: 0 4px 15px var(--shadow-medium);
          position: relative;
          overflow: hidden;
        }

        .submit-button:hover:not(:disabled) {
          transform: translateY(-2px);
          box-shadow: 0 8px 25px var(--shadow-medium);
        }

        .submit-button:active:not(:disabled) {
          transform: translateY(0);
        }

        .submit-button:disabled {
          opacity: 0.6;
          cursor: not-allowed;
          transform: none;
        }

        .submit-button::before {
          content: '';
          position: absolute;
          top: 0;
          left: -100%;
          width: 100%;
          height: 100%;
          background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
          transition: left 0.5s;
        }

        .submit-button:hover:not(:disabled)::before {
          left: 100%;
        }

        .loading-spinner {
          display: inline-flex;
          align-items: center;
          gap: 10px;
        }

        .spinner {
          width: 20px;
          height: 20px;
          border: 2px solid var(--accent-color);
          border-top: 2px solid transparent;
          border-radius: 50%;
          animation: spin 1s linear infinite;
        }

        .user-info {
          margin-top: 30px;
          padding: 20px;
          background: var(--background-section);
          border-radius: 10px;
          border: 1px solid var(--border-light);
          text-align: center;
        }

        .user-info-text {
          font-size: 12px;
          color: var(--secondary-color);
          opacity: 0.8;
          line-height: 1.4;
        }

        @keyframes spin {
          0% { transform: rotate(0deg); }
          100% { transform: rotate(360deg); }
        }

        @media (max-width: 480px) {
          .register-header {
            padding: 30px 20px;
          }
          
          .register-header h1 {
            font-size: 1.8em;
          }
          
          .register-content {
            padding: 30px 20px;
          }
        }
      `}</style>
      
      <div className="register-container">
        <div className="register-card">
          <div className="register-header">
            <h1>–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å!</h1>
            <p>
              –î–ª—è –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ —É–∫–∞–∂–∏—Ç–µ –∏–º—è, –ø–æ–¥ –∫–æ—Ç–æ—Ä—ã–º –≤–∞—Å –±—É–¥–µ—Ç –≤–∏–¥–µ—Ç—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä
            </p>
          </div>

          <div className="register-content">
            <form onSubmit={handleSubmit}>
              <div className="form-group">
                <label htmlFor="displayName" className="form-label">
                  –í–∞—à–µ –∏–º—è –¥–ª—è –æ—Ç—á–µ—Ç–æ–≤
                </label>
                <input
                  type="text"
                  id="displayName"
                  value={displayName}
                  onChange={(e) => setDisplayName(e.target.value)}
                  placeholder="–í–≤–µ–¥–∏—Ç–µ –≤–∞—à–µ –∏–º—è"
                  className="form-input"
                  disabled={isLoading}
                  maxLength={50}
                />
                <p className="form-help">
                  –≠—Ç–æ –∏–º—è –±—É–¥–µ—Ç –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å—Å—è –≤ –æ—Ç—á–µ—Ç–∞—Ö –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
                </p>
              </div>

              {error && (
                <div className="error-message">
                  <p className="error-text">{error}</p>
                </div>
              )}

              <button
                type="submit"
                disabled={isLoading || !displayName.trim()}
                className="submit-button"
              >
                {isLoading ? (
                  <div className="loading-spinner">
                    <div className="spinner"></div>
                    –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è...
                  </div>
                ) : (
                  '–ó–∞–≤–µ—Ä—à–∏—Ç—å —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é'
                )}
              </button>
            </form>

            <div className="user-info">
              <p className="user-info-text">
                –í–∞—à–∏ –¥–∞–Ω–Ω—ã–µ Telegram: {user.first_name} {user.last_name && user.last_name}
                {user.username && ` (@${user.username})`}
              </p>
            </div>
          </div>
        </div>
      </div>
    </>
  );
}
</file>

<file path="src/components/ui/Card.tsx">
import React from 'react';

interface CardProps {
  children: React.ReactNode;
  title?: string;
  className?: string;
}

interface CardHeaderProps {
  children: React.ReactNode;
  className?: string;
  onClick?: () => void;
}

interface CardContentProps {
  children: React.ReactNode;
  className?: string;
}

interface CardTitleProps {
  children: React.ReactNode;
  className?: string;
}

export const Card: React.FC<CardProps> = ({ children, title, className = '' }) => {
  return (
    <div className={`bg-white rounded-lg shadow-md border border-gray-200 ${className}`}>
      {title && (
        <div className="px-6 py-4 border-b border-gray-200">
          <h3 className="text-lg font-semibold text-gray-900">{title}</h3>
        </div>
      )}
      <div className="p-6">
        {children}
      </div>
    </div>
  );
};

export const CardHeader: React.FC<CardHeaderProps> = ({ children, className = '', onClick }) => {
  return (
    <div 
      className={`px-6 py-4 border-b border-gray-200 ${className}`}
      onClick={onClick}
    >
      {children}
    </div>
  );
};

export const CardContent: React.FC<CardContentProps> = ({ children, className = '' }) => {
  return (
    <div className={`p-6 ${className}`}>
      {children}
    </div>
  );
};

export const CardTitle: React.FC<CardTitleProps> = ({ children, className = '' }) => {
  return (
    <h3 className={`text-lg font-semibold text-gray-900 ${className}`}>
      {children}
    </h3>
  );
};
</file>

<file path="src/components/Navigation.tsx">
'use client';

import React from 'react';
import Link from 'next/link';
import { usePathname } from 'next/navigation';
import { useTelegramAuth } from '@/hooks/useTelegramAuth';

const Navigation: React.FC = () => {
  const pathname = usePathname();
  const { user } = useTelegramAuth();

  const navItems = [
    { href: '/', label: '–ì–ª–∞–≤–Ω–∞—è', icon: 'üè†' },
    { href: '/pricing', label: '–ü—Ä–∞–π—Å', icon: 'üí≥' },
    { href: '/login', label: '–í—Ö–æ–¥', icon: 'üîê' },
    { href: '/account', label: '–õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç', icon: 'üë§' },
  ];

  // –°—Å—ã–ª–∫–∞ –Ω–∞ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞–º
  if (user?.role === 'admin') {
    navItems.push({ href: '/admin', label: '–ê–¥–º–∏–Ω‚Äë–ø–∞–Ω–µ–ª—å', icon: 'üõ†Ô∏è' });
  }

  return (
    <nav className="bg-white shadow-lg border-b border-gray-200">
      <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div className="flex justify-between h-16">
          <div className="flex">
            <div className="flex-shrink-0 flex items-center">
              <h1 className="text-xl font-bold text-gray-900">–ü—É—Ç—ë–≤–æ–π —É—á—ë—Ç</h1>
            </div>
            <div className="hidden sm:ml-6 sm:flex sm:space-x-8">
              {navItems.map((item) => {
                const isActive = pathname === item.href;
                return (
                  <Link
                    key={item.href}
                    href={item.href}
                    className={`inline-flex items-center px-1 pt-1 border-b-2 text-sm font-medium transition-colors ${
                      isActive
                        ? 'border-blue-500 text-gray-900'
                        : 'border-transparent text-gray-500 hover:border-gray-300 hover:text-gray-700'
                    }`}
                  >
                    <span className="mr-2">{item.icon}</span>
                    {item.label}
                  </Link>
                );
              })}
            </div>
          </div>
        </div>
      </div>
      
      {/* –ú–æ–±–∏–ª—å–Ω–æ–µ –º–µ–Ω—é */}
      <div className="sm:hidden">
        <div className="pt-2 pb-3 space-y-1">
          {navItems.map((item) => {
            const isActive = pathname === item.href;
            return (
              <Link
                key={item.href}
                href={item.href}
                className={`block pl-3 pr-4 py-2 border-l-4 text-base font-medium transition-colors ${
                  isActive
                    ? 'bg-blue-50 border-blue-500 text-blue-700'
                    : 'border-transparent text-gray-500 hover:bg-gray-50 hover:border-gray-300 hover:text-gray-700'
                }`}
              >
                <span className="mr-2">{item.icon}</span>
                {item.label}
              </Link>
            );
          })}
        </div>
      </div>
    </nav>
  );
};

export default Navigation;
</file>

<file path="src/components/PaymentsList.tsx">
'use client';

import Image from 'next/image';
import React from 'react';

export type Payment = {
  id: string | number;
  date: string;
  amount: number;
  comment?: string;
  isAdmin?: boolean;
  isAdvance?: boolean;
};

interface PaymentsListProps {
  payments: Payment[];
  onDelete: (id: string | number) => void;
}

export function PaymentsList({ payments, onDelete }: PaymentsListProps) {
  if (!payments.length) {
    return <div className="payments-empty">–í—ã–ø–ª–∞—Ç –ø–æ–∫–∞ –Ω–µ—Ç</div>;
  }

  return (
    <div className="payments-list">
      {payments.map((payment) => (
        <div key={payment.id} className="payment-block">
          <div className="payment-row">
            <div className="payment-date">{payment.date}</div>
            <div className="payment-amount">
              {formatCurrency(payment.amount)}
              {payment.isAdmin && <span className="payment-admin-dot">‚Ä¢</span>}
              {payment.isAdvance && <span className="payment-advance-badge">–ê–í–ê–ù–°</span>}
            </div>
            <button
              type="button"
              className="payment-delete"
              onClick={() => onDelete(payment.id)}
              aria-label="–£–¥–∞–ª–∏—Ç—å –≤—ã–ø–ª–∞—Ç—É"
            >
              <Image src="/trash.svg" alt="" width={16} height={16} />
            </button>
          </div>
          {payment.comment && (
            <div className="payment-comment">
              {payment.comment}
            </div>
          )}
        </div>
      ))}
      <style jsx>{`
        .payments-empty {
          font-size: 12px;
          color: rgba(44, 26, 15, 0.6);
        }
        .payments-list {
          display: flex;
          flex-direction: column;
          gap: 10px;
        }
        .payment-block {
          display: flex;
          flex-direction: column;
          gap: 4px;
        }
        .payment-row {
          display: flex;
          align-items: center;
          gap: 12px;
          width: 100%;
        }
        .payment-date {
          min-width: 48px;
          font-size: 13px;
          color: rgba(44, 26, 15, 0.75);
        }
        .payment-amount {
          display: flex;
          align-items: center;
          font-weight: 600;
          color: var(--primary-color, #2c1a0f);
          flex: 1;
        }
        .payment-admin-dot {
          margin-left: 6px;
          color: rgba(44, 26, 15, 0.6);
        }
        .payment-advance-badge {
          display: inline-block;
          background-color: #ff9800;
          color: white;
          font-size: 9px;
          font-weight: bold;
          padding: 1px 4px;
          border-radius: 3px;
          margin-left: 6px;
          vertical-align: middle;
          text-transform: uppercase;
        }
        .payment-delete {
          margin-left: auto;
          border: none;
          background: transparent;
          padding: 4px;
          display: flex;
          align-items: center;
          justify-content: center;
          cursor: pointer;
          width: 24px;
          height: 24px;
        }
        .payment-delete:hover {
          opacity: 0.8;
        }
        .payment-comment {
          margin-left: 60px;
          font-size: 12px;
          color: rgba(44, 26, 15, 0.6);
          line-height: 1.3;
          overflow-wrap: break-word;
        }
        @media (max-width: 600px) {
          .payment-row {
            gap: 8px;
          }
          .payment-date {
            min-width: 42px;
          }
          .payment-comment {
            margin-left: 54px;
          }
        }
      `}</style>
    </div>
  );
}

function formatCurrency(amount: number): string {
  return new Intl.NumberFormat('ru-RU', {
    style: 'currency',
    currency: 'RUB',
    minimumFractionDigits: 0,
    maximumFractionDigits: 0,
  })
    .format(amount)
    .replace(/\s?‚ÇΩ/, ' ‚ÇΩ');
}
</file>

<file path="src/lib/auth-server.ts">
import { NextRequest } from 'next/server';
import { getUserByTelegramId, getUserById } from './db';
import { verifyToken } from './session';

export interface AuthenticatedUser {
  id: number;
  telegram_id: number;
  first_name: string;
  last_name?: string;
  username?: string;
  display_name?: string;
  role?: 'admin' | 'demo' | 'master';
  created_at?: string;
  updated_at?: string;
}

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤ –∑–∞–ø—Ä–æ—Å–∞ (—Ç–æ–ª—å–∫–æ –¥–ª—è —Å–µ—Ä–≤–µ—Ä–Ω–æ–π —á–∞—Å—Ç–∏)
export async function getUserFromRequest(request: NextRequest): Promise<AuthenticatedUser | null> {
  try {
    // 1) –ü—Ä–æ–≤–µ—Ä—è–µ–º cookie-—Å–µ—Å—Å–∏—é
    const cookieHeader = request.headers.get('cookie') || '';
    const cookies = Object.fromEntries(cookieHeader.split(';').map(kv => {
      const idx = kv.indexOf('=');
      if (idx === -1) return [kv.trim(), ''];
      const key = kv.slice(0, idx).trim();
      const val = kv.slice(idx + 1).trim();
      return [key, decodeURIComponent(val)];
    }));
    const token = cookies['auth_token'];
    if (token) {
      const payload = verifyToken(token);
      if (payload && payload.user_id) {
        const byId = await getUserById(payload.user_id);
        if (byId) {
          return {
            id: byId.id!,
            telegram_id: byId.telegram_id,
            first_name: byId.first_name,
            last_name: byId.last_name,
            username: byId.username,
            display_name: byId.display_name,
            role: byId.role as any,
            created_at: byId.created_at,
            updated_at: byId.updated_at
          };
        }
      }
    }

    // 2) Fallback: Telegram –∑–∞–≥–æ–ª–æ–≤–æ–∫
    const telegramId = request.headers.get('x-telegram-id');
    if (!telegramId) {
      return null;
    }
    const user = await getUserByTelegramId(parseInt(telegramId));
    
    if (!user) {
      return null;
    }
    
    return {
      id: user.id!,
      telegram_id: user.telegram_id,
      first_name: user.first_name,
      last_name: user.last_name,
      username: user.username,
      display_name: user.display_name,
      role: user.role as any,
      created_at: user.created_at,
      updated_at: user.updated_at
    };
  } catch (error) {
    console.error('–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:', error);
    return null;
  }
}

// Middleware –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ (—Ç–æ–ª—å–∫–æ –¥–ª—è —Å–µ—Ä–≤–µ—Ä–Ω–æ–π —á–∞—Å—Ç–∏)
export async function requireAuth(request: NextRequest): Promise<AuthenticatedUser> {
  const user = await getUserFromRequest(request);
  if (!user) {
    throw new Error('Unauthorized');
  }
  return user;
}

// Middleware –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ä–æ–ª–∏ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
export async function requireAdmin(request: NextRequest): Promise<AuthenticatedUser> {
  const user = await requireAuth(request);
  if (user.role !== 'admin') {
    throw new Error('Forbidden');
  }
  return user;
}

// –†–∞–∑—Ä–µ—à–∏—Ç—å —Ç–æ–ª—å–∫–æ –º–∞—Å—Ç–µ—Ä—É –≤—ã–ø–æ–ª–Ω—è—Ç—å –º—É—Ç–∞—Ü–∏–∏ (—à–∞–±–ª–æ–Ω –¥–ª—è —Å–º–µ–Ω/–≤—ã–ø–ª–∞—Ç)
export async function requireMasterForMutation(request: NextRequest): Promise<AuthenticatedUser> {
  const user = await requireAuth(request);
  if (user.role === 'admin') {
    throw new Error('Forbidden'); // –ê–¥–º–∏–Ω –Ω–µ –º–æ–∂–µ—Ç –∏–∑–º–µ–Ω—è—Ç—å —Å–º–µ–Ω—ã/–≤—ã–ø–ª–∞—Ç—ã
  }
  if (user.role === 'demo') {
    throw new Error('Forbidden'); // –î–µ–º–æ —Ç–æ–ª—å–∫–æ –ø—Ä–æ—Å–º–æ—Ç—Ä
  }
  // –†–∞–∑—Ä–µ—à–µ–Ω—ã –º–∞—Å—Ç–µ—Ä–∞ –∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –±–µ–∑ —è–≤–Ω–æ –∑–∞–¥–∞–Ω–Ω–æ–π —Ä–æ–ª–∏, —Ç—Ä–∞–∫—Ç—É–µ–º –∫–∞–∫ –º–∞—Å—Ç–µ—Ä
  return user;
}

// –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π –∑–∞–ø—Ä–µ—Ç –¥–ª—è —Ä–æ–ª–µ–π (–º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–ª—è –ª—é–±—ã—Ö –º—É—Ç–∞—Ü–∏–π)
export async function forbidRoles(request: NextRequest, roles: Array<'admin'|'demo'>): Promise<AuthenticatedUser> {
  const user = await requireAuth(request);
  if (roles.includes((user.role ?? 'master') as any)) {
    throw new Error('Forbidden');
  }
  return user;
}
</file>

<file path="src/lib/auth.ts">
export interface AuthenticatedUser {
  id: number;
  telegram_id: number;
  first_name: string;
  last_name?: string;
  username?: string;
  display_name?: string;
  role?: 'admin' | 'demo' | 'master';
}

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ (–¥–ª—è –∫–ª–∏–µ–Ω—Ç—Å–∫–æ–π —á–∞—Å—Ç–∏)
export function getAuthHeaders(): Record<string, string> {
  const user = getUserFromStorage();
  
  if (!user) {
    // –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω –∏ –º—ã –Ω–µ –≤ Telegram, –∏—Å–ø–æ–ª—å–∑—É–µ–º fallback –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    if (!isTelegramWebApp()) {
      return {
        'x-telegram-id': '87654321', // Fallback telegram_id –¥–ª—è —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
      };
    }
    return {};
  }
  
  return {
    'x-telegram-id': user.telegram_id.toString(),
  };
}



// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ localStorage (–¥–ª—è –∫–ª–∏–µ–Ω—Ç—Å–∫–æ–π —á–∞—Å—Ç–∏)
export function getUserFromStorage(): AuthenticatedUser | null {
  if (typeof window === 'undefined') {
    return null;
  }
  
  try {
    const userData = localStorage.getItem('telegram_user');
    if (!userData) {
      return null;
    }
    
    return JSON.parse(userData);
  } catch (error) {
    console.error('–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ localStorage:', error);
    return null;
  }
}

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ localStorage
export function saveUserToStorage(user: AuthenticatedUser): void {
  if (typeof window === 'undefined') {
    return;
  }
  
  localStorage.setItem('telegram_user', JSON.stringify(user));
}

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ localStorage
export function removeUserFromStorage(): void {
  if (typeof window === 'undefined') {
    return;
  }
  
  localStorage.removeItem('telegram_user');
}

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏, –∑–∞–ø—É—â–µ–Ω–æ –ª–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≤ Telegram
export function isTelegramWebApp(): boolean {
  if (typeof window === 'undefined') {
    return false;
  }
  
  const webApp = (window as any).Telegram?.WebApp;
  
  // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–µ —Ç–æ–ª—å–∫–æ –Ω–∞–ª–∏—á–∏–µ –æ–±—ä–µ–∫—Ç–∞, –Ω–æ –∏ —á—Ç–æ –æ–Ω –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω Telegram
  // –í –±—Ä–∞—É–∑–µ—Ä–µ –æ–±—ä–µ–∫—Ç –º–æ–∂–µ—Ç —Å—É—â–µ—Å—Ç–≤–æ–≤–∞—Ç—å, –Ω–æ –Ω–µ –±—ã—Ç—å –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–º
  return !!(webApp && webApp.initData && webApp.platform !== 'unknown');
}

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è initData –∏–∑ Telegram WebApp
export function getTelegramInitData(): string | null {
  if (typeof window === 'undefined') {
    return null;
  }
  
  const webApp = (window as any).Telegram?.WebApp;
  return webApp?.initData || null;
}
</file>

<file path="next.config.ts">
import type { NextConfig } from "next";

const nextConfig: NextConfig = {
  output: 'standalone',
  trailingSlash: false,
  generateEtags: false,
  poweredByHeader: false,
}

export default nextConfig;
</file>

<file path="README.md">
# Pytuchet - –£—á–µ—Ç —Ä–∞–±–æ—á–∏—Ö —Å–º–µ–Ω

–í–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–ª—è —É—á–µ—Ç–∞ —Ä–∞–±–æ—á–∏—Ö —Å–º–µ–Ω –∏ –∑–∞—Ä–∞–±–æ—Ç–∫–∞ –≤ –±–∞–Ω–Ω–æ–º –∫–æ–º–ø–ª–µ–∫—Å–µ. –ü–æ—Å—Ç—Ä–æ–µ–Ω–æ –Ω–∞ Next.js —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º PostgreSQL.

## üöÄ –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- ‚úÖ –£—á–µ—Ç —Ä–∞–±–æ—á–∏—Ö —Å–º–µ–Ω —Å –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏–µ–π –ø–æ —É—Å–ª—É–≥–∞–º
- üí∞ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ü–µ–Ω–∞–º–∏ –Ω–∞ —É—Å–ª—É–≥–∏
- üìä –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ä–∞—Å—á–µ—Ç –∑–∞—Ä–∞–±–æ—Ç–∫–∞
- üì± –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–π –¥–∏–∑–∞–π–Ω –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤
- üîÑ –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏

## üõ† –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏

- **Frontend**: Next.js 16, React 19, TypeScript, Tailwind CSS
- **Backend**: Next.js API Routes
- **–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö**: PostgreSQL (–ª–æ–∫–∞–ª—å–Ω–æ) / Vercel Postgres (production)
- **–î–µ–ø–ª–æ–π**: Vercel

## üì¶ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –∑–∞–ø—É—Å–∫

### –õ–æ–∫–∞–ª—å–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞

1. **–ö–ª–æ–Ω–∏—Ä—É–π—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π:**
```bash
git clone https://github.com/AEV18rus/pytuchet.git
cd pytuchet
```

2. **–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:**
```bash
npm install
```

3. **–ù–∞—Å—Ç—Ä–æ–π—Ç–µ PostgreSQL:**
```bash
# –°–æ–∑–¥–∞–π—Ç–µ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö
createdb pytuchet

# –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–π—Ç–µ —Ç–∞–±–ª–∏—Ü—ã
npm run init-postgres
```

4. **–ù–∞—Å—Ç—Ä–æ–π—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è:**
–°–∫–æ–ø–∏—Ä—É–π—Ç–µ `.env.local` –∏ –Ω–∞—Å—Ç—Ä–æ–π—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –≤–∞—à–µ–π PostgreSQL:
```bash
POSTGRES_URL="postgres://username@localhost:5432/pytuchet"
```

5. **–ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ—Ä–≤–µ—Ä —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏:**
```bash
npm run dev
```

–û—Ç–∫—Ä–æ–π—Ç–µ [http://localhost:3000](http://localhost:3000) –≤ –±—Ä–∞—É–∑–µ—Ä–µ.

## üöÄ –î–µ–ø–ª–æ–π –Ω–∞ Vercel

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Vercel Postgres

1. **–°–æ–∑–¥–∞–π—Ç–µ –ø—Ä–æ–µ–∫—Ç –Ω–∞ Vercel:**
   - –ü–æ–¥–∫–ª—é—á–∏—Ç–µ GitHub —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
   - Vercel –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–ø—Ä–µ–¥–µ–ª–∏—Ç Next.js –ø—Ä–æ–µ–∫—Ç

2. **–î–æ–±–∞–≤—å—Ç–µ Vercel Postgres:**
   - –í –ø–∞–Ω–µ–ª–∏ –ø—Ä–æ–µ–∫—Ç–∞ –ø–µ—Ä–µ–π–¥–∏—Ç–µ –≤ Storage ‚Üí Create Database
   - –í—ã–±–µ—Ä–∏—Ç–µ Postgres –∏ —Å–æ–∑–¥–∞–π—Ç–µ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö
   - Vercel –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–æ–±–∞–≤–∏—Ç –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

3. **–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–π—Ç–µ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö:**
   ```bash
   # –ü–æ—Å–ª–µ –¥–µ–ø–ª–æ—è –≤—ã–∑–æ–≤–∏—Ç–µ API –¥–ª—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
   curl -X POST https://your-app.vercel.app/api/init-db
   ```

–ü–æ–¥—Ä–æ–±–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ —Å–º. –≤ [VERCEL_SETUP.md](./VERCEL_SETUP.md)

## üìã –ü–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

```bash
# –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞
npm run dev              # –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–µ—Ä–∞ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
npm run build           # –°–±–æ—Ä–∫–∞ –¥–ª—è production
npm run start           # –ó–∞–ø—É—Å–∫ production —Å–µ—Ä–≤–µ—Ä–∞

# –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
npm run init-postgres   # –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ª–æ–∫–∞–ª—å–Ω–æ–π PostgreSQL
npm run init-vercel     # –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Vercel Postgres
npm run view-db         # –ü—Ä–æ—Å–º–æ—Ç—Ä —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

# –î–µ–ø–ª–æ–π
vercel                  # –î–µ–ø–ª–æ–π –Ω–∞ Vercel
vercel --prod          # –î–µ–ø–ª–æ–π –≤ production
```

## üìä –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

### –¢–∞–±–ª–∏—Ü–∞ `shifts` (—Å–º–µ–Ω—ã)
- `id` - —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä
- `date` - –¥–∞—Ç–∞ —Å–º–µ–Ω—ã
- `start_time` - –≤—Ä–µ–º—è –Ω–∞—á–∞–ª–∞
- `end_time` - –≤—Ä–µ–º—è –æ–∫–æ–Ω—á–∞–Ω–∏—è
- `services` - JSON —Å —É—Å–ª—É–≥–∞–º–∏ –∏ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º
- `total_earnings` - –æ–±—â–∏–π –∑–∞—Ä–∞–±–æ—Ç–æ–∫
- `created_at` - –≤—Ä–µ–º—è —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–ø–∏—Å–∏

### –¢–∞–±–ª–∏—Ü–∞ `prices` (—Ü–µ–Ω—ã)
- `id` - —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä
- `service_name` - –Ω–∞–∑–≤–∞–Ω–∏–µ —É—Å–ª—É–≥–∏
- `price` - —Ü–µ–Ω–∞ –∑–∞ —É—Å–ª—É–≥—É
- `created_at` - –≤—Ä–µ–º—è —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–ø–∏—Å–∏
- `updated_at` - –≤—Ä–µ–º—è –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è

## ü§ù –£—á–∞—Å—Ç–∏–µ –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ

1. –§–æ—Ä–∫–Ω–∏—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
2. –°–æ–∑–¥–∞–π—Ç–µ –≤–µ—Ç–∫—É –¥–ª—è –Ω–æ–≤–æ–π —Ñ—É–Ω–∫—Ü–∏–∏ (`git checkout -b feature/amazing-feature`)
3. –ó–∞—Ñ–∏–∫—Å–∏—Ä—É–π—Ç–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è (`git commit -m 'Add amazing feature'`)
4. –û—Ç–ø—Ä–∞–≤—å—Ç–µ –≤ –≤–µ—Ç–∫—É (`git push origin feature/amazing-feature`)
5. –û—Ç–∫—Ä–æ–π—Ç–µ Pull Request

## üìÑ –õ–∏—Ü–µ–Ω–∑–∏—è

–≠—Ç–æ—Ç –ø—Ä–æ–µ–∫—Ç —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω—è–µ—Ç—Å—è –ø–æ–¥ –ª–∏—Ü–µ–Ω–∑–∏–µ–π MIT. –°–º. —Ñ–∞–π–ª `LICENSE` –¥–ª—è –ø–æ–¥—Ä–æ–±–Ω–æ—Å—Ç–µ–π.
</file>

<file path="src/app/api/admin/logs/route.ts">
import { NextRequest, NextResponse } from 'next/server';
import { getLogs, addLog, clearLogs } from '@/lib/logging';
import { requireAdmin } from '@/lib/auth-server';

// GET - –ø–æ–ª—É—á–∏—Ç—å –ª–æ–≥–∏
export async function GET(request: NextRequest) {
  try {
    // –¢—Ä–µ–±—É–µ—Ç—Å—è —Ä–æ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
    await requireAdmin(request);
    
    // –ü–æ–ª—É—á–∞–µ–º –ª–æ–≥–∏
    const logs = getLogs();
    
    return NextResponse.json({
      success: true,
      logs: logs,
      total: logs.length
    });
  } catch (error) {
    if (error instanceof Error) {
      if (error.message === 'Unauthorized') {
        return NextResponse.json({ success: false, error: '–¢—Ä–µ–±—É–µ—Ç—Å—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è' }, { status: 401 });
      }
      if (error.message === 'Forbidden') {
        return NextResponse.json({ success: false, error: '–î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â–µ–Ω' }, { status: 403 });
      }
    }
    console.error('–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –ª–æ–≥–æ–≤:', error);
    return NextResponse.json(
      { success: false, error: '–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –ª–æ–≥–æ–≤' },
      { status: 500 }
    );
  }
}

// DELETE - –æ—á–∏—Å—Ç–∏—Ç—å –ª–æ–≥–∏
export async function DELETE(request: NextRequest) {
  try {
    await requireAdmin(request);
    clearLogs();
    
    addLog('info', '–õ–æ–≥–∏ –æ—á–∏—â–µ–Ω—ã –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º');
    
    return NextResponse.json({
      success: true,
      message: '–õ–æ–≥–∏ –æ—á–∏—â–µ–Ω—ã'
    });
  } catch (error) {
    if (error instanceof Error) {
      if (error.message === 'Unauthorized') {
        return NextResponse.json({ success: false, error: '–¢—Ä–µ–±—É–µ—Ç—Å—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è' }, { status: 401 });
      }
      if (error.message === 'Forbidden') {
        return NextResponse.json({ success: false, error: '–î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â–µ–Ω' }, { status: 403 });
      }
    }
    console.error('–û—à–∏–±–∫–∞ –æ—á–∏—Å—Ç–∫–∏ –ª–æ–≥–æ–≤:', error);
    return NextResponse.json(
      { success: false, error: '–û—à–∏–±–∫–∞ –æ—á–∏—Å—Ç–∫–∏ –ª–æ–≥–æ–≤' },
      { status: 500 }
    );
  }
}
</file>

<file path="src/app/api/auth/telegram/route.ts">
import { NextRequest, NextResponse } from 'next/server';
import crypto from 'crypto';
import { getUserByTelegramId, createUser, updateUser } from '@/lib/db';
import { AuthenticatedUser } from '@/lib/auth-server';
import { addLog } from '@/lib/logging';
import { validate, validate3rd } from '@tma.js/init-data-node';

// –î–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏ Telegram –ø–æ–¥–ø–∏—Å–∏
function hmac(hexKey: Buffer, s: string) {
  return crypto.createHmac('sha256', hexKey).update(s).digest('hex');
}

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∏–∑–≤–ª–µ—á–µ–Ω–∏—è bot_id –∏–∑ —Ç–æ–∫–µ–Ω–∞ –±–æ—Ç–∞
function getBotIdFromToken(botToken: string): number {
  const botId = botToken.split(':')[0];
  return parseInt(botId, 10);
}

function buildDataCheck(params: URLSearchParams, includeQueryId: boolean) {
  const p = new URLSearchParams(params.toString()); // –∫–æ–ø–∏—è
  p.delete('hash');
  p.delete('signature');
  if (!includeQueryId) p.delete('query_id');

  // –í–ê–ñ–ù–û: –Ω–∏–∫–∞–∫–∏—Ö –ª–∏—à–Ω–∏—Ö \n –≤ –∫–æ–Ω—Ü–µ, —Å–æ—Ä—Ç–∏—Ä—É–µ–º —Å—Ç—Ä–æ–≥–æ –ø–æ –∫–ª—é—á—É
  const entries = Array.from(p.entries()).sort(([a], [b]) => a.localeCompare(b));
  return entries.map(([k, v]) => `${k}=${v}`).join('\n');
}

function debugTelegramSignature(initDataRaw: string, botTokenRaw: string, expected: string) {
  const initData = typeof initDataRaw === 'string' ? initDataRaw : String(initDataRaw);
  const botToken = botTokenRaw.trim();

  addLog('info', 'üîç –î–ò–ê–ì–ù–û–°–¢–ò–ö–ê Telegram –ø–æ–¥–ø–∏—Å–∏', {
    expected: expected,
    botTokenLength: botToken.length,
    initDataLength: initData.length
  });

  const params = new URLSearchParams(initData);
  const hasSignature = params.has('signature');
  const hasHash = params.has('hash');
  
  addLog('info', 'üîç –†–µ–∂–∏–º –ø—Ä–æ–≤–µ—Ä–∫–∏ –≤ debug', { 
    hasSignature, 
    hasHash,
    mode: hasSignature ? 'validate3rd (–Ω–æ–≤—ã–π)' : 'validate (—Å—Ç–∞—Ä—ã–π)'
  });

  let validationResult = false;
  let errorMessage = '';

  try {
    if (hasSignature) {
      // –ù–æ–≤—ã–π —Ä–µ–∂–∏–º: –∏—Å–ø–æ–ª—å–∑—É–µ–º validate3rd —Å bot_id
      const botId = getBotIdFromToken(botToken);
      validate3rd(initData, botId);
      validationResult = true;
      addLog('info', '‚úÖ DEBUG: validate3rd —É—Å–ø–µ—à–Ω–æ', { botId });
    } else {
      // –°—Ç–∞—Ä—ã–π —Ä–µ–∂–∏–º: –∏—Å–ø–æ–ª—å–∑—É–µ–º validate —Å bot token
      validate(initData, botToken);
      validationResult = true;
      addLog('info', '‚úÖ DEBUG: validate —É—Å–ø–µ—à–Ω–æ');
    }
  } catch (error) {
    validationResult = false;
    errorMessage = error instanceof Error ? error.message : String(error);
    addLog('info', '‚ùå DEBUG: –û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏', { error: errorMessage });
  }

  addLog('info', 'üîç –†–ï–ó–£–õ–¨–¢–ê–¢ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏', {
    validationResult,
    errorMessage,
    hasSignature,
    hasHash,
    expected
  });

  console.log('‚Äî Telegram auth debug (–æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–∞—è –±–∏–±–ª–∏–æ—Ç–µ–∫–∞) ‚Äî');
  console.log('expected hash:', expected);
  console.log('validation result:', validationResult ? '‚úÖ VALID' : '‚ùå INVALID');
  if (errorMessage) {
    console.log('error:', errorMessage);
  }
}

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–¥–ø–∏—Å–∏ Telegram initData
function verifyTelegramWebAppData(initData: string, botToken: string): any {
  // –õ–æ–≥–∏—Ä—É–µ–º –∏—Å—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
  addLog('info', 'üßæ RAW initData FULL STRING', { initData: initData });
  
  const params = new URLSearchParams(initData);
  addLog('info', 'üîë ALL KEYS from initData', { keys: Array.from(params.keys()) });
  
  // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ signature –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Ä–µ–∂–∏–º–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏
  const hasSignature = params.has('signature');
  const hasHash = params.has('hash');
  
  addLog('info', 'üîç –†–µ–∂–∏–º –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–¥–ø–∏—Å–∏', { 
    hasSignature, 
    hasHash,
    mode: hasSignature ? 'validate3rd (–Ω–æ–≤—ã–π)' : 'validate (—Å—Ç–∞—Ä—ã–π)'
  });
  
  try {
    if (hasSignature) {
      // –ù–æ–≤—ã–π —Ä–µ–∂–∏–º: –∏—Å–ø–æ–ª—å–∑—É–µ–º validate3rd —Å bot_id
      const botId = getBotIdFromToken(botToken);
      addLog('info', 'ü§ñ –ò—Å–ø–æ–ª—å–∑—É–µ–º validate3rd', { botId });
      
      // validate3rd –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –ø–æ–¥–ø–∏—Å—å –∏ –Ω–µ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ
      validate3rd(initData, botId);
      
      addLog('info', '‚úÖ validate3rd —É—Å–ø–µ—à–Ω–æ');
    } else {
      // –°—Ç–∞—Ä—ã–π —Ä–µ–∂–∏–º: –∏—Å–ø–æ–ª—å–∑—É–µ–º validate —Å bot token
      addLog('info', 'üîë –ò—Å–ø–æ–ª—å–∑—É–µ–º validate (—Å—Ç–∞—Ä—ã–π —Ä–µ–∂–∏–º)');
      
      // validate –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –ø–æ–¥–ø–∏—Å—å –∏ –Ω–µ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ
      validate(initData, botToken);
      
      addLog('info', '‚úÖ validate —É—Å–ø–µ—à–Ω–æ');
    }
  } catch (error) {
    addLog('error', '–û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–¥–ø–∏—Å–∏ Telegram', {
      error: error instanceof Error ? error.message : String(error),
      hasSignature,
      hasHash,
      initDataLength: initData.length
    });
    
    throw new Error('Invalid signature');
  }
  
  // –ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–∞—Ä—Å–∏–º –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
  const userParam = params.get('user');
  if (!userParam) {
    throw new Error('User data not found');
  }

  let userData;
  try {
    userData = JSON.parse(userParam);
  } catch (parseError) {
    // –ü–æ–ø—Ä–æ–±—É–µ–º —Å –¥–µ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ–º
    try {
      userData = JSON.parse(decodeURIComponent(userParam));
    } catch (secondParseError) {
      throw new Error('Failed to parse user data');
    }
  }

  return userData;
}

export async function POST(request: NextRequest) {
  try {
    // üí° –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
    const requestIP = request.headers.get('x-forwarded-for') || request.headers.get('x-real-ip') || 'unknown';
    const userAgent = request.headers.get('user-agent') || 'unknown';
    const timestamp = new Date().toISOString();
    
    console.log('üí° –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è:');
    console.log('Request IP:', requestIP);
    console.log('User agent:', userAgent);
    console.log('Timestamp:', timestamp);
    
    const body = await request.json();
    const { initData } = body;

    // –õ–æ–≥–∏—Ä—É–µ–º –Ω–∞—á–∞–ª–æ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
    addLog('info', '–ù–∞—á–∞–ª–æ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ Telegram', {
      hasInitData: !!initData,
      initDataType: typeof initData,
      initDataLength: initData ? initData.length : 0,
      hasBotToken: !!process.env.TELEGRAM_BOT_TOKEN,
      userAgent,
      ip: requestIP,
      timestamp
    });
    
    if (!initData) {
      console.log('Auth failed: initData –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç');
      addLog('error', '–û—à–∏–±–∫–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏: initData –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç', {
        requestBody: body,
        ip: requestIP,
        userAgent,
        timestamp
      });
      return NextResponse.json(
        { error: 'initData is required' },
        { status: 400 }
      );
    }
    
    // –ü–æ–ª—É—á–∞–µ–º —Ç–æ–∫–µ–Ω –±–æ—Ç–∞ –∏–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
    const botToken = process.env.TELEGRAM_BOT_TOKEN?.trim();
    if (!botToken) {
      console.log('Auth failed: TELEGRAM_BOT_TOKEN –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω');
      return NextResponse.json({ error: '–û—à–∏–±–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ —Å–µ—Ä–≤–µ—Ä–∞' }, { status: 500 });
    }
    
    console.log('Token ends with:', JSON.stringify(botToken.slice(-3)));
    
    // –í–∞–ª–∏–¥–∞—Ü–∏—è —Ñ–æ—Ä–º–∞—Ç–∞ —Ç–æ–∫–µ–Ω–∞ Telegram (–¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –≤–∏–¥–∞: 123456789:ABC-DEF1234ghIkl-zyx57W2v1u123ew11)
    if (!/^\d+:[\w-]{35}$/.test(botToken)) {
      addLog('error', '–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç TELEGRAM_BOT_TOKEN', { 
        tokenLength: botToken.length,
        tokenFormat: botToken.replace(/:.+/, ':***') 
      });
      return NextResponse.json({ error: '–û—à–∏–±–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ —Å–µ—Ä–≤–µ—Ä–∞' }, { status: 500 });
    }
    
    // üîç –î–ò–ê–ì–ù–û–°–¢–ò–ö–ê: –ø—Ä–æ–≤–µ—Ä—è–µ–º –≤—Å–µ –≤–æ–∑–º–æ–∂–Ω—ã–µ –∫–æ–º–±–∏–Ω–∞—Ü–∏–∏
    const allParams = new URLSearchParams(initData);
    const expectedHash = allParams.get('hash') || '';
    console.log('üîç –ó–∞–ø—É—Å–∫ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ Telegram –ø–æ–¥–ø–∏—Å–∏...');
    debugTelegramSignature(initData, botToken, expectedHash);
    
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ–¥–ø–∏—Å—å Telegram
    let userData;
    try {
      addLog('info', 'üîê –í—ã–∑—ã–≤–∞–µ–º verifyTelegramWebAppData', { initDataLength: initData.length });
      userData = verifyTelegramWebAppData(initData, botToken);
      // –õ–æ–≥–∏—Ä—É–µ–º userData –±–µ–∑ –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö (photo_url)
      const { photo_url, ...safeUserData } = userData;
      addLog('info', '‚úÖ verifyTelegramWebAppData —É—Å–ø–µ—à–Ω–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∞', { userData: safeUserData });
    } catch (error) {
      console.log('Auth failed:', error instanceof Error ? error.message : 'Unknown error');
      return NextResponse.json({ error: '–ù–µ–≤–µ—Ä–Ω–∞—è –ø–æ–¥–ø–∏—Å—å Telegram' }, { status: 401 });
    }
    
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
    let user = await getUserByTelegramId(userData.id);
    
    if (user) {
      // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–æ–ª—å–∫–æ –±–∞–∑–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ Telegram, –µ—Å–ª–∏ –æ–Ω–∏ –∏–∑–º–µ–Ω–∏–ª–∏—Å—å
      // –ù–ï –∑–∞—Ç—Ä–∞–≥–∏–≤–∞–µ–º display_name –∏ –¥—Ä—É–≥–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
      const needsUpdate = 
        user.first_name !== userData.first_name ||
        user.last_name !== userData.last_name ||
        user.username !== userData.username;
      
      if (needsUpdate) {
        const updatedUser = await updateUser(userData.id, {
          first_name: userData.first_name,
          last_name: userData.last_name,
          username: userData.username
          // display_name –Ω–∞–º–µ—Ä–µ–Ω–Ω–æ –ù–ï –æ–±–Ω–æ–≤–ª—è–µ–º
        });
        user = updatedUser;
      }
    } else {
      // –°–æ–∑–¥–∞–µ–º –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
      user = await createUser({
        telegram_id: userData.id,
        first_name: userData.first_name,
        last_name: userData.last_name,
        username: userData.username
        // display_name –±—É–¥–µ—Ç null –¥–ª—è –Ω–æ–≤—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
      });
    }
    
    console.log('Auth success for user:', user.telegram_id);
    
    addLog('info', '–£—Å–ø–µ—à–Ω–∞—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è Telegram', {
      userId: user.id,
      telegramId: user.telegram_id,
      username: user.username,
      ip: requestIP,
      userAgent,
      timestamp
    });
    
    // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    return NextResponse.json({
      success: true,
      user: {
        id: user.id,
        telegram_id: user.telegram_id,
        first_name: user.first_name,
        last_name: user.last_name,
        username: user.username,
        display_name: user.display_name,
        created_at: user.created_at,
        updated_at: user.updated_at
      }
    });
    
  } catch (error) {
    console.error('–û—à–∏–±–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏:', error);
    
    addLog('error', '–û—à–∏–±–∫–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ Telegram', {
      error: error instanceof Error ? error.message : String(error),
      stack: error instanceof Error ? error.stack : undefined
    });
    
    return NextResponse.json({ error: '–û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞' }, { status: 500 });
  }
}

export async function GET() {
  return NextResponse.json({ error: '–ú–µ—Ç–æ–¥ –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è' }, { status: 405 });
}
</file>

<file path="src/app/api/init-db/route.ts">
import { NextResponse } from 'next/server';
import { initDatabase } from '@/lib/db';

export async function POST() {
  try {
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
    if (!process.env.POSTGRES_URL && !process.env.DATABASE_URL && !process.env.PRISMA_DATABASE_URL) {
      return NextResponse.json({
        error: 'Database not configured',
        message: 'POSTGRES_URL, DATABASE_URL, or PRISMA_DATABASE_URL environment variable not found'
      }, { status: 503 });
    }

    console.log('–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö...');
    await initDatabase();
    
    return NextResponse.json({ 
      message: '–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö —É—Å–ø–µ—à–Ω–æ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞',
      timestamp: new Date().toISOString()
    });
  } catch (error) {
    console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö:', error);
    return NextResponse.json({ 
      error: '–û—à–∏–±–∫–∞ –ø—Ä–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö',
      details: error instanceof Error ? error.message : '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'
    }, { status: 500 });
  }
}

export async function GET() {
  try {
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è –¥–ª—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
    if (!process.env.POSTGRES_URL && !process.env.DATABASE_URL && !process.env.PRISMA_DATABASE_URL) {
      return NextResponse.json(
        { 
          error: 'Database not configured', 
          message: 'POSTGRES_URL, DATABASE_URL, or PRISMA_DATABASE_URL environment variable not found' 
        }, 
        { status: 503 }
      );
    }

    // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
    const { sql } = await import('@vercel/postgres');
    
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü
    const tablesResult = await sql`
      SELECT table_name 
      FROM information_schema.tables 
      WHERE table_schema = 'public'
    `;
    
    const tables = tablesResult.rows.map(row => row.table_name);
    const hasShiftsTable = tables.includes('shifts');
    const hasPricesTable = tables.includes('prices');
    
    let pricesCount = 0;
    let shiftsCount = 0;
    
    if (hasPricesTable) {
      const pricesResult = await sql`SELECT COUNT(*) as count FROM prices`;
      pricesCount = parseInt(pricesResult.rows[0].count);
    }
    
    if (hasShiftsTable) {
      const shiftsResult = await sql`SELECT COUNT(*) as count FROM shifts`;
      shiftsCount = parseInt(shiftsResult.rows[0].count);
    }
    
    return NextResponse.json({
      status: 'ok',
      database: {
        tables: tables,
        hasShiftsTable,
        hasPricesTable,
        pricesCount,
        shiftsCount
      },
      timestamp: new Date().toISOString()
    });
  } catch (error) {
    console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö:', error);
    return NextResponse.json({ 
      error: '–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö',
      details: error instanceof Error ? error.message : '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'
    }, { status: 500 });
  }
}
</file>

<file path="src/app/api/prices/route.ts">
import { NextRequest, NextResponse } from 'next/server';
import { getPrices, addPrice, deletePrice } from '@/lib/db';
import { ensureDatabaseInitialized } from '@/lib/global-init';
import { requireAdmin } from '@/lib/auth-server';

export async function GET() {
  try {
    await ensureDatabaseInitialized();
    const prices = await getPrices();
    return NextResponse.json(prices);
  } catch (error) {
    console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ —Ü–µ–Ω:', error);
    return NextResponse.json({ error: '–û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞' }, { status: 500 });
  }
}

export async function POST(request: NextRequest) {
  try {
    await requireAdmin(request);
    await ensureDatabaseInitialized();
    const { name, price } = await request.json();
    
    if (!name || !price) {
      return NextResponse.json({ error: '–ù–∞–∑–≤–∞–Ω–∏–µ –∏ —Ü–µ–Ω–∞ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã' }, { status: 400 });
    }
    
    if (typeof price !== 'number' || price <= 0) {
      return NextResponse.json({ error: '–¶–µ–Ω–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–º —á–∏—Å–ª–æ–º' }, { status: 400 });
    }
    

    await addPrice({ name, price });
    
    return NextResponse.json({ 
      message: '–¶–µ–Ω–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ',
      price: { name, price }
    });
  } catch (error) {
    if (error instanceof Error) {
      if (error.message === 'Unauthorized') {
        return NextResponse.json({ error: '–¢—Ä–µ–±—É–µ—Ç—Å—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è' }, { status: 401 });
      }
      if (error.message === 'Forbidden') {
        return NextResponse.json({ error: '–î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â–µ–Ω' }, { status: 403 });
      }
    }
    console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ —Ü–µ–Ω—ã:', error);
    return NextResponse.json({ error: '–û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞' }, { status: 500 });
  }
}

export async function DELETE(request: NextRequest) {
  try {
    await requireAdmin(request);
    await ensureDatabaseInitialized();
    const { searchParams } = new URL(request.url);
    const id = searchParams.get('id');
    
    if (!id) {
      return NextResponse.json({ error: 'ID —É—Å–ª—É–≥–∏ –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω' }, { status: 400 });
    }
    
    const priceId = parseInt(id);
    if (isNaN(priceId)) {
      return NextResponse.json({ error: '–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π ID —É—Å–ª—É–≥–∏' }, { status: 400 });
    }

    await deletePrice(priceId);
    
    return NextResponse.json({ 
      message: '–£—Å–ª—É–≥–∞ —É–¥–∞–ª–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ'
    });
  } catch (error) {
    if (error instanceof Error) {
      if (error.message === 'Unauthorized') {
        return NextResponse.json({ error: '–¢—Ä–µ–±—É–µ—Ç—Å—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è' }, { status: 401 });
      }
      if (error.message === 'Forbidden') {
        return NextResponse.json({ error: '–î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â–µ–Ω' }, { status: 403 });
      }
    }
    console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ —É—Å–ª—É–≥–∏:', error);
    return NextResponse.json({ error: '–û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞' }, { status: 500 });
  }
}
</file>

<file path="src/app/api/reports/route.ts">
import { NextRequest, NextResponse } from 'next/server';
import { getMonthlyReportsForAllMasters, getMonthsWithShiftsData } from '@/lib/db';

type RawPayoutEntry = {
  id: number;
  amount: number | string;
  date: string;
  comment?: string;
  initiator_role?: 'admin' | 'master' | 'system' | null;
  initiated_by?: number | null;
  method?: string | null;
  source?: string | null;
  reversed_at?: string | null;
  reversed_by?: number | null;
  reversal_reason?: string | null;
};

type RawReportRow = {
  user_id: number;
  first_name: string;
  last_name: string;
  display_name?: string;
  earnings: number | string;
  total_payouts: number | string;
  remaining: number | string;
  recent_payouts?: RawPayoutEntry[];
};

export async function GET(request: NextRequest) {
  try {
    const { searchParams } = new URL(request.url);
    const from = searchParams.get('from');
    const to = searchParams.get('to');

    // –ü–æ–ª—É—á–∞–µ–º –≤—Å–µ –º–µ—Å—è—Ü—ã —Å–æ —Å–º–µ–Ω–∞–º–∏
    const allMonths = await getMonthsWithShiftsData();
    console.log('API: –í—Å–µ –º–µ—Å—è—Ü—ã —Å–æ —Å–º–µ–Ω–∞–º–∏:', allMonths);
    
    // –§–∏–ª—å—Ç—Ä—É–µ–º –º–µ—Å—è—Ü—ã –ø–æ –¥–∏–∞–ø–∞–∑–æ–Ω—É, –µ—Å–ª–∏ —É–∫–∞–∑–∞–Ω
    let filteredMonths = allMonths;
    if (from || to) {
      const fromDate = from ? new Date(from + '-01') : new Date('2020-01-01');
      const toDate = to ? new Date(to + '-01') : new Date();
      
      filteredMonths = allMonths.filter(month => {
        const monthDate = new Date(month + '-01');
        return monthDate >= fromDate && monthDate <= toDate;
      });
    }

    // –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –º–µ—Å—è—Ü–∞
    const monthsData = await Promise.all(
      filteredMonths.map(async (month) => {
        const reports = await getMonthlyReportsForAllMasters(month) as RawReportRow[];
        
        // –ì—Ä—É–ø–ø–∏—Ä—É–µ–º –¥–∞–Ω–Ω—ã–µ –ø–æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞–º
        const employees = reports.map(report => {
          const recentPayouts = Array.isArray(report.recent_payouts)
            ? report.recent_payouts.map((entry) => ({
                id: entry.id,
                amount: parseFloat(String(entry.amount)) || 0,
                date: entry.date,
                comment: entry.comment,
                initiator_role: entry.initiator_role,
                initiated_by: entry.initiated_by,
                method: entry.method,
                source: entry.source,
                reversed_at: entry.reversed_at,
                reversed_by: entry.reversed_by,
                reversal_reason: entry.reversal_reason
              }))
            : [];

          return {
            id: report.user_id,
            name: report.display_name || `${report.first_name} ${report.last_name}`,
            earned: parseFloat(String(report.earnings)) || 0,
            paid: parseFloat(String(report.total_payouts)) || 0,
            outstanding: parseFloat(String(report.remaining)) || 0,
            recentPayouts,
          };
        });

        // –í—ã—á–∏—Å–ª—è–µ–º –æ–±—â–∏–µ —Å—É–º–º—ã
        const totalEarned = employees.reduce((sum, emp) => sum + emp.earned, 0);
        const totalPaid = employees.reduce((sum, emp) => sum + emp.paid, 0);
        const totalOutstanding = employees.reduce((sum, emp) => sum + emp.outstanding, 0);

        // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Å—Ç–∞—Ç—É—Å –º–µ—Å—è—Ü–∞
        let status = 'open';
        if (totalOutstanding === 0) {
          status = 'closed';
        } else if (totalPaid > 0) {
          status = 'partial';
        }

        return {
          month,
          employees: employees.filter(emp => emp.earned > 0), // –§–∏–ª—å—Ç—Ä—É–µ–º —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ –±–µ–∑ —Å–º–µ–Ω
          totalEarned,
          totalPaid,
          totalOutstanding,
          status,
        };
      })
    );

    // –§–∏–ª—å—Ç—Ä—É–µ–º –º–µ—Å—è—Ü—ã –±–µ–∑ —Å–º–µ–Ω –∏ —Å–æ—Ä—Ç–∏—Ä—É–µ–º –ø–æ —É–±—ã–≤–∞–Ω–∏—é
    const result = monthsData
      .filter(month => month.employees.length > 0)
      .sort((a, b) => b.month.localeCompare(a.month));

    console.log('API: –†–µ–∑—É–ª—å—Ç–∞—Ç –æ—Ç—á–µ—Ç–æ–≤:', JSON.stringify(result, null, 2));
    return NextResponse.json(result);
  } catch (error) {
    console.error('Error fetching reports:', error);
    return NextResponse.json({ error: 'Failed to fetch reports' }, { status: 500 });
  }
}
</file>

<file path="src/app/api/user/profile/route.ts">
import { NextRequest, NextResponse } from 'next/server';
import { getUserFromRequest, requireAuth } from '@/lib/auth-server';
import { getUserById, updateUser } from '@/lib/db';

export async function GET(request: NextRequest) {
  try {
    const user = await getUserFromRequest(request);
    
    if (!user) {
      return NextResponse.json(
        { error: '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω' },
        { status: 401 }
      );
    }

    // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ –ø–æ–ª—É—á–∞–µ–º —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ –ø–æ–ª—è –ø—Ä–æ—Ñ–∏–ª—è –∏–∑ –ë–î
    const full = await getUserById(user.id);

    return NextResponse.json({
      success: true,
      user: {
        id: user.id,
        telegram_id: user.telegram_id,
        first_name: user.first_name,
        last_name: user.last_name,
        username: user.username,
        display_name: user.display_name,
        created_at: user.created_at,
        updated_at: user.updated_at,
        // –ù–æ–≤—ã–µ –ø–æ–ª—è –¥–ª—è UI –ª–∏—á–Ω–æ–≥–æ –∫–∞–±–∏–Ω–µ—Ç–∞
        browser_login: full?.browser_login || null,
        password_set_at: full?.password_set_at || null,
        last_login_at: full?.last_login_at || null
      }
    });

  } catch (error) {
    console.error('Profile error:', error);
    return NextResponse.json(
      { error: '–í–Ω—É—Ç—Ä–µ–Ω–Ω—è—è –æ—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞' },
      { status: 500 }
    );
  }
}

// –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (—Å–µ–π—á–∞—Å –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ display_name)
export async function PATCH(request: NextRequest) {
  try {
    const user = await requireAuth(request);

    const body = await request.json();
    const { display_name } = body;

    if (display_name === undefined) {
      return NextResponse.json(
        { error: '–ù–µ –ø–µ—Ä–µ–¥–∞–Ω–æ –ø–æ–ª–µ display_name' },
        { status: 400 }
      );
    }

    if (typeof display_name !== 'string') {
      return NextResponse.json(
        { error: 'display_name –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —Å—Ç—Ä–æ–∫–æ–π' },
        { status: 400 }
      );
    }

    const trimmed = display_name.trim();
    if (trimmed.length < 2) {
      return NextResponse.json(
        { error: '–ò–º—è –¥–æ–ª–∂–Ω–æ —Å–æ–¥–µ—Ä–∂–∞—Ç—å –º–∏–Ω–∏–º—É–º 2 —Å–∏–º–≤–æ–ª–∞' },
        { status: 400 }
      );
    }
    if (trimmed.length > 50) {
      return NextResponse.json(
        { error: '–ò–º—è –Ω–µ –¥–æ–ª–∂–Ω–æ –ø—Ä–µ–≤—ã—à–∞—Ç—å 50 —Å–∏–º–≤–æ–ª–æ–≤' },
        { status: 400 }
      );
    }

    // –û–±–Ω–æ–≤–ª—è–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ –µ–≥–æ telegram_id (updateUser –æ–∂–∏–¥–∞–µ—Ç telegramId)
    const updated = await updateUser(user.telegram_id, { display_name: trimmed });

    return NextResponse.json({
      success: true,
      user: updated,
      message: '–ò–º—è —É—Å–ø–µ—à–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω–æ'
    });
  } catch (error) {
    if (error instanceof Error && error.message === 'Unauthorized') {
      return NextResponse.json({ error: '–¢—Ä–µ–±—É–µ—Ç—Å—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è' }, { status: 401 });
    }
    console.error('Profile update error:', error);
    return NextResponse.json(
      { error: '–í–Ω—É—Ç—Ä–µ–Ω–Ω—è—è –æ—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞' },
      { status: 500 }
    );
  }
}
</file>

<file path="src/components/UserManagement.tsx">
'use client';

import { useState, useEffect } from 'react';
import { getAuthHeaders } from '@/lib/auth';

interface User {
  id: number;
  telegram_id: number;
  first_name: string;
  last_name?: string;
  username?: string;
  display_name?: string;
  role?: 'admin' | 'demo' | 'master';
  is_blocked?: boolean;
  blocked_at?: string;
  created_at?: string;
  updated_at?: string;
}

interface Shift {
  id: number;
  user_id: number;
  date: string;
  hours: number;
  steam_bath: number;
  brand_steam: number;
  intro_steam: number;
  scrubbing: number;
  masters: number;
  total: number;
  created_at?: string;
}

interface UserManagementProps {
  onUserSelect?: (userId: number) => void;
  readonly?: boolean;
}

export default function UserManagement({ onUserSelect, readonly = false }: UserManagementProps) {
  const [users, setUsers] = useState<User[]>([]);
  const [selectedUser, setSelectedUser] = useState<User | null>(null);
  const [userShifts, setUserShifts] = useState<Shift[]>([]);
  const [loading, setLoading] = useState(true);
  const [shiftsLoading, setShiftsLoading] = useState(false);
  const [showUserDetails, setShowUserDetails] = useState(false);
  const roles: Array<'admin' | 'master' | 'demo'> = ['admin', 'master', 'demo'];

  useEffect(() => {
    loadUsers();
  }, []);

  const loadUsers = async () => {
    try {
      setLoading(true);
      const response = await fetch('/api/users', { headers: getAuthHeaders() });
      const data = await response.json();
      
      if (!response.ok) {
        throw new Error(data.error || '–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π');
      }
      
      if (data.success) {
        setUsers(data.users);
      } else {
        throw new Error(data.error || '–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π');
      }
    } catch (error) {
      console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π:', error);
      const errorMessage = error instanceof Error ? error.message : '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞';
      alert(`–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏: ${errorMessage}`);
    } finally {
      setLoading(false);
    }
  };

  const loadUserShifts = async (userId: number) => {
    try {
      setShiftsLoading(true);
      const response = await fetch(`/api/users/${userId}`, { headers: getAuthHeaders() });
      const data = await response.json();
      
      if (!response.ok) {
        throw new Error(data.error || '–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å–º–µ–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è');
      }
      
      if (data.success) {
        setUserShifts(data.shifts);
      } else {
        throw new Error(data.error || '–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å —Å–º–µ–Ω—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è');
      }
    } catch (error) {
      console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å–º–µ–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:', error);
      const errorMessage = error instanceof Error ? error.message : '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞';
      alert(`–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–º–µ–Ω: ${errorMessage}`);
    } finally {
      setShiftsLoading(false);
    }
  };

  const handleUserAction = async (userId: number, action: 'block' | 'unblock' | 'delete') => {
    if (readonly) {
      alert('–î–µ–º–æ —Ä–µ–∂–∏–º: –∏–∑–º–µ–Ω–µ–Ω–∏—è –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã');
      return;
    }
    try {
      if (action === 'delete') {
        if (!confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è? –í—Å–µ –µ–≥–æ —Å–º–µ–Ω—ã —Ç–∞–∫–∂–µ –±—É–¥—É—Ç —É–¥–∞–ª–µ–Ω—ã.')) {
          return;
        }
        const response = await fetch(`/api/users/${userId}`, {
          method: 'DELETE',
          headers: getAuthHeaders(),
        });
        const data = await response.json();
        
        if (!response.ok) {
          throw new Error(data.error || '–û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è');
        }
        
        if (data.success) {
          alert('–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É—Å–ø–µ—à–Ω–æ —É–¥–∞–ª–µ–Ω');
          await loadUsers();
          if (selectedUser?.id === userId) {
            setSelectedUser(null);
            setUserShifts([]);
            setShowUserDetails(false);
          }
        } else {
          throw new Error(data.error || '–ù–µ —É–¥–∞–ª–æ—Å—å —É–¥–∞–ª–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è');
        }
      } else {
        const response = await fetch(`/api/users/${userId}`, {
          method: 'PATCH',
          headers: {
            'Content-Type': 'application/json',
            ...getAuthHeaders(),
          },
          body: JSON.stringify({ action }),
        });
        const data = await response.json();
        
        if (!response.ok) {
          throw new Error(data.error || `–û—à–∏–±–∫–∞ –ø—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ –¥–µ–π—Å—Ç–≤–∏—è: ${action}`);
        }
        
        if (data.success) {
          const actionText = action === 'block' ? '–∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω' : '—Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω';
          alert(`–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É—Å–ø–µ—à–Ω–æ ${actionText}`);
          await loadUsers();
          if (selectedUser?.id === userId) {
            setSelectedUser(data.user);
          }
        } else {
          throw new Error(data.error || `–ù–µ —É–¥–∞–ª–æ—Å—å –≤—ã–ø–æ–ª–Ω–∏—Ç—å –¥–µ–π—Å—Ç–≤–∏–µ: ${action}`);
        }
      }
    } catch (error) {
      console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ –¥–µ–π—Å—Ç–≤–∏—è:', error);
      const errorMessage = error instanceof Error ? error.message : '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞';
      alert(`–û—à–∏–±–∫–∞: ${errorMessage}`);
    }
  };

  const handleRoleChange = async (userId: number, role: 'admin' | 'master' | 'demo') => {
    if (readonly) {
      alert('–î–µ–º–æ —Ä–µ–∂–∏–º: –∏–∑–º–µ–Ω–µ–Ω–∏—è –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã');
      return;
    }
    try {
      const response = await fetch(`/api/users/${userId}`, {
        method: 'PATCH',
        headers: {
          'Content-Type': 'application/json',
          ...getAuthHeaders(),
        },
        body: JSON.stringify({ action: 'set_role', role })
      });
      const data = await response.json();
      if (!response.ok) {
        throw new Error(data.error || '–û—à–∏–±–∫–∞ –ø—Ä–∏ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–∏ —Ä–æ–ª–∏');
      }
      if (data.success) {
        // –û–±–Ω–æ–≤–ª—è–µ–º –ª–æ–∫–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
        setUsers(prev => prev.map(u => (u.id === userId ? { ...u, role } : u)));
        if (selectedUser?.id === userId) {
          setSelectedUser({ ...selectedUser, role });
        }
        alert('–†–æ–ª—å –æ–±–Ω–æ–≤–ª–µ–Ω–∞');
      } else {
        throw new Error(data.error || '–ù–µ —É–¥–∞–ª–æ—Å—å –æ–±–Ω–æ–≤–∏—Ç—å —Ä–æ–ª—å');
      }
    } catch (error) {
      console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–∏ —Ä–æ–ª–∏:', error);
      const errorMessage = error instanceof Error ? error.message : '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞';
      alert(`–û—à–∏–±–∫–∞: ${errorMessage}`);
    }
  };

  const handleUserSelect = (user: User) => {
    setSelectedUser(user);
    setShowUserDetails(true);
    loadUserShifts(user.id);
    if (onUserSelect) {
      onUserSelect(user.id);
    }
  };

  const formatDate = (dateString: string) => {
    return new Date(dateString).toLocaleDateString('ru-RU');
  };

  const formatCurrency = (amount: number) => {
    return new Intl.NumberFormat('ru-RU', {
      style: 'currency',
      currency: 'RUB',
      minimumFractionDigits: 0,
    }).format(amount);
  };

  if (loading) {
    return <div className="loading">–ó–∞–≥—Ä—É–∑–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π...</div>;
  }

  return (
    <div className="user-management">
      {readonly && (
        <div className="readonly-banner">
          <strong>–î–µ–º–æ —Ä–µ–∂–∏–º:</strong> —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–æ–ª—è–º–∏ –∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è–º–∏ –æ—Ç–∫–ª—é—á–µ–Ω–æ.
        </div>
      )}
      <div className="users-section">
        <h3>–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ ({users.length})</h3>
        <div className="users-list">
          {users.map((user) => (
            <div
              key={user.id}
              className={`user-card ${user.is_blocked ? 'blocked' : ''} ${
                selectedUser?.id === user.id ? 'selected' : ''
              }`}
              onClick={() => handleUserSelect(user)}
            >
              <div className="user-info">
                <div className="user-name">
                  {user.display_name || `${user.first_name} ${user.last_name || ''}`}
                  {user.username && <span className="username">@{user.username}</span>}
                  {user.display_name && (
                    <span className="telegram-name">({user.first_name} {user.last_name || ''})</span>
                  )}
                </div>
              <div className="user-meta">
                ID: {user.telegram_id}
                {user.role && (
                  <span className="role-badge">–†–æ–ª—å: {user.role}</span>
                )}
                {user.is_blocked && <span className="blocked-badge">–ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω</span>}
              </div>
                <div className="user-date">
                  –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è: {user.created_at ? formatDate(user.created_at) : '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ'}
                </div>
              </div>
              <div className="user-actions">
                <div className="role-select">
                  <label>–†–æ–ª—å:&nbsp;
                    <select
                      value={user.role || 'master'}
                      onChange={(e) => {
                        e.stopPropagation();
                        const value = e.target.value as 'admin' | 'master' | 'demo';
                        handleRoleChange(user.id, value);
                      }}
                      disabled={readonly}
                    >
                      {roles.map(r => (
                        <option key={r} value={r}>{r}</option>
                      ))}
                    </select>
                  </label>
                </div>
                {user.is_blocked ? (
                  <button
                    className="action-btn unblock"
                    onClick={(e) => {
                      e.stopPropagation();
                      handleUserAction(user.id, 'unblock');
                    }}
                    disabled={readonly}
                  >
                    –†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å
                  </button>
                ) : (
                  <button
                    className="action-btn block"
                    onClick={(e) => {
                      e.stopPropagation();
                      handleUserAction(user.id, 'block');
                    }}
                    disabled={readonly}
                  >
                    –ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å
                  </button>
                )}
                <button
                  className="action-btn delete"
                  onClick={(e) => {
                    e.stopPropagation();
                    handleUserAction(user.id, 'delete');
                  }}
                  disabled={readonly}
                >
                  –£–¥–∞–ª–∏—Ç—å
                </button>
              </div>
            </div>
          ))}
        </div>
      </div>

      {showUserDetails && selectedUser && (
        <div className="user-details">
          <div className="details-header">
            <h3>
              –°–º–µ–Ω—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: {selectedUser.display_name || `${selectedUser.first_name} ${selectedUser.last_name || ''}`}
            </h3>
            <button
              className="close-btn"
              onClick={() => {
                setShowUserDetails(false);
                setSelectedUser(null);
                setUserShifts([]);
              }}
            >
              ‚úï
            </button>
          </div>

          {shiftsLoading ? (
            <div className="loading">–ó–∞–≥—Ä—É–∑–∫–∞ —Å–º–µ–Ω...</div>
          ) : userShifts.length > 0 ? (
            <div className="shifts-table-container">
              <table className="shifts-table">
                <thead>
                  <tr>
                    <th>–î–∞—Ç–∞</th>
                    <th>–ß–∞—Å—ã</th>
                    <th>–ü</th>
                    <th>–§</th>
                    <th>–û</th>
                    <th>–°</th>
                    <th>–ú–∞—Å—Ç–µ—Ä–∞</th>
                    <th>–ò—Ç–æ–≥–æ</th>
                  </tr>
                </thead>
                <tbody>
                  {userShifts.map((shift) => (
                    <tr key={shift.id}>
                      <td>{formatDate(shift.date)}</td>
                      <td>{shift.hours}</td>
                      <td>{shift.steam_bath}</td>
                      <td>{shift.brand_steam}</td>
                      <td>{shift.intro_steam}</td>
                      <td>{shift.scrubbing}</td>
                      <td>{shift.masters}</td>
                      <td>{formatCurrency(shift.total)}</td>
                    </tr>
                  ))}
                </tbody>
              </table>
              <div className="shifts-summary">
                <strong>
                  –í—Å–µ–≥–æ —Å–º–µ–Ω: {userShifts.length} | 
                  –û–±—â–∞—è —Å—É–º–º–∞: {formatCurrency(userShifts.reduce((sum, shift) => sum + shift.total, 0))}
                </strong>
              </div>
            </div>
          ) : (
            <div className="no-data">–£ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ–∫–∞ –Ω–µ—Ç —Å–º–µ–Ω</div>
          )}
        </div>
      )}

      <style jsx>{`
        .user-management {
          display: flex;
          flex-direction: column;
          gap: 20px;
        }

        .readonly-banner {
          background: #fff3cd;
          color: #856404;
          border: 1px solid #ffeeba;
          border-radius: 8px;
          padding: 10px 14px;
          font-size: 0.9em;
        }

        .users-section h3 {
          margin: 0 0 15px 0;
          color: #333;
        }

        .users-list {
          display: grid;
          grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
          gap: 15px;
        }

        .user-card {
          border: 1px solid #ddd;
          border-radius: 8px;
          padding: 15px;
          background: white;
          cursor: pointer;
          transition: all 0.2s ease;
        }

        .user-card:hover {
          border-color: #007bff;
          box-shadow: 0 2px 8px rgba(0, 123, 255, 0.1);
        }

        .user-card.selected {
          border-color: #007bff;
          background: #f8f9fa;
        }

        .user-card.blocked {
          border-color: #dc3545;
          background: #fff5f5;
        }

        .user-info {
          margin-bottom: 10px;
        }

        .user-name {
          font-weight: bold;
          margin-bottom: 5px;
        }

        .username {
          color: #666;
          font-weight: normal;
          margin-left: 8px;
        }

        .user-meta {
          font-size: 0.9em;
          color: #666;
          margin-bottom: 3px;
        }

        .user-date {
          font-size: 0.8em;
          color: #999;
        }

        .blocked-badge {
          background: #dc3545;
          color: white;
          padding: 2px 6px;
          border-radius: 4px;
          font-size: 0.8em;
          margin-left: 8px;
        }

        .role-badge {
          background: #e9ecef;
          color: #333;
          padding: 2px 6px;
          border-radius: 4px;
          font-size: 0.8em;
          margin-left: 8px;
        }

        .user-actions {
          display: flex;
          gap: 8px;
        }

        .role-select select {
          padding: 6px 8px;
          border: 1px solid #ddd;
          border-radius: 4px;
          margin-right: 8px;
        }

        .action-btn {
          padding: 6px 12px;
          border: none;
          border-radius: 4px;
          cursor: pointer;
          font-size: 0.9em;
          transition: background-color 0.2s ease;
        }

        .action-btn:disabled {
          opacity: 0.6;
          cursor: not-allowed;
        }

        .action-btn.block {
          background: #ffc107;
          color: #000;
        }

        .action-btn.block:hover {
          background: #e0a800;
        }

        .action-btn.unblock {
          background: #28a745;
          color: white;
        }

        .action-btn.unblock:hover {
          background: #218838;
        }

        .action-btn.delete {
          background: #dc3545;
          color: white;
        }

        .action-btn.delete:hover {
          background: #c82333;
        }

        .user-details {
          border: 1px solid #ddd;
          border-radius: 8px;
          padding: 20px;
          background: white;
          margin-top: 20px;
        }

        .details-header {
          display: flex;
          justify-content: space-between;
          align-items: center;
          margin-bottom: 20px;
        }

        .details-header h3 {
          margin: 0;
          color: #333;
        }

        .close-btn {
          background: #f8f9fa;
          border: 1px solid #ddd;
          border-radius: 4px;
          padding: 8px 12px;
          cursor: pointer;
          font-size: 16px;
        }

        .close-btn:hover {
          background: #e9ecef;
        }

        .shifts-table-container {
          overflow-x: auto;
        }

        .shifts-table {
          width: 100%;
          border-collapse: collapse;
          margin-bottom: 15px;
        }

        .shifts-table th,
        .shifts-table td {
          padding: 10px;
          text-align: left;
          border-bottom: 1px solid #ddd;
        }

        .shifts-table th {
          background: #f8f9fa;
          font-weight: bold;
        }

        .shifts-table tr:hover {
          background: #f8f9fa;
        }

        .shifts-summary {
          text-align: right;
          padding: 10px;
          background: #f8f9fa;
          border-radius: 4px;
        }

        .loading {
          text-align: center;
          padding: 20px;
          color: #666;
        }

        .no-data {
          text-align: center;
          padding: 40px;
          color: #999;
          font-style: italic;
        }

        @media (max-width: 768px) {
          .users-list {
            grid-template-columns: 1fr;
          }

          .user-actions {
            flex-direction: column;
          }

          .action-btn {
            width: 100%;
          }

          .details-header {
            flex-direction: column;
            align-items: flex-start;
            gap: 10px;
          }

          .shifts-table {
            font-size: 0.9em;
          }

          .shifts-table th,
          .shifts-table td {
            padding: 8px 4px;
          }
        }
      `}</style>
    </div>
  );
}
</file>

<file path="src/hooks/useTelegramAuth.ts">
'use client';

import { useState, useEffect } from 'react';
import { 
  AuthenticatedUser, 
  getUserFromStorage, 
  saveUserToStorage, 
  removeUserFromStorage,
  isTelegramWebApp,
  getTelegramInitData 
} from '@/lib/auth';

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
const verifyUserExists = async (user: AuthenticatedUser): Promise<boolean> => {
  try {
    const response = await fetch('/api/user/profile', {
      method: 'GET',
      headers: {
        'x-telegram-id': user.telegram_id.toString(),
      },
    });
    
    return response.ok;
  } catch (error) {
    console.error('Error verifying user existence:', error);
    return false;
  }
};

export function useTelegramAuth() {
  const [user, setUser] = useState<AuthenticatedUser | null>(null);
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState<string | null>(null);

  useEffect(() => {
    const initAuth = async () => {
      try {
        console.log('=== CLIENT AUTH DEBUG ===');
        console.log('Starting authentication process...');
        
        // 0) –°–Ω–∞—á–∞–ª–∞ –ø—Ä–æ–≤–µ—Ä—è–µ–º cookie-—Å–µ—Å—Å–∏—é (–±—Ä–∞—É–∑–µ—Ä–Ω—ã–π –≤—Ö–æ–¥)
        try {
          const meRes = await fetch('/api/auth/me', { method: 'GET' });
          if (meRes.ok) {
            const meData = await meRes.json();
            if (meData && meData.authenticated && meData.user) {
              console.log('Authenticated via cookie session:', meData.user);
              setUser(meData.user);
              saveUserToStorage(meData.user);
              setLoading(false);
              return;
            }
          }
        } catch (cookieErr) {
          console.log('Cookie session not available:', cookieErr);
        }

        // –°–Ω–∞—á–∞–ª–∞ –ø—Ä–æ–≤–µ—Ä—è–µ–º localStorage
        const storedUser = getUserFromStorage();
        if (storedUser) {
          console.log('Found stored user in localStorage:', storedUser);
          
          // –î–ª—è fallback –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (–±—Ä–∞—É–∑–µ—Ä–Ω—ã—Ö) –Ω–µ –ø—Ä–æ–≤–µ—Ä—è–µ–º –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö
          if (storedUser.telegram_id === 87654321) {
            console.log('Found fallback user, using directly without DB verification');
            setUser(storedUser);
            setLoading(false);
            return;
          }
          
          // –î–ª—è —Ä–µ–∞–ª—å–Ω—ã—Ö Telegram –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –ø—Ä–æ–≤–µ—Ä—è–µ–º, —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
          const userExists = await verifyUserExists(storedUser);
          if (userExists) {
            setUser(storedUser);
            setLoading(false);
            return;
          } else {
            console.log('User from localStorage no longer exists in database, clearing localStorage');
            removeUserFromStorage();
            // –ü—Ä–æ–¥–æ–ª–∂–∞–µ–º —Å –æ–±—ã—á–Ω–æ–π –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–µ–π
          }
        }

        console.log('No stored user found, checking Telegram WebApp...');
        console.log('isTelegramWebApp() result:', isTelegramWebApp());
        
        // –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–µ—Ç –≤ localStorage, –ø—Ä–æ–≤–µ—Ä—è–µ–º Telegram WebApp
        if (isTelegramWebApp()) {
          console.log('Running in Telegram WebApp');
           console.log('Telegram WebApp object:', typeof window !== 'undefined' && (window as any).Telegram?.WebApp);
          
          const initData = getTelegramInitData();
          console.log('getTelegramInitData() result:', initData);
          console.log('initData type:', typeof initData);
          console.log('initData length:', initData ? initData.length : 'null/undefined');
          
          if (initData) {
            console.log('Attempting to authenticate with Telegram...');
            await authenticateWithTelegram(initData);
          } else {
            console.log('No initData available, using fallback user');
            // –ï—Å–ª–∏ –Ω–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –¥–∞–Ω–Ω—ã–µ Telegram, –∏—Å–ø–æ–ª—å–∑—É–µ–º fallback –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            await authenticateWithFallbackUser();
          }
        } else {
          console.log('Not running in Telegram WebApp, using fallback user');
          // –ï—Å–ª–∏ –Ω–µ –≤ Telegram WebApp, –∏—Å–ø–æ–ª—å–∑—É–µ–º fallback –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
          await authenticateWithFallbackUser();
        }
      } catch (err) {
        console.error('–û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏:', err);
        console.error('Error details:', {
          message: err instanceof Error ? err.message : 'Unknown error',
          stack: err instanceof Error ? err.stack : 'No stack trace'
        });
        setError('–û—à–∏–±–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏');
      } finally {
        setLoading(false);
      }
    };

    initAuth();
  }, []);

  const authenticateWithTelegram = async (initData: string) => {
    try {
      setLoading(true);
      setError(null);

      const response = await fetch('/api/auth/telegram', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({ initData }),
      });

      if (!response.ok) {
        const errorData = await response.json();
        throw new Error(errorData.error || '–û—à–∏–±–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏');
      }

      const data = await response.json();
      
      if (data.success && data.user) {
        setUser(data.user);
        saveUserToStorage(data.user);
      } else {
        throw new Error('–ù–µ–≤–µ—Ä–Ω—ã–π –æ—Ç–≤–µ—Ç —Å–µ—Ä–≤–µ—Ä–∞');
      }
    } catch (err) {
      console.error('–û—à–∏–±–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ —á–µ—Ä–µ–∑ Telegram:', err);
      setError(err instanceof Error ? err.message : '–û—à–∏–±–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏');
    } finally {
      setLoading(false);
    }
  };

  const authenticateWithFallbackUser = async () => {
    try {
      const isInTelegram = isTelegramWebApp();
      
      const fallbackUser: AuthenticatedUser = {
        id: 0, // –í—Ä–µ–º–µ–Ω–Ω—ã–π ID –¥–ª—è –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        telegram_id: 87654321,
        first_name: 'New',
        last_name: 'User',
        username: 'newuser'
      };

      // –ï—Å–ª–∏ –≤—Ö–æ–¥ –ù–ï –∏–∑ Telegram (—Ç.–µ. –∏–∑ –±—Ä–∞—É–∑–µ—Ä–∞), –¥–æ–±–∞–≤–ª—è–µ–º display_name
      // —á—Ç–æ–±—ã –æ–±–æ–π—Ç–∏ –ø—Ä–æ–≤–µ—Ä–∫—É —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
      if (!isInTelegram) {
        fallbackUser.display_name = 'Browser User';
      }
      // –ï—Å–ª–∏ –≤—Ö–æ–¥ –∏–∑ Telegram, display_name –Ω–∞–º–µ—Ä–µ–Ω–Ω–æ –Ω–µ —É–∫–∞–∑—ã–≤–∞–µ–º, 
      // —á—Ç–æ–±—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–ø–∞–ª –Ω–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é

      setUser(fallbackUser);
      saveUserToStorage(fallbackUser);
    } catch (err) {
      console.error('–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è fallback –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:', err);
      setError('–û—à–∏–±–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏');
    } finally {
      setLoading(false);
    }
  };

  const logout = () => {
    // –í—ã—Ö–æ–¥–∏–º –∏–∑ cookie-—Å–µ—Å—Å–∏–∏, –µ—Å–ª–∏ –æ–Ω–∞ –µ—Å—Ç—å
    fetch('/api/auth/logout', { method: 'POST' }).catch(() => {});
    setUser(null);
    removeUserFromStorage();
  };

  return {
    user,
    loading,
    error,
    logout,
    isAuthenticated: !!user,
  };
}
</file>

<file path=".gitignore">
# See https://help.github.com/articles/ignoring-files/ for more about ignoring files.

# dependencies
/node_modules
/.pnp
.pnp.*
.yarn/*
!.yarn/patches
!.yarn/plugins
!.yarn/releases
!.yarn/versions

# testing
/coverage

# next.js
/.next/
/out/

# production
/build

# misc
.DS_Store
*.pem

# debug
npm-debug.log*
yarn-debug.log*
yarn-error.log*
.pnpm-debug.log*

# env files (can opt-in for committing if needed)
.env*

# vercel
.vercel

# typescript
*.tsbuildinfo
next-env.d.ts
.env*.local
</file>

<file path="scripts/init-local-postgres.sql">
-- –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è PostgreSQL —Ç–∞–±–ª–∏—Ü –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏

-- –°–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
CREATE TABLE IF NOT EXISTS users (
  id SERIAL PRIMARY KEY,
  telegram_id BIGINT NOT NULL UNIQUE,
  first_name TEXT NOT NULL,
  last_name TEXT,
  username TEXT,
  display_name TEXT,
  role TEXT NOT NULL DEFAULT 'master',
  browser_login TEXT,
  password_hash TEXT,
  password_set_at TIMESTAMP,
  last_login_at TIMESTAMP,
  is_blocked BOOLEAN DEFAULT FALSE,
  blocked_at TIMESTAMP,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- –£–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–Ω–¥–µ–∫—Å –¥–ª—è –ª–æ–≥–∏–Ω–∞ (–ø–æ–∑–≤–æ–ª—è–µ—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ NULL)
CREATE UNIQUE INDEX IF NOT EXISTS idx_users_browser_login ON users(browser_login);

-- –°–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã shifts
CREATE TABLE IF NOT EXISTS shifts (
  id SERIAL PRIMARY KEY,
  user_id INTEGER NOT NULL REFERENCES users(id) ON DELETE CASCADE,
  date TEXT NOT NULL,
  hours REAL NOT NULL,
  steam_bath INTEGER NOT NULL DEFAULT 0,
  brand_steam INTEGER NOT NULL DEFAULT 0,
  intro_steam INTEGER NOT NULL DEFAULT 0,
  scrubbing INTEGER NOT NULL DEFAULT 0,
  masters INTEGER NOT NULL DEFAULT 1,
  total REAL NOT NULL,
  hourly_rate REAL NOT NULL,
  steam_bath_price REAL NOT NULL,
  brand_steam_price REAL NOT NULL,
  intro_steam_price REAL NOT NULL,
  scrubbing_price REAL NOT NULL,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- –°–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã prices (–æ–±—â–∏–µ —Ü–µ–Ω—ã –¥–ª—è –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π)
CREATE TABLE IF NOT EXISTS prices (
  id SERIAL PRIMARY KEY,
  name TEXT NOT NULL UNIQUE,
  price REAL NOT NULL,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- –°–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã default_prices –¥–ª—è –∑–Ω–∞—á–µ–Ω–∏–π –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
CREATE TABLE IF NOT EXISTS default_prices (
  id SERIAL PRIMARY KEY,
  name TEXT NOT NULL UNIQUE,
  price REAL NOT NULL
);

-- –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–∞—á–∞–ª—å–Ω—ã—Ö —Ü–µ–Ω –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
INSERT INTO default_prices (name, price) VALUES 
  ('–ü–æ—á–∞—Å–æ–≤–∞—è —Å—Ç–∞–≤–∫–∞', 400),
  ('–ü—É—Ç–µ–≤–æ–µ –ø–∞—Ä–µ–Ω–∏–µ', 3200),
  ('–§–∏—Ä–º–µ–Ω–Ω–æ–µ –ø–∞—Ä–µ–Ω–∏–µ', 4500),
  ('–û–∑–Ω–∞–∫–æ–º–∏—Ç–µ–ª—å–Ω–æ–µ –ø–∞—Ä–µ–Ω–∏–µ', 2500),
  ('–°–∫—Ä–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ', 1200)
ON CONFLICT (name) DO NOTHING;

-- –í—ã–≤–æ–¥ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Å–æ–∑–¥–∞–Ω–Ω—ã—Ö —Ç–∞–±–ª–∏—Ü–∞—Ö
\echo '–¢–∞–±–ª–∏—Ü—ã —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω—ã:'
\dt
</file>

<file path="src/app/account/page.tsx">
'use client';

import React, { useState } from 'react';
import { useRouter } from 'next/navigation';
import { useTelegramAuth } from '@/hooks/useTelegramAuth';
import { getAuthHeaders } from '@/lib/auth';

export default function AccountPage() {
  const router = useRouter();
  const { user, loading } = useTelegramAuth();

  const [login, setLogin] = useState('');
  const [password, setPassword] = useState('');
  const [confirmPassword, setConfirmPassword] = useState('');
  const [currentPassword, setCurrentPassword] = useState('');
  const [status, setStatus] = useState<string | null>(null);
  const [error, setError] = useState<string | null>(null);
  const [logoutStatus, setLogoutStatus] = useState<string | null>(null);
  const [profileExtras, setProfileExtras] = useState<{ browser_login?: string | null; password_set_at?: string | null } | null>(null);
  const [displayName, setDisplayName] = useState<string>('');
  const [isEditingName, setIsEditingName] = useState<boolean>(false);
  const [nameInput, setNameInput] = useState<string>('');
  const [nameError, setNameError] = useState<string | null>(null);
  const [nameStatus, setNameStatus] = useState<string | null>(null);

  React.useEffect(() => {
    if (loading) return;
    const checkAuth = async () => {
      try {
        const res = await fetch('/api/auth/me', { headers: getAuthHeaders() });
        if (!res.ok) {
          router.replace('/login');
        }
      } catch {
        router.replace('/login');
      }
    };
    checkAuth();
  }, [loading, router]);

  React.useEffect(() => {
    if (!user || loading) return;

    const loadProfile = async () => {
      try {
        const res = await fetch('/api/user/profile', { headers: getAuthHeaders() });
        const data = await res.json();
        if (res.ok && data?.user) {
          setProfileExtras({
            browser_login: data.user.browser_login ?? null,
            password_set_at: data.user.password_set_at ?? null,
          });
          const pref = (data.user.browser_login ?? user.username ?? '').trim();
          if (pref) setLogin(pref);
          const dn = (data.user.display_name ?? `${user.first_name}${user.last_name ? ' ' + user.last_name : ''}`).trim();
          setDisplayName(dn);
          setNameInput(dn);
        } else {
          if (user.username) setLogin(user.username);
          const dn = (user.display_name ?? `${user.first_name}${user.last_name ? ' ' + user.last_name : ''}`).trim();
          setDisplayName(dn);
          setNameInput(dn);
        }
      } catch {
        if (user.username) setLogin(user.username);
        const dn = (user.display_name ?? `${user.first_name}${user.last_name ? ' ' + user.last_name : ''}`).trim();
        setDisplayName(dn);
        setNameInput(dn);
      }
    };
    loadProfile();
  }, [user, loading]);

  const handleSaveDisplayName = async () => {
    setNameError(null);
    setNameStatus(null);
    const trimmed = nameInput.trim();
    if (trimmed.length < 2) {
      setNameError('–ò–º—è –º–∏–Ω–∏–º—É–º 2 —Å–∏–º–≤–æ–ª–∞');
      return;
    }
    if (trimmed.length > 50) {
      setNameError('–ò–º—è –Ω–µ –¥–æ–ª–∂–Ω–æ –ø—Ä–µ–≤—ã—à–∞—Ç—å 50 —Å–∏–º–≤–æ–ª–æ–≤');
      return;
    }
    try {
      const res = await fetch('/api/user/profile', {
        method: 'PATCH',
        headers: { 'Content-Type': 'application/json', ...getAuthHeaders() },
        body: JSON.stringify({ display_name: trimmed })
      });
      const data = await res.json();
      if (res.ok) {
        setDisplayName(trimmed);
        setIsEditingName(false);
        setNameStatus('–ò–º—è –æ–±–Ω–æ–≤–ª–µ–Ω–æ');
      } else {
        setNameError(data.error || '–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∏–º–µ–Ω–∏');
      }
    } catch {
      setNameError('–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è');
    }
  };

  const handleSetPassword = async (e: React.FormEvent) => {
    e.preventDefault();
    setError(null);
    setStatus(null);

    if (password !== confirmPassword) {
      setError('–ü–∞—Ä–æ–ª–∏ –Ω–µ —Å–æ–≤–ø–∞–¥–∞—é—Ç');
      return;
    }

    try {
      const body: any = { browser_login: login, new_password: password };
      if (profileExtras?.password_set_at) {
        body.current_password = currentPassword;
      }

      const res = await fetch('/api/user/set-password', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json', ...getAuthHeaders() },
        body: JSON.stringify(body),
      });
      const data = await res.json();

      if (res.ok) {
        setStatus('–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã');
        setProfileExtras({ browser_login: login, password_set_at: new Date().toISOString() });
        setPassword('');
        setConfirmPassword('');
        setCurrentPassword('');
      } else {
        setError(data.error || '–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è');
      }
    } catch {
      setError('–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è');
    }
  };

  const handleLogout = async () => {
    try {
      const res = await fetch('/api/auth/logout', { method: 'POST', headers: getAuthHeaders() });
      if (res.ok) {
        setLogoutStatus('–í—ã –≤—ã—à–ª–∏ –∏–∑ —Å–∏—Å—Ç–µ–º—ã');
        router.push('/login');
      } else {
        setLogoutStatus('–û—à–∏–±–∫–∞ –≤—ã—Ö–æ–¥–∞');
      }
    } catch {
      setLogoutStatus('–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è');
    }
  };

  if (loading) {
    return (
      <>
        <style jsx global>{`
          * { margin: 0; padding: 0; box-sizing: border-box; }
          :root {
            --primary-color: #4A2B1B;
            --secondary-color: #7A3E2D;
            --accent-color: #E9D5B5;
            --background-main: #F2E5D3;
            --font-color: #2C1A0F;
            --primary-light: #5D3426;
            --primary-dark: #3A2015;
            --secondary-light: #8B4A38;
            --secondary-dark: #6A3424;
            --accent-light: #F0E2C8;
            --accent-dark: #DCC49F;
            --background-card: #FEFCF8;
            --background-section: rgba(233, 213, 181, 0.15);
            --shadow-light: rgba(74, 43, 27, 0.1);
            --shadow-medium: rgba(74, 43, 27, 0.15);
            --border-light: rgba(74, 43, 27, 0.2);
          }
          body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: linear-gradient(135deg, var(--background-main) 0%, var(--accent-light) 100%); min-height: 100vh; padding: 32px; color: var(--font-color); }
          .loading-container { display: flex; align-items: center; justify-content: center; height: 100vh; }
        `}</style>
        <div className="flex items-center justify-center h-screen">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
      </>
    );
  }

  if (!user) {
    return (
      <>
        <style jsx global>{`
          * { margin: 0; padding: 0; box-sizing: border-box; }
          body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: linear-gradient(135deg, #F2E5D3 0%, #F0E2C8 100%); min-height: 100vh; padding: 32px; color: #2C1A0F; }
          .loading-container { display: flex; align-items: center; justify-content: center; height: 100vh; }
        `}</style>
        <div className="flex items-center justify-center h-screen">–ù–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω</div>
      </>
    );
  }

  // –û—Å–Ω–æ–≤–Ω—ã–µ —Å—Ç–∏–ª–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –∞–∫–∫–∞—É–Ω—Ç–∞
  const Styles = (
    <style jsx global>{`
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
  
    :root {
      --primary-color: #4A2B1B;
      --secondary-color: #7A3E2D;
      --accent-color: #E9D5B5;
      --background-main: #F2E5D3;
      --font-color: #2C1A0F;
      --primary-light: #5D3426;
      --primary-dark: #3A2015;
      --secondary-light: #8B4A38;
      --secondary-dark: #6A3424;
      --accent-light: #F0E2C8;
      --accent-dark: #DCC49F;
      --background-card: #FEFCF8;
      --background-section: rgba(233, 213, 181, 0.15);
      --shadow-light: rgba(74, 43, 27, 0.1);
      --shadow-medium: rgba(74, 43, 27, 0.15);
      --border-light: rgba(74, 43, 27, 0.2);
    }
  
  body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background: linear-gradient(135deg, var(--background-main) 0%, var(--accent-light) 100%);
    min-height: 100vh;
    padding: clamp(6px, 4vw, 36px);
    color: var(--font-color);
  }
  
  .container {
    width: min(100%, 760px);
    margin: 0 auto;
    background: var(--background-card);
    border-radius: 18px;
    box-shadow: 0 12px 24px var(--shadow-light);
    overflow: hidden;
  }
  
    .header {
      background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
      color: var(--accent-color);
      padding: clamp(20px, 6vw, 40px);
    }

    .header-content {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: clamp(16px, 5vw, 32px);
      flex-wrap: wrap;
      text-align: left;
    }

    .logo {
      width: clamp(72px, 18vw, 120px);
      height: clamp(72px, 18vw, 120px);
      flex-shrink: 0;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .header h1 {
      font-size: 2.5em;
      margin-bottom: 10px;
      text-shadow: 0 2px 4px rgba(0,0,0,0.3);
    }

    .header p {
      font-size: 1.1rem;
      opacity: 0.9;
    }
  
  .content {
    padding: clamp(20px, 6vw, 48px);
  }

  .back-section { margin-bottom: 24px; display: flex; justify-content: flex-start; padding-left: 20px; }
  .back-button { width: auto; }

  .section {
    background: linear-gradient(135deg, var(--background-section) 0%, rgba(122, 62, 45, 0.06) 100%);
    border-radius: 12px;
    padding: 32px;
    margin-bottom: 40px;
    border: 1px solid var(--border-light);
    box-shadow: 0 6px 18px var(--shadow-light);
    position: relative;
    overflow: hidden;
  }

  @media (max-width: 768px) {
    .container {
      border-radius: 14px;
    }

    .content {
      padding: 20px;
    }

    .form-grid {
      grid-template-columns: 1fr;
      gap: 18px;
    }

    .section {
      padding: 22px;
      margin-bottom: 28px;
    }

    .back-section {
      justify-content: flex-start;
      padding-left: 0;
    }

    .buttons-row {
      flex-direction: column;
    }

    .buttons-row .btn {
      width: 100%;
      min-width: 0;
    }
  }

  @media (max-width: 480px) {
    body {
      padding: 8px;
    }

    .logo {
      width: 60px;
      height: 60px;
    }

    .content {
      padding: 16px;
    }

    .section {
      padding: 18px;
    }
  }

  @media (max-width: 420px) {
    body {
      padding: 4px;
    }

    .container {
      border-radius: 10px;
    }
  }
  
  .section::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 2px;
    background: linear-gradient(90deg, var(--primary-color) 0%, var(--secondary-color) 100%);
  }
  
    .section h2 {
      color: var(--primary-color);
      margin-bottom: 25px;
      font-size: 1.6em;
      font-weight: 700;
      text-shadow: 0 1px 2px var(--shadow-light);
    }
  
  .form-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
    gap: 24px;
    margin-bottom: 24px;
  }
  
    .input-group {
      display: flex;
      flex-direction: column;
      gap: 6px;
    }
  
    .input-label {
      font-weight: 600;
      color: var(--font-color);
      margin-bottom: 8px;
      font-size: 14px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
  
  .input-field {
    width: 100%;
    padding: 14px 16px;
    border: 1px solid rgba(74, 43, 27, 0.25);
    border-radius: 12px;
    font-size: 16px;
    background: rgba(255, 255, 255, 0.9);
    color: var(--font-color);
    transition: box-shadow 0.2s ease, border-color 0.2s ease, background 0.2s ease;
    box-shadow: 0 1px 2px rgba(74, 43, 27, 0.08);
  }
  
  .input-field:focus {
    outline: none;
    border-color: var(--primary-color);
    box-shadow: 0 0 0 3px rgba(74, 43, 27, 0.12);
  }

  .readonly-field {
    background: rgba(255, 255, 255, 0.7);
    box-shadow: none;
    border: 1px solid rgba(42, 26, 15, 0.12);
  }

  .btn {
    background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
    color: var(--accent-color);
    border: none;
    padding: 12px 22px;
    border-radius: 12px;
    font-size: 14px;
    font-weight: 700;
    cursor: pointer;
    transition: all 0.25s ease;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    box-shadow: 0 3px 10px var(--shadow-medium);
    text-decoration: none;
    display: inline-block;
  }
  
  .btn:hover {
    transform: translateY(-1px);
    box-shadow: 0 6px 18px rgba(74, 43, 27, 0.35);
    background: linear-gradient(135deg, var(--primary-light) 0%, var(--secondary-light) 100%);
  }
  
    .btn-danger {
      background: linear-gradient(135deg, #dc2626, #b91c1c);
    }

    .btn-danger:hover {
      background: linear-gradient(135deg, #ef4444, #dc2626);
    }

  .btn-secondary {
    background: linear-gradient(135deg, var(--accent-color) 0%, var(--accent-light) 100%);
    color: var(--primary-color);
    border: 2px solid var(--primary-color);
  }

  .btn-secondary:hover {
    background: linear-gradient(135deg, var(--accent-dark) 0%, var(--accent-color) 100%);
  }
  .buttons-row { display: flex; gap: 12px; margin-top: 12px; flex-wrap: wrap; align-items: stretch; }
  .buttons-row .btn { flex: 1 1 auto; min-width: 200px; }
  .status-line { margin-bottom: 16px; font-size: 14px; color: var(--font-color); }

  .status-message {
    text-align: center;
    padding: 12px;
    margin: 16px 0;
    border-radius: 8px;
    font-weight: 500;
  }
  
    .success {
      background: rgba(34, 197, 94, 0.1);
      color: #22c55e;
      border: 1px solid #22c55e;
    }
  
    .error {
      background: rgba(220, 38, 38, 0.1);
      color: #dc2626;
      border: 1px solid #dc2626;
    }
  `}</style>
  );

  // –û–±–Ω–æ–≤–ª—è–µ–º JSX –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –Ω–æ–≤—ã—Ö –∫–ª–∞—Å—Å–æ–≤, –∏—Å–ø—Ä–∞–≤–ª—è—è —Å–∏–Ω—Ç–∞–∫—Å–∏—Å –∏ —Ä–∞–∑–º–µ—â–µ–Ω–∏–µ –∫–Ω–æ–ø–∫–∏
  return (
    <>
      {Styles}
      <div className="container">
        <header className="header">
          <div className="header-content">
            <div className="logo">
              <img src="/logo.svg" alt="–õ–æ–≥–æ—Ç–∏–ø" style={{ width: '100%', height: '100%' }} />
            </div>
            <div className="header-text">
              <h1>–õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç</h1>
            </div>
          </div>
        </header>
        <main className="content">
          <div className="back-section">
            <button className="btn btn-secondary back-button" onClick={() => router.back()}>–ù–∞–∑–∞–¥</button>
          </div>
          <section className="section">
            <h2>–î–∞–Ω–Ω—ã–µ –ø—Ä–æ—Ñ–∏–ª—è</h2>
            <div className="form-grid">
              <div className="input-group">
                <label className="input-label">Telegram ID</label>
                <div className="input-field readonly-field">{user.telegram_id || 'N/A'}</div>
              </div>
              <div className="input-group">
                <label className="input-label">–ò–º—è</label>
                {isEditingName ? (
                  <div>
                    <input
                      type="text"
                      value={nameInput}
                      onChange={(e) => setNameInput(e.target.value)}
                      className="input-field"
                    />
                    <div className="buttons-row" style={{ marginTop: '10px' }}>
                      <button type="button" className="btn" onClick={handleSaveDisplayName}>–°–û–•–†–ê–ù–ò–¢–¨</button>
                      <button type="button" className="btn btn-danger" onClick={() => { setIsEditingName(false); setNameInput(displayName); setNameError(null); }}>–û–¢–ú–ï–ù–ê</button>
                    </div>
                  </div>
                ) : (
                  <div style={{ display: 'flex', alignItems: 'center', gap: '10px' }}>
                    <div className="input-field readonly-field" style={{ flex: '1' }}>{displayName}</div>
                    <button type="button" className="btn" onClick={() => setIsEditingName(true)}>–ò–ó–ú–ï–ù–ò–¢–¨</button>
                  </div>
                )}
                {nameError && <p className="status-message error">{nameError}</p>}
                {nameStatus && <p className="status-message success">{nameStatus}</p>}
              </div>
              <div className="input-group">
                <label className="input-label">–õ–æ–≥–∏–Ω (Telegram username)</label>
                <div className="input-field readonly-field">@{user.username || 'N/A'}</div>
              </div>
            </div>
          </section>
  
          <section className="section">
            <h2>–£—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø–∞—Ä–æ–ª—è –¥–ª—è –≤—Ö–æ–¥–∞ –≤ –±—Ä–∞—É–∑–µ—Ä–µ</h2>
            <p className="status-line">
              {profileExtras?.password_set_at
                ? `–°—Ç–∞—Ç—É—Å: –ø–∞—Ä–æ–ª—å —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω ${new Date(profileExtras.password_set_at).toLocaleString()}`
                : '–°—Ç–∞—Ç—É—Å: –ø–∞—Ä–æ–ª—å –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω'}
            </p>
            <form onSubmit={handleSetPassword} className="form-grid">
              <div className="input-group">
                <label className="input-label">–¢–µ–∫—É—â–∏–π –ø–∞—Ä–æ–ª—å</label>
                <input
                  type="password"
                  value={currentPassword}
                  onChange={(e) => setCurrentPassword(e.target.value)}
                  placeholder="–≤–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—É—â–∏–π –ø–∞—Ä–æ–ª—å"
                  className="input-field"
                />
              </div>
              <div className="input-group">
                <label className="input-label">–ù–æ–≤—ã–π –ø–∞—Ä–æ–ª—å</label>
                <input
                  type="password"
                  value={password}
                  onChange={(e) => setPassword(e.target.value)}
                  placeholder="–º–∏–Ω–∏–º—É–º 8 —Å–∏–º–≤–æ–ª–æ–≤"
                  required
                  className="input-field"
                />
              </div>
              <div className="input-group">
                <label className="input-label">–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –ø–∞—Ä–æ–ª—è</label>
                <input
                  type="password"
                  value={confirmPassword}
                  onChange={(e) => setConfirmPassword(e.target.value)}
                  placeholder="–ø–æ–≤—Ç–æ—Ä–∏—Ç–µ –ø–∞—Ä–æ–ª—å"
                  required
                  className="input-field"
                />
              </div>
              <div className="buttons-row">
                <button type="submit" className="btn">–°–û–•–†–ê–ù–ò–¢–¨ –ü–ê–†–û–õ–¨</button>
                <button type="button" className="btn btn-danger" onClick={handleLogout}>–í–´–ô–¢–ò</button>
              </div>
            </form>
          </section>
  
          {error && <p className="status-message error">{error}</p>}
          {status && <p className="status-message success">{status}</p>}
          {logoutStatus && <p className="status-message">{logoutStatus}</p>}
        </main>
      </div>
    </>
  );
}
</file>

<file path="src/app/api/payouts/route.ts">
import { NextRequest, NextResponse } from 'next/server';
import { 
  getPayoutsByUser, 
  getPayoutsByUserAndMonth,
  getMonthsWithShifts,
  getEarningsForMonth,
  getPayoutsForMonth,
  getUserByTelegramId,
  getPayoutsDataOptimized,
  getMonthStatus,
  createPayoutWithCorrection
} from '@/lib/db';
import { getUserFromRequest, requireMasterForMutation } from '@/lib/auth-server';
import { ensureDatabaseInitialized } from '@/lib/global-init';

// GET /api/payouts - –ø–æ–ª—É—á–∏—Ç—å –≤—Å–µ –≤—ã–ø–ª–∞—Ç—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å –¥–∞–Ω–Ω—ã–º–∏ –ø–æ –º–µ—Å—è—Ü–∞–º
export async function GET(request: NextRequest) {
  try {
    await ensureDatabaseInitialized();
    
    const user = await getUserFromRequest(request);
    if (!user) {
      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });
    }

    // –ò—Å–ø–æ–ª—å–∑—É–µ–º –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—É—é —Ñ—É–Ω–∫—Ü–∏—é –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –≤—Å–µ—Ö –¥–∞–Ω–Ω—ã—Ö –æ–¥–Ω–∏–º –∑–∞–ø—Ä–æ—Å–æ–º
    const monthsData = await getPayoutsDataOptimized(user.id!);

    return NextResponse.json({ months: monthsData });
  } catch (error) {
    console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –≤—ã–ø–ª–∞—Ç:', error);
    return NextResponse.json({ error: 'Internal server error' }, { status: 500 });
  }
}

// POST /api/payouts - —Å–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é –≤—ã–ø–ª–∞—Ç—É
export async function POST(request: NextRequest) {
  try {
    console.log('üîÑ –ù–∞—á–∏–Ω–∞–µ–º —Å–æ–∑–¥–∞–Ω–∏–µ –≤—ã–ø–ª–∞—Ç—ã...');
    await ensureDatabaseInitialized();
    console.log('‚úÖ –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞');
    
    // –†–∞–∑—Ä–µ—à–∞–µ–º –º—É—Ç–∞—Ü–∏–∏ —Ç–æ–ª—å–∫–æ –¥–ª—è –º–∞—Å—Ç–µ—Ä–∞ (–∞–¥–º–∏–Ω/–¥–µ–º–æ –∑–∞–ø—Ä–µ—â–µ–Ω—ã)
    try {
      await requireMasterForMutation(request);
    } catch {
      return NextResponse.json({ error: 'Forbidden' }, { status: 403 });
    }

    const user = await getUserFromRequest(request);
    console.log('üë§ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å:', user);
    if (!user) {
      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });
    }

  const body = await request.json();
  const { month, amount, date, comment } = body;
  console.log('üìù –î–∞–Ω–Ω—ã–µ –≤—ã–ø–ª–∞—Ç—ã:', { month, amount, date, comment });

    // –í–∞–ª–∏–¥–∞—Ü–∏—è
    if (!month || !amount || !date) {
      return NextResponse.json({ 
        error: '–ú–µ—Å—è—Ü, —Å—É–º–º–∞ –∏ –¥–∞—Ç–∞ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã' 
      }, { status: 400 });
    }

    if (amount <= 0) {
      return NextResponse.json({ 
        error: '–°—É–º–º–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –±–æ–ª—å—à–µ 0' 
      }, { status: 400 });
    }

    // –ü—Ä–æ–≤–µ—Ä–∫–∞: –º–µ—Å—è—Ü –∑–∞–∫—Ä—ã—Ç?
    console.log('üîç –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç–∞—Ç—É—Å –º–µ—Å—è—Ü–∞:', month);
    const isClosed = await getMonthStatus(month);
    console.log('üìÖ –°—Ç–∞—Ç—É—Å –º–µ—Å—è—Ü–∞:', isClosed);
    if (isClosed) {
      return NextResponse.json({ 
        error: '–ú–µ—Å—è—Ü –∑–∞–∫—Ä—ã—Ç, –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤—ã–ø–ª–∞—Ç –∑–∞–ø—Ä–µ—â–µ–Ω–æ' 
      }, { status: 403 });
    }

    // –°–æ–∑–¥–∞–µ–º –≤—ã–ø–ª–∞—Ç—É —Å –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–æ–π (—É—á–∏—Ç—ã–≤–∞–µ—Ç –ø–µ—Ä–µ–ø–ª–∞—Ç—ã)
    console.log('üí∞ –°–æ–∑–¥–∞–µ–º –≤—ã–ø–ª–∞—Ç—É —Å –∫–æ—Ä—Ä–µ–∫—Ü–∏–µ–π...');
    const { payout, overpayment } = await createPayoutWithCorrection({
      user_id: user.id!,
      month,
      amount: parseFloat(amount),
      date,
      comment: comment || ''
    });
    console.log('‚úÖ –í—ã–ø–ª–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∞:', payout, '–ü–µ—Ä–µ–ø–ª–∞—Ç–∞:', overpayment);

    return NextResponse.json({ payout, overpayment });
  } catch (error) {
    console.error('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –≤—ã–ø–ª–∞—Ç—ã:', error);
    return NextResponse.json({ error: 'Internal server error' }, { status: 500 });
  }
}
</file>

<file path="src/app/api/prices/[id]/route.ts">
import { NextRequest, NextResponse } from 'next/server';
import { updatePrice } from '@/lib/db';
import { ensureDatabaseInitialized } from '@/lib/global-init';
import { requireAdmin } from '@/lib/auth-server';

export async function PUT(
  request: NextRequest,
  context: { params: Promise<{ id: string }> }
) {
  try {
    await requireAdmin(request);
    await ensureDatabaseInitialized();

    const { id } = await context.params;
    const idNum = parseInt(id);
    if (isNaN(idNum)) {
      return NextResponse.json({ error: '–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π ID —É—Å–ª—É–≥–∏' }, { status: 400 });
    }

    const { name, price } = await request.json();

    if (!name || price === undefined) {
      return NextResponse.json({ error: '–ù–∞–∑–≤–∞–Ω–∏–µ –∏ —Ü–µ–Ω–∞ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã' }, { status: 400 });
    }
    if (typeof price !== 'number' || price <= 0) {
      return NextResponse.json({ error: '–¶–µ–Ω–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–º —á–∏—Å–ª–æ–º' }, { status: 400 });
    }

    await updatePrice(idNum, { name, price });

    return NextResponse.json({
      message: '–¶–µ–Ω–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ',
      price: { id: idNum, name, price }
    });
  } catch (error) {
    if (error instanceof Error) {
      if (error.message === 'Unauthorized') {
        return NextResponse.json({ error: '–¢—Ä–µ–±—É–µ—Ç—Å—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è' }, { status: 401 });
      }
      if (error.message === 'Forbidden') {
        return NextResponse.json({ error: '–î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â–µ–Ω' }, { status: 403 });
      }
    }
    console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ —Ü–µ–Ω—ã:', error);
    return NextResponse.json({ error: '–û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞' }, { status: 500 });
  }
}
</file>

<file path="src/app/api/shifts/[id]/route.ts">
import { NextRequest, NextResponse } from 'next/server';
import { deleteShift, getShiftById, getMonthStatus } from '@/lib/db';
import { requireMasterForMutation } from '@/lib/auth-server';

export async function DELETE(request: NextRequest, { params }: { params: Promise<{ id: string }> }) {
  try {
    // –£–¥–∞–ª–µ–Ω–∏–µ —Å–º–µ–Ω—ã —Ä–∞–∑—Ä–µ—à–µ–Ω–æ —Ç–æ–ª—å–∫–æ –º–∞—Å—Ç–µ—Ä—É
    const user = await requireMasterForMutation(request);
    const { id: idParam } = await params;
    const id = parseInt(idParam);
    if (isNaN(id)) {
      return NextResponse.json({ error: '–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π ID' }, { status: 400 });
    }
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –ª–∏ —Å–º–µ–Ω–∞ –∏ –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–∏—Ç –ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
    const shift = await getShiftById(id);
    if (!shift || shift.user_id !== user.id) {
      return NextResponse.json({ error: '–°–º–µ–Ω–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞ –∏–ª–∏ –Ω–µ –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–∏—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é' }, { status: 404 });
    }

    // –ü—Ä–æ–≤–µ—Ä–∫–∞: –º–µ—Å—è—Ü –∑–∞–∫—Ä—ã—Ç?
    const month = (typeof shift.date === 'string' && shift.date.length >= 7) ? shift.date.slice(0, 7) : '';
    if (month) {
      const isClosed = await getMonthStatus(month);
      if (isClosed) {
        return NextResponse.json({ error: '–ú–µ—Å—è—Ü –∑–∞–∫—Ä—ã—Ç, —É–¥–∞–ª–µ–Ω–∏–µ —Å–º–µ–Ω –∑–∞–ø—Ä–µ—â–µ–Ω–æ' }, { status: 403 });
      }
    }

    await deleteShift(id, user.id);
    
    return NextResponse.json({ message: '–°–º–µ–Ω–∞ —É–¥–∞–ª–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ' });
  } catch (error) {
    if (error instanceof Error) {
      if (error.message === 'Unauthorized') {
        return NextResponse.json({ error: '–¢—Ä–µ–±—É–µ—Ç—Å—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è' }, { status: 401 });
      }
      if (error.message === 'Forbidden') {
        return NextResponse.json({ error: '–î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â–µ–Ω' }, { status: 403 });
      }
    }
    console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ —Å–º–µ–Ω—ã:', error);
    return NextResponse.json({ error: '–û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞' }, { status: 500 });
  }
}
</file>

<file path="version.json">
{
  "version": "2.6.0",
  "buildDate": "2025-11-14T09:00:00Z",
  "description": "–û–±–Ω–æ–≤–ª–µ–Ω UI –≤—ã–ø–ª–∞—Ç –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ –∏ –¥–æ–±–∞–≤–ª–µ–Ω—ã –º–≥–Ω–æ–≤–µ–Ω–Ω—ã–µ –ø–µ—Ä–µ—Å—á–µ—Ç—ã –ø–µ—Ä–µ–ø–ª–∞—Ç"
}
</file>

<file path="src/app/admin/page.tsx">
'use client';

import { useState, useEffect } from 'react';
import { useRouter } from 'next/navigation';
import UserManagement from '@/components/UserManagement';
import Link from 'next/link';
import Image from 'next/image';
import { getAuthHeaders } from '@/lib/auth';

interface Shift {
  id?: number;
  date: string;
  hours: number;
  steam_bath: number;
  brand_steam: number;
  intro_steam: number;
  scrubbing: number;
  masters: number;
  total: number;
  hourly_rate?: number;
  steam_bath_price?: number;
  brand_steam_price?: number;
  intro_steam_price?: number;
  scrubbing_price?: number;
  // –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ –¥–ª—è –∞–¥–º–∏–Ω –ø–∞–Ω–µ–ª–∏
  first_name?: string;
  last_name?: string;
  username?: string;
  display_name?: string;
  telegram_id?: number;
}

interface Version {
  version: string;
  buildDate: string;
  description: string;
}

export default function AdminPage() {
  const router = useRouter();
  const [showReports, setShowReports] = useState(false);
  const [showUserManagement, setShowUserManagement] = useState(false);
  const [shifts, setShifts] = useState<Shift[]>([]);
  const [loading, setLoading] = useState(false);
  const [version, setVersion] = useState<Version | null>(null);
  const [userRole, setUserRole] = useState<'admin' | 'master' | 'demo' | undefined>(undefined);

  // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏: –µ—Å–ª–∏ –Ω–µ—Ç cookie-—Å–µ—Å—Å–∏–∏ –∏–ª–∏ Telegram –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤ ‚Äî —Ä–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ /login
  useEffect(() => {
    const checkAuth = async () => {
      try {
        const res = await fetch('/api/auth/me', { headers: getAuthHeaders() });
        if (!res.ok) {
          router.replace('/login');
          return;
        }
        const data = await res.json().catch(() => null);
        const role = data?.user?.role as ('admin' | 'master' | 'demo' | undefined);
        setUserRole(role);
        // –†–∞–∑—Ä–µ—à–∞–µ–º –¥–æ—Å—Ç—É–ø –≤ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å –¥–ª—è admin –∏ demo (–¥–µ–º–æ —Ç–æ–ª—å–∫–æ –ø—Ä–æ—Å–º–æ—Ç—Ä)
        if (role !== 'admin' && role !== 'demo') {
          router.replace('/');
          return;
        }
      } catch {
        router.replace('/login');
      }
    };
    checkAuth();
  }, [router]);

  const loadShifts = async () => {
    try {
      setLoading(true);
      const response = await fetch('/api/admin/shifts', { headers: getAuthHeaders() });
      if (response.ok) {
        const data = await response.json();
        setShifts(data);
      }
    } catch (error) {
      console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–º–µ–Ω:', error);
    } finally {
      setLoading(false);
    }
  };

  const loadVersion = async () => {
    try {
      const response = await fetch('/api/version', { headers: getAuthHeaders() });
      if (response.ok) {
        const data = await response.json();
        setVersion(data);
      }
    } catch (error) {
      console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –≤–µ—Ä—Å–∏–∏:', error);
    }
  };

  useEffect(() => {
    loadVersion();
  }, []);

  const handleReportsClick = () => {
    if (!showReports) {
      loadShifts();
    }
    setShowReports(!showReports);
  };

  const formatDate = (dateString: string) => {
    return new Date(dateString).toLocaleDateString('ru-RU');
  };

  const formatCurrency = (amount: number) => {
    return new Intl.NumberFormat('ru-RU', {
      style: 'currency',
      currency: 'RUB',
      minimumFractionDigits: 0,
      maximumFractionDigits: 0,
    }).format(amount);
  };

  return (
    <div className="container">
      <div className="header">
        <div className="header-content">
          <div 
            className="logo"
            onClick={() => router.push('/')}
            style={{ cursor: 'pointer' }}
          >
            <Image
              src="/logo.svg"
              alt="–õ–æ–≥–æ—Ç–∏–ø"
              width={50}
              height={50}
            />
          </div>
          <div className="header-text">
            <h1>–ê–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å</h1>
          </div>
        </div>
      </div>

      <div className="content">
        {userRole === 'demo' && (
          <div className="readonly-banner">
            <strong>–î–µ–º–æ —Ä–µ–∂–∏–º:</strong> –ø–∞–Ω–µ–ª—å –¥–æ—Å—Ç—É–ø–Ω–∞ —Ç–æ–ª—å–∫–æ –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞, –ø—Ä–∞–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö –æ—Ç–∫–ª—é—á–µ–Ω–∞.
          </div>
        )}
        {!showReports && !showUserManagement ? (
           <div className="admin-section">
             <div className="admin-grid">
               <button 
                 onClick={() => router.push('/pricing')}
                 className="admin-card admin-button"
               >
                 <div className="card-content">
                   <h3>–ü—Ä–∞–π—Å-–ª–∏—Å—Ç</h3>
                   <p>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ü–µ–Ω–∞–º–∏ –Ω–∞ —É—Å–ª—É–≥–∏</p>
                 </div>
               </button>

               <button 
                 onClick={() => router.push('/admin/reports')}
                 className="admin-card admin-button"
               >
                 <div className="card-content">
                   <h3>–û—Ç—á–µ—Ç—ã</h3>
                   <p>–û—Ç—á–µ—Ç—ã –ø–æ –º–∞—Å—Ç–µ—Ä–∞–º —Å –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏–µ–π —Å–º–µ–Ω</p>
                 </div>
               </button>

               <button 
                 onClick={() => setShowUserManagement(true)}
                 className="admin-card admin-button"
               >
                 <div className="card-content">
                   <h3>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏</h3>
                   <p>–ü—Ä–æ—Å–º–æ—Ç—Ä, –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –∏ —É–¥–∞–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</p>
                 </div>
               </button>

               <button className="admin-card admin-button" disabled>
                 <div className="card-content">
                   <h3>–ù–∞—Å—Ç—Ä–æ–π–∫–∏</h3>
                   <p>–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Å–∏—Å—Ç–µ–º—ã</p>
                 </div>
               </button>

               <button 
                 onClick={() => router.push('/admin/logs')}
                 className="admin-card admin-button"
                 disabled={true}
               >
                 <div className="card-content">
                   <h3>–°–∏—Å—Ç–µ–º–Ω—ã–µ –ª–æ–≥–∏</h3>
                   <p>–ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤</p>
                 </div>
               </button>
             </div>

            <div className="back-section">
              <button 
                onClick={() => router.push('/')}
                className="btn btn-secondary"
              >
                –ù–∞–∑–∞–¥ –Ω–∞ –≥–ª–∞–≤–Ω—É—é
              </button>
            </div>

            {version && (
              <div className="version-info">
                <p>–í–µ—Ä—Å–∏—è: {version.version}</p>
                <p>–î–∞—Ç–∞ —Å–±–æ—Ä–∫–∏: {new Date(version.buildDate).toLocaleDateString('ru-RU')}</p>
                <p>{version.description}</p>
              </div>
            )}
          </div>
        ) : showReports ? (
          <div className="reports-section">
            <div className="reports-header">
              <h2>–û—Ç—á–µ—Ç—ã –ø–æ —Å–º–µ–Ω–∞–º</h2>
              <button 
                onClick={() => setShowReports(false)}
                className="btn btn-secondary"
              >
                –ù–∞–∑–∞–¥ –∫ –ø–∞–Ω–µ–ª–∏
              </button>
            </div>

            {loading ? (
              <div className="loading">–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö...</div>
            ) : (
              <div className="table-container">
                {shifts.length === 0 ? (
                  <div className="no-data">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –æ —Å–º–µ–Ω–∞—Ö</div>
                ) : (
                  <table className="shifts-table">
                    <thead>
                      <tr>
                        <th>–ú–∞—Å—Ç–µ—Ä</th>
                        <th>–î–∞—Ç–∞</th>
                        <th>–ß–∞—Å—ã</th>
                        <th>–ü</th>
                        <th>–§</th>
                        <th>–û</th>
                        <th>–°</th>
                        <th>–ú–∞—Å—Ç–µ—Ä–∞</th>
                        <th>–ò—Ç–æ–≥–æ</th>
                      </tr>
                    </thead>
                    <tbody>
                      {shifts.map((shift) => (
                        <tr key={shift.id}>
                          <td className="user-cell">
                            <div className="user-info">
                              <div className="user-name">
                                {shift.display_name || `${shift.first_name} ${shift.last_name || ''}`.trim()}
                              </div>
                              <div className="user-username">@{shift.username}</div>
                            </div>
                          </td>
                          <td>{formatDate(shift.date)}</td>
                          <td>{shift.hours}</td>
                          <td>{shift.steam_bath}</td>
                          <td>{shift.brand_steam}</td>
                          <td>{shift.intro_steam}</td>
                          <td>{shift.scrubbing}</td>
                          <td>{shift.masters}</td>
                          <td className="total-cell">{formatCurrency(shift.total)}</td>
                        </tr>
                      ))}
                    </tbody>
                  </table>
                )}
              </div>
            )}
           </div>
         ) : (
           <div className="user-management-section">
             <div className="reports-header">
               <h2>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏</h2>
               <button 
                 onClick={() => setShowUserManagement(false)}
                 className="btn btn-secondary"
               >
                 –ù–∞–∑–∞–¥ –∫ –ø–∞–Ω–µ–ª–∏
               </button>
             </div>
             <UserManagement readonly={userRole === 'demo'} />
           </div>
         )}
       </div>

      <style jsx>{`
        .container {
          max-width: 800px;
          margin: 0 auto;
          background: var(--background-card);
          border-radius: 15px;
          box-shadow: 0 20px 40px var(--shadow-light);
          overflow: hidden;
          min-height: 90vh;
        }

        .header {
          background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
          color: var(--accent-color);
          padding: 5px !important;
          text-align: center;
        }

        .header-content {
          display: flex;
          align-items: center;
          justify-content: center;
          gap: 12px;
          flex-wrap: nowrap;
          max-width: 400px;
          margin: 0 auto;
        }

        .logo {
          width: 50px;
          height: 50px;
          flex-shrink: 0;
          transition: transform 0.3s ease;
        }

        .logo:hover {
          transform: scale(1.05);
        }

        .header-text {
          text-align: left;
        }

        .header h1 {
          font-size: 2.5em;
          margin-bottom: 10px;
          text-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }

        .content {
          padding: 30px;
        }

        .readonly-banner {
          background: #fff3cd;
          color: #856404;
          border: 1px solid #ffeeba;
          border-radius: 8px;
          padding: 12px 16px;
          margin-bottom: 16px;
          font-size: 0.95em;
        }



        .admin-grid {
          display: grid;
          grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
          gap: 20px;
          margin-bottom: 30px;
        }

        .admin-card {
          background: linear-gradient(135deg, var(--background-section) 0%, rgba(122, 62, 45, 0.08) 100%);
          border: 2px solid var(--primary-color);
          border-radius: 12px;
          padding: 25px;
          text-decoration: none;
          color: var(--font-color);
          transition: all 0.3s ease;
          box-shadow: 0 8px 25px var(--shadow-medium);
          position: relative;
          cursor: pointer;
        }

        .admin-button {
          background: linear-gradient(135deg, var(--background-section) 0%, rgba(122, 62, 45, 0.08) 100%);
          border: 2px solid var(--primary-color);
          font-family: inherit;
          font-size: inherit;
        }

        .admin-card:hover:not(:disabled) {
          transform: translateY(-3px);
          box-shadow: 0 12px 30px var(--shadow-medium);
          border-color: var(--secondary-color);
        }

        .admin-card:disabled {
          opacity: 0.6;
          cursor: not-allowed;
        }

        .card-content {
          text-align: center;
        }

        .card-content h3 {
          color: var(--primary-color);
          font-size: 1.4em;
          margin-bottom: 10px;
          font-weight: 600;
        }

        .card-content p {
          color: var(--font-color);
          font-size: 0.95em;
          opacity: 0.8;
          line-height: 1.4;
        }

        .back-section {
          text-align: center;
          margin-top: 30px;
        }

        .version-info {
          text-align: center;
          margin-top: 20px;
          padding: 15px;
          background: var(--background-section);
          border-radius: 8px;
          border: 1px solid var(--border-light);
        }

        .version-info p {
          margin: 5px 0;
          font-size: 0.85em;
          color: var(--font-color);
          opacity: 0.7;
        }

        .version-info p:first-child {
          font-weight: 600;
          color: var(--primary-color);
          opacity: 1;
        }

        .btn {
          background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
          color: var(--accent-color);
          border: none;
          padding: 12px 24px;
          border-radius: 8px;
          font-size: 14px;
          font-weight: 600;
          cursor: pointer;
          transition: all 0.3s ease;
          box-shadow: 0 4px 15px var(--shadow-medium);
          text-transform: uppercase;
          letter-spacing: 0.5px;
        }

        .btn:hover {
          transform: translateY(-2px);
          box-shadow: 0 6px 20px var(--shadow-medium);
          background: linear-gradient(135deg, var(--primary-light) 0%, var(--secondary-light) 100%);
        }

        .btn-secondary {
          background: linear-gradient(135deg, var(--accent-color) 0%, var(--accent-light) 100%);
          color: var(--primary-color);
          border: 2px solid var(--primary-color);
        }

        .btn-secondary:hover {
          background: linear-gradient(135deg, var(--accent-dark) 0%, var(--accent-color) 100%);
        }

        .reports-section {
          min-height: 400px;
        }

        .reports-header {
          display: flex;
          justify-content: space-between;
          align-items: center;
          margin-bottom: 30px;
          flex-wrap: wrap;
          gap: 15px;
        }

        .reports-header h2 {
          color: var(--primary-color);
          font-size: 1.8em;
          margin: 0;
        }

        .loading, .no-data {
          text-align: center;
          padding: 40px;
          color: var(--font-color);
          font-size: 1.1em;
        }

        .table-container {
          overflow-x: auto;
          border-radius: 12px;
          box-shadow: 0 8px 25px var(--shadow-medium);
        }

        .shifts-table {
          width: 100%;
          border-collapse: collapse;
          background: var(--background-card);
          border-radius: 12px;
          overflow: hidden;
        }

        .shifts-table th {
          background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
          color: var(--accent-color);
          padding: 15px 10px;
          text-align: left;
          font-weight: 600;
          font-size: 0.9em;
          text-transform: uppercase;
          letter-spacing: 0.5px;
        }

        .shifts-table td {
          padding: 12px 10px;
          border-bottom: 1px solid var(--border-light);
          color: var(--font-color);
        }

        .shifts-table tr:hover {
          background: var(--background-section);
        }

        .total-cell {
          font-weight: 600;
          color: var(--primary-color);
        }

        .user-cell {
          min-width: 150px;
        }

        .user-info {
          display: flex;
          flex-direction: column;
          gap: 2px;
        }

        .user-name {
          font-weight: 600;
          color: var(--primary-color);
          font-size: 0.9em;
        }

        .user-username {
          font-size: 0.8em;
          color: var(--font-color-light);
          opacity: 0.8;
        }

        @media (max-width: 768px) {
          .content {
            padding: 20px;
          }

          .admin-grid {
            grid-template-columns: 1fr;
          }

          .reports-header {
            flex-direction: column;
            text-align: center;
          }

          .shifts-table {
            font-size: 0.85em;
          }

          .shifts-table th,
          .shifts-table td {
            padding: 8px 6px;
          }
        }
      `}</style>
    </div>
  );
}
</file>

<file path="src/app/api/prices/bulk/route.ts">
import { NextRequest, NextResponse } from 'next/server';
import { addPrice, updatePrice, getPrices } from '@/lib/db';
import { ensureDatabaseInitialized } from '@/lib/global-init';
import { requireAdmin } from '@/lib/auth-server';

interface Prices {
  hourly_rate: number;
  steam_bath_price: number;
  brand_steam_price: number;
  intro_steam_price: number;
  scrubbing_price: number;
  zaparnik_price: number;
}

const priceMapping: Record<keyof Prices, string> = {
  hourly_rate: '–ü–æ—á–∞—Å–æ–≤–∞—è —Å—Ç–∞–≤–∫–∞',
  steam_bath_price: '–ü—É—Ç–µ–≤–æ–µ –ø–∞—Ä–µ–Ω–∏–µ',
  brand_steam_price: '–§–∏—Ä–º–µ–Ω–Ω–æ–µ –ø–∞—Ä–µ–Ω–∏–µ',
  intro_steam_price: '–û–∑–Ω–∞–∫–æ–º–∏—Ç–µ–ª—å–Ω–æ–µ –ø–∞—Ä–µ–Ω–∏–µ',
  scrubbing_price: '–°–∫—Ä–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ',
  zaparnik_price: '–ó–∞–ø–∞—Ä–Ω–∏–∫'
};

export async function POST(request: NextRequest) {
  try {
    await requireAdmin(request);
    await ensureDatabaseInitialized();
    const prices: Prices = await request.json();
    
    // –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö
    for (const [key, value] of Object.entries(prices)) {
      if (typeof value !== 'number' || value <= 0) {
        return NextResponse.json({ 
          error: `–¶–µ–Ω–∞ –¥–ª—è ${priceMapping[key as keyof Prices]} –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–º —á–∏—Å–ª–æ–º` 
        }, { status: 400 });
      }
    }

    // –ü–æ–ª—É—á–∞–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Ü–µ–Ω—ã
    const existingPrices = await getPrices();
    const existingPricesMap = new Map(existingPrices.map(p => [p.name, p]));
    
    // –û–±–Ω–æ–≤–ª—è–µ–º –∏–ª–∏ –¥–æ–±–∞–≤–ª—è–µ–º –∫–∞–∂–¥—É—é —Ü–µ–Ω—É
    for (const [key, value] of Object.entries(prices)) {
      const name = priceMapping[key as keyof Prices];
      const existingPrice = existingPricesMap.get(name);
      
      if (existingPrice) {
        await updatePrice(existingPrice.id!, { name, price: value });
      } else {
        await addPrice({ name, price: value });
      }
    }
    
    return NextResponse.json({ 
      message: '–¶–µ–Ω—ã —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã —É—Å–ø–µ—à–Ω–æ',
      prices
    });
  } catch (error) {
    if (error instanceof Error) {
      if (error.message === 'Unauthorized') {
        return NextResponse.json({ error: '–¢—Ä–µ–±—É–µ—Ç—Å—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è' }, { status: 401 });
      }
      if (error.message === 'Forbidden') {
        return NextResponse.json({ error: '–î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â–µ–Ω' }, { status: 403 });
      }
    }
    console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ —Ü–µ–Ω:', error);
    return NextResponse.json({ error: '–û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞' }, { status: 500 });
  }
}

export async function PUT(request: NextRequest) {
  try {
    await requireAdmin(request);
    await ensureDatabaseInitialized();
    const prices: Prices = await request.json();
    
    // –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö
    for (const [key, value] of Object.entries(prices)) {
      if (typeof value !== 'number' || value <= 0) {
        return NextResponse.json({ 
          error: `–¶–µ–Ω–∞ –¥–ª—è ${priceMapping[key as keyof Prices]} –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–º —á–∏—Å–ª–æ–º` 
        }, { status: 400 });
      }
    }

    // –ü–æ–ª—É—á–∞–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Ü–µ–Ω—ã
    const existingPrices = await getPrices();
    const existingPricesMap = new Map(existingPrices.map(p => [p.name, p]));
    
    // –û–±–Ω–æ–≤–ª—è–µ–º –∏–ª–∏ –¥–æ–±–∞–≤–ª—è–µ–º –∫–∞–∂–¥—É—é —Ü–µ–Ω—É
    for (const [key, value] of Object.entries(prices)) {
      const name = priceMapping[key as keyof Prices];
      const existingPrice = existingPricesMap.get(name);
      
      if (existingPrice) {
        await updatePrice(existingPrice.id!, { name, price: value });
      } else {
        await addPrice({ name, price: value });
      }
    }
    
    return NextResponse.json({ 
      message: '–¶–µ–Ω—ã –æ–±–Ω–æ–≤–ª–µ–Ω—ã —É—Å–ø–µ—à–Ω–æ',
      prices
    });
  } catch (error) {
    if (error instanceof Error) {
      if (error.message === 'Unauthorized') {
        return NextResponse.json({ error: '–¢—Ä–µ–±—É–µ—Ç—Å—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è' }, { status: 401 });
      }
      if (error.message === 'Forbidden') {
        return NextResponse.json({ error: '–î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â–µ–Ω' }, { status: 403 });
      }
    }
    console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ —Ü–µ–Ω:', error);
    return NextResponse.json({ error: '–û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞' }, { status: 500 });
  }
}

export async function GET() {
  try {
    await ensureDatabaseInitialized();
    const prices = await getPrices();
    
    // –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –≤ —Ñ–æ—Ä–º–∞—Ç, –æ–∂–∏–¥–∞–µ–º—ã–π —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–æ–º
    const pricesObject: Prices = {
      hourly_rate: 0,
      steam_bath_price: 0,
      brand_steam_price: 0,
      intro_steam_price: 0,
      scrubbing_price: 0,
      zaparnik_price: 0
    };
    
    // –ó–∞–ø–æ–ª–Ω—è–µ–º –¥–∞–Ω–Ω—ã–º–∏ –∏–∑ –±–∞–∑—ã
    prices.forEach((price: { name: string; price: number }) => {
      const key = Object.keys(priceMapping).find(k => priceMapping[k as keyof Prices] === price.name);
      if (key) {
        pricesObject[key as keyof Prices] = price.price;
      }
    });
    
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ –≤—Å–µ —Ü–µ–Ω—ã –∑–∞–≥—Ä—É–∂–µ–Ω—ã –∏–∑ –±–∞–∑—ã
    const missingPrices = Object.entries(pricesObject).filter(([_, value]) => value === 0);
    if (missingPrices.length > 0) {
      return NextResponse.json({ 
        error: '–ù–µ –≤—Å–µ —Ü–µ–Ω—ã –Ω–∞–π–¥–µ–Ω—ã –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö. –ù–µ–æ–±—Ö–æ–¥–∏–º–æ —Å–Ω–∞—á–∞–ª–∞ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Ü–µ–Ω—ã.' 
      }, { status: 404 });
    }
    
    return NextResponse.json(pricesObject);
  } catch (error) {
    console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ —Ü–µ–Ω:', error);
    return NextResponse.json({ error: '–û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞' }, { status: 500 });
  }
}
</file>

<file path="src/app/payouts/page.tsx">
'use client';

import { useState, useEffect, useCallback } from 'react';
import Image from 'next/image';
import { useRouter } from 'next/navigation';
import { useTelegramAuth } from '@/hooks/useTelegramAuth';

// –¢–∏–ø—ã –¥–ª—è Telegram WebApp
declare global {
  interface Window {
    Telegram?: {
      WebApp: {
        ready: () => void;
        initDataUnsafe: {
          user?: {
            id: number;
            telegram_id: number;
            first_name: string;
            last_name: string;
            username?: string;
          };
        };
      };
    };
  }
}

interface Payout {
  id: number;
  amount: number;
  date: string;
  comment?: string;
  initiator_role?: 'admin' | 'master' | 'system' | null;
  method?: string | null;
  source?: string | null;
  reversed_at?: string | null;
  reversal_reason?: string | null;
  is_advance?: boolean;
}

interface MonthData {
  month: string;
  earnings: number;
  payouts: Payout[];
  remaining: number;
  total_payouts: number;
  total_payouts_real: number;
  advance_amount: number;
  progress: number;
  status: string;
}

interface User {
  id: number;
  telegram_id: number;
  first_name: string;
  last_name: string;
  username?: string;
}

interface TelegramInitUser {
  id: number;
  first_name: string;
  last_name?: string;
  username?: string;
}

export default function PayoutsPage() {
  const router = useRouter();
  const { user: authUser } = useTelegramAuth();
  const [user, setUser] = useState<User | null>(null);
  const [months, setMonths] = useState<MonthData[]>([]);
  const [isLoading, setIsLoading] = useState(true);
  const [error, setError] = useState<string | null>(null);
  const [showModal, setShowModal] = useState(false);
  const [modalData, setModalData] = useState({
    month: '',
    amount: '',
    date: '',
    comment: ''
  });
  const [expandedMonths, setExpandedMonths] = useState<Set<string>>(new Set());
  const [selectedYear, setSelectedYear] = useState<number>(2025);
  const [isManualInput, setIsManualInput] = useState<boolean>(false);
  const [manualYear, setManualYear] = useState<string>('');

  useEffect(() => {
    const initializeUser = async () => {
      try {
        if (typeof window !== 'undefined' && window.Telegram?.WebApp) {
          const tg = window.Telegram.WebApp;
          tg.ready();

          const initData = tg.initDataUnsafe;
          if (initData?.user) {
            // –ü—Ä–∏–≤–æ–¥–∏–º –æ–±—ä–µ–∫—Ç Telegram –∫ —Ñ–æ—Ä–º–µ –Ω–∞—à–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            const tgUser = initData.user as TelegramInitUser;
            setUser({
              id: tgUser.id,
              telegram_id: tgUser.id,
              first_name: tgUser.first_name,
              last_name: tgUser.last_name || '',
              username: tgUser.username,
            });
          } else {
            // Fallback –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –≤ Telegram WebApp –±–µ–∑ –¥–∞–Ω–Ω—ã—Ö
            setUser({
              id: 20,
              telegram_id: 87654321,
              first_name: 'Test',
              last_name: 'User',
              username: 'testuser'
            });
          }
        } else {
          // Fallback –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –≤–Ω–µ Telegram
          setUser({
            id: 20,
            telegram_id: 87654321,
            first_name: 'Test',
            last_name: 'User',
            username: 'testuser'
          });
        }
      } catch (err) {
        console.error('–û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:', err);
        // –î–∞–∂–µ –ø—Ä–∏ –æ—à–∏–±–∫–µ –∏—Å–ø–æ–ª—å–∑—É–µ–º fallback –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
        setUser({
          id: 20,
          telegram_id: 87654321,
          first_name: 'Test',
          last_name: 'User',
          username: 'testuser'
        });
      } finally {
        setIsLoading(false);
      }
    };

    initializeUser();
  }, []);

  const fetchPayouts = useCallback(async () => {
    if (!user) return;

    try {
      setIsLoading(true);
      setError(null); // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –ø—Ä–µ–¥—ã–¥—É—â–∏–µ –æ—à–∏–±–∫–∏

      console.log('Fetching payouts for user:', user.telegram_id);

      // –ï—Å–ª–∏ –ø–æ –∫–∞–∫–∏–º-—Ç–æ –ø—Ä–∏—á–∏–Ω–∞–º telegram_id –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç (Telegram WebApp), –∏—Å–ø–æ–ª—å–∑—É–µ–º id –∫–∞–∫ telegram_id
      const telegramHeader = (user.telegram_id ?? user.id ?? 87654321).toString();
      const response = await fetch('/api/payouts', {
        headers: {
          'x-telegram-id': telegramHeader
        }
      });

      console.log('Response status:', response.status);

      if (!response.ok) {
        const errorText = await response.text();
        console.error('Response error:', errorText);
        throw new Error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö');
      }

      const data = await response.json();
      console.log('Received data:', data);

      // API –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ–±—ä–µ–∫—Ç —Å –ø–æ–ª–µ–º months
      const monthsData = data.months || [];

      // –§–∏–ª—å—Ç—Ä—É–µ–º –¥–∞–Ω–Ω—ã–µ –ø–æ –≤—ã–±—Ä–∞–Ω–Ω–æ–º—É –≥–æ–¥—É
      const filteredData = monthsData.filter((monthData: MonthData) => {
        // –ü–∞—Ä—Å–∏–º –≥–æ–¥ –∏–∑ —Å—Ç—Ä–æ–∫–∏ —Ñ–æ—Ä–º–∞—Ç–∞ "YYYY-MM"
        const monthYear = parseInt(monthData.month.split('-')[0]);
        return monthYear === selectedYear;
      });
      setMonths(filteredData);

      if (filteredData.length === 0) {
        setError(`–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –∑–∞ ${selectedYear} –≥–æ–¥`);
      }
    } catch (err) {
      console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –≤—ã–ø–ª–∞—Ç:', err);
      setError('–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –æ –≤—ã–ø–ª–∞—Ç–∞—Ö');
    } finally {
      setIsLoading(false);
    }
  }, [selectedYear, user]);

  useEffect(() => {
    if (user) {
      fetchPayouts();
    }
  }, [user, fetchPayouts]);

  const handleAddPayout = async (e: React.FormEvent) => {
    e.preventDefault();
    if (!user) return;

    try {
      const response = await fetch('/api/payouts', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          'x-telegram-id': user.telegram_id.toString()
        },
        body: JSON.stringify({
          month: modalData.month,
          amount: parseFloat(modalData.amount),
          date: modalData.date,
          comment: modalData.comment || undefined
        })
      });

      if (!response.ok) {
        throw new Error('–û—à–∏–±–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –≤—ã–ø–ª–∞—Ç—ã');
      }

      setShowModal(false);
      setModalData({ month: '', amount: '', date: '', comment: '' });
      fetchPayouts();
    } catch (err) {
      console.error('–û—à–∏–±–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –≤—ã–ø–ª–∞—Ç—ã:', err);
      alert('–ù–µ —É–¥–∞–ª–æ—Å—å –¥–æ–±–∞–≤–∏—Ç—å –≤—ã–ø–ª–∞—Ç—É');
    }
  };

  const handleDeletePayout = async (payoutId: number) => {
    if (!user || !confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç—É –≤—ã–ø–ª–∞—Ç—É?')) return;

    try {
      const response = await fetch(`/api/payouts/${payoutId}`, {
        method: 'DELETE',
        headers: {
          'x-telegram-id': user.telegram_id.toString()
        }
      });

      if (!response.ok) {
        throw new Error('–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è –≤—ã–ø–ª–∞—Ç—ã');
      }

      fetchPayouts();
    } catch (err) {
      console.error('–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è –≤—ã–ø–ª–∞—Ç—ã:', err);
      alert('–ù–µ —É–¥–∞–ª–æ—Å—å —É–¥–∞–ª–∏—Ç—å –≤—ã–ø–ª–∞—Ç—É');
    }
  };

  const toggleMonthExpansion = (month: string) => {
    const newExpanded = new Set(expandedMonths);
    if (newExpanded.has(month)) {
      newExpanded.delete(month);
    } else {
      newExpanded.add(month);
    }
    setExpandedMonths(newExpanded);
  };

  const formatMonth = (monthStr: string) => {
    const date = new Date(monthStr + '-01');
    return date.toLocaleDateString('ru-RU', {
      month: 'long',
      year: 'numeric'
    });
  };

  const formatDateTime = (dateString: string) => {
    const date = new Date(dateString);
    return date.toLocaleString('ru-RU', {
      day: '2-digit',
      month: '2-digit',
      hour: '2-digit',
      minute: '2-digit'
    });
  };

  const getInitiatorLabel = (role?: string | null) => {
    switch (role) {
      case 'admin':
        return '–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä';
      case 'system':
        return '–°–∏—Å—Ç–µ–º–∞';
      default:
        return '–ú–∞—Å—Ç–µ—Ä';
    }
  };

  const getNextMonthName = (monthStr: string) => {
    const [year, month] = monthStr.split('-').map(Number);
    const nextDate = new Date(year, month, 1); // month —É–∂–µ +1 –∏–∑-–∑–∞ –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏ —Å 0
    return nextDate.toLocaleDateString('ru-RU', {
      month: 'long',
      year: 'numeric'
    });
  };

  const getStatusColor = (remaining: number) => {
    if (remaining <= 0) return 'green';
    if (remaining < 5000) return 'orange';
    return 'red';
  };

  const getStatusIcon = (remaining: number) => {
    if (remaining <= 0) return '‚úì';
    return '‚óè';
  };

  const getAvailableYears = () => {
    const years = [];
    for (let year = 2025; year <= 2030; year++) {
      years.push(year);
    }
    return years;
  };

  const handleYearChange = (value: string) => {
    if (value === 'manual') {
      setIsManualInput(true);
      setManualYear(selectedYear.toString());
    } else {
      setIsManualInput(false);
      setSelectedYear(parseInt(value));
    }
  };

  const handleManualYearSubmit = () => {
    const year = parseInt(manualYear);
    if (year && year >= 2020 && year <= 2050) {
      setSelectedYear(year);
      setIsManualInput(false);
    }
  };

  const handleManualYearCancel = () => {
    setIsManualInput(false);
    setManualYear('');
  };

  if (isLoading) {
    return (
      <div className="container">
        <div className="loading-container">
          <div className="loading-spinner"></div>
          <p>–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö...</p>
        </div>
        <style jsx>{`
          .container {
            max-width: 1200px;
            margin: 20px auto;
            padding: 20px;
            background: #f8f6f3;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(74, 43, 27, 0.15);
            border: 3px solid #7a3e2d;
            min-height: 80vh;
          }
          .loading-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 400px;
            color: #7a3e2d;
          }
          .loading-spinner {
            width: 40px;
            height: 40px;
            border: 4px solid #e5d5c8;
            border-top: 4px solid #7a3e2d;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 20px;
          }
          @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
          }
        `}</style>
      </div>
    );
  }

  return (
    <div className="container">
      <div className="content">
        {/* –®–∞–ø–∫–∞ –≤ —Å—Ç–∏–ª–µ –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã */}
        <div className="header">
          <div className="header-content">
            <div className="logo" onClick={() => router.push('/admin')} style={{ cursor: 'pointer' }}>
              <Image
                src="/logo.svg"
                alt="–õ–æ–≥–æ—Ç–∏–ø"
                width={120}
                height={120}
                priority
              />
            </div>
            <div className="header-text">
              <h1>–í—ã–ø–ª–∞—Ç—ã</h1>
            </div>
          </div>
        </div>

        <div className="content">
          {/* –ö–Ω–æ–ø–∫–∞ –Ω–∞–∑–∞–¥ */}
          <div className="back-section">
            <button
              onClick={() => router.push('/')}
              className="back-button"
            >
              ‚Üê –ù–∞–∑–∞–¥
            </button>
          </div>

          {/* –í—ã–±–æ—Ä –≥–æ–¥–∞ */}
          <div className="year-section">
            <div className="year-selector">
              <label className="year-label">–í—ã–±—Ä–∞—Ç—å –≥–æ–¥</label>
              {!isManualInput ? (
                <div className="year-select-container">
                  <select
                    value={selectedYear}
                    onChange={(e) => handleYearChange(e.target.value)}
                    className="year-select"
                  >
                    {getAvailableYears().map(year => (
                      <option key={year} value={year}>{year}</option>
                    ))}
                    <option value="manual">–í–≤–µ—Å—Ç–∏ –≤—Ä—É—á–Ω—É—é...</option>
                  </select>
                </div>
              ) : (
                <div className="manual-year-input">
                  <input
                    type="number"
                    value={manualYear}
                    onChange={(e) => setManualYear(e.target.value)}
                    placeholder="–í–≤–µ–¥–∏—Ç–µ –≥–æ–¥"
                    className="year-input"
                    min="2020"
                    max="2050"
                  />
                  <div className="manual-year-actions">
                    <button onClick={handleManualYearSubmit} className="btn-year-confirm">
                      ‚úì
                    </button>
                    <button onClick={handleManualYearCancel} className="btn-year-cancel">
                      ‚úï
                    </button>
                  </div>
                </div>
              )}
            </div>
          </div>

          {error && (
            <div className="error-message">
              {error}
            </div>
          )}

          <div className="months-grid">
            {months.length === 0 ? (
              <div className="empty-state">
                <div className="empty-title">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –∑–∞ {selectedYear} –≥–æ–¥</div>
                <p>–î–∞–Ω–Ω—ã–µ –æ –∑–∞—Ä–∞–±–æ—Ç–∫–µ –∑–∞ –≤—ã–±—Ä–∞–Ω–Ω—ã–π –≥–æ–¥ –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç</p>
              </div>
            ) : (
              months.map((monthData) => (
                <div key={monthData.month} className="month-card">
                  <div className="month-header">
                    <div className="month-icon">
                      <Image
                        src="/calendar.svg"
                        alt="–ö–∞–ª–µ–Ω–¥–∞—Ä—å"
                        width={24}
                        height={24}
                      />
                    </div>
                    <h3 className="month-title">{formatMonth(monthData.month)}</h3>
                    <div className={`status-indicator ${getStatusColor(monthData.remaining)}`}>
                      {getStatusIcon(monthData.remaining)}
                    </div>
                  </div>

                  <div className="earnings-section">
                    <div className="earnings-row">
                      <span className="earnings-icon">‚óè</span>
                      <span className="earnings-label">–ó–∞—Ä–∞–±–æ—Ç–∞–Ω–æ:</span>
                      <span className="earnings-value earned">{monthData.earnings.toLocaleString()} ‚ÇΩ</span>
                    </div>
                    <div className="earnings-simple">
                      <span className="earnings-label">–í—ã–ø–ª–∞—á–µ–Ω–æ:</span>
                      <span className="earnings-value paid">{(monthData.total_payouts || 0).toLocaleString()} ‚ÇΩ</span>
                    </div>
                    {monthData.advance_amount > 0 && (
                      <div className="earnings-simple">
                        <span className="earnings-label">–ê–≤–∞–Ω—Å:</span>
                        <span className="earnings-value advance">{monthData.advance_amount.toLocaleString()} ‚ÇΩ</span>
                      </div>
                    )}
                    <div className="earnings-simple">
                      <span className="earnings-label">–û—Å—Ç–∞—Ç–æ–∫:</span>
                      <span className="earnings-value remaining">{monthData.remaining.toLocaleString()} ‚ÇΩ</span>
                    </div>
                  </div>

                  <div className="progress-section">
                    <div className="progress-bar">
                      <div
                        className="progress-fill"
                        style={{
                          width: `${Math.min(100, monthData.progress || 0)}%`
                        }}
                      ></div>
                    </div>
                    <div className="progress-percentage">
                      {Math.round(monthData.progress || 0)}%
                    </div>
                  </div>



                  <div className="card-actions">
                    <button
                      onClick={() => {
                        setModalData(prev => ({ ...prev, month: monthData.month }));
                        setShowModal(true);
                      }}
                      className="btn btn-primary"
                      disabled={authUser?.role === 'demo'}
                    >
                      + –î–æ–±–∞–≤–∏—Ç—å –≤—ã–ø–ª–∞—Ç—É
                    </button>
                    {monthData.payouts.length > 0 && (
                      <button
                        onClick={() => toggleMonthExpansion(monthData.month)}
                        className="btn btn-secondary"
                      >
                        {expandedMonths.has(monthData.month) ? '–°–∫—Ä—ã—Ç—å –∏—Å—Ç–æ—Ä–∏—é' : '–ü–æ–∫–∞–∑–∞—Ç—å –∏—Å—Ç–æ—Ä–∏—é'}
                      </button>
                    )}
                  </div>

                  {/* –ò—Å—Ç–æ—Ä–∏—è –≤—ã–ø–ª–∞—Ç */}
                  {expandedMonths.has(monthData.month) && monthData.payouts.length > 0 && (
                    <div className="history-section">
                      <h4 className="history-title">–ò—Å—Ç–æ—Ä–∏—è –≤—ã–ø–ª–∞—Ç:</h4>
                      <div className="history-list">
                        {monthData.payouts.map((payout) => (
                          <div
                            key={payout.id}
                            className={`history-item ${payout.reversed_at ? 'history-item--reversed' : ''}`}
                          >
                            <div className="history-info">
                              <div className="history-amount">{payout.amount.toLocaleString()} ‚ÇΩ</div>
                              <div className="history-details">
                                {new Date(payout.date).toLocaleDateString('ru-RU')} ¬∑ {getInitiatorLabel(payout.initiator_role)}
                                {payout.is_advance && <span className="advance-badge">–ê–í–ê–ù–°</span>}
                                {payout.comment && ` ‚Ä¢ ${payout.comment}`}
                              </div>
                              {payout.reversed_at && (
                                <div className="history-reversed-note">
                                  –û—Ç–º–µ–Ω–µ–Ω–æ {formatDateTime(payout.reversed_at)}
                                  {payout.reversal_reason && ` ‚Ä¢ ${payout.reversal_reason}`}
                                </div>
                              )}
                            </div>
                            {!payout.reversed_at && (
                              <button
                                onClick={() => handleDeletePayout(payout.id)}
                                className="btn btn-danger btn-small"
                                disabled={authUser?.role === 'demo'}
                              >
                                –£–¥–∞–ª–∏—Ç—å
                              </button>
                            )}
                          </div>
                        ))}

                        {/* –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∞–≤–∞–Ω—Å–∞ –æ—Ç–¥–µ–ª—å–Ω–æ–π —Å—Ç—Ä–æ–∫–æ–π */}
                        {monthData.advance_amount > 0 && (
                          <div className="history-item history-item--advance">
                            <div className="history-separator"></div>
                            <div className="history-info">
                              <div className="history-amount advance-amount">–ê–≤–∞–Ω—Å: {monthData.advance_amount.toLocaleString()} ‚ÇΩ</div>
                              <div className="history-details">
                                –ü–µ—Ä–µ–Ω–æ—Å–∏—Ç—Å—è –Ω–∞ {getNextMonthName(monthData.month)}
                              </div>
                            </div>
                          </div>
                        )}
                      </div>
                    </div>
                  )}
                </div>
              ))
            )}
          </div>
        </div>

        {/* –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –≤—ã–ø–ª–∞—Ç—ã */}
        {showModal && (
          <div className="modal-overlay">
            <div className="modal-content">
              <h2 className="modal-title">–î–æ–±–∞–≤–∏—Ç—å –≤—ã–ø–ª–∞—Ç—É</h2>
              <form onSubmit={handleAddPayout} className="modal-form">
                <div className="form-group">
                  <label className="form-label">–ú–µ—Å—è—Ü</label>
                  <input
                    type="month"
                    value={modalData.month}
                    onChange={(e) => setModalData(prev => ({ ...prev, month: e.target.value }))}
                    className="form-input"
                    required
                  />
                </div>
                <div className="form-group">
                  <label className="form-label">–°—É–º–º–∞ (‚ÇΩ)</label>
                  <input
                    type="number"
                    step="0.01"
                    min="0"
                    value={modalData.amount}
                    onChange={(e) => setModalData(prev => ({ ...prev, amount: e.target.value }))}
                    className="form-input"
                    required
                  />
                </div>
                <div className="form-group">
                  <label className="form-label">–î–∞—Ç–∞</label>
                  <input
                    type="date"
                    value={modalData.date}
                    onChange={(e) => setModalData(prev => ({ ...prev, date: e.target.value }))}
                    className="form-input"
                    required
                  />
                </div>
                <div className="form-group">
                  <label className="form-label">–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π</label>
                  <textarea
                    value={modalData.comment}
                    onChange={(e) => setModalData(prev => ({ ...prev, comment: e.target.value }))}
                    className="form-textarea"
                    rows={3}
                  />
                </div>
                <div className="modal-actions">
                  <button type="submit" className="btn btn-primary" disabled={authUser?.role === 'demo'}>
                    –î–æ–±–∞–≤–∏—Ç—å
                  </button>
                  <button
                    type="button"
                    onClick={() => setShowModal(false)}
                    className="btn btn-secondary"
                  >
                    –û—Ç–º–µ–Ω–∞
                  </button>
                </div>
              </form>
            </div>
          </div>
        )}
      </div>

      <style jsx>{`
        /* –û—Å–Ω–æ–≤–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ */
        :root {
          --primary-color: #7a3e2d;
          --secondary-color: #8b4513;
          --accent-color: #f5f5dc;
          --background-card: #ffffff;
          --background-section: #f8f6f3;
          --font-color: #333333;
          --border-light: #e5d5c8;
          --shadow-light: rgba(74, 43, 27, 0.1);
          --shadow-medium: rgba(74, 43, 27, 0.2);
          --primary-light: #9d5a47;
          --secondary-light: #a0522d;
        }

        .container {
          max-width: 1200px;
          margin: 20px auto;
          padding: 0;
          background: var(--background-section);
          border-radius: 20px;
          box-shadow: 0 10px 30px var(--shadow-medium);
          border: 3px solid var(--primary-color);
          min-height: 80vh;
          position: relative;
          overflow: hidden;
        }

        .header {
          background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
          color: var(--accent-color);
          padding: 40px;
          text-align: center;
        }

        .header-content {
          display: flex;
          align-items: center;
          justify-content: center;
          gap: 30px;
          flex-wrap: nowrap;
        }

        .logo {
          width: 120px;
          height: 120px;
          flex-shrink: 0;
          display: flex;
          align-items: center;
          justify-content: center;
        }

        .header-text {
          text-align: left;
        }

        .header h1 {
          font-size: 2.5em;
          margin-bottom: 10px;
          text-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
          font-size: 1.1rem;
          opacity: 0.9;
        }

        .container::before {
          content: '';
          position: absolute;
          top: 0;
          left: 0;
          right: 0;
          height: 4px;
          background: linear-gradient(90deg, var(--primary-color) 0%, var(--secondary-color) 100%);
          border-radius: 20px 20px 0 0;
        }

        .content {
          position: relative;
          z-index: 1;
          padding: 30px;
        }

        .back-section {
          margin-bottom: 20px;
        }

        .year-section {
          display: flex;
          justify-content: flex-start;
          margin-bottom: 30px;
        }

        .back-button {
          padding: 12px 20px;
          background: var(--background-card);
          border: 2px solid var(--border-light);
          border-radius: 10px;
          color: var(--primary-color);
          font-size: 14px;
          font-weight: 600;
          cursor: pointer;
          transition: all 0.3s ease;
          box-shadow: 0 4px 15px var(--shadow-medium);
          display: flex;
          align-items: center;
          gap: 8px;
          text-decoration: none;
        }

        .back-button:hover {
          background: var(--primary-color);
          color: var(--background-card);
          border-color: var(--primary-color);
          box-shadow: 0 8px 25px rgba(74, 43, 27, 0.4);
          transform: translateY(-3px);
        }

        .back-button:active {
          transform: translateY(-1px);
          box-shadow: 0 4px 15px var(--shadow-medium);
        }

        .year-selector {
          display: flex;
          flex-direction: column;
          align-items: flex-start;
          gap: 8px;
        }

        .year-label {
          font-weight: 600;
          color: var(--primary-color);
          font-size: 14px;
          text-transform: uppercase;
          letter-spacing: 0.5px;
        }

        .year-select {
          padding: 12px 16px;
          border: 2px solid var(--border-light);
          border-radius: 10px;
          background: var(--background-card);
          color: var(--font-color);
          font-size: 16px;
          font-weight: 600;
          cursor: pointer;
          transition: all 0.3s ease;
          box-shadow: 0 2px 4px var(--shadow-light);
          min-width: 120px;
        }

        .year-select:focus {
          outline: none;
          border-color: var(--primary-color);
          box-shadow: 0 0 0 4px rgba(74, 43, 27, 0.1);
        }

        .year-select:hover {
          border-color: var(--primary-light);
          box-shadow: 0 4px 8px var(--shadow-light);
        }

        .year-select-container {
          position: relative;
        }

        .manual-year-input {
          display: flex;
          align-items: center;
          gap: 10px;
        }

        .year-input {
          padding: 12px 16px;
          border: 2px solid var(--border-light);
          border-radius: 10px;
          background: var(--background-card);
          color: var(--font-color);
          font-size: 16px;
          font-weight: 600;
          cursor: text;
          transition: all 0.3s ease;
          box-shadow: 0 2px 4px var(--shadow-light);
          min-width: 120px;
        }

        .year-input:focus {
          outline: none;
          border-color: var(--primary-color);
          box-shadow: 0 0 0 4px rgba(74, 43, 27, 0.1);
        }

        .manual-year-actions {
          display: flex;
          gap: 5px;
        }

        .btn-year-confirm,
        .btn-year-cancel {
          width: 32px;
          height: 32px;
          border: none;
          border-radius: 6px;
          font-size: 14px;
          font-weight: bold;
          cursor: pointer;
          transition: all 0.2s ease;
          display: flex;
          align-items: center;
          justify-content: center;
        }

        .btn-year-confirm {
          background: #22c55e;
          color: white;
        }

        .btn-year-confirm:hover {
          background: #16a34a;
          transform: scale(1.05);
        }

        .btn-year-cancel {
          background: #ef4444;
          color: white;
        }

        .btn-year-cancel:hover {
          background: #dc2626;
          transform: scale(1.05);
        }

        .page-header {
          text-align: left;
          margin-bottom: 40px;
        }

        .page-header h1 {
          color: var(--primary-color);
          font-size: 2.5em;
          font-weight: 700;
          margin-bottom: 15px;
          text-shadow: 0 1px 2px var(--shadow-light);
        }

        .page-header p {
          color: var(--secondary-color);
          font-size: 1.1em;
          font-weight: 500;
          line-height: 1.6;
        }

        .error-message {
          background: linear-gradient(135deg, #fee2e2 0%, #fecaca 100%);
          border: 2px solid #dc2626;
          color: #991b1b;
          padding: 20px;
          border-radius: 12px;
          margin-bottom: 30px;
          font-weight: 600;
          text-align: center;
          box-shadow: 0 4px 12px rgba(220, 38, 38, 0.2);
        }

        .empty-state {
          text-align: center;
          padding: 60px 20px;
          color: var(--secondary-color);
          background: var(--background-card);
          border-radius: 12px;
          box-shadow: 0 4px 12px var(--shadow-light);
          margin: 20px 0;
          border: 2px solid var(--border-light);
        }

        .empty-title {
          font-size: 1.4em;
          font-weight: 600;
          margin-bottom: 12px;
          color: var(--primary-color);
        }

        .months-grid {
          display: grid;
          grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
          gap: 30px;
        }

        .month-card {
          background: linear-gradient(135deg, var(--background-card) 0%, rgba(122, 62, 45, 0.02) 100%);
          border-radius: 16px;
          padding: 30px;
          border: 2px solid var(--border-light);
          box-shadow: 0 8px 25px var(--shadow-medium);
          transition: all 0.3s ease;
          position: relative;
          overflow: hidden;
        }

        .month-card::before {
          content: '';
          position: absolute;
          top: 0;
          left: 0;
          right: 0;
          height: 4px;
          background: linear-gradient(90deg, var(--primary-color) 0%, var(--secondary-color) 100%);
        }

        .month-card:hover {
          transform: translateY(-5px);
          box-shadow: 0 12px 35px var(--shadow-medium);
          border-color: var(--primary-light);
        }

        .month-header {
          display: flex;
          align-items: center;
          gap: 15px;
          margin-bottom: 25px;
        }

        .month-icon {
          display: flex;
          align-items: center;
          justify-content: center;
          width: 32px;
          height: 32px;
          margin-right: 12px;
          opacity: 0.8;
          color: var(--primary-color);
          transition: all 0.3s ease;
        }

        .month-icon:hover {
          opacity: 1;
          transform: scale(1.1);
        }

        .month-title {
          flex: 1;
          font-size: 1.4em;
          font-weight: 700;
          color: var(--primary-color);
          text-transform: capitalize;
        }

        .status-indicator {
          width: 20px;
          height: 20px;
          border-radius: 50%;
          display: flex;
          align-items: center;
          justify-content: center;
          font-size: 12px;
          font-weight: bold;
          color: white;
        }

        .status-indicator.green {
          background: #22c55e;
        }

        .status-indicator.orange {
          background: #f97316;
        }

        .status-indicator.red {
          background: #dc2626;
        }

        .earnings-section {
          margin-bottom: 16px;
          padding: 0;
        }

        .earnings-row {
          display: flex;
          align-items: center;
          margin-bottom: 8px;
          gap: 8px;
        }

        .earnings-simple {
          display: flex;
          align-items: center;
          margin-bottom: 6px;
          padding-left: 20px;
          gap: 8px;
        }

        .earnings-icon {
          color: #22c55e;
          font-size: 12px;
          font-weight: bold;
          width: 16px;
          flex-shrink: 0;
        }

        .earnings-label {
          font-weight: 500;
          color: #333;
          font-size: 15px;
          min-width: 100px;
        }

        .earnings-simple .earnings-label {
          font-weight: 400;
          color: #666;
          font-size: 13px;
          min-width: 80px;
        }

        .earnings-value {
          font-weight: 700;
          font-size: 15px;
          color: #333;
          text-align: right;
          min-width: 80px;
        }

        .earnings-value.earned {
          color: #333;
          font-weight: 700;
        }

        .earnings-value.paid {
          color: #666;
          font-weight: 500;
          font-size: 13px;
        }

        .earnings-value.remaining {
          color: #666;
          font-weight: 500;
          font-size: 13px;
        }

        .earnings-value.advance {
          color: #ff9800;
          font-weight: 600;
          font-size: 13px;
        }

        .earnings-percentage {
          font-weight: 600;
          color: #333;
          font-size: 15px;
          margin-left: auto;
          flex-shrink: 0;
        }

        .progress-section {
          display: flex;
          align-items: center;
          gap: 15px;
          margin-bottom: 20px;
        }

        .progress-bar {
          flex: 1;
          height: 12px;
          background: var(--border-light);
          border-radius: 6px;
          overflow: hidden;
          box-shadow: inset 0 2px 4px var(--shadow-light);
        }

        .progress-fill {
          height: 100%;
          background: linear-gradient(90deg, #22c55e 0%, #16a34a 100%);
          border-radius: 6px;
          transition: width 0.3s ease;
        }

        .progress-percentage {
          font-weight: 700;
          color: var(--primary-color);
          font-size: 14px;
          min-width: 40px;
          text-align: right;
        }

        .debt-notice {
          background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
          border: 2px solid #f59e0b;
          color: #92400e;
          padding: 15px;
          border-radius: 10px;
          margin-bottom: 20px;
          font-weight: 600;
          display: flex;
          align-items: center;
          gap: 10px;
        }

        .debt-icon {
          font-size: 18px;
        }

        .card-actions {
          display: flex;
          gap: 12px;
          flex-wrap: wrap;
        }

        .btn {
          background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
          color: var(--accent-color);
          border: none;
          padding: 11px 22px;
          border-radius: 10px;
          font-size: 11px;
          font-weight: 700;
          cursor: pointer;
          transition: all 0.3s ease;
          text-transform: uppercase;
          letter-spacing: 0.5px;
          box-shadow: 0 4px 15px var(--shadow-medium);
          flex: 1;
          min-width: 120px;
          display: inline-flex;
          align-items: center;
          justify-content: center;
          gap: 6px;
        }

        .btn:hover {
          transform: translateY(-3px);
          box-shadow: 0 8px 25px rgba(74, 43, 27, 0.4);
          background: linear-gradient(135deg, var(--primary-light) 0%, var(--secondary-light) 100%);
        }

        .btn:active {
          transform: translateY(-1px);
          box-shadow: 0 4px 15px var(--shadow-medium);
        }

        .btn:disabled {
          opacity: 0.6;
          cursor: not-allowed;
          transform: none;
          box-shadow: 0 4px 15px var(--shadow-medium);
        }

        .btn-primary {
          background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
          color: var(--accent-color);
        }

        .btn-primary:hover {
          background: linear-gradient(135deg, var(--primary-light) 0%, var(--secondary-light) 100%);
        }

        .btn-secondary {
          background: var(--background-card);
          color: var(--primary-color);
          border: 2px solid var(--border-light);
        }

        .btn-secondary:hover {
          background: var(--primary-color);
          color: var(--background-card);
          border-color: var(--primary-color);
        }

        .btn-danger {
          background: linear-gradient(135deg, #dc2626, #b91c1c);
          color: var(--accent-color);
        }

        .btn-danger:hover {
          background: linear-gradient(135deg, #ef4444, #dc2626);
        }

        .btn-small {
          padding: 8px 16px;
          font-size: 10px;
          min-width: 100px;
          border-radius: 8px;
          flex: none;
        }

        .history-section {
          border-top: 2px solid var(--border-light);
          padding-top: 25px;
          margin-top: 25px;
          animation: slideDown 0.3s ease-out;
        }

        @keyframes slideDown {
          from {
            opacity: 0;
            transform: translateY(-10px);
          }
          to {
            opacity: 1;
            transform: translateY(0);
          }
        }

        .history-title {
          font-weight: 600;
          color: var(--primary-color);
          margin-bottom: 20px;
          font-size: 1.1em;
        }

        .history-list {
          display: flex;
          flex-direction: column;
          gap: 12px;
        }

        .history-item {
          display: flex;
          justify-content: space-between;
          align-items: center;
          padding: 16px;
          background: rgba(255, 255, 255, 0.7);
          border-radius: 10px;
          border: 1px solid var(--border-light);
          transition: all 0.2s ease;
        }

        .history-item--reversed {
          opacity: 0.7;
          border-style: dashed;
          background: rgba(220, 38, 38, 0.05);
        }

        .history-item:hover {
          background: rgba(255, 255, 255, 0.9);
          box-shadow: 0 2px 8px var(--shadow-light);
        }

        .history-info {
          flex: 1;
        }

        .history-amount {
          font-weight: 700;
          color: var(--primary-color);
          font-size: 1.1em;
          margin-bottom: 4px;
        }

        .history-details {
          font-size: 14px;
          color: var(--secondary-color);
        }

        .history-reversed-note {
          font-size: 13px;
          color: #b45309;
          margin-top: 4px;
        }

        .history-item--advance {
          background: rgba(255, 152, 0, 0.05);
          border-color: rgba(255, 152, 0, 0.3);
          flex-direction: column;
          align-items: stretch;
        }

        .history-item--advance:hover {
          background: rgba(255, 152, 0, 0.08);
        }

        .history-separator {
          width: 100%;
          height: 1px;
          background: linear-gradient(90deg, transparent 0%, rgba(255, 152, 0, 0.3) 50%, transparent 100%);
          margin-bottom: 12px;
        }

        .advance-amount {
          color: #ff9800;
          font-weight: 700;
          font-size: 1.1em;
        }

        .modal-overlay {
          position: fixed;
          inset: 0;
          background: rgba(0, 0, 0, 0.6);
          display: flex;
          align-items: center;
          justify-content: center;
          padding: 20px;
          z-index: 1000;
          backdrop-filter: blur(4px);
        }

        .modal-content {
          background: var(--background-card);
          border-radius: 16px;
          padding: 30px;
          width: 100%;
          max-width: 500px;
          box-shadow: 0 20px 50px rgba(0, 0, 0, 0.3);
          border: 2px solid var(--primary-color);
          position: relative;
        }

        .modal-content::before {
          content: '';
          position: absolute;
          top: 0;
          left: 0;
          right: 0;
          height: 4px;
          background: linear-gradient(90deg, var(--primary-color) 0%, var(--secondary-color) 100%);
          border-radius: 16px 16px 0 0;
        }

        .modal-title {
          color: var(--primary-color);
          font-size: 1.5em;
          font-weight: 700;
          margin-bottom: 25px;
          text-align: center;
        }

        .modal-form {
          display: flex;
          flex-direction: column;
          gap: 20px;
        }

        .form-group {
          display: flex;
          flex-direction: column;
          gap: 8px;
        }

        .form-label {
          font-weight: 600;
          color: var(--primary-color);
          font-size: 14px;
          text-transform: uppercase;
          letter-spacing: 0.5px;
        }

        .form-input,
        .form-textarea {
          padding: 14px 16px;
          border: 2px solid var(--border-light);
          border-radius: 10px;
          font-size: 16px;
          background: var(--background-card);
          color: var(--font-color);
          transition: all 0.3s ease;
          box-shadow: 0 2px 4px var(--shadow-light);
        }

        .form-input:focus,
        .form-textarea:focus {
          outline: none;
          border-color: var(--primary-color);
          box-shadow: 0 0 0 4px rgba(74, 43, 27, 0.1);
        }

        .form-textarea {
          resize: vertical;
          min-height: 80px;
        }

        .modal-actions {
          display: flex;
          gap: 15px;
          margin-top: 10px;
        }

        @media (max-width: 768px) {
          .container {
            margin: 0;
            padding: 0;
            border-radius: 0;
            border: none;
            min-height: 100vh;
          }

          .header {
            padding: 5px 20px !important;
          }

          .header-content {
            flex-direction: column;
            gap: 20px;
          }

          .logo {
            width: 100px;
            height: 100px;
          }

          .header-text {
            text-align: center;
          }

          .header h1 {
            font-size: 2em;
          }

          .content {
            padding: 0 15px;
          }

          .months-grid {
            grid-template-columns: 1fr;
            gap: 15px;
            padding: 0;
          }

          .month-card {
            padding: 15px;
            margin: 0;
            border-radius: 12px;
          }

          .back-section {
            padding: 10px 0;
          }

          .year-section {
            padding: 10px 0;
          }

          .manual-year-input {
            flex-direction: column;
            align-items: stretch;
            gap: 15px;
          }

          .year-input {
            font-size: 16px;
            padding: 14px 16px;
            min-width: auto;
            width: 100%;
          }

          .manual-year-actions {
            justify-content: center;
            gap: 15px;
          }

          .btn-year-confirm,
          .btn-year-cancel {
            width: 40px;
            height: 40px;
            font-size: 16px;
          }

          .card-actions {
            flex-direction: column;
            gap: 10px;
          }

          .btn {
            min-width: auto;
            padding: 12px 20px;
            font-size: 14px;
          }

          .modal-content {
            margin: 10px;
            padding: 20px;
          }

          .modal-actions {
            flex-direction: column;
          }

          .earnings-row {
            gap: 6px;
            margin-bottom: 8px;
          }

          .earnings-simple {
            padding-left: 16px;
            margin-bottom: 4px;
          }

          .earnings-label {
            font-size: 14px;
            min-width: 90px;
          }

          .earnings-simple .earnings-label {
            font-size: 12px;
            min-width: 70px;
          }

          .earnings-value {
            font-size: 14px;
            min-width: 70px;
          }

          .earnings-value.paid,
          .earnings-value.remaining {
            font-size: 12px;
          }

          .earnings-percentage {
            font-size: 14px;
          }

          .earnings-icon {
            font-size: 8px;
            width: 12px;
          }
        }

        .advance-badge {
          display: inline-block;
          background-color: #ff9800;
          color: white;
          font-size: 10px;
          font-weight: bold;
          padding: 2px 6px;
          border-radius: 4px;
          margin-left: 6px;
          vertical-align: middle;
          text-transform: uppercase;
        }
      `}</style>
    </div>
  );
}
</file>

<file path="src/app/globals.css">
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

:root {
    /* –¶–≤–µ—Ç–æ–≤–∞—è –ø–∞–ª–∏—Ç—Ä–∞ –≤ —Å—Ç–∏–ª–µ —Ä—É—Å—Å–∫–æ–π –±–∞–Ω–∏ */
    --primary-color: #4A2B1B;        /* –ì–ª—É–±–æ–∫–∏–π –±–∞–Ω–Ω—ã–π –∫–æ—Ä–∏—á–Ω–µ–≤—ã–π */
    --secondary-color: #7A3E2D;      /* –¢–µ–º–Ω—ã–π —è–Ω—Ç–∞—Ä–Ω–æ-–∫—Ä–∞—Å–Ω—ã–π */
    --accent-color: #E9D5B5;         /* –ë–µ—Ä–µ–∑–æ–≤—ã–π –±–µ–∂–µ–≤—ã–π */
    --background-main: #F2E5D3;      /* –¢–µ–ø–ª—ã–π –ø–∞—Ä–æ–≤–æ–π –±–µ–∂–µ–≤—ã–π */
    --font-color: #2C1A0F;           /* –£–≥–æ–ª—å–Ω–æ-–∫–æ—Ä–∏—á–Ω–µ–≤—ã–π */
    
    /* –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –æ—Ç—Ç–µ–Ω–∫–∏ –¥–ª—è –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ */
    --primary-light: #5D3426;        /* –°–≤–µ—Ç–ª–µ–µ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ */
    --primary-dark: #3A2015;         /* –¢–µ–º–Ω–µ–µ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ */
    --secondary-light: #8B4A38;      /* –°–≤–µ—Ç–ª–µ–µ –≤—Ç–æ—Ä–∏—á–Ω–æ–≥–æ */
    --secondary-dark: #6A3424;       /* –¢–µ–º–Ω–µ–µ –≤—Ç–æ—Ä–∏—á–Ω–æ–≥–æ */
    --accent-light: #F0E2C8;         /* –°–≤–µ—Ç–ª–µ–µ –∞–∫—Ü–µ–Ω—Ç–Ω–æ–≥–æ */
    --accent-dark: #DCC49F;          /* –¢–µ–º–Ω–µ–µ –∞–∫—Ü–µ–Ω—Ç–Ω–æ–≥–æ */
    
    /* –§–æ–Ω–æ–≤—ã–µ –æ—Ç—Ç–µ–Ω–∫–∏ */
    --background-card: #FEFCF8;      /* –û—á–µ–Ω—å —Å–≤–µ—Ç–ª—ã–π —Ç–µ–ø–ª—ã–π –±–µ–ª—ã–π */
    --background-section: rgba(233, 213, 181, 0.15); /* –ü–æ–ª—É–ø—Ä–æ–∑—Ä–∞—á–Ω—ã–π –∞–∫—Ü–µ–Ω—Ç */
    
    /* –¢–µ–Ω–∏ –∏ –≥—Ä–∞–Ω–∏—Ü—ã */
    --shadow-light: rgba(74, 43, 27, 0.1);
    --shadow-medium: rgba(74, 43, 27, 0.15);
    --border-light: rgba(74, 43, 27, 0.2);
}

body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background: linear-gradient(135deg, var(--background-main) 0%, var(--accent-light) 100%);
    min-height: 100vh;
    padding: 20px;
    color: var(--font-color);
}

.container {
    max-width: 800px;
    margin: 0 auto;
    background: var(--background-card);
    border-radius: 15px;
    box-shadow: 0 20px 40px var(--shadow-light);
    overflow: hidden;
}

.header {
    background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
    color: var(--accent-color);
    padding: 5px !important;
    text-align: center;
}

.header-content {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 12px;
    flex-wrap: nowrap;
    max-width: 400px;
    margin: 0 auto;
}

.logo {
    width: 50px;
    height: 50px;
    flex-shrink: 0;
}

.header-text {
    text-align: left;
}

.header h1 {
    font-size: 2.5em;
    margin-bottom: 10px;
    text-shadow: 0 2px 4px rgba(0,0,0,0.3);
}

.content {
    padding: 30px;
}

/* –°–µ–∫—Ü–∏—è –¥–ª—è —Ñ–æ—Ä–º—ã –Ω–æ–≤–æ–π —Å–º–µ–Ω—ã –≤ —Å—Ç–∏–ª–µ —Ä—É—Å—Å–∫–æ–π –±–∞–Ω–∏ */
.form-section {
    background: linear-gradient(135deg, var(--background-section) 0%, rgba(122, 62, 45, 0.08) 100%);
    border-radius: 12px;
    padding: 30px;
    margin-bottom: 30px;
    border: 2px solid var(--primary-color);
    box-shadow: 0 8px 25px var(--shadow-medium);
    position: relative;
}

.form-section::before {
    content: '';
    position: absolute;
    top: -1px;
    left: -1px;
    right: -1px;
    bottom: -1px;
    background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
    border-radius: 12px;
    z-index: -1;
}

.form-section h2 {
    color: var(--primary-color);
    margin-bottom: 25px;
    font-size: 1.8em;
    text-align: center;
    text-shadow: 0 1px 2px var(--shadow-light);
}

.month-card__header {
    background: #fff5ed;
    border-radius: 18px;
    box-shadow: 0 8px 22px rgba(74, 43, 27, 0.12);
    padding: 22px;
    margin-bottom: 24px;
    border: 1px solid #f2ceb2;
}

.month-card__status {
    display: inline-flex;
    align-items: center;
    gap: 10px;
    font-weight: 600;
    color: var(--secondary-color);
    margin-bottom: 16px;
}

.month-card__status span {
    font-size: 0.95rem;
}

.month-card__totals {
    background: #fff1e3;
    border-radius: 16px;
    border: 1px solid #f2ceb2;
    padding: 18px 22px;
    display: flex;
    flex-direction: column;
    gap: 12px;
}

.month-card__totals-row {
    display: flex;
    justify-content: space-between;
    align-items: flex-end;
}

.month-card__totals-label {
    font-size: 0.85rem;
    color: rgba(44, 26, 15, 0.7);
}

.month-card__totals-value {
    font-size: 1.3rem;
    font-weight: 700;
    color: var(--font-color);
}

.month-card__totals-row--accent .month-card__totals-value {
    font-size: 1.45rem;
}

.month-card__totals-value--danger {
    color: #c2410c;
}

.month-card__totals-value--success {
    color: #15803d;
}

.status-circle {
    width: 16px;
    height: 16px;
    border-radius: 999px;
    display: inline-block;
    background: #6b7280;
    flex-shrink: 0;
}

.status-circle--open {
    background: #ef4444;
}

.status-circle--partial {
    background: #eab308;
}

.status-circle--closed {
    background: #22c55e;
}

.form-group {
    margin-bottom: 20px;
}

.form-group label {
    display: block;
    margin-bottom: 8px;
    font-weight: 600;
    color: var(--primary-color);
    font-size: 1.1em;
}

.form-group input,
.form-group select {
    width: 100%;
    padding: 12px 15px;
    border: 2px solid var(--border-light);
    border-radius: 8px;
    font-size: 16px;
    background: var(--background-card);
    color: var(--font-color);
    transition: all 0.3s ease;
}

.form-group input:focus,
.form-group select:focus {
    outline: none;
    border-color: var(--primary-color);
    box-shadow: 0 0 0 3px rgba(74, 43, 27, 0.1);
    background: #fff;
}

.form-row {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 20px;
}

.btn {
    background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
    color: var(--accent-color);
    border: none;
    padding: 10px 21px;
    border-radius: 8px;
    font-size: 11px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
    box-shadow: 0 4px 15px var(--shadow-medium);
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 20px var(--shadow-medium);
    background: linear-gradient(135deg, var(--primary-light) 0%, var(--secondary-light) 100%);
}

.btn:active {
    transform: translateY(0);
    box-shadow: 0 2px 10px var(--shadow-medium);
}

.btn-secondary {
    background: linear-gradient(135deg, var(--accent-color) 0%, var(--accent-light) 100%);
    color: var(--primary-color);
    border: 2px solid var(--primary-color);
}

.btn-secondary:hover {
    background: linear-gradient(135deg, var(--accent-dark) 0%, var(--accent-color) 100%);
    transform: translateY(-2px);
    box-shadow: 0 6px 20px var(--shadow-medium);
}

.btn-secondary:active {
    transform: translateY(0);
    box-shadow: 0 2px 10px var(--shadow-medium);
}

.success-message {
    background: linear-gradient(135deg, rgba(76, 175, 80, 0.1) 0%, rgba(139, 195, 74, 0.1) 100%);
    color: #2E7D32;
    padding: 15px;
    border-radius: 8px;
    margin-top: 15px;
    border: 2px solid rgba(76, 175, 80, 0.3);
    font-weight: 600;
    text-align: center;
}

/* –û–±—â–∏–π —Å—Ç–∏–ª—å —Ç–∞–±–ª–∏—Ü —Å–º–µ–Ω –≤ —Ç—ë–ø–ª–æ–π —Ç–µ–º–µ (–∫–∞–∫ –Ω–∞ –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ) */
.shifts-table {
    width: 100%;
    border-collapse: collapse;
    background: var(--background-card);
    border-radius: 10px;
    overflow: hidden;
    box-shadow: 0 4px 8px var(--shadow-light);
}

.shifts-table th {
    background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
    color: var(--accent-color);
    padding: 15px 12px;
    text-align: left;
    font-weight: 600;
    font-size: 14px;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.shifts-table td {
    padding: 15px 12px;
    border-bottom: 1px solid var(--border-light);
    color: var(--font-color);
}

.shifts-table tr:hover {
    background: var(--background-section);
}

.shifts-table tr:last-child td {
    border-bottom: none;
}

.shift-row {
    transition: background-color 0.2s ease;
}

.shift-row:hover {
    background-color: rgba(139, 69, 19, 0.05);
}

.shifts-table--employees .employee-row {
    cursor: pointer;
}

.shifts-table--employees {
    border-collapse: separate;
    border-spacing: 0 18px;
}

.shifts-table--employees td {
    border-bottom: none;
    padding: 0;
}

.employee-card-wrapper {
    padding: 0;
}

.employee-card {
    background: #fff6ed;
    border: 1px solid #f2d6bf;
    border-radius: 20px;
    box-shadow: 0 8px 18px rgba(74, 43, 27, 0.12);
    padding: 18px 20px 20px;
}

.employee-card__header {
    display: flex;
    align-items: flex-start;
    justify-content: space-between;
    gap: 12px;
}

.employee-card__name {
    font-size: 1.2rem;
    font-weight: 600;
    color: var(--primary-color);
    margin: 0;
}

.employee-status-badge {
    display: inline-flex;
    align-items: center;
    gap: 6px;
    padding: 4px 10px;
    border-radius: 999px;
    font-size: 0.85rem;
    font-weight: 600;
    text-transform: lowercase;
    background: rgba(22, 163, 74, 0.12);
    color: #15803d;
    white-space: nowrap;
}

.employee-status-badge--debt {
    background: rgba(220, 38, 38, 0.12);
    color: #b91c1c;
}

.employee-status-badge__dot {
    width: 8px;
    height: 8px;
    border-radius: 999px;
    background: currentColor;
    display: inline-flex;
}

.employee-card__total {
    margin-top: 6px;
    font-weight: 600;
    color: var(--primary-color);
    font-size: 0.95rem;
}

.employee-card__total span {
    font-size: 1.05rem;
}

.employee-card__amount {
    font-weight: 600;
    color: var(--font-color);
}

.employee-card__amount--danger {
    color: #c2410c;
}

.employee-card__amount--safe {
    color: #15803d;
}

.employee-card__balance {
    display: flex;
    flex-direction: column;
    gap: 10px;
    margin-top: 16px;
}

.employee-card__summary-row {
    display: grid;
    grid-template-columns: 1fr auto;
    gap: 8px;
    font-size: 0.95rem;
    color: rgba(44, 26, 15, 0.7);
}

.employee-card__summary-row span:last-child {
    justify-self: end;
    font-weight: 600;
    color: var(--font-color);
}

.employee-card__summary-row--accent span:last-child {
    font-size: 1.15rem;
}

.shift-card-cell {
    padding: 0 !important;
    display: block !important;
    width: 100%;
}

.shift-card-list {
    display: flex;
    flex-direction: column;
    gap: 10px;
    width: 100%;
    padding: 0 15px;
}

.shift-card {
    background: #f9f4f0;
    border-radius: 18px;
    padding: 16px;
    border: 1px solid #ece0d6;
    width: 100%;
}

.shift-card__header {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    gap: 12px;
    margin-bottom: 12px;
}

.shift-card__date {
    font-size: 1rem;
    font-weight: 500;
    color: var(--primary-color);
}

.shift-card__masters {
    font-size: 0.9rem;
    color: rgba(44, 26, 15, 0.6);
    margin-top: 4px;
}

.shift-card__hours-badge {
    background: #f4e6da;
    color: var(--primary-color);
    font-weight: 600;
    padding: 6px 12px;
    border-radius: 999px;
    font-size: 0.95rem;
    white-space: nowrap;
}

.shift-card__services {
    display: flex;
    flex-direction: column;
    gap: 8px;
    margin-bottom: 10px;
}

.shift-card__service-row {
    display: grid;
    grid-template-columns: 60% 40%;
    align-items: center;
    gap: 8px;
    font-size: 0.9rem;
    color: rgba(44, 26, 15, 0.7);
}

.shift-card__service-row span:last-child {
    text-align: right;
    font-weight: 600;
    color: var(--font-color);
}

.shift-card__total {
    margin-top: 8px;
    text-align: right;
}

.shift-card__total-value {
    font-weight: 400;
    font-size: 0.95rem;
    color: var(--primary-color);
}

/* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å */
@media (max-width: 768px) {
    body {
        padding: 10px;
    }
    
    .container {
        border-radius: 10px;
    }
    
    .header {
        padding: 5px !important;
    }
    
    .header-content {
        flex-direction: column;
        gap: 15px;
    }
    
    .logo {
        width: 40px;
        height: 40px;
    }
    
    .header h1 {
        font-size: 2em;
    }
    
    .content {
        padding: 20px;
    }
    
    .form-section {
        padding: 20px;
    }
    
    .form-row {
        grid-template-columns: 1fr;
        gap: 15px;
    }
    
    .btn {
        padding: 12px 25px;
        font-size: 14px;
    }

    .month-card__header {
        padding: 18px;
    }

    .month-card__totals {
        padding: 16px;
    }

    .shifts-table--employees thead {
        display: none;
    }

    .shifts-table--employees tbody tr {
        display: block;
        border: none;
        border-radius: 0;
        box-shadow: none;
        background: transparent;
        margin-bottom: 16px;
    }

    .shifts-table--employees td {
        display: block;
        padding: 0;
        border: none;
    }

    .shifts-table--employees td + td {
        margin-top: 0;
    }

    .shifts-table--employees td::before {
        content: none;
    }

    .employee-card {
        padding: 16px;
    }

    .employee-card__balance {
        flex-direction: row;
        gap: 12px;
    }

    .shift-card {
        padding: 16px;
    }

    .shift-card__service-row {
        grid-template-columns: minmax(0, 1fr) auto;
    }

    .shift-card__hours-badge {
        font-size: 0.9rem;
    }

}

@media (max-width: 480px) {
    .month-card__header {
        padding: 16px;
    }

    .month-card__totals {
        padding: 14px;
    }

    .shift-card {
        padding: 14px;
    }
}

/* balance block: 2 columns, label on top, value below */
.balance-grid{
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 16px;
    align-items: start;
}
.balance-col{ min-width: 0; }
.balance-col--right{
    text-align: right;
}
.balance-label{
    font-size: 0.875rem;
    line-height: 1.2;
    opacity: .75;
    margin-bottom: 4px;
}
.balance-value{
    font-weight: 700;
    font-size: clamp(16px, 4vw, 18px);
    line-height: 1.1;
    white-space: nowrap;
    color: #000;
}
@media (min-width: 768px){
  /* –Ω–∞ –ø–ª–∞–Ω—à–µ—Ç–µ/–¥–µ—Å–∫—Ç–æ–ø–µ –º–æ–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å —á—É—Ç—å –∫—Ä—É–ø–Ω–µ–µ –∏ –≤—ã—Ä–æ–≤–Ω—è—Ç—å –ø–æ –Ω–∏–∑—É */
  .balance-grid{ gap: 24px; }
  .balance-value{ font-size: 18px; }
}
</file>

<file path="src/app/api/shifts/route.ts">
import { NextRequest, NextResponse } from 'next/server';
import { getShifts, addShift, getPrices, getShiftsForUserAndMonth, getMonthStatus, recalculateAdvancesForMonth, autoCloseFinishedMonths } from '@/lib/db';
import { requireAuth, requireMasterForMutation } from '@/lib/auth-server';

export async function GET(request: NextRequest) {
  try {
    const user = await requireAuth(request);
    const { searchParams } = new URL(request.url);
    const userId = searchParams.get('user_id');
    const month = searchParams.get('month');

    if (userId && month) {
      const shifts = await getShiftsForUserAndMonth(parseInt(userId), month);
      return NextResponse.json(shifts);
    } else {
      const shifts = await getShifts(user.id);
      return NextResponse.json(shifts);
    }
  } catch (error) {
    if (error instanceof Error && error.message === 'Unauthorized') {
      return NextResponse.json({ error: '–¢—Ä–µ–±—É–µ—Ç—Å—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è' }, { status: 401 });
    }
    console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ —Å–º–µ–Ω:', error);
    return NextResponse.json({ error: '–û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞' }, { status: 500 });
  }
}

export async function POST(request: NextRequest) {
  try {
    const user = await requireMasterForMutation(request);
    const { date, hours, masters, total, services, service_prices, steam_bath, brand_steam, intro_steam, scrubbing, zaparnik } = await request.json();

    try {
      const month = (typeof date === 'string' && date.length >= 7) ? date.slice(0, 7) : '';
      if (month) {
        const isClosed = await getMonthStatus(month);
        if (isClosed) {
          return NextResponse.json({ error: '–ú–µ—Å—è—Ü –∑–∞–∫—Ä—ã—Ç, –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ —Å–º–µ–Ω –∑–∞–ø—Ä–µ—â–µ–Ω–æ' }, { status: 403 });
        }
      }
    } catch (e) {
      // –µ—Å–ª–∏ —Ñ–æ—Ä–º–∞—Ç –¥–∞—Ç—ã –Ω–µ–æ–∂–∏–¥–∞–Ω–Ω—ã–π, –ø—Ä–æ–¥–æ–ª–∂–∞–µ–º –±–µ–∑ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏
    }

    if (!date || hours === undefined || total === undefined) {
      return NextResponse.json({ error: '–î–∞—Ç–∞, —á–∞—Å—ã –∏ –æ–±—â–∞—è —Å—É–º–º–∞ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã' }, { status: 400 });
    }
    if (typeof hours !== 'number' || hours < 0) {
      return NextResponse.json({ error: '–ß–∞—Å—ã –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–º —á–∏—Å–ª–æ–º' }, { status: 400 });
    }
    if (typeof total !== 'number' || total < 0) {
      return NextResponse.json({ error: '–û–±—â–∞—è —Å—É–º–º–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–º —á–∏—Å–ª–æ–º' }, { status: 400 });
    }

    const prices = await getPrices();

    const shiftData: any = {
      user_id: user.id,
      date,
      hours,
      masters: masters || 1,
      total,
      hourly_rate: prices.find(p => p.name === '–ü–æ—á–∞—Å–æ–≤–∞—è —Å—Ç–∞–≤–∫–∞')?.price || 0
    };

    if (services && typeof services === 'object') {
      shiftData.services = JSON.stringify(services);
      shiftData.service_prices = JSON.stringify(service_prices || {});

      shiftData.steam_bath = services['–ü—É—Ç–µ–≤–æ–µ –ø–∞—Ä–µ–Ω–∏–µ'] || 0;
      shiftData.brand_steam = services['–§–∏—Ä–º–µ–Ω–Ω–æ–µ –ø–∞—Ä–µ–Ω–∏–µ'] || 0;
      shiftData.intro_steam = services['–û–∑–Ω–∞–∫–æ–º–∏—Ç–µ–ª—å–Ω–æ–µ –ø–∞—Ä–µ–Ω–∏–µ'] || 0;
      shiftData.scrubbing = services['–°–∫—Ä–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ'] || 0;
      shiftData.zaparnik = services['–ó–∞–ø–∞—Ä–Ω–∏–∫'] || 0;

      shiftData.steam_bath_price = service_prices?.['–ü—É—Ç–µ–≤–æ–µ –ø–∞—Ä–µ–Ω–∏–µ'] || prices.find(p => p.name === '–ü—É—Ç–µ–≤–æ–µ –ø–∞—Ä–µ–Ω–∏–µ')?.price || 0;
      shiftData.brand_steam_price = service_prices?.['–§–∏—Ä–º–µ–Ω–Ω–æ–µ –ø–∞—Ä–µ–Ω–∏–µ'] || prices.find(p => p.name === '–§–∏—Ä–º–µ–Ω–Ω–æ–µ –ø–∞—Ä–µ–Ω–∏–µ')?.price || 0;
      shiftData.intro_steam_price = service_prices?.['–û–∑–Ω–∞–∫–æ–º–∏—Ç–µ–ª—å–Ω–æ–µ –ø–∞—Ä–µ–Ω–∏–µ'] || prices.find(p => p.name === '–û–∑–Ω–∞–∫–æ–º–∏—Ç–µ–ª—å–Ω–æ–µ –ø–∞—Ä–µ–Ω–∏–µ')?.price || 0;
      shiftData.scrubbing_price = service_prices?.['–°–∫—Ä–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ'] || prices.find(p => p.name === '–°–∫—Ä–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ')?.price || 0;
      shiftData.zaparnik_price = service_prices?.['–ó–∞–ø–∞—Ä–Ω–∏–∫'] || prices.find(p => p.name === '–ó–∞–ø–∞—Ä–Ω–∏–∫')?.price || 0;
    } else {
      shiftData.steam_bath = steam_bath || 0;
      shiftData.brand_steam = brand_steam || 0;
      shiftData.intro_steam = intro_steam || 0;
      shiftData.scrubbing = scrubbing || 0;
      shiftData.zaparnik = zaparnik || 0;

      shiftData.steam_bath_price = prices.find(p => p.name === '–ü—É—Ç–µ–≤–æ–µ –ø–∞—Ä–µ–Ω–∏–µ')?.price || 0;
      shiftData.brand_steam_price = prices.find(p => p.name === '–§–∏—Ä–º–µ–Ω–Ω–æ–µ –ø–∞—Ä–µ–Ω–∏–µ')?.price || 0;
      shiftData.intro_steam_price = prices.find(p => p.name === '–û–∑–Ω–∞–∫–æ–º–∏—Ç–µ–ª—å–Ω–æ–µ –ø–∞—Ä–µ–Ω–∏–µ')?.price || 0;
      shiftData.scrubbing_price = prices.find(p => p.name === '–°–∫—Ä–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ')?.price || 0;
      shiftData.zaparnik_price = prices.find(p => p.name === '–ó–∞–ø–∞—Ä–Ω–∏–∫')?.price || 0;
    }

    await addShift(shiftData);

    // –ü–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ–º –∞–≤–∞–Ω—Å—ã –¥–ª—è –º–µ—Å—è—Ü–∞, –≤ –∫–æ—Ç–æ—Ä—ã–π –¥–æ–±–∞–≤–ª–µ–Ω–∞ —Å–º–µ–Ω–∞
    try {
      const month = (typeof date === 'string' && date.length >= 7) ? date.slice(0, 7) : '';
      if (month) {
        await recalculateAdvancesForMonth(user.id, month);
      }

      // –ó–∞–ø—É—Å–∫–∞–µ–º –ø—Ä–æ–≤–µ—Ä–∫—É –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –∑–∞–∫—Ä—ã—Ç–∏—è –º–µ—Å—è—Ü–µ–≤ (–≤ —Ñ–æ–Ω–æ–≤–æ–º —Ä–µ–∂–∏–º–µ)
      autoCloseFinishedMonths().catch(err => console.error('–û—à–∏–±–∫–∞ –≤ —Ñ–æ–Ω–æ–≤–æ–π –∑–∞–¥–∞—á–µ –∞–≤—Ç–æ–∑–∞–∫—Ä—ã—Ç–∏—è:', err));
    } catch (e) {
      console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–µ—Ä–µ—Å—á–µ—Ç–µ –∞–≤–∞–Ω—Å–æ–≤:', e);
      // –ù–µ –ø—Ä–µ—Ä—ã–≤–∞–µ–º –æ—Ç–≤–µ—Ç –∫–ª–∏–µ–Ω—Ç—É, —Ç–∞–∫ –∫–∞–∫ —Å–º–µ–Ω–∞ —É–∂–µ –¥–æ–±–∞–≤–ª–µ–Ω–∞
    }

    return NextResponse.json({
      message: '–°–º–µ–Ω–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ',
      shift: { date, hours, masters, total, services: services || {} }
    });
  } catch (error) {
    if (error instanceof Error) {
      if (error.message === 'Unauthorized') {
        return NextResponse.json({ error: '–¢—Ä–µ–±—É–µ—Ç—Å—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è' }, { status: 401 });
      }
      if (error.message === 'Forbidden') {
        return NextResponse.json({ error: '–î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â–µ–Ω' }, { status: 403 });
      }
    }
    console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ —Å–º–µ–Ω—ã:', error);
    return NextResponse.json({ error: '–û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞' }, { status: 500 });
  }
}
</file>

<file path="vercel.json">
{
  "version": 2,
  "regions": ["fra1"],
  "buildCommand": "npm run build",
  "outputDirectory": ".next",
  "framework": "nextjs",
  "installCommand": "npm install"
}
</file>

<file path="src/app/pricing/page.tsx">
'use client';

import { useState, useEffect } from 'react';
import Image from 'next/image';
import { useRouter } from 'next/navigation';
import { useServices, Price } from '@/contexts/ServicesContext';
import { useTelegramAuth } from '@/hooks/useTelegramAuth';

interface Notification {
  id: number;
  message: string;
  type: 'success' | 'error';
}

export default function PricingPage() {
  const router = useRouter();
  const { prices, addPrice, updatePrice, deletePrice, refreshPrices, loading: pricesLoading, error } = useServices();
  const { user } = useTelegramAuth();
  const readonly = user?.role !== 'admin';

  const [isModalOpen, setIsModalOpen] = useState(false);
  const [newServiceName, setNewServiceName] = useState('');
  const [newServicePrice, setNewServicePrice] = useState('');
  const [notification, setNotification] = useState<Notification | null>(null);
  const [deletingServiceId, setDeletingServiceId] = useState<number | null>(null);
  const [editingServiceId, setEditingServiceId] = useState<number | null>(null);
  const [editingPrice, setEditingPrice] = useState('');
  const [updatingServiceId, setUpdatingServiceId] = useState<number | null>(null);

  useEffect(() => {
    // Ensure prices are up-to-date when visiting the page
    refreshPrices().catch(() => {});
  }, [refreshPrices]);

  const showNotification = (message: string, type: 'success' | 'error') => {
    const id = Date.now();
    setNotification({ id, message, type });
    setTimeout(() => setNotification(null), 3000);
  };

  const closeModal = () => {
    setIsModalOpen(false);
    setNewServiceName('');
    setNewServicePrice('');
  };

  const handleAddService = async () => {
    if (readonly) {
      showNotification('–¢–æ–ª—å–∫–æ –∞–¥–º–∏–Ω –º–æ–∂–µ—Ç –∏–∑–º–µ–Ω—è—Ç—å —Ü–µ–Ω—ã', 'error');
      return;
    }
    if (!newServiceName.trim() || !newServicePrice.trim()) {
      showNotification('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è', 'error');
      return;
    }
    const price = parseFloat(newServicePrice);
    if (isNaN(price) || price <= 0) {
      showNotification('–¶–µ–Ω–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–º —á–∏—Å–ª–æ–º', 'error');
      return;
    }
    try {
      await addPrice({ name: newServiceName.trim(), price });
      showNotification('–£—Å–ª—É–≥–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∞', 'success');
      closeModal();
    } catch (e) {
      console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ —É—Å–ª—É–≥–∏:', e);
      showNotification('–ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å', 'error');
    }
  };

  const handleDeleteService = async (id: number) => {
    if (readonly) {
      showNotification('–¢–æ–ª—å–∫–æ –∞–¥–º–∏–Ω –º–æ–∂–µ—Ç –∏–∑–º–µ–Ω—è—Ç—å —Ü–µ–Ω—ã', 'error');
      return;
    }
    if (!confirm('–£–¥–∞–ª–∏—Ç—å —É—Å–ª—É–≥—É?')) return;
    try {
      setDeletingServiceId(id);
      await deletePrice(id);
      showNotification('–£—Å–ª—É–≥–∞ —É–¥–∞–ª–µ–Ω–∞', 'success');
    } catch (e) {
      console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ —É—Å–ª—É–≥–∏:', e);
      showNotification('–ù–µ —É–¥–∞–ª–æ—Å—å —É–¥–∞–ª–∏—Ç—å', 'error');
    } finally {
      setDeletingServiceId(null);
    }
  };

  const startEditingPrice = (serviceId: number, currentPrice: number) => {
    if (readonly) return;
    setEditingServiceId(serviceId);
    setEditingPrice(currentPrice.toString());
  };

  const cancelEditing = () => {
    setEditingServiceId(null);
    setEditingPrice('');
  };

  const handleSaveAllChanges = async () => {
    if (readonly) {
      showNotification('–¢–æ–ª—å–∫–æ –∞–¥–º–∏–Ω –º–æ–∂–µ—Ç –∏–∑–º–µ–Ω—è—Ç—å —Ü–µ–Ω—ã', 'error');
      return;
    }
    
    try {
      setUpdatingServiceId(-1); // Use -1 to indicate batch save
      
      // Save all edited prices
      for (const service of prices) {
        if (editingServiceId === service.id && editingPrice.trim()) {
          const price = parseFloat(editingPrice);
          if (isNaN(price) || price <= 0) {
            showNotification('–¶–µ–Ω–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–º —á–∏—Å–ª–æ–º', 'error');
            return;
          }
          await updatePrice(service.id!, { name: service.name, price });
        }
      }
      
      showNotification('–í—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã', 'success');
      setEditingServiceId(null);
      setEditingPrice('');
    } catch (e) {
      console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–π:', e);
      showNotification('–ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è', 'error');
    } finally {
      setUpdatingServiceId(null);
    }
  };

  const handleBack = () => {
    router.push('/admin');
  };

  const saveEditedPrice = async (serviceId: number) => {
    if (readonly) {
      showNotification('–¢–æ–ª—å–∫–æ –∞–¥–º–∏–Ω –º–æ–∂–µ—Ç –∏–∑–º–µ–Ω—è—Ç—å —Ü–µ–Ω—ã', 'error');
      return;
    }
    if (!editingPrice.trim()) {
      showNotification('–í–≤–µ–¥–∏—Ç–µ —Ü–µ–Ω—É', 'error');
      return;
    }
    const price = parseFloat(editingPrice);
    if (isNaN(price) || price <= 0) {
      showNotification('–¶–µ–Ω–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–º —á–∏—Å–ª–æ–º', 'error');
      return;
    }
    try {
      setUpdatingServiceId(serviceId);
      const service = prices.find(s => s.id === serviceId);
      if (!service) return;
      await updatePrice(serviceId, { name: service.name, price });
      showNotification('–¶–µ–Ω–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∞', 'success');
      setEditingServiceId(null);
      setEditingPrice('');
    } catch (e) {
      console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ —Ü–µ–Ω—ã:', e);
      showNotification('–ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å', 'error');
    } finally {
      setUpdatingServiceId(null);
    }
  };

  return (
    <>
      <style jsx global>{`
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { background: #F2E5D3; min-height: 100vh; padding: 20px; color: #2C1A0F; }
        .container { max-width: 900px; margin: 0 auto; background: #FEFCF8; border-radius: 16px; box-shadow: 0 10px 30px rgba(74,43,27,0.1); overflow: hidden; }
        .header { background: linear-gradient(135deg,#4A2B1B 0%,#7A3E2D 100%); color: #E9D5B5; padding: 24px; }
        .header-content { display:flex; align-items:center; gap:16px; }
        .logo { width: 56px; height: 56px; display:flex; align-items:center; justify-content:center; }
        .header-text h1 { font-size: 24px; }
        .content { padding: 24px; }
        .page-header { display:flex; justify-content: space-between; align-items:center; margin-bottom: 16px; }
        .page-title { font-size: 22px; font-weight: 700; color: #4A2B1B; }
        .add-service-btn { background:#4A2B1B; color:#E9D5B5; border:none; padding:10px 16px; border-radius:8px; cursor:pointer; }
        .add-service-btn[disabled] { opacity:0.6; cursor:not-allowed; }
        .services-table { border:1px solid rgba(74,43,27,0.2); border-radius:12px; overflow:hidden; }
        .table-header { background:#F0E2C8; padding:12px; }
        .table-row { display:grid; grid-template-columns: 1fr 180px 60px; align-items:center; padding:12px; border-top:1px solid rgba(74,43,27,0.1); }
        .service-name { font-weight:600; }
        .service-price { }
        .price-display { cursor: pointer; font-weight: bold; color: #4A2B1B; }
        .edit-hint { margin-left: 8px; font-size:12px; color:#7A3E2D; }
        .delete-btn { background:transparent; border:none; cursor:pointer; }
        .delete-btn[disabled] { opacity:0.6; cursor:not-allowed; }
        .loading, .empty-state { padding:16px; text-align:center; color:#4A2B1B; }
        .modal-overlay { position:fixed; inset:0; background:rgba(0,0,0,0.3); display:flex; align-items:center; justify-content:center; }
        .modal { background:#FEFCF8; width: 380px; max-width: 92vw; border-radius:12px; box-shadow:0 8px 24px rgba(0,0,0,0.2); padding:16px; }
        .modal-header { margin-bottom: 12px; }
        .modal-title { font-size:18px; font-weight:700; color:#4A2B1B; }
        .form-group { margin-bottom:12px; }
        .form-label { display:block; margin-bottom:6px; font-weight:600; }
        .form-input { width:100%; padding:10px; border:1px solid rgba(74,43,27,0.2); border-radius:8px; }
        .modal-actions { display:flex; justify-content:flex-end; gap:8px; margin-top: 8px; }
        .btn-secondary { background:#E9D5B5; color:#4A2B1B; border:none; padding:8px 12px; border-radius:6px; cursor:pointer; }
        .btn-primary { background:#4A2B1B; color:#E9D5B5; border:none; padding:8px 12px; border-radius:6px; cursor:pointer; }
        .notifications { position:fixed; bottom:16px; right:16px; }
        .notification { padding:10px 14px; border-radius:8px; color:#FEFCF8; }
        .notification.success { background:#2E7D32; }
        .notification.error { background:#C62828; }
        .price-edit-container { display:flex; align-items:center; gap:8px; }
        .price-edit-input { width:120px; padding:8px; border:1px solid rgba(74,43,27,0.2); border-radius:8px; }
        .save-price-btn, .cancel-price-btn { border:none; background:#4A2B1B; color:#E9D5B5; padding:6px 10px; border-radius:6px; cursor:pointer; }
        .save-price-btn[disabled], .cancel-price-btn[disabled] { opacity:0.6; cursor:not-allowed; }
        .readonly-banner { background:#FFF3CD; color:#856404; border:1px solid #FFEeba; padding:10px; border-radius:8px; margin-bottom: 12px; }
      `}</style>

      <div className="container">
        <div className="header">
          <div className="header-content">
            <div className="logo" onClick={() => router.push('/')} style={{ cursor: 'pointer' }}>
              <Image src="/logo.svg" alt="–õ–æ–≥–æ—Ç–∏–ø" width={50} height={50} />
            </div>
            <div className="header-text">
              <h1>–ü—É—Ç–µ–≤—ã–π –£—á–µ—Ç</h1>
            </div>
          </div>
        </div>

        <div className="content">
          {readonly && (
            <div className="readonly-banner">
              –¢–æ–ª—å–∫–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –º–æ–∂–µ—Ç –∏–∑–º–µ–Ω—è—Ç—å —Ü–µ–Ω—ã. –ü—Ä–æ—Å–º–æ—Ç—Ä –≤–∫–ª—é—á–µ–Ω.
            </div>
          )}

          <div className="page-header">
            <button className="btn-secondary" onClick={handleBack}>–ù–∞–∑–∞–¥</button>
            <h2 className="page-title">–¶–µ–Ω—ã</h2>
            <button className="add-service-btn" onClick={() => setIsModalOpen(true)} disabled={readonly}>–î–æ–±–∞–≤–∏—Ç—å —É—Å–ª—É–≥—É</button>
          </div>

          <div className="services-table">
            {pricesLoading ? (
              <div className="loading">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
            ) : error ? (
              <div className="empty-state">–û—à–∏–±–∫–∞: {error}</div>
            ) : prices.length === 0 ? (
              <div className="empty-state">–£—Å–ª—É–≥–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã. –î–æ–±–∞–≤—å—Ç–µ –ø–µ—Ä–≤—É—é —É—Å–ª—É–≥—É.</div>
            ) : (
              <>
                <div className="table-header">
                  <div className="table-row">
                    <div className="service-name" style={{ fontWeight: 700 }}>–ù–∞–∑–≤–∞–Ω–∏–µ —É—Å–ª—É–≥–∏</div>
                    <div className="service-price" style={{ fontWeight: 700 }}>–¶–µ–Ω–∞</div>
                    <div style={{ width: '60px' }}></div>
                  </div>
                </div>
                {prices.map((service) => (
                  <div key={service.id} className={`table-row ${deletingServiceId === service.id ? 'deleting' : ''} ${updatingServiceId === service.id ? 'updating' : ''}`}>
                    <div className="service-name">{service.name}</div>
                    <div className="service-price">
                      {editingServiceId === service.id ? (
                        <div className="price-edit-container">
                          <input
                            type="number"
                            value={editingPrice}
                            onChange={(e) => setEditingPrice(e.target.value)}
                            className="price-edit-input"
                            placeholder="–¶–µ–Ω–∞"
                            min="0"
                            step="1"
                            disabled={updatingServiceId === service.id || readonly}
                          />
                          <div className="price-edit-buttons" style={{ display: 'flex', gap: 8 }}>
                            <button
                              className="save-price-btn"
                              onClick={() => service.id && saveEditedPrice(service.id)}
                              disabled={updatingServiceId === service.id || readonly}
                              title="–°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ü–µ–Ω—É"
                            >
                              ‚úì
                            </button>
                            <button
                              className="cancel-price-btn"
                              onClick={cancelEditing}
                              disabled={updatingServiceId === service.id}
                              title="–û—Ç–º–µ–Ω–∏—Ç—å"
                            >
                              ‚úï
                            </button>
                          </div>
                        </div>
                      ) : (
                        <div className="price-display" onClick={() => !readonly && service.id && startEditingPrice(service.id, service.price)}>
                          {service.price} ‚ÇΩ
                        </div>
                      )}
                    </div>
                    <button
                      className="delete-btn"
                      onClick={() => service.id && handleDeleteService(service.id)}
                      disabled={deletingServiceId === service.id || editingServiceId === service.id || readonly}
                      title="–£–¥–∞–ª–∏—Ç—å —É—Å–ª—É–≥—É"
                    >
                      <img src="/trash.svg" alt="–£–¥–∞–ª–∏—Ç—å" width="24" height="24" />
                    </button>
                  </div>
                ))}
              </>
            )}
          </div>

          {isModalOpen && (
            <div className="modal-overlay" onClick={closeModal}>
              <div className="modal" onClick={(e) => e.stopPropagation()}>
                <div className="modal-header">
                  <h3 className="modal-title">–î–æ–±–∞–≤–∏—Ç—å —É—Å–ª—É–≥—É</h3>
                </div>
                <div className="form-group">
                  <label className="form-label" htmlFor="serviceName">–ù–∞–∑–≤–∞–Ω–∏–µ —É—Å–ª—É–≥–∏</label>
                  <input
                    type="text"
                    id="serviceName"
                    className="form-input"
                    value={newServiceName}
                    onChange={(e) => setNewServiceName(e.target.value)}
                    placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ —É—Å–ª—É–≥–∏"
                    autoFocus
                  />
                </div>
                <div className="form-group">
                  <label className="form-label" htmlFor="servicePrice">–¶–µ–Ω–∞ (‚ÇΩ)</label>
                  <input
                    type="number"
                    id="servicePrice"
                    className="form-input"
                    value={newServicePrice}
                    onChange={(e) => setNewServicePrice(e.target.value)}
                    placeholder="–í–≤–µ–¥–∏—Ç–µ —Ü–µ–Ω—É"
                    min="0"
                    step="1"
                  />
                </div>
                <div className="modal-actions">
                  <button className="btn-secondary" onClick={closeModal}>–û—Ç–º–µ–Ω–∞</button>
                  <button className="btn-primary" onClick={handleAddService} disabled={readonly}>–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                </div>
              </div>
            </div>
          )}

          {notification && (
            <div className="notifications">
              <div key={notification.id} className={`notification ${notification.type}`}>
                {notification.message}
              </div>
            </div>
          )}
        </div>
      </div>
    </>
  );
}
</file>

<file path="src/app/layout.tsx">
import type { Metadata } from "next";
import "./globals.css";
import TelegramWebApp from "@/components/TelegramWebApp";
import { ServicesProvider } from "@/contexts/ServicesContext";

export const metadata: Metadata = {
  title: "–ü—É—Ç—ë–≤–æ–π —É—á—ë—Ç",
  description: "–°–∏—Å—Ç–µ–º–∞ —É—á–µ—Ç–∞ —Ä–∞–±–æ—á–∏—Ö —Å–º–µ–Ω",
  icons: {
    icon: '/favicon.ico',
  },
};

export default function RootLayout({
  children,
}: Readonly<{
  children: React.ReactNode;
}>) {
  return (
    <html lang="ru" suppressHydrationWarning>
      <head>
        <script src="https://telegram.org/js/telegram-web-app.js"></script>
      </head>
      <body>
        <TelegramWebApp />
        <ServicesProvider>
          <main>
            {children}
          </main>
        </ServicesProvider>
      </body>
    </html>
  );
}
</file>

<file path="src/app/page.tsx">
'use client';

import React, { useState, useEffect } from 'react';
import Link from 'next/link';
import Image from 'next/image';
import { useRouter } from 'next/navigation';
import UserGreeting from '@/components/UserGreeting';
import { useTelegramAuth } from '@/hooks/useTelegramAuth';
import { getAuthHeaders, isTelegramWebApp } from '@/lib/auth';

interface Shift {
  id?: number;
  date: string;
  hours: number;
  steam_bath: number;
  brand_steam: number;
  intro_steam: number;
  scrubbing: number;
  zaparnik: number;
  masters: number;
  total: number;
  hourly_rate?: number;
  steam_bath_price?: number;
  brand_steam_price?: number;
  intro_steam_price?: number;
  scrubbing_price?: number;
  zaparnik_price?: number;
}

interface Price {
  id?: number;
  name: string;
  price: number;
}

export default function HomePage() {
  const router = useRouter();
  const { isAuthenticated, user, loading: authLoading } = useTelegramAuth();
  // –†–µ–∂–∏–º –¥–µ–º–æ: –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –Ω–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –∏ —É–¥–∞–ª–µ–Ω–∏–µ
  const isDemo = user?.role === 'demo';
  const [shifts, setShifts] = useState<Shift[]>([]);
  const [prices, setPrices] = useState<Price[]>([]);
  const [loading, setLoading] = useState(true);
  const [expandedRows, setExpandedRows] = useState<Set<number>>(new Set());
  const [newShift, setNewShift] = useState<Omit<Shift, 'id' | 'total'>>({
    date: new Date().toISOString().split('T')[0],
    hours: 0,
    steam_bath: 0,
    brand_steam: 0,
    intro_steam: 0,
    scrubbing: 0,
    zaparnik: 0,
    masters: 2
  });

  // –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞ —Ñ–æ—Ä–º—ã –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
  useEffect(() => {
    setNewShift({
      date: new Date().toISOString().split('T')[0],
      hours: 0,
      steam_bath: 0,
      brand_steam: 0,
      intro_steam: 0,
      scrubbing: 0,
      zaparnik: 0,
      masters: 2
    });
  }, []);

  // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö
  const loadData = async () => {
    try {
      setLoading(true);
      
      // –°–æ–∑–¥–∞–µ–º –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä –¥–ª—è –æ—Ç–º–µ–Ω—ã –∑–∞–ø—Ä–æ—Å–æ–≤ –ø–æ —Ç–∞–π–º–∞—É—Ç—É
      const controller = new AbortController();
      const timeoutId = setTimeout(() => controller.abort(), 15000); // 15 —Å–µ–∫—É–Ω–¥ —Ç–∞–π–º–∞—É—Ç

      const authHeaders = getAuthHeaders();

      const [shiftsResponse, pricesResponse] = await Promise.all([
        fetch('/api/shifts', { 
          signal: controller.signal,
          headers: authHeaders
        }),
        fetch('/api/prices', { signal: controller.signal })
      ]);

      clearTimeout(timeoutId);

      if (shiftsResponse.ok) {
        const shiftsData = await shiftsResponse.json();
        setShifts(shiftsData);
      } else {
        console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–º–µ–Ω:', shiftsResponse.status);
      }

      if (pricesResponse.ok) {
        const pricesData = await pricesResponse.json();
        setPrices(pricesData);
      } else {
        console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ü–µ–Ω:', pricesResponse.status);
      }
    } catch (error) {
      if (error instanceof Error && error.name === 'AbortError') {
        console.error('–ó–∞–ø—Ä–æ—Å –æ—Ç–º–µ–Ω–µ–Ω –ø–æ —Ç–∞–π–º–∞—É—Ç—É');
      } else {
        console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –¥–∞–Ω–Ω—ã—Ö:', error);
      }
    } finally {
      setLoading(false);
    }
  };

  // –ü–æ–ª—É—á–µ–Ω–∏–µ —Ü–µ–Ω—ã –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é
  const getPrice = (name: string): number => {
    const price = prices.find(p => p.name === name);
    return price ? price.price : 0;
  };

  // –†–∞—Å—á–µ—Ç –æ–±—â–µ–π —Å—É–º–º—ã —Å–º–µ–Ω—ã
  const calculateTotal = (shift: Omit<Shift, 'id' | 'total'>): number => {
    const hourlyRate = getPrice('–ü–æ—á–∞—Å–æ–≤–∞—è —Å—Ç–∞–≤–∫–∞');
    const steamBathPrice = getPrice('–ü—É—Ç–µ–≤–æ–µ –ø–∞—Ä–µ–Ω–∏–µ');
    const brandSteamPrice = getPrice('–§–∏—Ä–º–µ–Ω–Ω–æ–µ –ø–∞—Ä–µ–Ω–∏–µ');
    const introSteamPrice = getPrice('–û–∑–Ω–∞–∫–æ–º–∏—Ç–µ–ª—å–Ω–æ–µ –ø–∞—Ä–µ–Ω–∏–µ');
    const scrubbingPrice = getPrice('–°–∫—Ä–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ');
    const zaparnikPrice = getPrice('–ó–∞–ø–∞—Ä–Ω–∏–∫');

    const hourlyTotal = shift.hours * hourlyRate;
    
    // –°—É–º–º–∞ –≤—Å–µ—Ö —É—Å–ª—É–≥
    const servicesTotal = (
      shift.steam_bath * steamBathPrice +
      shift.brand_steam * brandSteamPrice +
      shift.intro_steam * introSteamPrice +
      shift.scrubbing * scrubbingPrice +
      shift.zaparnik * zaparnikPrice
    );
    
    // 40% –æ—Ç —Å—É–º–º—ã —É—Å–ª—É–≥, –¥–µ–ª–µ–Ω–Ω–æ–µ –Ω–∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –º–∞—Å—Ç–µ—Ä–æ–≤
    const servicesEarnings = (servicesTotal * 0.4) / shift.masters;

    return hourlyTotal + servicesEarnings;
  };

  // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–π —Å–º–µ–Ω—ã
  const handleAddShift = async () => {
    try {
      const total = calculateTotal(newShift);
      const shiftData = { ...newShift, total };
      const authHeaders = getAuthHeaders();

      const response = await fetch('/api/shifts', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          ...authHeaders,
        },
        body: JSON.stringify(shiftData),
      });

      if (response.ok) {
        await loadData(); // –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ
        // –°–±—Ä–æ—Å —Ñ–æ—Ä–º—ã
        setNewShift({
          date: new Date().toISOString().split('T')[0],
          hours: 8,
          steam_bath: 0,
          brand_steam: 0,
          intro_steam: 0,
          scrubbing: 0,
          zaparnik: 0,
          masters: 1
        });
      } else {
        const errorData = await response.json();
        alert(`–û—à–∏–±–∫–∞ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ —Å–º–µ–Ω—ã: ${errorData.error || '–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â–µ —Ä–∞–∑.'}`);
      }
    } catch (error) {
      console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ —Å–º–µ–Ω—ã:', error);
      alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ —Å–º–µ–Ω—ã. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â–µ —Ä–∞–∑.');
    }
  };

  // –£–¥–∞–ª–µ–Ω–∏–µ —Å–º–µ–Ω—ã
  const handleDeleteShift = async (id: number) => {
    if (!confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç—É —Å–º–µ–Ω—É?')) return;

    try {
      const authHeaders = getAuthHeaders();
      const response = await fetch(`/api/shifts/${id}`, {
        method: 'DELETE',
        headers: authHeaders
      });

      if (response.ok) {
        await loadData(); // –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ
      } else {
        const errorData = await response.json();
        alert(`–û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ —Å–º–µ–Ω—ã: ${errorData.error || '–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â–µ —Ä–∞–∑.'}`);
      }
    } catch (error) {
      console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ —Å–º–µ–Ω—ã:', error);
      alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ —Å–º–µ–Ω—ã. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â–µ —Ä–∞–∑.');
    }
  };

  const toggleRowExpansion = (shiftId: number) => {
    setExpandedRows(prev => {
      const newSet = new Set(prev);
      if (newSet.has(shiftId)) {
        newSet.delete(shiftId);
      } else {
        newSet.add(shiftId);
      }
      return newSet;
    });
  };

  // –†–∞—Å—á–µ—Ç –æ–±—â–µ–π —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
  const totalHours = shifts.reduce((sum, shift) => sum + shift.hours, 0);
  const totalEarnings = shifts.reduce((sum, shift) => sum + shift.total, 0);

  // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (—Ç–æ–ª—å–∫–æ –¥–ª—è Telegram WebApp)
  useEffect(() => {
    if (!authLoading && isAuthenticated && user && !user.display_name && isTelegramWebApp()) {
      // –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω —á–µ—Ä–µ–∑ Telegram, –Ω–æ –Ω–µ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω (–Ω–µ—Ç display_name), –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ–º –Ω–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é
      router.push('/register');
      return;
    }
  }, [authLoading, isAuthenticated, user, router]);

  useEffect(() => {
    loadData();
  }, []);

  if (loading) {
    return (
      <>
        <style jsx global>{`
          * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
          }

          :root {
            --primary-color: #4A2B1B;
            --secondary-color: #7A3E2D;
            --accent-color: #E9D5B5;
            --background-main: #F2E5D3;
            --font-color: #2C1A0F;
            --primary-light: #5D3426;
            --primary-dark: #3A2015;
            --secondary-light: #8B4A38;
            --secondary-dark: #6A3424;
            --accent-light: #F0E2C8;
            --accent-dark: #DCC49F;
            --background-card: #FEFCF8;
            --background-section: rgba(233, 213, 181, 0.15);
            --shadow-light: rgba(74, 43, 27, 0.1);
            --shadow-medium: rgba(74, 43, 27, 0.15);
            --border-light: rgba(74, 43, 27, 0.2);
          }

          body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, var(--background-main) 0%, var(--accent-light) 100%);
            min-height: 100vh;
            padding: 20px;
            color: var(--font-color);
          }

          .loading-container {
            max-width: 800px;
            margin: 0 auto;
            background: var(--background-card);
            border-radius: 15px;
            box-shadow: 0 20px 40px var(--shadow-light);
            padding: 60px;
            text-align: center;
          }

          .loading-text {
            color: var(--primary-color);
            font-size: 1.5em;
            font-weight: 600;
          }
        `}</style>
        <div className="loading-container">
          <div className="loading-text">–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö...</div>
        </div>
      </>
    );
  }

  return (
    <>
      <style jsx global>{`
        * {
          margin: 0;
          padding: 0;
          box-sizing: border-box;
        }

        :root {
          --primary-color: #4A2B1B;
          --secondary-color: #7A3E2D;
          --accent-color: #E9D5B5;
          --background-main: #F2E5D3;
          --font-color: #2C1A0F;
          --primary-light: #5D3426;
          --primary-dark: #3A2015;
          --secondary-light: #8B4A38;
          --secondary-dark: #6A3424;
          --accent-light: #F0E2C8;
          --accent-dark: #DCC49F;
          --background-card: #FEFCF8;
          --background-section: rgba(233, 213, 181, 0.15);
          --shadow-light: rgba(74, 43, 27, 0.1);
          --shadow-medium: rgba(74, 43, 27, 0.15);
          --border-light: rgba(74, 43, 27, 0.2);
        }

        body {
          font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
          background: linear-gradient(135deg, var(--background-main) 0%, var(--accent-light) 100%);
          min-height: 100vh;
          padding: 20px;
          color: var(--font-color);
        }

        .container {
          max-width: 1200px;
          margin: 0 auto;
          background: var(--background-card);
          border-radius: 15px;
          box-shadow: 0 20px 40px var(--shadow-light);
          overflow: hidden;
        }

        .header {
          background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
          color: var(--accent-color);
          padding: 40px;
          text-align: center;
        }

        .header-content {
          display: flex;
          align-items: center;
          justify-content: center;
          gap: 30px;
          flex-wrap: nowrap;
        }

        .logo {
          width: 120px;
          height: 120px;
          flex-shrink: 0;
          display: flex;
          align-items: center;
          justify-content: center;
        }

        .header-text {
          text-align: left;
        }

        .header h1 {
          font-size: 2.5em;
          margin-bottom: 10px;
          text-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
          font-size: 1.1rem;
          opacity: 0.9;
        }

        .content {
          padding: 40px;
        }

        .stats-section {
          background: linear-gradient(135deg, var(--background-section) 0%, rgba(122, 62, 45, 0.08) 100%);
          border-radius: 12px;
          padding: 30px;
          margin-bottom: 30px;
          border: 2px solid var(--primary-color);
          box-shadow: 0 8px 25px var(--shadow-medium);
          position: relative;
          overflow: hidden;
        }

        .stats-section::before {
          content: '';
          position: absolute;
          top: 0;
          left: 0;
          right: 0;
          height: 4px;
          background: linear-gradient(90deg, var(--primary-color) 0%, var(--secondary-color) 100%);
        }

        .stats-grid {
          display: grid;
          grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
          gap: 20px;
        }

        .stat-card {
          background: var(--background-card);
          border-radius: 10px;
          padding: 20px;
          text-align: center;
          box-shadow: 0 4px 8px var(--shadow-light);
          border: 2px solid var(--border-light);
          transition: all 0.3s ease;
        }

        .stat-card:hover {
          transform: translateY(-3px);
          box-shadow: 0 8px 16px var(--shadow-medium);
          border-color: var(--primary-light);
        }

        .stat-value {
          font-size: 2.5em;
          font-weight: 700;
          margin-bottom: 8px;
        }

        .stat-value.blue { color: #3b82f6; }
        .stat-value.green { color: #22c55e; }
        .stat-value.purple { color: #8b5cf6; }
        .stat-value.orange { color: #f97316; }

        .stat-label {
          color: var(--secondary-color);
          font-weight: 500;
        }

        .form-section {
          background: linear-gradient(135deg, var(--background-section) 0%, rgba(122, 62, 45, 0.08) 100%);
          border-radius: 12px;
          padding: 30px;
          margin-bottom: 30px;
          border: 2px solid var(--primary-color);
          box-shadow: 0 8px 25px var(--shadow-medium);
          position: relative;
          overflow: hidden;
        }

        .form-section::before {
          content: '';
          position: absolute;
          top: 0;
          left: 0;
          right: 0;
          height: 4px;
          background: linear-gradient(90deg, var(--primary-color) 0%, var(--secondary-color) 100%);
        }

        .form-section h2 {
          color: var(--primary-color);
          margin-bottom: 25px;
          font-size: 1.6em;
          font-weight: 700;
          text-shadow: 0 1px 2px var(--shadow-light);
        }

        .form-grid {
          display: grid;
          grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
          gap: 20px;
          margin-bottom: 20px;
        }

        .services-grid {
          display: grid;
          grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
          gap: 20px;
          margin-bottom: 20px;
        }

        .input-group {
          display: flex;
          flex-direction: column;
        }

        .input-label {
          font-weight: 600;
          color: var(--font-color);
          margin-bottom: 8px;
          font-size: 14px;
          text-transform: uppercase;
          letter-spacing: 0.5px;
        }

        .input-field {
          width: 100%;
          padding: 14px 16px;
          border: 2px solid var(--border-light);
          border-radius: 10px;
          font-size: 16px;
          background: var(--background-card);
          color: var(--font-color);
          transition: all 0.3s ease;
          box-shadow: 0 2px 4px var(--shadow-light);
        }

        .input-field:focus {
          outline: none;
          border-color: var(--primary-color);
          box-shadow: 0 0 0 4px rgba(74, 43, 27, 0.1), 0 4px 12px var(--shadow-medium);
          transform: translateY(-1px);
        }

        .input-field:hover {
          border-color: var(--primary-light);
          box-shadow: 0 4px 8px var(--shadow-light);
        }

        /* –°–∫—Ä—ã—Ç–∏–µ —Å—Ç—Ä–µ–ª–æ–∫ –ø—Ä–æ–∫—Ä—É—Ç–∫–∏ –≤ –ø–æ–ª—è—Ö number */
        .input-field[type="number"]::-webkit-outer-spin-button,
        .input-field[type="number"]::-webkit-inner-spin-button {
          -webkit-appearance: none;
          margin: 0;
        }

        .input-field[type="number"] {
          -moz-appearance: textfield;
        }

        .form-footer {
          display: flex;
          justify-content: space-between;
          align-items: center;
          flex-wrap: wrap;
          gap: 20px;
        }

        .calculation-info {
          flex: 1;
          min-width: 200px;
        }

        .calculation-total {
          font-weight: 600;
          color: var(--primary-color);
          font-size: 1.1em;
        }

        .calculation-details {
          font-size: 0.9em;
          color: var(--secondary-color);
          margin-top: 5px;
        }

        .btn {
          background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
          color: var(--accent-color);
          border: none;
          padding: 11px 22px;
          border-radius: 10px;
          font-size: 11px;
          font-weight: 700;
          cursor: pointer;
          transition: all 0.3s ease;
          text-transform: uppercase;
          letter-spacing: 0.5px;
          box-shadow: 0 4px 15px var(--shadow-medium);
          text-decoration: none;
          display: inline-block;
        }

        .btn:hover {
          transform: translateY(-3px);
          box-shadow: 0 8px 25px rgba(74, 43, 27, 0.4);
          background: linear-gradient(135deg, var(--primary-light) 0%, var(--secondary-light) 100%);
        }

        .btn:active {
          transform: translateY(-1px);
          box-shadow: 0 4px 15px var(--shadow-medium);
        }

        .btn:disabled {
          opacity: 0.6;
          cursor: not-allowed;
          transform: none;
          box-shadow: 0 4px 15px var(--shadow-medium);
        }

        .btn-danger {
          background: linear-gradient(135deg, #dc2626, #b91c1c);
        }

        .btn-danger:hover {
          background: linear-gradient(135deg, #ef4444, #dc2626);
        }

        .shifts-section {
          background: linear-gradient(135deg, var(--background-section) 0%, rgba(122, 62, 45, 0.08) 100%);
          border-radius: 12px;
          padding: 30px;
          border: 2px solid var(--primary-color);
          box-shadow: 0 8px 25px var(--shadow-medium);
          position: relative;
          overflow: hidden;
        }

        .shifts-section::before {
          content: '';
          position: absolute;
          top: 0;
          left: 0;
          right: 0;
          height: 4px;
          background: linear-gradient(90deg, var(--primary-color) 0%, var(--secondary-color) 100%);
        }

        .shifts-section h2 {
          color: var(--primary-color);
          margin-bottom: 25px;
          font-size: 1.6em;
          font-weight: 700;
          text-shadow: 0 1px 2px var(--shadow-light);
        }

        .empty-state {
          text-align: center;
          padding: 60px 20px;
          color: #8B6B4B;
          background: var(--background-card);
          border-radius: 12px;
          box-shadow: 0 4px 12px rgba(74, 43, 27, 0.08);
          margin: 20px 0;
        }

        .empty-title {
          font-size: 1.4em;
          font-weight: 500;
          margin-bottom: 12px;
          color: #8B6B4B;
          line-height: 1.4;
        }

        .shifts-table {
          width: 100%;
          border-collapse: collapse;
          background: var(--background-card);
          border-radius: 10px;
          overflow: hidden;
          box-shadow: 0 4px 8px var(--shadow-light);
        }

        .shifts-table th {
          background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
          color: var(--accent-color);
          padding: 15px 12px;
          text-align: left;
          font-weight: 600;
          font-size: 14px;
          text-transform: uppercase;
          letter-spacing: 0.5px;
        }

        .shifts-table td {
          padding: 15px 12px;
          border-bottom: 1px solid var(--border-light);
          color: var(--font-color);
        }

        .shifts-table tr:hover {
          background: var(--background-section);
        }

        .shifts-table tr:last-child td {
          border-bottom: none;
        }

        .delete-btn {
          background: transparent;
          border: none;
          border-radius: 8px;
          width: 56px;
          height: 56px;
          display: flex;
          align-items: center;
          justify-content: center;
          cursor: pointer;
          transition: all 0.2s ease;
          padding: 8px;
        }

        .delete-btn:hover {
          background: rgba(156, 163, 175, 0.2);
          transform: scale(1.05);
        }

        .delete-btn img {
            opacity: 0.6;
            transition: opacity 0.2s ease;
          }

          .delete-btn:hover img {
            opacity: 0.8;
          }



        /* –°—Ç–∏–ª–∏ –¥–ª—è —Ä–∞—Å–∫—Ä—ã–≤–∞—é—â–∏—Ö—Å—è —Å—Ç—Ä–æ–∫ */
        .shift-row {
          transition: background-color 0.2s ease;
        }

        .shift-row:hover {
          background-color: rgba(139, 69, 19, 0.05);
        }

        .shift-row.expanded {
          background-color: rgba(139, 69, 19, 0.1);
        }

        .expand-icon {
          font-size: 12px;
          color: var(--primary-color);
          transition: transform 0.2s ease;
          display: inline-block;
          width: 16px;
        }

        .shift-details-row {
          background-color: rgba(139, 69, 19, 0.02);
          border-top: 1px solid rgba(139, 69, 19, 0.1);
        }

        .shift-details-content {
          padding: 20px;
          animation: slideDown 0.3s ease-out;
        }

        @keyframes slideDown {
          from {
            opacity: 0;
            transform: translateY(-10px);
          }
          to {
            opacity: 1;
            transform: translateY(0);
          }
        }

        .details-grid {
          display: grid;
          grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
          gap: 15px;
        }

        .detail-item {
          display: flex;
          justify-content: flex-start;
          align-items: center;
          gap: 8px;
          padding: 8px 12px;
          background-color: rgba(255, 255, 255, 0.5);
          border-radius: 6px;
          border: 1px solid rgba(139, 69, 19, 0.1);
        }

        .detail-label {
          font-weight: 500;
          color: #666;
          font-size: 14px;
        }

        .detail-value {
          font-weight: 600;
          color: var(--primary-color);
          font-size: 14px;
        }

        @media (max-width: 768px) {
          .container {
            margin: 10px;
            border-radius: 15px;
          }

          .header {
                padding: 5px 20px !important;
            }

          .header-content {
            flex-direction: column;
            gap: 20px;
          }

          .logo {
            width: 100px;
            height: 100px;
          }

          .header-text {
            text-align: center;
          }

          .header h1 {
            font-size: 2em;
          }

          .content {
            padding: 20px;
          }

          .form-grid, .services-grid {
            grid-template-columns: 1fr;
          }

          .form-footer {
            flex-direction: column;
            align-items: stretch;
          }



          /* –ú–æ–±–∏–ª—å–Ω—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è —Ç–∞–±–ª–∏—Ü—ã */
          .shifts-table {
            font-size: 14px;
          }

          .shifts-table th,
          .shifts-table td {
            padding: 8px 4px;
            font-size: 12px;
          }

          .shifts-table th:first-child,
          .shifts-table td:first-child {
            padding-left: 8px;
          }

          .shifts-table th:last-child,
          .shifts-table td:last-child {
            padding-right: 8px;
          }

          /* –ú–æ–±–∏–ª—å–Ω—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è –¥–µ—Ç–∞–ª–µ–π */
          .details-grid {
            grid-template-columns: 1fr;
            gap: 8px;
          }

          .shift-details-content {
            padding: 12px;
            margin: 0 -4px;
          }

          .detail-item {
            padding: 8px;
            font-size: 12px;
            border-radius: 6px;
          }

          .detail-label {
            font-size: 11px;
            margin-bottom: 2px;
          }

          .detail-value {
            font-size: 13px;
            font-weight: 700;
          }

          .expand-icon {
            font-size: 10px;
          }

          /* –ê–¥–∞–ø—Ç–∞—Ü–∏—è –¥–ª—è –æ—á–µ–Ω—å –º–∞–ª–µ–Ω—å–∫–∏—Ö —ç–∫—Ä–∞–Ω–æ–≤ */
          @media (max-width: 480px) {
            .shifts-table th,
            .shifts-table td {
              padding: 6px 2px;
              font-size: 11px;
            }

            .shift-details-content {
              padding: 10px;
              margin: 0 -2px;
            }

            .detail-item {
              padding: 6px;
              font-size: 11px;
            }

            .detail-label {
              font-size: 10px;
            }

            .detail-value {
              font-size: 12px;
            }
          }
        }
      `}</style>

      <div className="container">
        <div className="header">
          <div className="header-content">
            <div className="logo" onClick={() => router.push('/admin')} style={{cursor: 'pointer'}}>
              <Image 
                src="/logo.svg" 
                alt="–õ–æ–≥–æ—Ç–∏–ø" 
                width={120} 
                height={120}
                priority
              />
            </div>
            <div className="header-text">
              <h1>–ü—É—Ç—ë–≤—ã–π –£—á–µ—Ç</h1>
            </div>
          </div>
        </div>

        <div className="content">
          <div style={{ display: 'flex', justifyContent: 'flex-start', marginBottom: 20 }}>
            <Link href="/account" className="btn">–õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç</Link>
          </div>
          <UserGreeting />
          {/* –§–æ—Ä–º–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –Ω–æ–≤–æ–π —Å–º–µ–Ω—ã */}
          <div className="form-section">
            <h2>–î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—É—é —Å–º–µ–Ω—É</h2>
            
            <div className="form-grid">
              <div className="input-group">
                <label className="input-label">–î–∞—Ç–∞ —Å–º–µ–Ω—ã</label>
                <input
                  className="input-field"
                  type="date"
                  value={newShift.date}
                  onChange={(e) => setNewShift({ ...newShift, date: e.target.value })}
                  required
                />
              </div>
              <div className="input-group">
                <label className="input-label">–ß–∞—Å—ã —Ä–∞–±–æ—Ç—ã ({getPrice('–ü–æ—á–∞—Å–æ–≤–∞—è —Å—Ç–∞–≤–∫–∞')}‚ÇΩ)</label>
                <input
                  className="input-field"
                  type="number"
                  step="0.5"
                  value={newShift.hours === 0 ? '' : newShift.hours.toString()}
                  onChange={(e) => setNewShift({ ...newShift, hours: Number(e.target.value) || 0 })}
                  placeholder=""
                  required
                />
              </div>
              <div className="input-group">
                <label className="input-label">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –º–∞—Å—Ç–µ—Ä–æ–≤</label>
                <input
                  className="input-field"
                  type="number"
                  value={newShift.masters.toString()}
                  onChange={(e) => setNewShift({ ...newShift, masters: Number(e.target.value) })}
                  placeholder="2"
                  required
                />
              </div>
            </div>
            
            <h3 style={{color: 'var(--primary-color)', marginBottom: '15px', fontSize: '1.2em', fontWeight: '600'}}>–ë–∞–Ω–Ω—ã–µ —É—Å–ª—É–≥–∏</h3>
            <div className="services-grid">
              <div className="input-group">
                <label className="input-label">–ü—É—Ç–µ–≤–æ–µ –ø–∞—Ä–µ–Ω–∏–µ ({getPrice('–ü—É—Ç–µ–≤–æ–µ –ø–∞—Ä–µ–Ω–∏–µ')}‚ÇΩ)</label>
                <input
                  className="input-field"
                  type="number"
                  min="0"
                  value={newShift.steam_bath === 0 ? '' : newShift.steam_bath.toString()}
                  onChange={(e) => setNewShift({ ...newShift, steam_bath: Number(e.target.value) || 0 })}
                  placeholder=""
                />
              </div>
              <div className="input-group">
                <label className="input-label">–§–∏—Ä–º–µ–Ω–Ω–æ–µ –ø–∞—Ä–µ–Ω–∏–µ ({getPrice('–§–∏—Ä–º–µ–Ω–Ω–æ–µ –ø–∞—Ä–µ–Ω–∏–µ')}‚ÇΩ)</label>
                <input
                  className="input-field"
                  type="number"
                  min="0"
                  value={newShift.brand_steam === 0 ? '' : newShift.brand_steam.toString()}
                  onChange={(e) => setNewShift({ ...newShift, brand_steam: Number(e.target.value) || 0 })}
                  placeholder=""
                />
              </div>
              <div className="input-group">
                <label className="input-label">–û–∑–Ω–∞–∫–æ–º–∏—Ç–µ–ª—å–Ω–æ–µ ({getPrice('–û–∑–Ω–∞–∫–æ–º–∏—Ç–µ–ª—å–Ω–æ–µ –ø–∞—Ä–µ–Ω–∏–µ')}‚ÇΩ)</label>
                <input
                  className="input-field"
                  type="number"
                  min="0"
                  value={newShift.intro_steam === 0 ? '' : newShift.intro_steam.toString()}
                  onChange={(e) => setNewShift({ ...newShift, intro_steam: Number(e.target.value) || 0 })}
                  placeholder=""
                />
              </div>
              <div className="input-group">
                <label className="input-label">–°–∫—Ä–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ ({getPrice('–°–∫—Ä–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ')}‚ÇΩ)</label>
                <input
                  className="input-field"
                  type="number"
                  min="0"
                  value={newShift.scrubbing === 0 ? '' : newShift.scrubbing.toString()}
                  onChange={(e) => setNewShift({ ...newShift, scrubbing: Number(e.target.value) || 0 })}
                  placeholder=""
                />
              </div>
              <div className="input-group">
                <label className="input-label">–ó–∞–ø–∞—Ä–Ω–∏–∫ ({getPrice('–ó–∞–ø–∞—Ä–Ω–∏–∫')}‚ÇΩ)</label>
                <input
                  className="input-field"
                  type="number"
                  min="0"
                  value={newShift.zaparnik === 0 ? '' : newShift.zaparnik.toString()}
                  onChange={(e) => setNewShift({ ...newShift, zaparnik: Number(e.target.value) || 0 })}
                  placeholder=""
                />
              </div>
            </div>
            
            <div className="form-footer">
              <div className="calculation-info">
                <div className="calculation-total">
                  –†–∞—Å—á–µ—Ç–Ω–∞—è —Å—É–º–º–∞: {calculateTotal(newShift).toLocaleString()}‚ÇΩ
                </div>
                <div className="calculation-details">
                  –ü–æ—á–∞—Å–æ–≤–∞—è: {(newShift.hours * getPrice('–ü–æ—á–∞—Å–æ–≤–∞—è —Å—Ç–∞–≤–∫–∞')).toLocaleString()}‚ÇΩ + 
                  –£—Å–ª—É–≥–∏: {(calculateTotal(newShift) - newShift.hours * getPrice('–ü–æ—á–∞—Å–æ–≤–∞—è —Å—Ç–∞–≤–∫–∞')).toLocaleString()}‚ÇΩ
                </div>
              </div>
              <div style={{display: 'flex', gap: '15px', alignItems: 'center'}}>
                <button 
                  className="btn" 
                  onClick={handleAddShift} 
                  disabled={isDemo || !newShift.date || newShift.hours <= 0}
                >
                  –î–æ–±–∞–≤–∏—Ç—å —Å–º–µ–Ω—É
                </button>
                <button 
                  className="btn" 
                  onClick={() => window.location.href = '/payouts'}
                >
                  –í—ã–ø–ª–∞—Ç—ã
                </button>
              </div>
            </div>
          </div>

          {/* –°–ø–∏—Å–æ–∫ —Å–º–µ–Ω */}
          <div className="shifts-section">
            <h2>–ò—Å—Ç–æ—Ä–∏—è —Å–º–µ–Ω</h2>
            {shifts.length === 0 ? (
              <div className="empty-state">
                <div className="empty-title">–ü–æ–∫–∞ –∑–¥–µ—Å—å –ø—É—Å—Ç–æ</div>
                <div>–î–æ–±–∞–≤—å—Ç–µ –ø–µ—Ä–≤—É—é —Å–º–µ–Ω—É, —á—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å —É—á—ë—Ç</div>
              </div>
            ) : (
              <>
                {/* –ö–æ–º–ø–∞–∫—Ç–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ —Å —Ä–∞—Å–∫—Ä—ã–≤–∞—é—â–∏–º–∏—Å—è –¥–µ—Ç–∞–ª—è–º–∏ */}
                <div style={{overflowX: 'auto'}}>
                  <table className="shifts-table">
                    <thead>
                      <tr>
                        <th>–î–∞—Ç–∞</th>
                        <th>–°—É–º–º–∞</th>
                        <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                      </tr>
                    </thead>
                    <tbody>
                      {shifts.map((shift) => (
                        <React.Fragment key={shift.id}>
                          <tr 
                            className={`shift-row ${expandedRows.has(shift.id!) ? 'expanded' : ''}`}
                            onClick={() => shift.id && toggleRowExpansion(shift.id)}
                            style={{cursor: 'pointer'}}
                          >
                            <td>
                              <div style={{display: 'flex', alignItems: 'center', gap: '8px'}}>
                                <span className="expand-icon">
                                  {expandedRows.has(shift.id!) ? '‚ñº' : '‚ñ∂'}
                                </span>
                                {new Date(shift.date).toLocaleDateString('ru-RU')}
                              </div>
                            </td>
                            <td style={{fontWeight: '600', color: 'var(--primary-color)'}}>
                              {shift.total.toLocaleString()}‚ÇΩ
                            </td>
                            <td onClick={(e) => e.stopPropagation()}>
                              <button
                                className="delete-btn"
                                onClick={() => shift.id && handleDeleteShift(shift.id)}
                                title="–£–¥–∞–ª–∏—Ç—å —Å–º–µ–Ω—É"
                                disabled={isDemo}
                              >
                                <img src="/trash.svg" alt="–£–¥–∞–ª–∏—Ç—å" width="28" height="28" />
                              </button>
                            </td>
                          </tr>
                          {expandedRows.has(shift.id!) && (
                            <tr className="shift-details-row">
                              <td colSpan={3}>
                                <div className="shift-details-content">
                                  <div className="details-grid">
                                    <div className="detail-item">
                                      <span className="detail-label">–ß–∞—Å—ã —Ä–∞–±–æ—Ç—ã:</span>
                                      <span className="detail-value">{shift.hours}—á</span>
                                    </div>
                                    <div className="detail-item">
                                      <span className="detail-label">–ú–∞—Å—Ç–µ—Ä–∞:</span>
                                      <span className="detail-value">{shift.masters}</span>
                                    </div>
                                    <div className="detail-item">
                                      <span className="detail-label">–ü—É—Ç–µ–≤–æ–µ:</span>
                                      <span className="detail-value">{shift.steam_bath}</span>
                                    </div>
                                    <div className="detail-item">
                                      <span className="detail-label">–§–∏—Ä–º–µ–Ω–Ω–æ–µ:</span>
                                      <span className="detail-value">{shift.brand_steam}</span>
                                    </div>
                                    <div className="detail-item">
                                      <span className="detail-label">–û–∑–Ω–∞–∫–æ–º–∏—Ç–µ–ª—å–Ω–æ–µ:</span>
                                      <span className="detail-value">{shift.intro_steam}</span>
                                    </div>
                                    <div className="detail-item">
                                      <span className="detail-label">–°–∫—Ä–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ:</span>
                                      <span className="detail-value">{shift.scrubbing}</span>
                                    </div>
                                    <div className="detail-item">
                                      <span className="detail-label">–ó–∞–ø–∞—Ä–Ω–∏–∫:</span>
                                      <span className="detail-value">{shift.zaparnik}</span>
                                    </div>
                                  </div>
                                </div>
                              </td>
                            </tr>
                          )}
                        </React.Fragment>
                      ))}
                    </tbody>
                  </table>
                </div>
              </>
            )}
          </div>
        </div>
      </div>
    </>
  );
}
</file>

<file path="src/app/admin/reports/page.tsx">
'use client';

import { useState, useEffect, KeyboardEvent } from 'react';
import Image from 'next/image';
import { useRouter } from 'next/navigation';
import { useServices } from '@/contexts/ServicesContext';
import { getAuthHeaders } from '@/lib/auth';
import { ToastContainer, ToastVariant, useToast } from '@/components/Toast';
import { PaymentsList, Payment as HistoryPayment } from '@/components/PaymentsList';
import { NewPaymentForm } from '@/components/NewPaymentForm';

// –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã –¥–∞–Ω–Ω—ã—Ö
interface PayoutHistoryEntry {
  id: number;
  amount: number;
  date: string;
  comment?: string;
  initiator_role?: 'admin' | 'master' | 'system' | null;
  initiated_by?: number | null;
  method?: string | null;
  source?: string | null;
  reversed_at?: string | null;
  reversal_reason?: string | null;
  is_advance?: boolean;
}

interface Employee {
  id: number;
  name: string;
  earned: number;
  paid: number;
  outstanding: number;
  recentPayouts?: PayoutHistoryEntry[];
}

interface Month {
  month: string;
  status: string;
  totalEarned: number;
  totalPaid: number;
  totalOutstanding: number;
  employees: Employee[];
}

interface Shift {
  id: number;
  masterName: string;
  date: string;
  hours: number;
  steamBath: number;
  brandSteam: number;
  introSteam: number;
  scrubbing: number;
  masters: number;
  amount: number;
  services?: string | { [key: string]: number };
}

type ShiftLoadingEntry = {
  loading: boolean;
  error: boolean;
  data: Shift[] | null;
};

type ShiftLoadingState = Record<string, ShiftLoadingEntry>;

interface AdminPayoutUpdatePayload {
  employeeId: number;
  month: string;
  summary: {
    earnings: number;
    totalPaid: number;
    remaining: number;
  };
  history?: PayoutHistoryEntry[];
}

interface AdminPayoutSummary {
  earnings: number;
  totalPaid: number;
  remaining: number;
}

interface AdminPayoutMutationResponse {
  summary?: AdminPayoutSummary;
  history?: PayoutHistoryEntry[];
  overpayment?: number;
  payout?: { amount: number };
  error?: string;
}

// –£—Ç–∏–ª–∏—Ç—ã —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
const formatCurrency = (amount: number): string => {
  const formatted = new Intl.NumberFormat('ru-RU', {
    style: 'currency',
    currency: 'RUB',
    minimumFractionDigits: 0,
    maximumFractionDigits: 0,
  }).format(amount);

  return formatted.replace(/\u00A0/g, '\u202F');
};

const formatDate = (dateString: string): string => {
  const date = new Date(dateString);
  return date.toLocaleDateString('ru-RU', {
    day: '2-digit',
    month: '2-digit',
  });
};

const formatMonthName = (monthString: string): string => {
  const [year, month] = monthString.split('-');
  const date = new Date(parseInt(year), parseInt(month) - 1);
  return date.toLocaleDateString('ru-RU', {
    month: 'long',
    year: 'numeric',
  });
};

// –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Å—Ç–∞—Ç—É—Å–∞
const getStatusText = (status: string): string => {
  switch (status) {
    case 'open': return '–ù–µ –∑–∞–∫—Ä—ã—Ç';
    case 'partial': return '–ß–∞—Å—Ç–∏—á–Ω–æ –∑–∞–∫—Ä—ã—Ç';
    case 'closed': return '–ó–∞–∫—Ä—ã—Ç';
    default: return status;
  }
};

const getStatusCircle = (status: string) => {
  const statusText = getStatusText(status);

  return (
    <span
      className={`status-circle status-circle--${status}`}
      title={statusText}
      aria-label={statusText}
    />
  );
};

const getNextMonthString = (monthString: string): string => {
  const [year, month] = monthString.split('-').map(Number);
  const nextDate = new Date(year, month, 1);
  return `${nextDate.getFullYear()}-${String(nextDate.getMonth() + 1).padStart(2, '0')}`;
};

// –ö–æ–º–ø–æ–Ω–µ–Ω—Ç —Ç–∞–±–ª–∏—Ü—ã —Å–º–µ–Ω
function ShiftsTable({ shifts }: { shifts: Shift[] }) {
  const { prices } = useServices();
  const servicePrices = prices.filter(price => price.name !== '–ü–æ—á–∞—Å–æ–≤–∞—è —Å—Ç–∞–≤–∫–∞');

  return (
    <div className="shift-card-list">
      {shifts.map((shift) => {
        // –ü–∞—Ä—Å–∏–º –¥–∞–Ω–Ω—ã–µ —É—Å–ª—É–≥
        let servicesData: { [key: string]: number } = {};
        if (shift.services) {
          try {
            servicesData = typeof shift.services === 'string'
              ? JSON.parse(shift.services)
              : shift.services;
          } catch (e) {
            console.error('Error parsing services data:', e);
          }
        }

        const getServiceCount = (serviceName: string): number => {
          if (servicesData[serviceName] !== undefined) {
            return servicesData[serviceName];
          }

          switch (serviceName) {
            case '–ü—É—Ç–µ–≤–æ–µ –ø–∞—Ä–µ–Ω–∏–µ':
              return shift.steamBath || 0;
            case '–§–∏—Ä–º–µ–Ω–Ω–æ–µ –ø–∞—Ä–µ–Ω–∏–µ':
              return shift.brandSteam || 0;
            case '–û–∑–Ω–∞–∫–æ–º–∏—Ç–µ–ª—å–Ω–æ–µ –ø–∞—Ä–µ–Ω–∏–µ':
              return shift.introSteam || 0;
            case '–°–∫—Ä–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ':
              return shift.scrubbing || 0;
            default:
              return 0;
          }
        };

        const visibleServices = servicePrices
          .map(price => ({
            name: price.name,
            count: getServiceCount(price.name)
          }))
          .filter(service => service.count > 0);
        const totalFormatted = formatCurrency(shift.amount).replace(/\s*‚ÇΩ/, '‚ÇΩ');

        return (
          <div key={shift.id} className="shift-card">
            <div className="shift-card__header">
              <div>
                <div className="shift-card__date">{formatDate(shift.date)}</div>
                <div className="shift-card__masters">–º–∞—Å—Ç–µ—Ä–æ–≤: {shift.masters}</div>
              </div>
              <span className="shift-card__hours-badge">
                {shift.hours} —á
              </span>
            </div>

            {visibleServices.length > 0 && (
              <div className="shift-card__services">
                {visibleServices.map(service => (
                  <div className="shift-card__service-row" key={service.name}>
                    <span>{service.name}</span>
                    <span>{service.count}</span>
                  </div>
                ))}
              </div>
            )}

            <div className="shift-card__total" aria-label="–ò—Ç–æ–≥–æ –∑–∞ —Å–º–µ–Ω—É">
              <span className="shift-card__total-value">{totalFormatted}</span>
            </div>
          </div>
        );
      })}
    </div>
  );
}

// –ö–æ–º–ø–æ–Ω–µ–Ω—Ç —Å—Ç—Ä–æ–∫–∏ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞
function EmployeeRow({
  employee,
  month,
  shiftState,
  onToggle,
  onPayoutCreated,
  onToast,
  onReloadMonth
}: {
  employee: Employee;
  month: string;
  shiftState: ShiftLoadingState[string];
  onToggle: (employeeId: number, month: string) => void;
  onPayoutCreated: (payload: AdminPayoutUpdatePayload) => void;
  onToast: (message: string, variant?: ToastVariant) => void;
  onReloadMonth?: (month: string) => Promise<void>;
}) {
  const [expanded, setExpanded] = useState(false);
  const hasDebt = employee.outstanding > 0;
  const statusBadgeLabel = hasDebt ? '–¥–æ–ª–≥' : '–≤—ã–ø–ª–∞—á–µ–Ω–æ';
  const [isPayoutModalOpen, setPayoutModalOpen] = useState(false);
  const [isSubmittingPayout, setIsSubmittingPayout] = useState(false);
  const recentPayouts = employee.recentPayouts ?? [];
  const payments: HistoryPayment[] = recentPayouts.map((payout) => ({
    id: payout.id,
    date: formatDate(payout.date),
    amount: payout.amount,
    comment: payout.comment,
    isAdmin: payout.initiator_role === 'admin',
    isAdvance: payout.is_advance,
  }));

  const handleToggle = () => {
    const newExpanded = !expanded;
    setExpanded(newExpanded);

    if (newExpanded && !shiftState?.data && !shiftState?.loading) {
      onToggle(employee.id, month);
    }
  };

  const handleRetry = () => {
    onToggle(employee.id, month);
  };

  const handleOpenPayoutModal = (event: React.MouseEvent<HTMLButtonElement>) => {
    event.stopPropagation();
    setPayoutModalOpen(true);
  };

  const handleClosePayoutModal = () => {
    setPayoutModalOpen(false);
  };

  const handleCreatePayment = async ({ amount, comment }: { amount: number; comment: string }) => {
    setIsSubmittingPayout(true);
    try {
      const response = await fetch('/api/admin/payouts', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          ...getAuthHeaders()
        },
        body: JSON.stringify({
          userId: employee.id,
          month,
          amount,
          comment: comment || undefined,
          source: 'admin:reports'
        })
      });

      const payload = await response
        .json()
        .catch(() => null) as AdminPayoutMutationResponse | null;

      if (!response.ok) {
        const errorMessage = payload?.error || '–ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤—ã–ø–ª–∞—Ç—É';
        throw new Error(errorMessage);
      }

      if (payload?.summary) {
        onPayoutCreated({
          employeeId: employee.id,
          month,
          summary: payload.summary,
          history: payload.history
        });
      }

      setPayoutModalOpen(false);

      if (payload?.payout) {
        onToast(`–í—ã–ø–ª–∞—Ç–∞ ${formatCurrency(payload.payout.amount)} —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞`, 'success');
      } else {
        onToast('–í—ã–ø–ª–∞—Ç–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞', 'success');
      }

      if (payload?.overpayment) {
        onToast(`–ü–µ—Ä–µ–ø–ª–∞—Ç–∞ ${formatCurrency(payload.overpayment)} –ø–µ—Ä–µ–Ω–µ—Å–µ–Ω–∞ –Ω–∞ —Å–ª–µ–¥—É—é—â–∏–π –º–µ—Å—è—Ü`, 'info');
        if (onReloadMonth) {
          const nextMonth = getNextMonthString(month);
          onReloadMonth(nextMonth).catch((error) => {
            console.error('–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å–ª–µ–¥—É—é—â–µ–≥–æ –º–µ—Å—è—Ü–∞:', error);
          });
        }
      }
    } catch (error) {
      const message = error instanceof Error ? error.message : '–ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤—ã–ø–ª–∞—Ç—É';
      onToast(message, 'error');
    } finally {
      setIsSubmittingPayout(false);
    }
  };

  const handleDeletePayment = async (payoutId: string | number) => {
    if (!window.confirm('–£–¥–∞–ª–∏—Ç—å –≤—ã–ø–ª–∞—Ç—É?')) {
      return;
    }
    try {
      const response = await fetch(`/api/admin/payouts/${payoutId}`, {
        method: 'DELETE',
        headers: getAuthHeaders()
      });

      const payload = await response
        .json()
        .catch(() => null) as AdminPayoutMutationResponse | null;
      if (!response.ok) {
        throw new Error(payload?.error || '–ù–µ —É–¥–∞–ª–æ—Å—å —É–¥–∞–ª–∏—Ç—å –≤—ã–ø–ª–∞—Ç—É');
      }

      if (payload?.summary) {
        onPayoutCreated({
          employeeId: employee.id,
          month,
          summary: payload.summary,
          history: payload.history
        });
      }
      onToast('–í—ã–ø–ª–∞—Ç–∞ —É–¥–∞–ª–µ–Ω–∞', 'success');
    } catch (error) {
      const message = error instanceof Error ? error.message : '–ù–µ —É–¥–∞–ª–æ—Å—å —É–¥–∞–ª–∏—Ç—å –≤—ã–ø–ª–∞—Ç—É';
      onToast(message, 'error');
    } finally {
      // nothing
    }
  };

  return (
    <>
      <tr
        className="employee-row hover:bg-gray-50 transition-colors border-b border-gray-100"
      >
        <td colSpan={2} className="employee-card-wrapper">
          <div className="employee-card">
            <div className="employee-card__header">
              <h3
                className="employee-card__name-button"
                role="button"
                tabIndex={0}
                aria-expanded={expanded}
                onClick={handleToggle}
                onKeyDown={(event: KeyboardEvent<HTMLHeadingElement>) => {
                  if (event.key === 'Enter' || event.key === ' ') {
                    event.preventDefault();
                    handleToggle();
                  }
                }}
              >
                {employee.name}
              </h3>
              <span className={`employee-status-badge ${hasDebt ? 'employee-status-badge--debt' : 'employee-status-badge--paid'}`}>
                <span className="employee-status-badge__dot" />
                {statusBadgeLabel}
              </span>
            </div>
            <div className="employee-card__balance balance-grid">
              <div className="balance-col">
                <div className="balance-label">–ò—Ç–æ–≥–æ</div>
                <div className="balance-value employee-card__amount">
                  {formatCurrency(employee.earned)}
                </div>
              </div>
              <div className="balance-col balance-col--right">
                <div className="balance-label">–û—Å—Ç–∞—Ç–æ–∫</div>
                <div className={`balance-value employee-card__amount ${hasDebt ? 'employee-card__amount--danger' : 'employee-card__amount--safe'}`}>
                  {formatCurrency(employee.outstanding)}
                </div>
              </div>
            </div>
            <div className="employee-card__actions">
              <button
                type="button"
                className="btn btn-secondary btn-compact"
                onClick={handleOpenPayoutModal}
              >
                –î–æ–±–∞–≤–∏—Ç—å –≤—ã–ø–ª–∞—Ç—É
              </button>
            </div>
            <div className="employee-card__history">
              <div className="employee-card__history-header">
                <span>–ü–æ—Å–ª–µ–¥–Ω–∏–µ –≤—ã–ø–ª–∞—Ç—ã</span>
              </div>
              <PaymentsList payments={payments} onDelete={handleDeletePayment} />
            </div>
          </div>
        </td>
      </tr>
      {isPayoutModalOpen && (
        <tr>
          <td colSpan={2}>
            <div className="payout-modal__backdrop" onClick={handleClosePayoutModal}>
              <div className="payout-modal" onClick={(e) => e.stopPropagation()}>
                <h3>–ù–æ–≤–∞—è –≤—ã–ø–ª–∞—Ç–∞</h3>
                <NewPaymentForm
                  onSubmit={handleCreatePayment}
                  onCancel={handleClosePayoutModal}
                  isSubmitting={isSubmittingPayout}
                />
              </div>
            </div>
          </td>
        </tr>
      )}
      {expanded && (
        <tr>
          <td colSpan={2} className="shift-card-cell">
            {shiftState?.loading && (
              <div className="text-center py-4 text-gray-600">
                –ó–∞–≥—Ä—É–∑–∫–∞ —Å–º–µ–Ω...
              </div>
            )}
            {shiftState?.error && (
              <div className="text-center py-4">
                <div className="text-red-600 mb-2">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏</div>
                <button
                  onClick={handleRetry}
                  className="px-3 py-1 bg-blue-500 text-white rounded text-sm hover:bg-blue-600 transition-colors"
                >
                  –ü–æ–≤—Ç–æ—Ä–∏—Ç—å
                </button>
              </div>
            )}
            {shiftState?.data && shiftState.data.length === 0 && (
              <div className="text-center py-4 text-gray-600">
                –°–º–µ–Ω –Ω–µ—Ç
              </div>
            )}
            {shiftState?.data && shiftState.data.length > 0 && (
              <ShiftsTable shifts={shiftState.data} />
            )}
          </td>
        </tr>
      )}
    </>
  );
}

// –ö–æ–º–ø–æ–Ω–µ–Ω—Ç –∫–∞—Ä—Ç–æ—á–∫–∏ –º–µ—Å—è—Ü–∞
function MonthCard({
  month,
  shiftStates,
  onLoadShifts,
  onPayoutCreated,
  onToast,
  onReloadMonth
}: {
  month: Month;
  shiftStates: ShiftLoadingState;
  onLoadShifts: (employeeId: number, monthStr: string) => void;
  onPayoutCreated: (payload: AdminPayoutUpdatePayload) => void;
  onToast: (message: string, variant?: ToastVariant) => void;
  onReloadMonth: (month: string) => Promise<void>;
}) {
  const statusText = getStatusText(month.status);
  const outstandingValueClass = [
    'month-card__totals-value',
    month.totalOutstanding > 0
      ? 'month-card__totals-value--danger'
      : month.totalOutstanding < 0
        ? 'month-card__totals-value--success'
        : ''
  ].join(' ').trim();

  return (
    <div className={`form-section mb-8`}>
      {/* –ó–∞–≥–æ–ª–æ–≤–æ–∫ –º–µ—Å—è—Ü–∞ */}
      <div className="month-card__header">
        <h2 className="text-2xl font-bold mb-4" style={{ color: 'var(--primary-color)' }}>
          {formatMonthName(month.month)}
        </h2>
        <div className="month-card__status">
          {getStatusCircle(month.status)}
          <span>{statusText}</span>
        </div>
        <div className="month-card__totals" role="list">
          <div className="month-card__totals-row" role="listitem">
            <span className="month-card__totals-label">–ó–∞—Ä–∞–±–æ—Ç–∞–Ω–æ</span>
            <span className="month-card__totals-value">
              {formatCurrency(month.totalEarned)}
            </span>
          </div>
          <div className="month-card__totals-row" role="listitem">
            <span className="month-card__totals-label">–í—ã–ø–ª–∞—á–µ–Ω–æ</span>
            <span className="month-card__totals-value">
              {formatCurrency(month.totalPaid)}
            </span>
          </div>
          <div className="month-card__totals-row month-card__totals-row--accent" role="listitem">
            <span className="month-card__totals-label">–û—Å—Ç–∞—Ç–æ–∫</span>
            <span className={outstandingValueClass}>
              {formatCurrency(month.totalOutstanding)}
            </span>
          </div>
        </div>
      </div>

      {/* –¢–∞–±–ª–∏—Ü–∞ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ */}
      <div style={{ background: 'var(--background-card)', borderRadius: '10px', boxShadow: '0 4px 8px var(--shadow-light)' }}>
        <table className="shifts-table shifts-table--employees" style={{ width: '100%' }}>
          <thead>
            <tr>
              <th className="py-4 px-4">–°–æ—Ç—Ä—É–¥–Ω–∏–∫</th>
              <th className="py-4 px-4 text-right">–ë–∞–ª–∞–Ω—Å</th>
            </tr>
          </thead>
          <tbody>
            {month.employees.map((employee) => {
              const employeeKey = `${employee.id}-${month.month}`;
              return (
                <EmployeeRow
                  key={employee.id}
                  employee={employee}
                  month={month.month}
                  shiftState={shiftStates[employeeKey]}
                  onToggle={onLoadShifts}
                  onPayoutCreated={onPayoutCreated}
                  onToast={onToast}
                  onReloadMonth={onReloadMonth}
                />
              );
            })}
          </tbody>
        </table>
      </div>
    </div>
  );
}

// –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç —Å—Ç—Ä–∞–Ω–∏—Ü—ã –æ—Ç—á–µ—Ç–æ–≤
export default function ReportsPage() {
  const router = useRouter();
  const [months, setMonths] = useState<Month[]>([]);
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState<string | null>(null);
  const [shiftStates, setShiftStates] = useState<ShiftLoadingState>({});
  const { toasts, showToast, hideToast } = useToast();

  const handlePayoutUpdate = (payload: AdminPayoutUpdatePayload) => {
    setMonths(prevMonths => prevMonths.map((monthData) => {
      if (monthData.month !== payload.month) {
        return monthData;
      }

      const updatedEmployees = monthData.employees.map((emp) =>
        emp.id === payload.employeeId
          ? {
            ...emp,
            earned: payload.summary.earnings,
            paid: payload.summary.totalPaid,
            outstanding: payload.summary.remaining,
            recentPayouts: payload.history ?? emp.recentPayouts
          }
          : emp
      );

      const totalEarned = updatedEmployees.reduce((sum, emp) => sum + emp.earned, 0);
      const totalPaid = updatedEmployees.reduce((sum, emp) => sum + emp.paid, 0);
      const totalOutstanding = updatedEmployees.reduce((sum, emp) => sum + emp.outstanding, 0);

      let status = 'open';
      if (totalOutstanding === 0) {
        status = 'closed';
      } else if (totalPaid > 0) {
        status = 'partial';
      }

      return {
        ...monthData,
        employees: updatedEmployees,
        totalEarned,
        totalPaid,
        totalOutstanding,
        status
      };
    }));
  };

  // –ó–∞–≥—Ä—É–∑–∫–∞ –æ—Å–Ω–æ–≤–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –æ—Ç—á–µ—Ç–æ–≤
  const loadReports = async () => {
    setLoading(true);
    setError(null);
    try {
      const response = await fetch('/api/reports', { headers: getAuthHeaders() });
      if (!response.ok) {
        throw new Error(`–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –æ—Ç—á–µ—Ç–æ–≤: ${response.status} ${response.statusText}`);
      }

      const data = await response.json();

      if (Array.isArray(data)) {
        const typedMonths = data as Month[];
        // –§–∏–ª—å—Ç—Ä—É–µ–º –º–µ—Å—è—Ü—ã, –æ—Å—Ç–∞–≤–ª—è—è —Ç–æ–ª—å–∫–æ —Ç–µ, –≥–¥–µ –µ—Å—Ç—å —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∏ —Å –∑–∞—Ä–∞–±–æ—Ç–∫–æ–º
        const filteredMonths = typedMonths.filter((month) => {
          const employees = Array.isArray(month.employees) ? month.employees : [];
          return employees.some((emp) => emp.earned > 0);
        });

        setMonths(filteredMonths);
      } else {
        setMonths([]);
      }
    } catch (err) {
      console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –æ—Ç—á–µ—Ç–æ–≤:', err);
      setError(err instanceof Error ? err.message : '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞');
    } finally {
      setLoading(false);
    }
  };

  const reloadMonthData = async (targetMonth: string) => {
    try {
      const response = await fetch(`/api/reports?from=${targetMonth}&to=${targetMonth}`, {
        headers: getAuthHeaders()
      });
      if (!response.ok) {
        return;
      }
      const data = await response.json();
      if (!Array.isArray(data) || data.length === 0) {
        return;
      }
      const updatedMonth = data[0] as Month;
      setMonths(prevMonths => {
        const exists = prevMonths.some(m => m.month === updatedMonth.month);
        const nextList = exists
          ? prevMonths.map(m => (m.month === updatedMonth.month ? updatedMonth : m))
          : [...prevMonths, updatedMonth];
        return nextList.sort((a, b) => b.month.localeCompare(a.month));
      });
    } catch (error) {
      console.error('–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –º–µ—Å—è—Ü–∞ –ø–æ—Å–ª–µ –ø–µ—Ä–µ–ø–ª–∞—Ç—ã:', error);
    }
  };

  // –ó–∞–≥—Ä—É–∑–∫–∞ —Å–º–µ–Ω –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞
  const loadShifts = async (employeeId: number, month: string) => {
    const employeeKey = `${employeeId}-${month}`;

    setShiftStates(prev => ({
      ...prev,
      [employeeKey]: { loading: true, error: false, data: null }
    }));

    try {
      const response = await fetch(`/api/reports/${employeeId}/shifts?month=${month}`, {
        headers: getAuthHeaders()
      });
      if (!response.ok) {
        throw new Error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–º–µ–Ω');
      }

      const data = await response.json();

      setShiftStates(prev => ({
        ...prev,
        [employeeKey]: { loading: false, error: false, data: data.shifts || [] }
      }));
    } catch (err) {
      console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–º–µ–Ω:', err);
      setShiftStates(prev => ({
        ...prev,
        [employeeKey]: { loading: false, error: true, data: null }
      }));
    }
  };

  useEffect(() => {
    loadReports();
  }, []);

  if (loading) {
    return (
      <div className="container">
        <div className="header">
          <div className="header-content">
            <div className="logo">
              <Image src="/logo.svg" alt="–õ–æ–≥–æ—Ç–∏–ø" width={60} height={60} priority />
            </div>
            <div className="header-text">
              <h1>–û—Ç—á–µ—Ç—ã</h1>
            </div>
          </div>
        </div>
        <div className="content">
          <div style={{ textAlign: 'center', padding: '40px' }}>
            <div style={{ color: 'var(--primary-color)', fontWeight: 600 }}>–ó–∞–≥—Ä—É–∑–∫–∞ –æ—Ç—á—ë—Ç–æ–≤...</div>
          </div>
        </div>
      </div>
    );
  }

  if (error) {
    return (
      <div className="container">
        <div className="header">
          <div className="header-content">
            <div className="logo">
              <Image src="/logo.svg" alt="–õ–æ–≥–æ—Ç–∏–ø" width={60} height={60} priority />
            </div>
            <div className="header-text">
              <h1>–û—Ç—á–µ—Ç—ã</h1>
            </div>
          </div>
        </div>
        <div className="content">
          <div style={{ textAlign: 'center' }}>
            <div style={{ color: '#dc2626', marginBottom: '16px' }}>–û—à–∏–±–∫–∞: {error}</div>
            <button className="btn" onClick={loadReports}>–ü–æ–≤—Ç–æ—Ä–∏—Ç—å –∑–∞–≥—Ä—É–∑–∫—É</button>
          </div>
        </div>
      </div>
    );
  }

  return (
    <div className="container">
      <div className="header">
        <div className="header-content">
          <div className="logo">
            <Image src="/logo.svg" alt="–õ–æ–≥–æ—Ç–∏–ø" width={60} height={60} priority />
          </div>
          <div className="header-text">
            <h1>–û—Ç—á–µ—Ç—ã</h1>
          </div>
        </div>
      </div>
      <div className="content">
        <div className="back-section">
          <button
            onClick={() => router.push('/admin')}
            className="btn btn-secondary"
          >
            –ù–∞–∑–∞–¥
          </button>
        </div>

        {months.length === 0 ? (
          <div className="empty-state">
            <div className="empty-title">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è</div>
          </div>
        ) : (
          months.map((month) => (
            <MonthCard
              key={month.month}
              month={month}
              shiftStates={shiftStates}
              onLoadShifts={loadShifts}
              onPayoutCreated={handlePayoutUpdate}
              onToast={showToast}
              onReloadMonth={reloadMonthData}
            />
          ))
        )}
      </div>
      <ToastContainer toasts={toasts} onDismiss={hideToast} />

      <style jsx>{`
        .back-section {
          margin-bottom: 20px;
        }

        .btn {
          background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
          color: var(--accent-color);
          border: none;
          padding: 12px 24px;
          border-radius: 8px;
          font-size: 14px;
          font-weight: 600;
          cursor: pointer;
          transition: all 0.3s ease;
          box-shadow: 0 4px 15px var(--shadow-medium);
          text-transform: uppercase;
          letter-spacing: 0.5px;
        }

        .btn:hover {
          transform: translateY(-2px);
          box-shadow: 0 6px 20px var(--shadow-medium);
          background: linear-gradient(135deg, var(--primary-light) 0%, var(--secondary-light) 100%);
        }

        .btn-secondary {
          background: linear-gradient(135deg, var(--accent-color) 0%, var(--accent-light) 100%);
          color: var(--primary-color);
          border: 2px solid var(--primary-color);
        }

        .btn-secondary:hover {
          background: linear-gradient(135deg, var(--accent-dark) 0%, var(--accent-color) 100%);
        }

        :global(.employee-card__actions .btn.btn-compact) {
          padding: 4px 10px;
          border-radius: 8px;
          font-size: 10px;
          letter-spacing: 0.15px;
        }

        .employee-card__header {
          display: flex;
          justify-content: space-between;
          align-items: center;
          margin-bottom: 12px;
        }

        .employee-card__name-button {
          cursor: pointer;
          font-size: 20px;
          font-weight: 700;
          color: var(--primary-color);
          display: inline;
          line-height: 1.2;
          margin: 0;
          padding: 0;
        }

        .employee-card__name-button:focus-visible {
          outline: 2px solid rgba(44, 26, 15, 0.4);
          border-radius: 4px;
        }

        .employee-card__actions {
          margin-top: 10px;
          display: flex;
          justify-content: flex-end;
        }

        .employee-card__history {
          margin-top: 16px;
          padding-top: 12px;
          border-top: 1px solid rgba(44, 26, 15, 0.1);
        }

        .employee-card__history-header {
          display: flex;
          justify-content: space-between;
          align-items: center;
          font-size: 12px;
          color: rgba(44, 26, 15, 0.7);
          margin-bottom: 8px;
        }

        .payout-modal__backdrop {
          position: fixed;
          inset: 0;
          background: rgba(0,0,0,0.4);
          display: flex;
          align-items: center;
          justify-content: center;
          padding: 16px;
          z-index: 1200;
        }

        .payout-modal {
          background: #fff;
          border-radius: 16px;
          width: min(420px, 100%);
          padding: 24px;
          box-shadow: 0 20px 60px rgba(0,0,0,0.2);
        }

        .payout-modal h3 {
          margin-bottom: 8px;
          font-size: 20px;
          color: var(--primary-color);
        }

        @media (max-width: 640px) {
          .payout-modal {
            padding: 20px;
          }
        }
      `}</style>
    </div>
  );
}
</file>

<file path="package.json">
{
  "name": "pytuchet-nextjs",
  "version": "2.5.0",
  "private": true,
  "scripts": {
    "dev": "next dev",
    "build": "next build",
    "start": "next start",
    "lint": "eslint",
    "init-postgres": "node scripts/init-postgres.js",
    "init-vercel": "node scripts/init-vercel-postgres.js",
    "view-db": "node scripts/view-database.js",
    "webhook:set": "node scripts/setup-telegram-webhook.js set",
    "webhook:info": "node scripts/setup-telegram-webhook.js info",
    "webhook:delete": "node scripts/setup-telegram-webhook.js delete"
  },
  "dependencies": {
    "@tma.js/init-data-node": "^2.0.3",
    "@types/pg": "^8.15.5",
    "@vercel/postgres": "^0.10.0",
    "dotenv": "^17.2.3",
    "next": "16.0.0",
    "pg": "^8.16.3",
    "react": "19.2.0",
    "react-dom": "19.2.0"
  },
  "devDependencies": {
    "@tailwindcss/postcss": "^4",
    "@types/node": "^20",
    "@types/react": "^19",
    "@types/react-dom": "^19",
    "eslint": "^9",
    "eslint-config-next": "16.0.0",
    "tailwindcss": "^4",
    "typescript": "^5"
  }
}
</file>

<file path="src/lib/db.ts">
import { sql, createClient } from '@vercel/postgres';
import dotenv from 'dotenv';
import { Pool } from 'pg';

// –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Å—Ä–µ–¥—É –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
const isVercel = !!process.env.VERCEL;

// –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è –¥–ª—è Vercel Postgres
// –í–∞–∂–Ω–æ: –ª–æ–∫–∞–ª—å–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞ —á–∞—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç DATABASE_URL, –∫–æ—Ç–æ—Ä–∞—è –ù–ï –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è @vercel/postgres.
// –ü–æ—ç—Ç–æ–º—É DATABASE_URL –Ω–µ –¥–æ–ª–∂–Ω–∞ –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç—å –Ω–∞—Å –≤ —Ä–µ–∂–∏–º Vercel Postgres.
const hasVercelPostgres = !!(process.env.POSTGRES_URL || process.env.PRISMA_DATABASE_URL || process.env.POSTGRES_URL_NON_POOLING);

// –ò—Å–ø–æ–ª—å–∑—É–µ–º Vercel Postgres –¢–û–õ–¨–ö–û –µ—Å–ª–∏ —Ä–µ–∞–ª—å–Ω–æ –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É—é—Ç –µ–≥–æ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ.
const useVercelPostgres = isVercel && hasVercelPostgres;

// –°–æ–∑–¥–∞–µ–º –∫–ª–∏–µ–Ω—Ç –¥–ª—è Vercel Postgres
let vercelClient: any = null;

// –°–æ–∑–¥–∞–µ–º –ø—É–ª –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
let localPool: Pool | null = null;

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∫–ª–∏–µ–Ω—Ç–∞ Vercel Postgres
function getVercelClient() {
  if (!vercelClient && useVercelPostgres) {
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è –ø–µ—Ä–µ–¥ —Å–æ–∑–¥–∞–Ω–∏–µ–º –∫–ª–∏–µ–Ω—Ç–∞
    if (process.env.POSTGRES_URL || process.env.DATABASE_URL || process.env.PRISMA_DATABASE_URL) {
      vercelClient = createClient();
    }
  }
  return vercelClient;
}

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ –ø—É–ª–∞ —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ–º Vercel Postgres
if (!useVercelPostgres) {
  // –Ø–≤–Ω–æ –∑–∞–≥—Ä—É–∂–∞–µ–º .env.local –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
  try {
    dotenv.config({ path: '.env.local' });
  } catch { }
  const connectionString = process.env.DATABASE_URL || process.env.POSTGRES_URL;
  if (connectionString) {
    localPool = new Pool({ connectionString });
  }
}

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –ø—Ä–æ—Å—Ç—ã—Ö SQL –∑–∞–ø—Ä–æ—Å–æ–≤ –±–µ–∑ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
async function executeSimpleQuery(query: string) {
  if (useVercelPostgres) {
    // –ò—Å–ø–æ–ª—å–∑—É–µ–º Vercel Postgres sql.query –¥–ª—è –ª—É—á—à–µ–π –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
    try {
      const result = await sql.query(query);
      return result;
    } catch (error) {
      console.error('Vercel Postgres query error:', error);
      throw error;
    }
  } else {
    // –ò—Å–ø–æ–ª—å–∑—É–µ–º –æ–±—ã—á–Ω—ã–π PostgreSQL –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
    if (!localPool) {
      throw new Error('Local PostgreSQL pool not initialized');
    }
    const result = await localPool.query(query);
    return { rows: result.rows };
  }
}

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è SQL –∑–∞–ø—Ä–æ—Å–æ–≤ —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏
export async function executeQuery(query: string, params?: any[]) {
  if (useVercelPostgres) {
    // –ò—Å–ø–æ–ª—å–∑—É–µ–º Vercel Postgres sql template literal –¥–ª—è –ª—É—á—à–µ–π –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
    try {
      let result;
      if (params && params.length > 0) {
        // –î–ª—è –∑–∞–ø—Ä–æ—Å–æ–≤ —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏ –∏—Å–ø–æ–ª—å–∑—É–µ–º sql.query
        result = await sql.query(query, params);
      } else {
        // –î–ª—è –ø—Ä–æ—Å—Ç—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ –±–µ–∑ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
        result = await sql.query(query);
      }
      return result;
    } catch (error) {
      console.error('Vercel Postgres query error:', error);
      throw error;
    }
  } else {
    // –ò—Å–ø–æ–ª—å–∑—É–µ–º –ª–æ–∫–∞–ª—å–Ω—ã–π PostgreSQL –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
    if (!localPool) {
      throw new Error('Database pool not initialized');
    }
    const result = await localPool.query(query, params);
    return result;
  }
}

// –¢–∏–ø—ã –¥–ª—è –¥–∞–Ω–Ω—ã—Ö
export interface User {
  id?: number;
  telegram_id: number;
  first_name: string;
  last_name?: string;
  username?: string;
  display_name?: string;
  // –†–æ–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: admin, demo, master
  role?: 'admin' | 'demo' | 'master';
  // –ü–æ–ª—è –¥–ª—è –±—Ä–∞—É–∑–µ—Ä–Ω–æ–π –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
  browser_login?: string;
  password_hash?: string;
  password_set_at?: string;
  last_login_at?: string;
  is_blocked?: boolean;
  blocked_at?: string;
  created_at?: string;
  updated_at?: string;
}

export interface Shift {
  id?: number;
  user_id: number;
  date: string;
  hours: number;
  steam_bath: number;
  brand_steam: number;
  intro_steam: number;
  scrubbing: number;
  zaparnik: number;
  masters: number;
  total: number;
  // –¶–µ–Ω—ã –Ω–∞ –º–æ–º–µ–Ω—Ç —Å–æ–∑–¥–∞–Ω–∏—è —Å–º–µ–Ω—ã
  hourly_rate: number;
  steam_bath_price: number;
  brand_steam_price: number;
  intro_steam_price: number;
  scrubbing_price: number;
  zaparnik_price: number;
  // –ù–æ–≤—ã–µ –ø–æ–ª—è –¥–ª—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏—Ö —É—Å–ª—É–≥
  services?: string; // JSON —Å—Ç—Ä–æ–∫–∞ —Å —É—Å–ª—É–≥–∞–º–∏
  service_prices?: string; // JSON —Å—Ç—Ä–æ–∫–∞ —Å —Ü–µ–Ω–∞–º–∏ —É—Å–ª—É–≥
  created_at?: string;
}

export interface Price {
  id?: number;
  name: string;
  price: number;
  updated_at?: string;
}

export interface Payout {
  id?: number;
  user_id: number;
  month: string; // –§–æ—Ä–º–∞—Ç: YYYY-MM
  amount: number;
  date: string; // –î–∞—Ç–∞ –≤—ã–ø–ª–∞—Ç—ã
  comment?: string;
  initiated_by?: number | null;
  initiator_role?: 'admin' | 'master' | 'system' | null;
  method?: string | null;
  source?: string | null;
  reversed_at?: string | null;
  reversed_by?: number | null;
  reversal_reason?: string | null;
  is_advance?: boolean; // –ü–æ–º–µ—á–∞–µ—Ç –≤—ã–ø–ª–∞—Ç—É –∫–∞–∫ –∞–≤–∞–Ω—Å (–º–µ—Å—è—Ü –Ω–µ –∑–∞–∫—Ä—ã—Ç)
  created_at?: string;
}

export interface Carryover {
  id?: number;
  user_id: number;
  from_month: string; // –§–æ—Ä–º–∞—Ç: YYYY-MM
  to_month: string; // –§–æ—Ä–º–∞—Ç: YYYY-MM
  amount: number;
  created_at?: string;
}

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è PostgreSQL —Ç–∞–±–ª–∏—Ü
async function initPostgres() {
  try {
    // –°–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
    await executeQuery(`
      CREATE TABLE IF NOT EXISTS users (
        id SERIAL PRIMARY KEY,
        telegram_id BIGINT NOT NULL UNIQUE,
        first_name TEXT NOT NULL,
        last_name TEXT,
        username TEXT,
        display_name TEXT,
        role TEXT NOT NULL DEFAULT 'master',
        browser_login TEXT,
        password_hash TEXT,
        password_set_at TIMESTAMP,
        last_login_at TIMESTAMP,
        is_blocked BOOLEAN DEFAULT FALSE,
        blocked_at TIMESTAMP,
        created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
        updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
      )
    `);

    // –î–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤—ã–µ –ø–æ–ª—è –≤ —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é —Ç–∞–±–ª–∏—Ü—É users, –µ—Å–ª–∏ –∏—Ö –Ω–µ—Ç
    await executeQuery(`
      ALTER TABLE users 
      ADD COLUMN IF NOT EXISTS role TEXT NOT NULL DEFAULT 'master',
      ADD COLUMN IF NOT EXISTS is_blocked BOOLEAN DEFAULT FALSE,
      ADD COLUMN IF NOT EXISTS blocked_at TIMESTAMP,
      ADD COLUMN IF NOT EXISTS display_name TEXT,
      ADD COLUMN IF NOT EXISTS browser_login TEXT,
      ADD COLUMN IF NOT EXISTS password_hash TEXT,
      ADD COLUMN IF NOT EXISTS password_set_at TIMESTAMP,
      ADD COLUMN IF NOT EXISTS last_login_at TIMESTAMP
    `);

    // –£–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–Ω–¥–µ–∫—Å –¥–ª—è –ª–æ–≥–∏–Ω–∞ (–¥–æ–ø—É—Å–∫–∞–µ—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ NULL)
    await executeQuery(`
      CREATE UNIQUE INDEX IF NOT EXISTS idx_users_browser_login ON users(browser_login)
    `);

    // –°–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü –µ—Å–ª–∏ –∏—Ö –Ω–µ—Ç
    await executeQuery(`
      CREATE TABLE IF NOT EXISTS shifts (
        id SERIAL PRIMARY KEY,
        user_id INTEGER NOT NULL REFERENCES users(id) ON DELETE CASCADE,
        date TEXT NOT NULL,
        hours REAL NOT NULL,
        steam_bath INTEGER NOT NULL DEFAULT 0,
        brand_steam INTEGER NOT NULL DEFAULT 0,
        intro_steam INTEGER NOT NULL DEFAULT 0,
        scrubbing INTEGER NOT NULL DEFAULT 0,
        zaparnik INTEGER NOT NULL DEFAULT 0,
        masters INTEGER NOT NULL DEFAULT 1,
        total REAL NOT NULL,
        hourly_rate REAL NOT NULL,
        steam_bath_price REAL NOT NULL,
        brand_steam_price REAL NOT NULL,
        intro_steam_price REAL NOT NULL,
        scrubbing_price REAL NOT NULL,
        zaparnik_price REAL NOT NULL,
        created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
      )
    `);

    // –î–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤—ã–µ –ø–æ–ª—è –≤ —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é —Ç–∞–±–ª–∏—Ü—É shifts, –µ—Å–ª–∏ –∏—Ö –Ω–µ—Ç
    await executeQuery(`
      ALTER TABLE shifts 
      ADD COLUMN IF NOT EXISTS zaparnik INTEGER NOT NULL DEFAULT 0,
      ADD COLUMN IF NOT EXISTS zaparnik_price REAL NOT NULL DEFAULT 0
    `);

    // –î–æ–±–∞–≤–ª—è–µ–º –ø–æ–ª—è –¥–ª—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏—Ö —É—Å–ª—É–≥
    await executeQuery(`
      ALTER TABLE shifts 
      ADD COLUMN IF NOT EXISTS services TEXT,
      ADD COLUMN IF NOT EXISTS service_prices TEXT
    `);

    await executeQuery(`
      CREATE TABLE IF NOT EXISTS prices (
        id SERIAL PRIMARY KEY,
        name TEXT NOT NULL UNIQUE,
        price REAL NOT NULL,
        updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
      )
    `);

    await executeQuery(`
      CREATE TABLE IF NOT EXISTS payouts (
        id SERIAL PRIMARY KEY,
        user_id INTEGER NOT NULL REFERENCES users(id) ON DELETE CASCADE,
        month TEXT NOT NULL,
        amount REAL NOT NULL,
        date TEXT NOT NULL,
        comment TEXT,
        initiated_by INTEGER REFERENCES users(id) ON DELETE SET NULL,
        initiator_role TEXT,
        method TEXT,
        source TEXT,
        reversed_at TIMESTAMP,
        reversed_by INTEGER REFERENCES users(id) ON DELETE SET NULL,
        reversal_reason TEXT,
        created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
      )
    `);

    await executeQuery(`
      ALTER TABLE payouts
      ADD COLUMN IF NOT EXISTS initiated_by INTEGER REFERENCES users(id) ON DELETE SET NULL,
      ADD COLUMN IF NOT EXISTS initiator_role TEXT,
      ADD COLUMN IF NOT EXISTS method TEXT,
      ADD COLUMN IF NOT EXISTS source TEXT,
      ADD COLUMN IF NOT EXISTS reversed_at TIMESTAMP,
      ADD COLUMN IF NOT EXISTS reversed_by INTEGER REFERENCES users(id) ON DELETE SET NULL,
      ADD COLUMN IF NOT EXISTS reversal_reason TEXT,
      ADD COLUMN IF NOT EXISTS is_advance BOOLEAN DEFAULT FALSE
    `);

    // –°—Ç–∞—Ç—É—Å –º–µ—Å—è—Ü–∞ (–∑–∞–∫—Ä—ã—Ç/–æ—Ç–∫—Ä—ã—Ç)
    await executeQuery(`
      CREATE TABLE IF NOT EXISTS month_status (
        month TEXT PRIMARY KEY,
        closed BOOLEAN NOT NULL DEFAULT FALSE,
        updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
      )
    `);

    // –¢–∞–±–ª–∏—Ü–∞ –ø–µ—Ä–µ–Ω–æ—Å–æ–≤ –ø–µ—Ä–µ–ø–ª–∞—Ç
    await executeQuery(`
      CREATE TABLE IF NOT EXISTS carryovers (
        id SERIAL PRIMARY KEY,
        user_id INTEGER NOT NULL REFERENCES users(id) ON DELETE CASCADE,
        from_month TEXT NOT NULL,
        to_month TEXT NOT NULL,
        amount REAL NOT NULL,
        created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
        UNIQUE(user_id, from_month, to_month)
      )
    `);

    console.log('PostgreSQL tables initialized successfully');
  } catch (error) {
    console.error('Error initializing database:', error);
    throw error;
  }
}

// –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏
export async function getUserByTelegramId(telegramId: number): Promise<User | null> {
  try {
    const result = await executeQuery('SELECT * FROM users WHERE telegram_id = $1', [telegramId]);
    return result.rows.length > 0 ? result.rows[0] as User : null;
  } catch (error) {
    console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:', error);
    throw error;
  }
}

export async function createUser(userData: Omit<User, 'id' | 'created_at' | 'updated_at'>): Promise<User> {
  try {
    const result = await executeQuery(`
      INSERT INTO users (telegram_id, first_name, last_name, username, display_name, role)
      VALUES ($1, $2, $3, $4, $5, $6)
      RETURNING *
    `, [userData.telegram_id, userData.first_name, userData.last_name, userData.username, userData.display_name, userData.role ?? 'master']);
    return result.rows[0] as User;
  } catch (error) {
    console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:', error);
    throw error;
  }
}

export async function updateUser(telegramId: number, userData: Partial<Omit<User, 'id' | 'telegram_id' | 'created_at'>>): Promise<User> {
  try {
    // –°—Ç—Ä–æ–∏–º –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π –∑–∞–ø—Ä–æ—Å —Ç–æ–ª—å–∫–æ –¥–ª—è –ø–µ—Ä–µ–¥–∞–Ω–Ω—ã—Ö –ø–æ–ª–µ–π
    const updates: string[] = [];
    const values: any[] = [telegramId];
    let paramIndex = 2;

    if (userData.first_name !== undefined) {
      updates.push(`first_name = $${paramIndex}`);
      values.push(userData.first_name);
      paramIndex++;
    }

    if (userData.last_name !== undefined) {
      updates.push(`last_name = $${paramIndex}`);
      values.push(userData.last_name);
      paramIndex++;
    }

    if (userData.username !== undefined) {
      updates.push(`username = $${paramIndex}`);
      values.push(userData.username);
      paramIndex++;
    }

    if (userData.display_name !== undefined) {
      updates.push(`display_name = $${paramIndex}`);
      values.push(userData.display_name);
      paramIndex++;
    }

    if (userData.role !== undefined) {
      updates.push(`role = $${paramIndex}`);
      values.push(userData.role);
      paramIndex++;
    }

    if (userData.browser_login !== undefined) {
      updates.push(`browser_login = $${paramIndex}`);
      values.push(userData.browser_login);
      paramIndex++;
    }

    if (userData.password_hash !== undefined) {
      updates.push(`password_hash = $${paramIndex}`);
      values.push(userData.password_hash);
      paramIndex++;
    }

    if (userData.password_set_at !== undefined) {
      updates.push(`password_set_at = $${paramIndex}`);
      values.push(userData.password_set_at);
      paramIndex++;
    }

    if (userData.last_login_at !== undefined) {
      updates.push(`last_login_at = $${paramIndex}`);
      values.push(userData.last_login_at);
      paramIndex++;
    }

    if (userData.is_blocked !== undefined) {
      updates.push(`is_blocked = $${paramIndex}`);
      values.push(userData.is_blocked);
      paramIndex++;
    }

    if (userData.blocked_at !== undefined) {
      updates.push(`blocked_at = $${paramIndex}`);
      values.push(userData.blocked_at);
      paramIndex++;
    }

    // –í—Å–µ–≥–¥–∞ –æ–±–Ω–æ–≤–ª—è–µ–º updated_at
    updates.push('updated_at = CURRENT_TIMESTAMP');

    if (updates.length === 1) { // –¢–æ–ª—å–∫–æ updated_at
      // –ï—Å–ª–∏ –Ω–µ—Ç –ø–æ–ª–µ–π –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è, –ø—Ä–æ—Å—Ç–æ –≤–æ–∑–≤—Ä–∞—â–∞–µ–º —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
      const result = await executeQuery('SELECT * FROM users WHERE telegram_id = $1', [telegramId]);
      return result.rows[0] as User;
    }

    const query = `
      UPDATE users 
      SET ${updates.join(', ')}
      WHERE telegram_id = $1
      RETURNING *
    `;

    const result = await executeQuery(query, values);
    return result.rows[0] as User;
  } catch (error) {
    console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:', error);
    throw error;
  }
}

export async function getAllUsers(): Promise<User[]> {
  try {
    const result = await executeQuery('SELECT * FROM users ORDER BY created_at DESC', []);
    return result.rows as User[];
  } catch (error) {
    console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π:', error);
    throw error;
  }
}

// –ü–æ–ª—É—á–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ browser_login
export async function getUserByBrowserLogin(login: string): Promise<User | null> {
  try {
    const result = await executeQuery('SELECT * FROM users WHERE browser_login = $1', [login]);
    return result.rows.length > 0 ? (result.rows[0] as User) : null;
  } catch (error) {
    console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ –ª–æ–≥–∏–Ω—É:', error);
    throw error;
  }
}

// –ü–æ–ª—É—á–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ ID
export async function getUserById(id: number): Promise<User | null> {
  try {
    const result = await executeQuery('SELECT * FROM users WHERE id = $1', [id]);
    return result.rows.length > 0 ? (result.rows[0] as User) : null;
  } catch (error) {
    console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ ID:', error);
    throw error;
  }
}

export async function blockUser(userId: number): Promise<User> {
  try {
    const result = await executeQuery(`
      UPDATE users 
      SET is_blocked = TRUE,
          blocked_at = CURRENT_TIMESTAMP,
          updated_at = CURRENT_TIMESTAMP
      WHERE id = $1
      RETURNING *
    `, [userId]);
    return result.rows[0] as User;
  } catch (error) {
    console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –±–ª–æ–∫–∏—Ä–æ–≤–∫–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:', error);
    throw error;
  }
}

export async function unblockUser(userId: number): Promise<User> {
  try {
    const result = await executeQuery(`
      UPDATE users 
      SET is_blocked = FALSE,
          blocked_at = NULL,
          updated_at = CURRENT_TIMESTAMP
      WHERE id = $1
      RETURNING *
    `, [userId]);
    return result.rows[0] as User;
  } catch (error) {
    console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:', error);
    throw error;
  }
}

export async function deleteUser(userId: number): Promise<void> {
  try {
    // –°–Ω–∞—á–∞–ª–∞ —É–¥–∞–ª—è–µ–º –≤—Å–µ —Å–º–µ–Ω—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (CASCADE –¥–æ–ª–∂–µ–Ω —ç—Ç–æ —Å–¥–µ–ª–∞—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏, –Ω–æ –¥–ª—è –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç–∏)
    await executeQuery('DELETE FROM shifts WHERE user_id = $1', [userId]);
    // –ó–∞—Ç–µ–º —É–¥–∞–ª—è–µ–º —Å–∞–º–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    await executeQuery('DELETE FROM users WHERE id = $1', [userId]);
  } catch (error) {
    console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:', error);
    throw error;
  }
}

// –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ä–æ–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–º—É ID
export async function setUserRole(userId: number, role: 'admin' | 'demo' | 'master'): Promise<User> {
  try {
    const result = await executeQuery(
      `
        UPDATE users
        SET role = $2,
            updated_at = CURRENT_TIMESTAMP
        WHERE id = $1
        RETURNING *
      `,
      [userId, role]
    );
    return result.rows[0] as User;
  } catch (error) {
    console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–∏ —Ä–æ–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é:', error);
    throw error;
  }
}

// –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å–æ —Å–º–µ–Ω–∞–º–∏
export async function getShifts(userId?: number): Promise<Shift[]> {
  try {
    if (userId) {
      const result = await executeQuery('SELECT * FROM shifts WHERE user_id = $1 ORDER BY date DESC, id DESC', [userId]);
      return result.rows as Shift[];
    } else {
      const result = await executeQuery('SELECT * FROM shifts ORDER BY date DESC, id DESC');
      return result.rows as Shift[];
    }
  } catch (error) {
    console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ —Å–º–µ–Ω:', error);
    throw error;
  }
}

export async function getShiftsWithUsers(): Promise<any[]> {
  try {
    const result = await executeQuery(`
      SELECT 
        s.*,
        u.first_name,
        u.last_name,
        u.username,
        u.display_name,
        u.telegram_id
      FROM shifts s
      JOIN users u ON s.user_id = u.id
      ORDER BY s.date DESC, s.id DESC
    `);
    return result.rows;
  } catch (error) {
    console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ —Å–º–µ–Ω —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏:', error);
    throw error;
  }
}

export async function addShift(shift: Omit<Shift, 'id' | 'created_at'>): Promise<void> {
  try {
    await executeQuery(`
      INSERT INTO shifts (user_id, date, hours, steam_bath, brand_steam, intro_steam, scrubbing, zaparnik, masters, total, hourly_rate, steam_bath_price, brand_steam_price, intro_steam_price, scrubbing_price, zaparnik_price, services, service_prices)
      VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18)
    `, [shift.user_id, shift.date, shift.hours, shift.steam_bath, shift.brand_steam, shift.intro_steam, shift.scrubbing, shift.zaparnik, shift.masters, shift.total, shift.hourly_rate, shift.steam_bath_price, shift.brand_steam_price, shift.intro_steam_price, shift.scrubbing_price, shift.zaparnik_price, shift.services || null, shift.service_prices || null]);
  } catch (error) {
    console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ —Å–º–µ–Ω—ã:', error);
    throw error;
  }
}

export async function deleteShift(id: number, userId: number): Promise<void> {
  try {
    await executeQuery('DELETE FROM shifts WHERE id = $1 AND user_id = $2', [id, userId]);
  } catch (error) {
    console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ —Å–º–µ–Ω—ã:', error);
    throw error;
  }
}

// –ü–æ–ª—É—á–∏—Ç—å —Å–º–µ–Ω—É –ø–æ ID
export async function getShiftById(id: number): Promise<Shift | null> {
  try {
    const result = await executeQuery('SELECT * FROM shifts WHERE id = $1', [id]);
    return result.rows.length > 0 ? (result.rows[0] as Shift) : null;
  } catch (error) {
    console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ —Å–º–µ–Ω—ã –ø–æ ID:', error);
    throw error;
  }
}

// –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —Ü–µ–Ω–∞–º–∏
export async function getPrices(): Promise<Price[]> {
  try {
    const result = await executeQuery('SELECT * FROM prices ORDER BY id');
    return result.rows as Price[];
  } catch (error) {
    console.error('Error getting prices:', error);
    throw error;
  }
}

export async function addPrice(price: Omit<Price, 'id'>): Promise<Price> {
  try {
    const result = await executeQuery(
      'INSERT INTO prices (name, price) VALUES ($1, $2) RETURNING *',
      [price.name, price.price]
    );
    return result.rows[0] as Price;
  } catch (error) {
    console.error('Error adding price:', error);
    throw error;
  }
}

export async function updatePrice(id: number, price: Omit<Price, 'id'>): Promise<Price> {
  try {
    const result = await executeQuery(
      'UPDATE prices SET name = $1, price = $2 WHERE id = $3 RETURNING *',
      [price.name, price.price, id]
    );
    return result.rows[0] as Price;
  } catch (error) {
    console.error('Error updating price:', error);
    throw error;
  }
}

export async function deletePrice(id: number): Promise<void> {
  try {
    await executeQuery('DELETE FROM prices WHERE id = $1', [id]);
  } catch (error) {
    console.error('Error deleting price:', error);
    throw error;
  }
}

// –ö—ç—à –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
let isDbInitialized = false;
let initPromise: Promise<void> | null = null;

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
export async function initDatabase(): Promise<void> {
  // –ï—Å–ª–∏ –±–∞–∑–∞ —É–∂–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞, –≤–æ–∑–≤—Ä–∞—â–∞–µ–º—Å—è —Å—Ä–∞–∑—É
  if (isDbInitialized) {
    return;
  }

  // –ï—Å–ª–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —É–∂–µ –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ, –∂–¥–µ–º –µ—ë –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è
  if (initPromise) {
    return initPromise;
  }

  // –°–æ–∑–¥–∞–µ–º –ø—Ä–æ–º–∏—Å –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
  initPromise = performDatabaseInit();

  try {
    await initPromise;
    isDbInitialized = true;
  } catch (error) {
    // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –ø—Ä–æ–º–∏—Å –ø—Ä–∏ –æ—à–∏–±–∫–µ, —á—Ç–æ–±—ã –º–æ–∂–Ω–æ –±—ã–ª–æ –ø–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å —Å–Ω–æ–≤–∞
    initPromise = null;
    throw error;
  }
}

async function performDatabaseInit(): Promise<void> {
  try {
    if (useVercelPostgres) {
      // –î–ª—è Vercel Postgres –∏—Å–ø–æ–ª—å–∑—É–µ–º sql.query –¥–ª—è –ª—É—á—à–µ–π –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
      console.log('Initializing Vercel Postgres database...');

      // –°–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
      await sql.query(`
        CREATE TABLE IF NOT EXISTS users (
          id SERIAL PRIMARY KEY,
          telegram_id BIGINT NOT NULL UNIQUE,
          first_name TEXT NOT NULL,
          last_name TEXT,
          username TEXT,
          display_name TEXT,
          role TEXT NOT NULL DEFAULT 'master',
          browser_login TEXT,
          password_hash TEXT,
          password_set_at TIMESTAMP,
          last_login_at TIMESTAMP,
          is_blocked BOOLEAN DEFAULT FALSE,
          blocked_at TIMESTAMP,
          created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
          updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
        )
      `);

      // –î–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤—ã–µ –ø–æ–ª—è –≤ —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é —Ç–∞–±–ª–∏—Ü—É users, –µ—Å–ª–∏ –∏—Ö –Ω–µ—Ç
      await sql.query(`
        ALTER TABLE users 
        ADD COLUMN IF NOT EXISTS role TEXT NOT NULL DEFAULT 'master',
        ADD COLUMN IF NOT EXISTS is_blocked BOOLEAN DEFAULT FALSE,
        ADD COLUMN IF NOT EXISTS blocked_at TIMESTAMP,
        ADD COLUMN IF NOT EXISTS display_name TEXT,
        ADD COLUMN IF NOT EXISTS browser_login TEXT,
        ADD COLUMN IF NOT EXISTS password_hash TEXT,
        ADD COLUMN IF NOT EXISTS password_set_at TIMESTAMP,
        ADD COLUMN IF NOT EXISTS last_login_at TIMESTAMP
      `);

      // –£–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–Ω–¥–µ–∫—Å –¥–ª—è –ª–æ–≥–∏–Ω–∞ (–¥–æ–ø—É—Å–∫–∞–µ—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ NULL)
      await sql.query(`
        CREATE UNIQUE INDEX IF NOT EXISTS idx_users_browser_login ON users(browser_login)
      `);

      // –°–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã shifts
      await sql.query(`
        CREATE TABLE IF NOT EXISTS shifts (
          id SERIAL PRIMARY KEY,
          user_id INTEGER NOT NULL REFERENCES users(id) ON DELETE CASCADE,
          date TEXT NOT NULL,
          hours REAL NOT NULL,
          steam_bath INTEGER NOT NULL DEFAULT 0,
          brand_steam INTEGER NOT NULL DEFAULT 0,
          intro_steam INTEGER NOT NULL DEFAULT 0,
          scrubbing INTEGER NOT NULL DEFAULT 0,
          zaparnik INTEGER NOT NULL DEFAULT 0,
          masters INTEGER NOT NULL DEFAULT 1,
          total REAL NOT NULL,
          hourly_rate REAL NOT NULL,
          steam_bath_price REAL NOT NULL,
          brand_steam_price REAL NOT NULL,
          intro_steam_price REAL NOT NULL,
          scrubbing_price REAL NOT NULL,
          zaparnik_price REAL NOT NULL DEFAULT 0,
          created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
        )
      `);

      // –ì–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ–º –Ω–∞–ª–∏—á–∏–µ –Ω–æ–≤—ã—Ö –ø–æ–ª–µ–π –≤ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π —Ç–∞–±–ª–∏—Ü–µ (–º–∏–≥—Ä–∞—Ü–∏—è)
      await sql.query(`
        ALTER TABLE shifts 
        ADD COLUMN IF NOT EXISTS zaparnik INTEGER NOT NULL DEFAULT 0,
        ADD COLUMN IF NOT EXISTS zaparnik_price REAL NOT NULL DEFAULT 0
      `);

      // –°–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã prices
      await sql.query(`
        CREATE TABLE IF NOT EXISTS prices (
          id SERIAL PRIMARY KEY,
          name TEXT NOT NULL UNIQUE,
          price REAL NOT NULL,
          updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
        )
      `);

      // –°–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã payouts
      await sql.query(`
        CREATE TABLE IF NOT EXISTS payouts (
          id SERIAL PRIMARY KEY,
          user_id INTEGER NOT NULL REFERENCES users(id) ON DELETE CASCADE,
          month TEXT NOT NULL,
          amount REAL NOT NULL,
          date TEXT NOT NULL,
          comment TEXT DEFAULT '',
          created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
        )
      `);

      // –°—Ç–∞—Ç—É—Å –º–µ—Å—è—Ü–∞ (–∑–∞–∫—Ä—ã—Ç/–æ—Ç–∫—Ä—ã—Ç)
      await sql.query(`
        CREATE TABLE IF NOT EXISTS month_status (
          month TEXT PRIMARY KEY,
          closed BOOLEAN NOT NULL DEFAULT FALSE,
          updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
        )
      `);

      // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ –¥–∞–Ω–Ω—ã–µ –≤ —Ç–∞–±–ª–∏—Ü–µ prices
      const pricesResult = await sql.query('SELECT COUNT(*) as count FROM prices');
      const pricesCount = pricesResult.rows[0].count;

      if (pricesCount === 0) {
        // –î–æ–±–∞–≤–ª—è–µ–º –±–∞–∑–æ–≤—ã–µ —Ü–µ–Ω—ã
        await sql.query(`
          INSERT INTO prices (name, price) VALUES 
          ('–ü–æ—á–∞—Å–æ–≤–∞—è —Å—Ç–∞–≤–∫–∞', 400),
          ('–ü—É—Ç–µ–≤–æ–µ –ø–∞—Ä–µ–Ω–∏–µ', 3500),
          ('–§–∏—Ä–º–µ–Ω–Ω–æ–µ –ø–∞—Ä–µ–Ω–∏–µ', 4200),
          ('–û–∑–Ω–∞–∫–æ–º–∏—Ç–µ–ª—å–Ω–æ–µ –ø–∞—Ä–µ–Ω–∏–µ', 2500),
          ('–°–∫—Ä–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ', 1200),
          ('–ó–∞–ø–∞—Ä–Ω–∏–∫', 800)
        `);
        console.log('Default prices inserted');
      }

      // –ù–∞–∑–Ω–∞—á–∞–µ–º –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ –ø–æ telegram_id, –µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
      try {
        await sql.query('UPDATE users SET role = $1 WHERE telegram_id = $2', ['admin', 7001686456]);
        console.log('Admin role assigned for telegram_id 7001686456 (if existed)');
        await sql.query('UPDATE users SET role = $1 WHERE telegram_id = $2', ['admin', 87654321]);
        console.log('Admin role assigned for fallback test telegram_id 87654321 (if existed)');
      } catch (e) {
        console.warn('Failed to assign admin by telegram_id on Vercel Postgres:', e);
      }

      console.log('Vercel Postgres database initialized successfully');
    } else {
      // –î–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –∏—Å–ø–æ–ª—å–∑—É–µ–º —Å—Ç–∞—Ä—ã–π –º–µ—Ç–æ–¥
      await initPostgres();
      await initDefaultPrices();

      // –ù–∞–∑–Ω–∞—á–∞–µ–º –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ –ø–æ telegram_id, –µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å—É—â–µ—Å—Ç–≤—É–µ—Ç (–ª–æ–∫–∞–ª—å–Ω—ã–π Postgres)
      try {
        await executeQuery('UPDATE users SET role = $1 WHERE telegram_id = $2', ['admin', 7001686456]);
        console.log('Admin role assigned for telegram_id 7001686456 (if existed)');
        await executeQuery('UPDATE users SET role = $1 WHERE telegram_id = $2', ['admin', 87654321]);
        console.log('Admin role assigned for fallback test telegram_id 87654321 (if existed)');
      } catch (e) {
        console.warn('Failed to assign admin by telegram_id on local Postgres:', e);
      }
    }

    console.log('PostgreSQL tables initialized successfully');
  } catch (error) {
    console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö:', error);
    throw error;
  }
}

export async function initDefaultPrices(): Promise<void> {
  try {
    const defaultPrices = [
      { name: '–ü–æ—á–∞—Å–æ–≤–∞—è —Å—Ç–∞–≤–∫–∞', price: 400 },
      { name: '–ü—É—Ç–µ–≤–æ–µ –ø–∞—Ä–µ–Ω–∏–µ', price: 3500 },
      { name: '–§–∏—Ä–º–µ–Ω–Ω–æ–µ –ø–∞—Ä–µ–Ω–∏–µ', price: 4200 },
      { name: '–û–∑–Ω–∞–∫–æ–º–∏—Ç–µ–ª—å–Ω–æ–µ –ø–∞—Ä–µ–Ω–∏–µ', price: 2500 },
      { name: '–°–∫—Ä–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ', price: 1200 },
      { name: '–ó–∞–ø–∞—Ä–Ω–∏–∫', price: 800 }
    ];

    for (const price of defaultPrices) {
      await executeQuery(
        'INSERT INTO prices (name, price) VALUES ($1, $2) ON CONFLICT (name) DO NOTHING',
        [price.name, price.price]
      );
    }

    console.log('Default prices initialized successfully');
  } catch (error) {
    console.error('Error initializing default prices:', error);
    throw error;
  }
}

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—á–∏—Å—Ç–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (–æ—Å—Ç–∞–≤–ª—è–µ–º —Ç–æ–ª—å–∫–æ User Test)
export async function cleanupUsersExceptTest(): Promise<void> {
  try {
    // –°–Ω–∞—á–∞–ª–∞ —É–¥–∞–ª—è–µ–º –≤—Å–µ —Å–º–µ–Ω—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π, –∫—Ä–æ–º–µ User Test
    await executeQuery(
      'DELETE FROM shifts WHERE user_id NOT IN (SELECT id FROM users WHERE first_name = $1)',
      ['User Test']
    );

    // –ó–∞—Ç–µ–º —É–¥–∞–ª—è–µ–º –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π, –∫—Ä–æ–º–µ User Test
    await executeQuery(
      'DELETE FROM users WHERE first_name != $1',
      ['User Test']
    );

    console.log('Users cleanup completed successfully');
  } catch (error) {
    console.error('Error during users cleanup:', error);
    throw error;
  }
}

// –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –≤—ã–ø–ª–∞—Ç–∞–º–∏
export async function createPayout(payout: Omit<Payout, 'id' | 'created_at'>): Promise<Payout> {
  try {
    const result = await executeQuery(
      `INSERT INTO payouts (
        user_id, 
        month, 
        amount, 
        date, 
        comment, 
        initiated_by, 
        initiator_role, 
        method, 
        source, 
        reversed_at,
        reversed_by,
        reversal_reason,
        is_advance
      ) VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING *`,
      [
        payout.user_id,
        payout.month,
        payout.amount,
        payout.date,
        payout.comment ?? null,
        payout.initiated_by !== undefined ? payout.initiated_by : payout.user_id,
        payout.initiator_role ?? 'master',
        payout.method ?? null,
        payout.source ?? null,
        payout.reversed_at ?? null,
        payout.reversed_by ?? null,
        payout.reversal_reason ?? null,
        payout.is_advance ?? false
      ]
    );
    return result.rows[0] as Payout;
  } catch (error) {
    console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –≤—ã–ø–ª–∞—Ç—ã:', error);
    throw error;
  }
}

// –ù–æ–≤–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –≤—ã–ø–ª–∞—Ç —Å –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–æ–π —Å—É–º–º –∏ –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –∞–≤–∞–Ω—Å–æ–≤
export async function createPayoutWithCorrection(payout: Omit<Payout, 'id' | 'created_at'>): Promise<{ payout: Payout; overpayment?: number }> {
  try {
    // –ü–æ–ª—É—á–∞–µ–º –∑–∞—Ä–∞–±–æ—Ç–æ–∫ –∑–∞ –º–µ—Å—è—Ü
    const monthlyEarnings = await getEarningsForMonth(payout.user_id, payout.month);

    // –ü–æ–ª—É—á–∞–µ–º —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –≤—ã–ø–ª–∞—Ç—ã –∑–∞ –º–µ—Å—è—Ü
    const existingPayouts = await getPayoutsForMonth(payout.user_id, payout.month);

    // –í—ã—á–∏—Å–ª—è–µ–º –æ—Å—Ç–∞–≤—à—É—é—Å—è —Å—É–º–º—É –¥–ª—è –≤—ã–ø–ª–∞—Ç
    const remainingEarnings = monthlyEarnings - existingPayouts;

    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –∑–∞–∫—Ä—ã—Ç –ª–∏ –º–µ—Å—è—Ü
    const isClosed = await isMonthClosed(payout.month);

    // –ï—Å–ª–∏ –≤—ã–ø–ª–∞—Ç–∞ –ø—Ä–µ–≤—ã—à–∞–µ—Ç –æ—Å—Ç–∞–≤—à–∏–π—Å—è –∑–∞—Ä–∞–±–æ—Ç–æ–∫
    if (payout.amount > remainingEarnings) {
      if (!isClosed) {
        // –°–¶–ï–ù–ê–†–ò–ô: –ê–í–ê–ù–° (–º–µ—Å—è—Ü –Ω–µ –∑–∞–∫—Ä—ã—Ç)
        // –°–æ–∑–¥–∞–µ–º –≤—ã–ø–ª–∞—Ç—É –Ω–∞ –ø–æ–ª–Ω—É—é —Å—É–º–º—É, –ø–æ–º–µ—á–∞–µ–º –∫–∞–∫ –∞–≤–∞–Ω—Å
        console.log(`–°–æ–∑–¥–∞–Ω–∏–µ –∞–≤–∞–Ω—Å–∞ –¥–ª—è ${payout.user_id} –≤ ${payout.month}: ${payout.amount} ‚ÇΩ (–∑–∞—Ä–∞–±–æ—Ç–æ–∫ ${monthlyEarnings} ‚ÇΩ, –≤—ã–ø–ª–∞—á–µ–Ω–æ ${existingPayouts} ‚ÇΩ)`);

        const advancePayout = {
          ...payout,
          is_advance: true
        };

        const createdPayout = await createPayout(advancePayout);

        return {
          payout: createdPayout,
          overpayment: 0 // –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ–ø–ª–∞—Ç—ã –Ω–µ—Ç, —ç—Ç–æ –∞–≤–∞–Ω—Å
        };
      } else {
        // –°–¶–ï–ù–ê–†–ò–ô: –ü–ï–†–ï–ü–õ–ê–¢–ê (–º–µ—Å—è—Ü –∑–∞–∫—Ä—ã—Ç)
        // –°—Ç–∞—Ä–∞—è –ª–æ–≥–∏–∫–∞: —Ä–∞–∑–±–∏–≤–∞–µ–º –Ω–∞ –≤—ã–ø–ª–∞—Ç—É –∏ –ø–µ—Ä–µ–Ω–æ—Å
        const actualAmount = Math.max(0, remainingEarnings);
        const overpayment = payout.amount - actualAmount;

        console.log(`–°–æ–∑–¥–∞–Ω–∏–µ –ø–µ—Ä–µ–ø–ª–∞—Ç—ã –¥–ª—è ${payout.user_id} –≤ ${payout.month}: –≤—ã–ø–ª–∞—Ç–∞ ${actualAmount} ‚ÇΩ, –ø–µ—Ä–µ–Ω–æ—Å ${overpayment} ‚ÇΩ`);

        // –°–æ–∑–¥–∞–µ–º –≤—ã–ø–ª–∞—Ç—É —Å —Å–∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ–π —Å—É–º–º–æ–π (–µ—Å–ª–∏ –æ–Ω–∞ > 0)
        let createdPayout: Payout;

        if (actualAmount > 0) {
          createdPayout = await createPayout({
            ...payout,
            amount: actualAmount,
            is_advance: false
          });
        } else {
          // –ï—Å–ª–∏ –≤—Å—è —Å—É–º–º–∞ —É—Ö–æ–¥–∏—Ç –≤ –ø–µ—Ä–µ–Ω–æ—Å, —Å–æ–∑–¥–∞–µ–º —Ñ–∏–∫—Ç–∏–≤–Ω—É—é –∑–∞–ø–∏—Å—å –¥–ª—è –≤–æ–∑–≤—Ä–∞—Ç–∞ (–∏–ª–∏ –±–µ—Ä–µ–º –ø–µ—Ä–≤—É—é —á–∞—Å—Ç—å –ø–µ—Ä–µ–Ω–æ—Å–∞)
          // –í –¥–∞–Ω–Ω–æ–º —Å–ª—É—á–∞–µ –ª—É—á—à–µ –≤–µ—Ä–Ω—É—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É, –ø–æ—Ö–æ–∂—É—é –Ω–∞ –≤—ã–ø–ª–∞—Ç—É
          createdPayout = { ...payout, amount: 0, id: 0 } as Payout;
        }

        // –°–æ–∑–¥–∞–µ–º –ø–µ—Ä–µ–Ω–æ—Å –Ω–∞ —Å–ª–µ–¥—É—é—â–∏–π –º–µ—Å—è—Ü
        if (overpayment > 0) {
          await createCarryoverForOverpayment(payout, overpayment);
        }

        return {
          payout: createdPayout,
          overpayment: overpayment
        };
      }
    }

    // –°–¶–ï–ù–ê–†–ò–ô: –û–ë–´–ß–ù–ê–Ø –í–´–ü–õ–ê–¢–ê (—Ö–≤–∞—Ç–∞–µ—Ç –∑–∞—Ä–∞–±–æ—Ç–∫–∞)
    const createdPayout = await createPayout({
      ...payout,
      is_advance: false
    });

    return {
      payout: createdPayout,
      overpayment: undefined
    };
  } catch (error) {
    console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –≤—ã–ø–ª–∞—Ç—ã —Å –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–æ–π:', error);
    throw error;
  }
}

// –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –ø–µ—Ä–µ–Ω–æ—Å–∞ –ø–µ—Ä–µ–ø–ª–∞—Ç—ã
async function createCarryoverForOverpayment(
  originalPayout: Omit<Payout, 'id' | 'created_at'>,
  amount: number
): Promise<void> {
  try {
    // –í—ã—á–∏—Å–ª—è–µ–º —Å–ª–µ–¥—É—é—â–∏–π –º–µ—Å—è—Ü
    const [year, monthNumber] = originalPayout.month.split('-').map(Number);
    const nextDate = new Date(year, monthNumber, 1); // monthNumber —É–∂–µ 1-–∏–Ω–¥–µ–∫—Å–∏—Ä–æ–≤–∞–Ω
    const nextMonth = `${nextDate.getFullYear()}-${String(nextDate.getMonth() + 1).padStart(2, '0')}`;

    // –°–æ–∑–¥–∞–µ–º –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –¥–ª—è –ø–µ—Ä–µ–Ω–æ—Å–∞
    const monthNames = [
      '—è–Ω–≤–∞—Ä—è', '—Ñ–µ–≤—Ä–∞–ª—è', '–º–∞—Ä—Ç–∞', '–∞–ø—Ä–µ–ª—è', '–º–∞—è', '–∏—é–Ω—è',
      '–∏—é–ª—è', '–∞–≤–≥—É—Å—Ç–∞', '—Å–µ–Ω—Ç—è–±—Ä—è', '–æ–∫—Ç—è–±—Ä—è', '–Ω–æ—è–±—Ä—è', '–¥–µ–∫–∞–±—Ä—è'
    ];
    const fromMonthName = monthNames[monthNumber - 1];
    const fromYear = year;
    const comment = `–ü–µ—Ä–µ–Ω–æ—Å —Å ${fromMonthName} ${fromYear}`;

    // –°–æ–∑–¥–∞–µ–º –≤—ã–ø–ª–∞—Ç—É-–ø–µ—Ä–µ–Ω–æ—Å –≤ —Å–ª–µ–¥—É—é—â–µ–º –º–µ—Å—è—Ü–µ
    await createPayoutWithCorrection({
      user_id: originalPayout.user_id,
      month: nextMonth,
      amount: amount,
      date: originalPayout.date,
      comment: comment,
      initiated_by: originalPayout.initiated_by,
      initiator_role: originalPayout.initiator_role,
      method: originalPayout.method,
      source: 'carryover'
    });
  } catch (error) {
    console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –ø–µ—Ä–µ–Ω–æ—Å–∞ –ø–µ—Ä–µ–ø–ª–∞—Ç—ã:', error);
    throw error;
  }
}

export async function getPayoutsByUser(userId: number): Promise<Payout[]> {
  try {
    const result = await executeQuery(
      'SELECT * FROM payouts WHERE user_id = $1 ORDER BY month DESC, date DESC',
      [userId]
    );
    return result.rows as Payout[];
  } catch (error) {
    console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –≤—ã–ø–ª–∞—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:', error);
    throw error;
  }
}

export async function getPayoutsByUserAndMonth(userId: number, month: string): Promise<Payout[]> {
  try {
    const result = await executeQuery(
      'SELECT * FROM payouts WHERE user_id = $1 AND month = $2 ORDER BY date DESC',
      [userId, month]
    );
    return result.rows as Payout[];
  } catch (error) {
    console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –≤—ã–ø–ª–∞—Ç –∑–∞ –º–µ—Å—è—Ü:', error);
    throw error;
  }
}

export async function deletePayout(id: number, userId: number): Promise<boolean> {
  try {
    const result = await executeQuery(
      'DELETE FROM payouts WHERE id = $1 AND user_id = $2 RETURNING id',
      [id, userId]
    );
    const rows = Array.isArray((result as any).rows) ? (result as any).rows : [];
    return rows.length > 0;
  } catch (error) {
    console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –≤—ã–ø–ª–∞—Ç—ã:', error);
    throw error;
  }
}

// –ü–æ–ª—É—á–∏—Ç—å –≤—ã–ø–ª–∞—Ç—É –ø–æ ID
export async function getPayoutById(id: number): Promise<Payout | null> {
  try {
    const result = await executeQuery('SELECT * FROM payouts WHERE id = $1', [id]);
    return result.rows.length > 0 ? (result.rows[0] as Payout) : null;
  } catch (error) {
    console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –≤—ã–ø–ª–∞—Ç—ã –ø–æ ID:', error);
    throw error;
  }
}

export async function deletePayoutForce(id: number): Promise<boolean> {
  try {
    const result = await executeQuery('DELETE FROM payouts WHERE id = $1 RETURNING id', [id]);
    const rows = Array.isArray((result as any).rows) ? (result as any).rows : [];
    return rows.length > 0;
  } catch (error) {
    console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–º —É–¥–∞–ª–µ–Ω–∏–∏ –≤—ã–ø–ª–∞—Ç—ã:', error);
    throw error;
  }
}

export async function getPayoutHistoryForUserAndMonth(
  userId: number,
  month: string,
  limit = 5
): Promise<Payout[]> {
  try {
    const result = await executeQuery(
      `SELECT * FROM payouts
       WHERE user_id = $1 AND month = $2
       ORDER BY date DESC, created_at DESC, id DESC
       LIMIT $3`,
      [userId, month, limit]
    );
    return result.rows as Payout[];
  } catch (error) {
    console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –∏—Å—Ç–æ—Ä–∏–∏ –≤—ã–ø–ª–∞—Ç:', error);
    throw error;
  }
}

export async function markPayoutReversed(
  payoutId: number,
  adminId: number,
  reason?: string
): Promise<Payout | null> {
  try {
    const result = await executeQuery(
      `UPDATE payouts
       SET reversed_at = COALESCE(reversed_at, CURRENT_TIMESTAMP),
           reversed_by = CASE WHEN reversed_at IS NULL THEN $2 ELSE reversed_by END,
           reversal_reason = CASE WHEN reversed_at IS NULL THEN COALESCE($3, reversal_reason) ELSE reversal_reason END
       WHERE id = $1
       RETURNING *`,
      [payoutId, adminId, reason ?? null]
    );
    return result.rows.length > 0 ? (result.rows[0] as Payout) : null;
  } catch (error) {
    console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–º–µ—Ç–∫–µ –≤—ã–ø–ª–∞—Ç—ã –∫–∞–∫ –æ—Ç–∫–∞—Ç–∞–Ω–Ω–æ–π:', error);
    throw error;
  }
}

// --- –°—Ç–∞—Ç—É—Å –º–µ—Å—è—Ü–∞ (–∑–∞–∫—Ä—ã—Ç/–æ—Ç–∫—Ä—ã—Ç) ---
export async function getMonthStatuses(): Promise<{ month: string; closed: boolean }[]> {
  try {
    const result = await executeQuery('SELECT month, closed FROM month_status ORDER BY month DESC');
    return result.rows.map((row: any) => ({ month: row.month, closed: !!row.closed }));
  } catch (error) {
    console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ —Å—Ç–∞—Ç—É—Å–æ–≤ –º–µ—Å—è—Ü–µ–≤:', error);
    throw error;
  }
}

export async function getMonthStatus(month: string): Promise<boolean> {
  try {
    const result = await executeQuery('SELECT closed FROM month_status WHERE month = $1', [month]);
    if (result.rows.length === 0) {
      return false; // –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –º–µ—Å—è—Ü –æ—Ç–∫—Ä—ã—Ç
    }
    return !!result.rows[0].closed;
  } catch (error) {
    console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ —Å—Ç–∞—Ç—É—Å–∞ –º–µ—Å—è—Ü–∞:', error);
    throw error;
  }
}

export async function setMonthClosed(month: string, closed: boolean): Promise<{ month: string; closed: boolean }> {
  try {
    const result = await executeQuery(
      `INSERT INTO month_status (month, closed, updated_at)
       VALUES ($1, $2, CURRENT_TIMESTAMP)
       ON CONFLICT (month) DO UPDATE SET closed = EXCLUDED.closed, updated_at = CURRENT_TIMESTAMP
       RETURNING month, closed`,
      [month, closed]
    );
    return { month: result.rows[0].month, closed: !!result.rows[0].closed };
  } catch (error) {
    console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ —É—Å—Ç–∞–Ω–æ–≤–∫–µ —Å—Ç–∞—Ç—É—Å–∞ –º–µ—Å—è—Ü–∞:', error);
    throw error;
  }
}

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –º–µ—Å—è—Ü–µ–≤ —Å —Å–º–µ–Ω–∞–º–∏ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
export async function getMonthsWithShifts(userId: number): Promise<string[]> {
  try {
    const result = await executeQuery(
      `SELECT DISTINCT 
         TO_CHAR(TO_DATE(date, 'YYYY-MM-DD'), 'YYYY-MM') as month
       FROM shifts 
       WHERE user_id = $1 
       ORDER BY month DESC`,
      [userId]
    );
    return result.rows.map(row => row.month);
  } catch (error) {
    console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –º–µ—Å—è—Ü–µ–≤ —Å–æ —Å–º–µ–Ω–∞–º–∏:', error);
    throw error;
  }
}

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Å—É–º–º—ã –∑–∞—Ä–∞–±–æ—Ç–∫–∞ –∑–∞ –º–µ—Å—è—Ü
export async function getEarningsForMonth(userId: number, month: string): Promise<number> {
  try {
    const result = await executeQuery(
      `SELECT COALESCE(SUM(total), 0) as total_earnings
       FROM shifts 
       WHERE user_id = $1 
       AND TO_CHAR(TO_DATE(date, 'YYYY-MM-DD'), 'YYYY-MM') = $2`,
      [userId, month]
    );
    return parseFloat(result.rows[0]?.total_earnings || '0');
  } catch (error) {
    console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –∑–∞—Ä–∞–±–æ—Ç–∫–∞ –∑–∞ –º–µ—Å—è—Ü:', error);
    throw error;
  }
}

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Å—É–º–º—ã –≤—ã–ø–ª–∞—Ç –∑–∞ –º–µ—Å—è—Ü
export async function getPayoutsForMonth(userId: number, month: string): Promise<number> {
  try {
    const result = await executeQuery(
      `SELECT COALESCE(SUM(amount), 0) as total_payouts
       FROM payouts 
       WHERE user_id = $1 AND month = $2 AND reversed_at IS NULL`,
      [userId, month]
    );
    return parseFloat(result.rows[0]?.total_payouts || '0');
  } catch (error) {
    console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –≤—ã–ø–ª–∞—Ç –∑–∞ –º–µ—Å—è—Ü:', error);
    throw error;
  }
}

// --- –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –∞–≤–∞–Ω—Å–∞–º–∏ ---

/**
 * –ü—Ä–æ–≤–µ—Ä—è–µ—Ç, –∑–∞–∫–æ–Ω—á–∏–ª—Å—è –ª–∏ –º–µ—Å—è—Ü (–ø–æ –∫–∞–ª–µ–Ω–¥–∞—Ä—é –∏–ª–∏ –≤—Ä—É—á–Ω—É—é –∑–∞–∫—Ä—ã—Ç)
 * @param month - –º–µ—Å—è—Ü –≤ —Ñ–æ—Ä–º–∞—Ç–µ YYYY-MM
 * @returns true –µ—Å–ª–∏ –º–µ—Å—è—Ü –∑–∞–∫–æ–Ω—á–∏–ª—Å—è –∏–ª–∏ –∑–∞–∫—Ä—ã—Ç –≤—Ä—É—á–Ω—É—é
 */
export async function isMonthClosed(month: string): Promise<boolean> {
  try {
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç–∞—Ç—É—Å –≤—Ä—É—á–Ω—É—é –∑–∞–∫—Ä—ã—Ç–æ–≥–æ –º–µ—Å—è—Ü–∞
    const manualStatus = await getMonthStatus(month);
    if (manualStatus) {
      return true;
    }

    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ –∫–∞–ª–µ–Ω–¥–∞—Ä—é: –º–µ—Å—è—Ü –∑–∞–∫–æ–Ω—á–∏–ª—Å—è?
    const [year, monthNum] = month.split('-').map(Number);
    const lastDayOfMonth = new Date(year, monthNum, 0); // 0 = –ø–æ—Å–ª–µ–¥–Ω–∏–π –¥–µ–Ω—å –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ –º–µ—Å—è—Ü–∞
    const today = new Date();

    // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≤—Ä–µ–º—è –Ω–∞ –Ω–∞—á–∞–ª–æ –¥–Ω—è –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–≥–æ —Å—Ä–∞–≤–Ω–µ–Ω–∏—è
    today.setHours(0, 0, 0, 0);
    lastDayOfMonth.setHours(23, 59, 59, 999);

    return today > lastDayOfMonth;
  } catch (error) {
    console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ –∑–∞–∫—Ä—ã—Ç–∏—è –º–µ—Å—è—Ü–∞:', error);
    throw error;
  }
}

/**
 * –ü–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ—Ç –∞–≤–∞–Ω—Å—ã –ø–æ—Å–ª–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è/–∏–∑–º–µ–Ω–µ–Ω–∏—è —Å–º–µ–Ω –≤ –º–µ—Å—è—Ü–µ
 * –û–±–Ω–æ–≤–ª—è–µ—Ç —Å—Ç–∞—Ç—É—Å –≤—ã–ø–ª–∞—Ç: –µ—Å–ª–∏ –∑–∞—Ä–∞–±–æ—Ç–æ–∫ –ø–æ–∫—Ä—ã–ª –∞–≤–∞–Ω—Å, —É–±–∏—Ä–∞–µ—Ç —Ñ–ª–∞–≥ is_advance
 * @param userId - ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
 * @param month - –º–µ—Å—è—Ü –≤ —Ñ–æ—Ä–º–∞—Ç–µ YYYY-MM
 */
export async function recalculateAdvancesForMonth(userId: number, month: string): Promise<void> {
  try {
    // –ü–æ–ª—É—á–∞–µ–º —Ç–µ–∫—É—â–∏–π –∑–∞—Ä–∞–±–æ—Ç–æ–∫ –∑–∞ –º–µ—Å—è—Ü
    const earnings = await getEarningsForMonth(userId, month);

    // –ü–æ–ª—É—á–∞–µ–º –≤—Å–µ –∞–≤–∞–Ω—Å—ã –≤ —ç—Ç–æ–º –º–µ—Å—è—Ü–µ
    const result = await executeQuery(
      `SELECT id, amount FROM payouts 
       WHERE user_id = $1 AND month = $2 AND is_advance = TRUE AND reversed_at IS NULL
       ORDER BY created_at ASC`,
      [userId, month]
    );

    if (result.rows.length === 0) {
      return; // –ù–µ—Ç –∞–≤–∞–Ω—Å–æ–≤ –¥–ª—è –ø–µ—Ä–µ—Å—á—ë—Ç–∞
    }

    let accumulatedPayouts = 0;

    for (const advance of result.rows as Payout[]) {
      accumulatedPayouts += advance.amount!;

      // –ï—Å–ª–∏ –∑–∞—Ä–∞–±–æ—Ç–æ–∫ –ø–æ–∫—Ä—ã–≤–∞–µ—Ç —ç—Ç–æ—Ç –∞–≤–∞–Ω—Å
      if (earnings >= accumulatedPayouts) {
        // –£–±–∏—Ä–∞–µ–º —Ñ–ª–∞–≥ –∞–≤–∞–Ω—Å–∞
        await executeQuery(
          `UPDATE payouts SET is_advance = FALSE WHERE id = $1`,
          [advance.id]
        );
        console.log(`–ê–≤–∞–Ω—Å ${advance.id} –ø–æ–∫—Ä—ã—Ç –∑–∞—Ä–∞–±–æ—Ç–∫–æ–º. –°—É–º–º–∞: ${advance.amount} ‚ÇΩ`);
      }
    }

    console.log(`–ü–µ—Ä–µ—Å—á—ë—Ç –∞–≤–∞–Ω—Å–æ–≤ –¥–ª—è –º–µ—Å—è—Ü–∞ ${month} –∑–∞–≤–µ—Ä—à—ë–Ω. –ó–∞—Ä–∞–±–æ—Ç–æ–∫: ${earnings} ‚ÇΩ`);
  } catch (error) {
    console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–µ—Ä–µ—Å—á—ë—Ç–µ –∞–≤–∞–Ω—Å–æ–≤:', error);
    throw error;
  }
}

/**
 * –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–∫—Ä—ã–≤–∞–µ—Ç –º–µ—Å—è—Ü—ã, –∫–æ—Ç–æ—Ä—ã–µ —É–∂–µ –∑–∞–≤–µ—Ä—à–∏–ª–∏—Å—å –ø–æ –∫–∞–ª–µ–Ω–¥–∞—Ä—é
 * –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∞–≤–∞–Ω—Å—ã, –ø—Ä–µ–≤—Ä–∞—â–∞—è –∏—Ö –≤ –ø–µ—Ä–µ–Ω–æ—Å—ã
 */
export async function autoCloseFinishedMonths(): Promise<void> {
  try {
    // –ü–æ–ª—É—á–∞–µ–º –≤—Å–µ –º–µ—Å—è—Ü—ã —Å–æ —Å–º–µ–Ω–∞–º–∏
    const result = await executeQuery(
      `SELECT DISTINCT TO_CHAR(TO_DATE(date, 'YYYY-MM-DD'), 'YYYY-MM') as month, user_id
       FROM shifts
       ORDER BY month ASC`
    );

    const monthsToCheck = result.rows as { month: string; user_id: number }[];

    for (const { month, user_id } of monthsToCheck) {
      // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –∑–∞–∫–æ–Ω—á–∏–ª—Å—è –ª–∏ –º–µ—Å—è—Ü –ø–æ –∫–∞–ª–µ–Ω–¥–∞—Ä—é
      const [year, monthNum] = month.split('-').map(Number);
      const lastDayOfMonth = new Date(year, monthNum, 0);
      const today = new Date();
      today.setHours(0, 0, 0, 0);
      lastDayOfMonth.setHours(23, 59, 59, 999);

      if (today > lastDayOfMonth) {
        // –ú–µ—Å—è—Ü –∑–∞–∫–æ–Ω—á–∏–ª—Å—è, –ø—Ä–æ–≤–µ—Ä—è–µ–º –Ω–µ –∑–∞–∫—Ä—ã—Ç –ª–∏ –æ–Ω —É–∂–µ
        const isClosed = await getMonthStatus(month);

        if (!isClosed) {
          console.log(`–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –∑–∞–∫—Ä—ã—Ç–∏–µ –º–µ—Å—è—Ü–∞ ${month} –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è ${user_id}`);

          // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –∞–≤–∞–Ω—Å—ã –ø–µ—Ä–µ–¥ –∑–∞–∫—Ä—ã—Ç–∏–µ–º
          await processMonthClosure(user_id, month);

          // –ó–∞–∫—Ä—ã–≤–∞–µ–º –º–µ—Å—è—Ü
          await setMonthClosed(month, true);
        }
      }
    }
  } catch (error) {
    console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–º –∑–∞–∫—Ä—ã—Ç–∏–∏ –º–µ—Å—è—Ü–µ–≤:', error);
    throw error;
  }
}

/**
 * –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∞–≤–∞–Ω—Å—ã –ø—Ä–∏ –∑–∞–∫—Ä—ã—Ç–∏–∏ –º–µ—Å—è—Ü–∞
 * –ü—Ä–µ–≤—Ä–∞—â–∞–µ—Ç –∞–≤–∞–Ω—Å—ã –≤ –ø–µ—Ä–µ–Ω–æ—Å—ã –Ω–∞ —Å–ª–µ–¥—É—é—â–∏–π –º–µ—Å—è—Ü
 * @param userId - ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
 * @param month - –∑–∞–∫—Ä—ã–≤–∞–µ–º—ã–π –º–µ—Å—è—Ü –≤ —Ñ–æ—Ä–º–∞—Ç–µ YYYY-MM
 */
export async function processMonthClosure(userId: number, month: string): Promise<void> {
  try {
    const earnings = await getEarningsForMonth(userId, month);
    const totalPayouts = await getPayoutsForMonth(userId, month);

    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ –ø–µ—Ä–µ–ø–ª–∞—Ç–∞
    if (totalPayouts <= earnings) {
      console.log(`–ú–µ—Å—è—Ü ${month}: –ø–µ—Ä–µ–ø–ª–∞—Ç—ã –Ω–µ—Ç (${totalPayouts} ‚ÇΩ <= ${earnings} ‚ÇΩ)`);
      return;
    }

    const overpayment = totalPayouts - earnings;
    console.log(`–ú–µ—Å—è—Ü ${month}: –ø–µ—Ä–µ–ø–ª–∞—Ç–∞ ${overpayment} ‚ÇΩ, —Å–æ–∑–¥–∞—ë–º –ø–µ—Ä–µ–Ω–æ—Å –Ω–∞ —Å–ª–µ–¥—É—é—â–∏–π –º–µ—Å—è—Ü`);

    // –í—ã—á–∏—Å–ª—è–µ–º —Å–ª–µ–¥—É—é—â–∏–π –º–µ—Å—è—Ü
    const [year, monthNumber] = month.split('-').map(Number);
    const nextDate = new Date(year, monthNumber, 1); // monthNumber —É–∂–µ 1-–∏–Ω–¥–µ–∫—Å–∏—Ä–æ–≤–∞–Ω
    const nextMonth = `${nextDate.getFullYear()}-${String(nextDate.getMonth() + 1).padStart(2, '0')}`;

    // –°–æ–∑–¥–∞–µ–º –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –¥–ª—è –ø–µ—Ä–µ–Ω–æ—Å–∞
    const monthNames = [
      '—è–Ω–≤–∞—Ä—è', '—Ñ–µ–≤—Ä–∞–ª—è', '–º–∞—Ä—Ç–∞', '–∞–ø—Ä–µ–ª—è', '–º–∞—è', '–∏—é–Ω—è',
      '–∏—é–ª—è', '–∞–≤–≥—É—Å—Ç–∞', '—Å–µ–Ω—Ç—è–±—Ä—è', '–æ–∫—Ç—è–±—Ä—è', '–Ω–æ—è–±—Ä—è', '–¥–µ–∫–∞–±—Ä—è'
    ];
    const fromMonthName = monthNames[monthNumber - 1];
    const comment = `–ü–µ—Ä–µ–Ω–æ—Å —Å ${fromMonthName} ${year}`;

    // –ü–æ–ª—É—á–∞–µ–º –ø–æ—Å–ª–µ–¥–Ω—é—é –¥–∞—Ç—É –º–µ—Å—è—Ü–∞ –¥–ª—è –¥–∞—Ç—ã –ø–µ—Ä–µ–Ω–æ—Å–∞
    const lastDay = new Date(year, monthNumber, 0);
    const payoutDate = `${year}-${String(monthNumber).padStart(2, '0')}-${String(lastDay.getDate()).padStart(2, '0')}`;

    // –°–æ–∑–¥–∞—ë–º –≤—ã–ø–ª–∞—Ç—É-–ø–µ—Ä–µ–Ω–æ—Å –≤ —Å–ª–µ–¥—É—é—â–µ–º –º–µ—Å—è—Ü–µ
    await createPayout({
      user_id: userId,
      month: nextMonth,
      amount: overpayment,
      date: payoutDate,
      comment: comment,
      initiated_by: null,
      initiator_role: 'system',
      method: 'carryover',
      source: 'carryover',
      reversed_at: null,
      is_advance: false // –ü–µ—Ä–µ–Ω–æ—Å –Ω–µ —è–≤–ª—è–µ—Ç—Å—è –∞–≤–∞–Ω—Å–æ–º
    });

    // –ü–æ–º–µ—á–∞–µ–º –≤—Å–µ –∞–≤–∞–Ω—Å—ã —Ç–µ–∫—É—â–µ–≥–æ –º–µ—Å—è—Ü–∞ –∫–∞–∫ –∑–∞–∫—Ä—ã—Ç—ã–µ (—Å–Ω–∏–º–∞–µ–º —Ñ–ª–∞–≥ is_advance)
    await executeQuery(
      `UPDATE payouts SET is_advance = FALSE 
       WHERE user_id = $1 AND month = $2 AND is_advance = TRUE`,
      [userId, month]
    );

    console.log(`–°–æ–∑–¥–∞–Ω –ø–µ—Ä–µ–Ω–æ—Å: ${overpayment} ‚ÇΩ –≤ –º–µ—Å—è—Ü ${nextMonth}`);
  } catch (error) {
    console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ –∑–∞–∫—Ä—ã—Ç–∏—è –º–µ—Å—è—Ü–∞:', error);
    throw error;
  }
}


// –ò—Ç–æ–≥–∏ –∑–∞ –º–µ—Å—è—Ü –ø–æ –≤—Å–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º (–∑–∞—Ä–∞–±–æ—Ç–∞–Ω–æ –ø–æ —Å–º–µ–Ω–∞–º, –≤—ã–ø–ª–∞—á–µ–Ω–æ, –æ—Å—Ç–∞—Ç–æ–∫)
export async function getMonthTotals(month: string): Promise<{ earned: number; paid: number; remaining: number }> {
  try {
    const earnedResult = await executeQuery(
      `SELECT COALESCE(SUM(total), 0) as earned
       FROM shifts 
       WHERE TO_CHAR(DATE_TRUNC('month', date::date), 'YYYY-MM') = $1`,
      [month]
    );

    const paidResult = await executeQuery(
      `SELECT COALESCE(SUM(amount), 0) as paid
       FROM payouts 
       WHERE month = $1 AND reversed_at IS NULL`,
      [month]
    );

    const earned = parseFloat(earnedResult.rows[0]?.earned || '0');
    const paid = parseFloat(paidResult.rows[0]?.paid || '0');
    const remaining = earned - paid;
    return { earned, paid, remaining };
  } catch (error) {
    console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –∏—Ç–æ–≥–æ–≤ –º–µ—Å—è—Ü–∞:', error);
    throw error;
  }
}

// –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –≤—Å–µ—Ö –¥–∞–Ω–Ω—ã—Ö –æ –≤—ã–ø–ª–∞—Ç–∞—Ö –æ–¥–Ω–∏–º –∑–∞–ø—Ä–æ—Å–æ–º
export async function getPayoutsDataOptimized(userId: number): Promise<any[]> {
  try {
    const result = await executeQuery(
      `WITH monthly_earnings AS (
        SELECT 
          TO_CHAR(DATE_TRUNC('month', date::date), 'YYYY-MM') as month,
          SUM(total) as earnings
        FROM shifts 
        WHERE user_id = $1
        GROUP BY month
      ),
      monthly_payouts AS (
        SELECT 
          month,
          -- –í–∫–ª—é—á–∞–µ–º –≤—Å–µ –≤—ã–ø–ª–∞—Ç—ã, –Ω–æ —Å—É–º–º—ã —É—á–∏—Ç—ã–≤–∞–µ–º —Ç–æ–ª—å–∫–æ –¥–ª—è –Ω–µ–æ—Ç–º–µ–Ω–µ–Ω–Ω—ã—Ö
          SUM(CASE WHEN reversed_at IS NULL THEN amount ELSE 0 END) as raw_total_payouts,
          JSON_AGG(
            JSON_BUILD_OBJECT(
              'id', id,
              'amount', amount,
              'date', date,
              'comment', comment,
              'initiated_by', initiated_by,
              'initiator_role', initiator_role,
              'method', method,
              'source', source,
              'reversed_at', reversed_at,
              'reversed_by', reversed_by,
              'reversal_reason', reversal_reason,
              'is_advance', is_advance
            )
            ORDER BY date DESC, created_at DESC, id DESC
          ) as payouts
        FROM payouts 
        WHERE user_id = $1
        GROUP BY month
      )
      SELECT 
        me.month,
        me.earnings,
        -- –†–µ–∞–ª—å–Ω–∞—è —Å—É–º–º–∞ –≤—Å–µ—Ö –≤—ã–ø–ª–∞—Ç
        COALESCE(mp.raw_total_payouts, 0) as total_payouts_real,
        -- –°—É–º–º–∞ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è (–Ω–µ –±–æ–ª—å—à–µ –∑–∞—Ä–∞–±–æ—Ç–∫–∞)
        LEAST(COALESCE(mp.raw_total_payouts, 0), me.earnings) as total_payouts,
        -- –°—É–º–º–∞ –∞–≤–∞–Ω—Å–∞ (–µ—Å–ª–∏ –≤—ã–ø–ª–∞—Ç—ã –ø—Ä–µ–≤—ã—à–∞—é—Ç –∑–∞—Ä–∞–±–æ—Ç–æ–∫)
        GREATEST(0, COALESCE(mp.raw_total_payouts, 0) - me.earnings) as advance_amount,
        -- –û—Å—Ç–∞—Ç–æ–∫ –∫ –≤—ã–ø–ª–∞—Ç–µ (–µ—Å–ª–∏ –∑–∞—Ä–∞–±–æ—Ç–æ–∫ –±–æ–ª—å—à–µ –≤—ã–ø–ª–∞—Ç)
        GREATEST(0, me.earnings - COALESCE(mp.raw_total_payouts, 0)) as remaining,
        CASE 
          WHEN me.earnings > 0 THEN 
            ROUND((LEAST(COALESCE(mp.raw_total_payouts, 0), me.earnings) / me.earnings) * 100)
          ELSE 0 
        END as progress,
        CASE 
          WHEN COALESCE(mp.raw_total_payouts, 0) >= me.earnings THEN 'completed'
          WHEN COALESCE(mp.raw_total_payouts, 0) > 0 THEN 'partial'
          ELSE 'none'
        END as status,
        COALESCE(mp.payouts, '[]'::json) as payouts
      FROM monthly_earnings me
      LEFT JOIN monthly_payouts mp ON me.month = mp.month
      ORDER BY me.month DESC`,
      [userId]
    );
    return result.rows;
  } catch (error) {
    console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –æ –≤—ã–ø–ª–∞—Ç–∞—Ö:', error);
    throw error;
  }
}

export async function getMonthlyReportsForAllMasters(month?: string): Promise<any[]> {
  try {
    if (month) {
      // –ï—Å–ª–∏ —É–∫–∞–∑–∞–Ω –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π –º–µ—Å—è—Ü, –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –¥–∞–Ω–Ω—ã–µ —Ç–æ–ª—å–∫–æ –¥–ª—è —ç—Ç–æ–≥–æ –º–µ—Å—è—Ü–∞
      const query = `
        WITH monthly_earnings AS (
          SELECT 
            s.user_id,
            u.first_name,
            u.last_name,
            u.display_name,
            $1 as month,
            SUM(s.hours) as hours,
            SUM(s.steam_bath) as steam_bath,
            SUM(s.brand_steam) as brand_steam,
            SUM(s.intro_steam) as intro_steam,
            SUM(s.scrubbing) as scrubbing,
            SUM(s.zaparnik) as zaparnik,
            SUM(s.total) as earnings
          FROM shifts s
          JOIN users u ON s.user_id = u.id
          WHERE (u.is_blocked = false OR u.is_blocked IS NULL)
          AND TO_CHAR(DATE_TRUNC('month', s.date::date), 'YYYY-MM') = $1
          GROUP BY s.user_id, u.first_name, u.last_name, u.display_name
        ),
        monthly_payouts AS (
          SELECT 
            p.user_id,
            SUM(CASE WHEN p.reversed_at IS NULL THEN p.amount ELSE 0 END) as raw_total_payouts
          FROM payouts p
          WHERE p.month = $1
          GROUP BY p.user_id
        )
        SELECT 
          me.user_id,
          me.first_name,
          me.last_name,
          me.display_name,
          me.month,
          me.hours,
          me.steam_bath,
          me.brand_steam,
          me.intro_steam,
          me.scrubbing,
          me.zaparnik,
          me.earnings,
          me.earnings,
          COALESCE(mp.raw_total_payouts, 0) as total_payouts,
          GREATEST(0, me.earnings - COALESCE(mp.raw_total_payouts, 0)) as remaining,
          CASE 
            WHEN COALESCE(mp.raw_total_payouts, 0) >= me.earnings THEN 'completed'
            WHEN COALESCE(mp.raw_total_payouts, 0) > 0 THEN 'partial'
            ELSE 'unpaid'
          END as status,
          COALESCE(rp.recent_payouts, '[]'::json) as recent_payouts
        FROM monthly_earnings me
        LEFT JOIN monthly_payouts mp ON me.user_id = mp.user_id
        LEFT JOIN LATERAL (
          SELECT JSON_AGG(
            JSON_BUILD_OBJECT(
              'id', payout_row.id,
              'amount', payout_row.amount,
              'date', payout_row.date,
              'comment', payout_row.comment,
              'initiated_by', payout_row.initiated_by,
              'initiator_role', payout_row.initiator_role,
              'method', payout_row.method,
              'source', payout_row.source,
              'reversed_at', payout_row.reversed_at,
              'reversed_by', payout_row.reversed_by,
              'reversal_reason', payout_row.reversal_reason,
              'is_advance', payout_row.is_advance
            )
            ORDER BY payout_row.date DESC, payout_row.created_at DESC, payout_row.id DESC
          ) as recent_payouts
          FROM (
            SELECT 
              p.id,
              p.amount,
              p.date,
              p.comment,
              p.initiated_by,
              p.initiator_role,
              p.method,
              p.source,
              p.reversed_at,
              p.reversed_by,
              p.reversal_reason,
              p.is_advance,
              p.created_at
            FROM payouts p
            WHERE p.user_id = me.user_id AND p.month = $1
            ORDER BY p.date DESC, p.created_at DESC, p.id DESC
            LIMIT 5
          ) payout_row
        ) rp ON true
        ORDER BY me.earnings DESC
      `;

      const result = await executeQuery(query, [month]);
      return result.rows;
    } else {
      // –ï—Å–ª–∏ –º–µ—Å—è—Ü –Ω–µ —É–∫–∞–∑–∞–Ω, –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è –≤—Å–µ—Ö –º–µ—Å—è—Ü–µ–≤
      const query = `
        WITH monthly_earnings AS (
          SELECT 
            s.user_id,
            u.first_name,
            u.last_name,
            u.display_name,
            TO_CHAR(DATE_TRUNC('month', s.date::date), 'YYYY-MM') as month,
            SUM(s.hours) as hours,
            SUM(s.steam_bath) as steam_bath,
            SUM(s.brand_steam) as brand_steam,
            SUM(s.intro_steam) as intro_steam,
            SUM(s.scrubbing) as scrubbing,
            SUM(s.zaparnik) as zaparnik,
            SUM(s.total) as earnings
          FROM shifts s
          JOIN users u ON s.user_id = u.id
          WHERE u.is_blocked = false OR u.is_blocked IS NULL
          GROUP BY s.user_id, u.first_name, u.last_name, u.display_name, month
        ),
        monthly_payouts AS (
          SELECT 
            p.user_id,
            p.month,
            SUM(CASE WHEN p.reversed_at IS NULL THEN p.amount ELSE 0 END) as raw_total_payouts
          FROM payouts p
          GROUP BY p.user_id, p.month
        )
        SELECT 
          me.user_id,
          me.first_name,
          me.last_name,
          me.display_name,
          me.month,
          me.hours,
          me.steam_bath,
          me.brand_steam,
          me.intro_steam,
          me.scrubbing,
          me.zaparnik,
          me.earnings,
          me.earnings,
          COALESCE(mp.raw_total_payouts, 0) as total_payouts,
          GREATEST(0, me.earnings - COALESCE(mp.raw_total_payouts, 0)) as remaining,
          CASE 
            WHEN COALESCE(mp.raw_total_payouts, 0) >= me.earnings THEN 'completed'
            WHEN COALESCE(mp.raw_total_payouts, 0) > 0 THEN 'partial'
            ELSE 'unpaid'
          END as status,
          COALESCE(rp.recent_payouts, '[]'::json) as recent_payouts
        FROM monthly_earnings me
        LEFT JOIN monthly_payouts mp ON me.user_id = mp.user_id AND me.month = mp.month
        LEFT JOIN LATERAL (
          SELECT JSON_AGG(
            JSON_BUILD_OBJECT(
              'id', payout_row.id,
              'amount', payout_row.amount,
              'date', payout_row.date,
              'comment', payout_row.comment,
              'initiated_by', payout_row.initiated_by,
              'initiator_role', payout_row.initiator_role,
              'method', payout_row.method,
              'source', payout_row.source,
              'reversed_at', payout_row.reversed_at,
              'reversed_by', payout_row.reversed_by,
              'reversal_reason', payout_row.reversal_reason,
              'is_advance', payout_row.is_advance
            )
            ORDER BY payout_row.date DESC, payout_row.created_at DESC, payout_row.id DESC
          ) as recent_payouts
          FROM (
            SELECT 
              p.id,
              p.amount,
              p.date,
              p.comment,
              p.initiated_by,
              p.initiator_role,
              p.method,
              p.source,
              p.reversed_at,
              p.reversed_by,
              p.reversal_reason,
              p.is_advance,
              p.created_at
            FROM payouts p
            WHERE p.user_id = me.user_id AND p.month = me.month
            ORDER BY p.date DESC, p.created_at DESC, p.id DESC
            LIMIT 5
          ) payout_row
        ) rp ON true
        ORDER BY me.month DESC, me.earnings DESC
      `;

      const result = await executeQuery(query, []);
      return result.rows;
    }
  } catch (error) {
    console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –æ—Ç—á–µ—Ç–æ–≤ –ø–æ –º–∞—Å—Ç–µ—Ä–∞–º:', error);
    throw error;
  }
}

export async function getShiftsForUserAndMonth(userId: number, month: string): Promise<Shift[]> {
  try {
    const result = await executeQuery(
      `SELECT * FROM shifts 
       WHERE user_id = $1 
       AND TO_CHAR(DATE_TRUNC('month', date::date), 'YYYY-MM') = $2
       ORDER BY date DESC`,
      [userId, month]
    );
    return result.rows;
  } catch (error) {
    console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ —Å–º–µ–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∑–∞ –º–µ—Å—è—Ü:', error);
    throw error;
  }
}

// –ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ –º–µ—Å—è—Ü—ã, –≤ –∫–æ—Ç–æ—Ä—ã—Ö –µ—Å—Ç—å —Å–º–µ–Ω—ã
export async function getMonthsWithShiftsData(): Promise<string[]> {
  try {
    const result = await executeQuery(
      `SELECT DISTINCT TO_CHAR(DATE_TRUNC('month', date::date), 'YYYY-MM') as month
       FROM shifts 
       ORDER BY month DESC`,
      []
    );
    return result.rows.map(row => row.month);
  } catch (error) {
    console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –º–µ—Å—è—Ü–µ–≤ —Å–æ —Å–º–µ–Ω–∞–º–∏:', error);
    throw error;
  }
}

// –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –ø–µ—Ä–µ–Ω–æ—Å–∞–º–∏ –ø–µ—Ä–µ–ø–ª–∞—Ç
export async function createCarryoverPayout(carryover: Omit<Carryover, 'id' | 'created_at'>, payoutDate: string): Promise<Payout> {
  try {
    // –°–æ–∑–¥–∞–µ–º –∑–∞–ø–∏—Å—å –≤ —Ç–∞–±–ª–∏—Ü–µ carryovers
    await executeQuery(
      `INSERT INTO carryovers (user_id, from_month, to_month, amount) 
       VALUES ($1, $2, $3, $4) 
       ON CONFLICT (user_id, from_month, to_month) 
       DO UPDATE SET amount = carryovers.amount + EXCLUDED.amount, created_at = CURRENT_TIMESTAMP`,
      [carryover.user_id, carryover.from_month, carryover.to_month, carryover.amount]
    );

    // –°–æ–∑–¥–∞–µ–º –≤—ã–ø–ª–∞—Ç—É –≤ —Å–ª–µ–¥—É—é—â–µ–º –º–µ—Å—è—Ü–µ
    const monthNames = [
      '—è–Ω–≤–∞—Ä—è', '—Ñ–µ–≤—Ä–∞–ª—è', '–º–∞—Ä—Ç–∞', '–∞–ø—Ä–µ–ª—è', '–º–∞—è', '–∏—é–Ω—è',
      '–∏—é–ª—è', '–∞–≤–≥—É—Å—Ç–∞', '—Å–µ–Ω—Ç—è–±—Ä—è', '–æ–∫—Ç—è–±—Ä—è', '–Ω–æ—è–±—Ä—è', '–¥–µ–∫–∞–±—Ä—è'
    ];

    const [year, month] = carryover.from_month.split('-');
    const monthIndex = parseInt(month) - 1;
    const monthName = monthNames[monthIndex];
    const comment = `–ü–µ—Ä–µ–Ω–æ—Å —Å ${monthName} ${year}`;

    const payout = await createPayout({
      user_id: carryover.user_id,
      month: carryover.to_month,
      amount: carryover.amount,
      date: payoutDate,
      comment: comment,
      initiated_by: null,
      initiator_role: 'system',
      method: 'carryover',
      source: 'carryover',
      reversed_at: null
    });

    return payout;
  } catch (error) {
    console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –ø–µ—Ä–µ–Ω–æ—Å–∞:', error);
    throw error;
  }
}

export async function getCarryoversToMonth(userId: number, month: string): Promise<Carryover[]> {
  try {
    const result = await executeQuery(
      'SELECT * FROM carryovers WHERE user_id = $1 AND to_month = $2 ORDER BY from_month',
      [userId, month]
    );
    return result.rows as Carryover[];
  } catch (error) {
    console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –ø–µ—Ä–µ–Ω–æ—Å–æ–≤ –≤ –º–µ—Å—è—Ü:', error);
    throw error;
  }
}

export async function getCarryoversFromMonth(userId: number, month: string): Promise<Carryover[]> {
  try {
    const result = await executeQuery(
      'SELECT * FROM carryovers WHERE user_id = $1 AND from_month = $2 ORDER BY to_month',
      [userId, month]
    );
    return result.rows as Carryover[];
  } catch (error) {
    console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –ø–µ—Ä–µ–Ω–æ—Å–æ–≤ –∏–∑ –º–µ—Å—è—Ü–∞:', error);
    throw error;
  }
}

export async function deleteCarryover(userId: number, fromMonth: string, toMonth: string): Promise<boolean> {
  try {
    const result = await executeQuery(
      'DELETE FROM carryovers WHERE user_id = $1 AND from_month = $2 AND to_month = $3',
      [userId, fromMonth, toMonth]
    );
    return (result.rowCount || 0) > 0;
  } catch (error) {
    console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –ø–µ—Ä–µ–Ω–æ—Å–∞:', error);
    throw error;
  }
}

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Å–ª–µ–¥—É—é—â–µ–≥–æ –º–µ—Å—è—Ü–∞
export function getNextMonth(month: string): string {
  const [year, monthNum] = month.split('-').map(Number);
  const nextDate = new Date(year, monthNum, 1); // monthNum —É–∂–µ 0-based –ø–æ—Å–ª–µ split
  return `${nextDate.getFullYear()}-${String(nextDate.getMonth() + 1).padStart(2, '0')}`;
}

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –ø–µ—Ä–µ–Ω–æ—Å–∞ –ø–µ—Ä–µ–ø–ª–∞—Ç—ã –Ω–∞ —Å–ª–µ–¥—É—é—â–∏–π –º–µ—Å—è—Ü (–∫–∞—Å–∫–∞–¥–Ω–æ)
export async function processOverpaymentCarryover(userId: number, month: string, payoutDate: string): Promise<void> {
  try {
    await processOverpaymentCarryoverOptimized(userId, month, payoutDate);
  } catch (error) {
    console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ –ø–µ—Ä–µ–Ω–æ—Å–∞ –ø–µ—Ä–µ–ø–ª–∞—Ç—ã:', error);
    throw error;
  }
}

// –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∫–∞—Å–∫–∞–¥–Ω—ã—Ö –ø–µ—Ä–µ–Ω–æ—Å–æ–≤
async function processOverpaymentCarryoverOptimized(
  userId: number,
  startMonth: string,
  payoutDate: string
): Promise<void> {
  let currentMonth = startMonth;
  let remainingOverpayment = 0;
  const maxIterations = 12; // –ú–∞–∫—Å–∏–º—É–º 12 –º–µ—Å—è—Ü–µ–≤ –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –±–µ—Å–∫–æ–Ω–µ—á–Ω–æ–≥–æ —Ü–∏–∫–ª–∞
  let iteration = 0;

  // –°–Ω–∞—á–∞–ª–∞ –≤—ã—á–∏—Å–ª—è–µ–º –Ω–∞—á–∞–ª—å–Ω—É—é –ø–µ—Ä–µ–ø–ª–∞—Ç—É
  const initialEarnings = await getEarningsForMonth(userId, currentMonth);
  const initialPayouts = await getPayoutsForMonth(userId, currentMonth);

  if (initialPayouts <= initialEarnings) {
    console.log(`–ú–µ—Å—è—Ü ${currentMonth}: –ø–µ—Ä–µ–ø–ª–∞—Ç—ã –Ω–µ—Ç (${initialPayouts} ‚ÇΩ <= ${initialEarnings} ‚ÇΩ)`);
    return;
  }

  remainingOverpayment = initialPayouts - initialEarnings;
  console.log(`–ù–∞—á–∞–ª—å–Ω–∞—è –ø–µ—Ä–µ–ø–ª–∞—Ç–∞ –≤ ${currentMonth}: ${remainingOverpayment} ‚ÇΩ`);

  // –°–æ–∑–¥–∞–µ–º –º–∞—Å—Å–∏–≤ –ø–µ—Ä–µ–Ω–æ—Å–æ–≤ –¥–ª—è batch-–æ–±—Ä–∞–±–æ—Ç–∫–∏
  const carryoversToCreate = [];

  while (remainingOverpayment > 0 && iteration < maxIterations) {
    iteration++;
    const nextMonth = getNextMonth(currentMonth);

    // –ü–æ–ª—É—á–∞–µ–º –∑–∞—Ä–∞–±–æ—Ç–æ–∫ —Å–ª–µ–¥—É—é—â–µ–≥–æ –º–µ—Å—è—Ü–∞
    const nextMonthEarnings = await getEarningsForMonth(userId, nextMonth);

    console.log(`–ú–µ—Å—è—Ü ${nextMonth}: –∑–∞—Ä–∞–±–æ—Ç–æ–∫ ${nextMonthEarnings} ‚ÇΩ, –Ω—É–∂–Ω–æ –ø–µ—Ä–µ–Ω–µ—Å—Ç–∏ ${remainingOverpayment} ‚ÇΩ`);

    // –°–æ–∑–¥–∞–µ–º –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –¥–ª—è –ø–µ—Ä–µ–Ω–æ—Å–∞
    const monthNames = [
      '—è–Ω–≤–∞—Ä—å', '—Ñ–µ–≤—Ä–∞–ª—å', '–º–∞—Ä—Ç', '–∞–ø—Ä–µ–ª—å', '–º–∞–π', '–∏—é–Ω—å',
      '–∏—é–ª—å', '–∞–≤–≥—É—Å—Ç', '—Å–µ–Ω—Ç—è–±—Ä—å', '–æ–∫—Ç—è–±—Ä—å', '–Ω–æ—è–±—Ä—å', '–¥–µ–∫–∞–±—Ä—å'
    ];

    const [currentYear, currentMonthNum] = currentMonth.split('-');
    const currentMonthIndex = parseInt(currentMonthNum) - 1;
    const currentMonthName = monthNames[currentMonthIndex];

    const carryoverComment = `–ü–µ—Ä–µ–Ω–æ—Å —Å ${currentMonthName} ${currentYear}`;

    // –î–æ–±–∞–≤–ª—è–µ–º –ø–µ—Ä–µ–Ω–æ—Å –≤ —Å–ø–∏—Å–æ–∫ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è
    carryoversToCreate.push({
      user_id: userId,
      month: nextMonth,
      amount: remainingOverpayment,
      date: payoutDate,
      comment: carryoverComment,
      initiated_by: null,
      initiator_role: 'system' as const,
      method: 'carryover',
      source: 'carryover',
      reversed_at: null
    });

    // –ï—Å–ª–∏ –∑–∞—Ä–∞–±–æ—Ç–æ–∫ —Å–ª–µ–¥—É—é—â–µ–≥–æ –º–µ—Å—è—Ü–∞ –ø–æ–∫—Ä—ã–≤–∞–µ—Ç –≤—Å—é –ø–µ—Ä–µ–ø–ª–∞—Ç—É
    if (nextMonthEarnings >= remainingOverpayment) {
      console.log(`–ü–µ—Ä–µ–ø–ª–∞—Ç–∞ ${remainingOverpayment} ‚ÇΩ –ø–æ–ª–Ω–æ—Å—Ç—å—é –ø–æ–∫—Ä—ã–≤–∞–µ—Ç—Å—è –∑–∞—Ä–∞–±–æ—Ç–∫–æ–º ${nextMonthEarnings} ‚ÇΩ –≤ ${nextMonth}`);
      remainingOverpayment = 0;
    } else {
      // –ï—Å–ª–∏ –∑–∞—Ä–∞–±–æ—Ç–æ–∫ –Ω–µ –ø–æ–∫—Ä—ã–≤–∞–µ—Ç –ø–µ—Ä–µ–ø–ª–∞—Ç—É, –ø–µ—Ä–µ–Ω–æ—Å–∏–º –æ—Å—Ç–∞—Ç–æ–∫ –¥–∞–ª—å—à–µ
      remainingOverpayment = remainingOverpayment - nextMonthEarnings;
      console.log(`–ó–∞—Ä–∞–±–æ—Ç–æ–∫ ${nextMonthEarnings} ‚ÇΩ –≤ ${nextMonth} –Ω–µ –ø–æ–∫—Ä—ã–≤–∞–µ—Ç –ø–µ—Ä–µ–ø–ª–∞—Ç—É, –æ—Å—Ç–∞–µ—Ç—Å—è ${remainingOverpayment} ‚ÇΩ`);
      currentMonth = nextMonth;
    }
  }

  // –°–æ–∑–¥–∞–µ–º –≤—Å–µ –ø–µ—Ä–µ–Ω–æ—Å—ã
  for (const carryover of carryoversToCreate) {
    await createPayout(carryover);
    console.log(`–°–æ–∑–¥–∞–Ω –ø–µ—Ä–µ–Ω–æ—Å: ${carryover.amount} ‚ÇΩ –≤ ${carryover.month}`);
  }

  if (iteration >= maxIterations) {
    console.warn(`–î–æ—Å—Ç–∏–≥–Ω—É—Ç–æ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏—Ç–µ—Ä–∞—Ü–∏–π (${maxIterations}) –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ –ø–µ—Ä–µ–Ω–æ—Å–æ–≤`);
  }
}
</file>

</files>
